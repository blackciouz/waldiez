/**
 * SPDX-License-Identifier: Apache-2.0
 * Copyright 2024 - 2026 Waldiez & contributors
 */

!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports,require("strip-ansi"),require("nanoid"),require("jszip"),require("react/jsx-runtime"),require("react"),require("@xyflow/react"),require("react-error-boundary"),require("react-hotkeys-hook"),require("@monaco-editor/react"),require("framer-motion"),require("react-dom"),require("zustand/shallow"),require("zustand/traditional"),require("microdiff"),require("zundo"),require("zustand"),require("react-icons/fa"),require("react-select"),require("react-icons/fa6"),require("rehype-highlight"),require("remark-gfm"),require("react-markdown"),require("react-icons/md"),require("react-icons/gi"),require("react-icons/go"),require("react-icons/ai")):"function"==typeof define&&define.amd?define(["exports","strip-ansi","nanoid","jszip","react/jsx-runtime","react","@xyflow/react","react-error-boundary","react-hotkeys-hook","@monaco-editor/react","framer-motion","react-dom","zustand/shallow","zustand/traditional","microdiff","zundo","zustand","react-icons/fa","react-select","react-icons/fa6","rehype-highlight","remark-gfm","react-markdown","react-icons/md","react-icons/gi","react-icons/go","react-icons/ai"],t):t((e="undefined"!=typeof globalThis?globalThis:e||self)["@waldiez"]={},e.stripAnsi,e.nanoid,e.jszip,e.jsxRuntime,e.react,e.XYFlowReact,e.reactErrorBoundary,e.reactHotkeysHook,e.react$1,e.framerMotion,e.reactDom,e.zustandShallow,e.zustandTraditional,e.microdiff,e.zundo,e.zustand,e.reactIconsFa,e.reactSelect,e.reactIconsFa6,e.rehypeHighlight,e.remarkGfm,e.reactMarkdown,e.reactIconsMd,e.reactIconsGi,e.reactIconsGo,e.reactIconsAi)}(this,(function(e,t,a,n,s,o,i,r,l,d,c,u,g,m,p,h,f,y,b,v,x,C,w,k,j,A,N){"use strict";var T=Object.defineProperty,S=(e,t,a)=>((e,t,a)=>t in e?T(e,t,{enumerable:!0,configurable:!0,writable:!0,value:a}):e[t]=a)(e,"symbol"!=typeof t?t+"":t,a);function M(e){const t=Object.create(null,{[Symbol.toStringTag]:{value:"Module"}});if(e)for(const a in e)if("default"!==a){const n=Object.getOwnPropertyDescriptor(e,a);Object.defineProperty(t,a,n.get?n:{enumerable:!0,get:()=>e[a]})}return t.default=e,Object.freeze(t)}const I=M(o);class E{constructor(e={humanInputMode:"NEVER",systemMessage:null,codeExecutionConfig:!1,agentDefaultAutoReply:null,maxConsecutiveAutoReply:null,termination:{type:"none",keywords:[],criterion:null,methodContent:null},modelIds:[],tools:[],parentId:void 0,nestedChats:[{messages:[],triggeredBy:[],condition:{conditionType:"string_llm",prompt:""},available:{type:"none",value:""}}],contextVariables:{},updateAgentStateBeforeReply:[],afterWork:null,handoffs:[]}){S(this,"systemMessage"),S(this,"humanInputMode"),S(this,"codeExecutionConfig"),S(this,"agentDefaultAutoReply"),S(this,"maxConsecutiveAutoReply"),S(this,"termination"),S(this,"modelIds"),S(this,"tools"),S(this,"parentId"),S(this,"nestedChats"),S(this,"contextVariables"),S(this,"updateAgentStateBeforeReply"),S(this,"afterWork"),S(this,"handoffs"),this.systemMessage=e.systemMessage,this.humanInputMode=e.humanInputMode,this.codeExecutionConfig=e.codeExecutionConfig,this.agentDefaultAutoReply=e.agentDefaultAutoReply,this.maxConsecutiveAutoReply=e.maxConsecutiveAutoReply,this.termination=e.termination,this.modelIds=e.modelIds,this.tools=e.tools,this.parentId=e.parentId,this.nestedChats=e.nestedChats,this.contextVariables=e.contextVariables,this.updateAgentStateBeforeReply=e.updateAgentStateBeforeReply,this.afterWork=e.afterWork||null,this.handoffs=e.handoffs||[]}}class D{static isValidInputRequest(e){return e&&"object"==typeof e&&"input_request"===e.type&&"string"==typeof e.request_id&&"string"==typeof e.prompt}static isValidPrintMessage(e){return!(!e||"object"!=typeof e)&&("string"==typeof e.type&&"print"===e.type&&(!("data"in e)||"string"!=typeof e.data&&"object"!=typeof e.data?!(!e.content||"object"!=typeof e.content)&&(!!e.content.data&&("string"==typeof e.content.data||Array.isArray(e.content.data)||"object"==typeof e.content.data)):(e.content={data:e.data},!0)))}static isValidTextMessage(e){return e&&"object"==typeof e&&"text"===e.type&&e.content&&"object"==typeof e.content&&void 0!==e.content.content&&"string"==typeof e.content.sender&&"string"==typeof e.content.recipient||Array.isArray(e.content)&&e.content.every((e=>"string"==typeof e||"object"==typeof e&&null!==e&&"type"in e&&"text"===e.type&&"text"in e&&"string"==typeof e.text))}static isValidTerminationMessage(e){return e&&"object"==typeof e&&"termination"===e.type&&e.content&&"object"==typeof e.content&&"string"==typeof e.content.termination_reason||e.termination_reason&&"string"==typeof e.termination_reason}static isValidGroupChatRun(e){return e&&"object"==typeof e&&"group_chat_run_chat"===e.type&&e.content&&"object"==typeof e.content&&"string"==typeof e.content.uuid&&"string"==typeof e.content.speaker}static isValidSpeakerSelection(e){return e&&"object"==typeof e&&("select_speaker"===e.type||"select_speaker_invalid_input"===e.type)&&e.content&&"object"==typeof e.content&&"string"==typeof e.content.uuid&&Array.isArray(e.content.agents)&&e.content.agents.every((e=>"string"==typeof e))}static isValidCodeExecutionReply(e){return e&&"object"==typeof e&&"generate_code_execution_reply"===e.type&&e.content&&"object"==typeof e.content&&"string"==typeof e.content.uuid&&"string"==typeof e.content.sender&&"string"==typeof e.content.recipient}static isValidParticipantsData(e){if(e&&"object"==typeof e&&Array.isArray(e.participants)&&e.participants.length>0&&e.participants.every((e=>e&&"string"==typeof e.name)))return!0;if(e&&"string"==typeof e)try{const t=JSON.parse(e);return D.isValidParticipantsData(t)}catch{return!1}return!1}}const R={DEFAULT_PROMPT:"Enter your message to start the conversation:",GENERIC_PROMPTS:[">","> "],WORKFLOW_END_MARKERS:["<Waldiez> - Workflow finished","<Waldiez> - Workflow stopped by user","<Waldiez> - Workflow execution failed:"],PARTICIPANTS_KEY:"participants",SYSTEM_MESSAGES:{GROUP_CHAT_RUN:"Group chat run",CODE_EXECUTION_REPLY:"Generate code execution reply",SPEAKER_SELECTION_HEADER:"## Select a speaker",SPEAKER_SELECTION_PROMPT:"Please select a speaker from the following list:",SPEAKER_SELECTION_NOTE:"**Note:** You can select a speaker by entering the corresponding number."}};class P{static isPasswordPrompt(e){return!!e.password&&("boolean"==typeof e.password?e.password:"string"==typeof e.password&&"true"===e.password.toLowerCase())}static normalizePrompt(e){return R.GENERIC_PROMPTS.includes(e)?R.DEFAULT_PROMPT:e}static generateMessageId(e){return e.id||e.uuid||a.nanoid()}static generateTimestamp(e){return e.timestamp||(new Date).toISOString()}static replaceImageUrls(e,t){var a;const n=/<img\s+(?!.*src=)([^"'>\s]+)\s*\/?>/g,s=e=>{const a=e.match(n);if(a&&1===a.length){return{type:"image_url",image_url:{url:a[0].replace(n,`<img src="${t}" />`),alt:"Image"}}}return null},o=e=>({...e,image_url:{...e.image_url,url:t}});if(Array.isArray(e))return e.map((e=>{var t;if("string"==typeof e){const t=s(e);return t||{type:"text",text:e}}if("object"!=typeof e||null===e||!("type"in e))return null;if("image_url"===e.type&&(null==(t=e.image_url)?void 0:t.url))return o(e);if("text"===e.type&&e.text){return s(e.text)||e}return e})).filter(Boolean);if("object"==typeof e&&null!==e&&"type"in e){if("image_url"===e.type&&"image_url"in e&&e.image_url&&"object"==typeof e.image_url&&"url"in e.image_url&&(null==(a=e.image_url)?void 0:a.url))return o(e);if("text"===e.type&&"text"in e&&"string"==typeof e.text){return s(e.text)||e}}if("string"==typeof e){const t=s(e);return t||[{type:"text",text:e}]}return e}static normalizeContent(e,t){var a;if("string"==typeof e){if(t){const a=/<img\s+(?!.*src=)([^"'>\s]+)\s*\/?>/g,n=e.match(a);if(n&&1===n.length){return[{type:"image_url",image_url:{url:n[0].replace(a,`<img src="${t}" />`),alt:"Image"}}]}}return[{type:"text",text:e}]}if(Array.isArray(e))return e.map((e=>{const a=P.normalizeContent(e,t);return Array.isArray(a)&&1===a.length?a[0]:a}));if("object"==typeof e&&null!==e&&"type"in e){if("text"===e.type&&"string"==typeof e.text)return[{type:"text",text:e.text}];if("image_url"===e.type&&(null==(a=e.image_url)?void 0:a.url))return[{type:"image_url",image_url:{url:e.image_url.url,alt:e.image_url.alt||"Image"}}]}return[e]}static generateSpeakerSelectionMarkdown(e){const t=e.map(((e,t)=>`- [${t+1}] ${e}`)).join("\n");return[R.SYSTEM_MESSAGES.SPEAKER_SELECTION_HEADER,"",R.SYSTEM_MESSAGES.SPEAKER_SELECTION_PROMPT,"",t,"",R.SYSTEM_MESSAGES.SPEAKER_SELECTION_NOTE].join("\n")}}class O{canHandle(e){return"tool_call"===e}static isValidToolCall(e){return e&&"object"==typeof e&&"tool_call"===e.type&&e.content&&"object"==typeof e.content}static extractToolFunctionNames(e){return e.content.tool_calls&&Array.isArray(e.content.tool_calls)?e.content.tool_calls.filter((e=>e.function&&"string"==typeof e.function.name)).map((e=>e.function.name)):[]}handle(e){if(!O.isValidToolCall(e))return;let t="Tool call";const n=O.extractToolFunctionNames(e);n.length>0&&(t+=`: ${n.join(", ")}`);return{message:{id:e.content.uuid??a.nanoid(),timestamp:(new Date).toISOString(),type:"system",content:[{type:"text",text:t}],sender:e.content.sender,recipient:e.content.recipient}}}}const L=class e{static process(a,n,s){const o=t(a.replace("\n","")).trim(),i=e.parseMessage(o);if(!i)return;const r=e.findHandler(i.type);if(!r)return;const l={requestId:n,imageUrl:s};return r.handle(i,l)}static parseMessage(e){try{return JSON.parse(e)}catch{return null}}static findHandler(e){return this.handlers.find((t=>t.canHandle(e)))}};S(L,"handlers",[new class{canHandle(e){return"input_request"===e}handle(e,t){if(!D.isValidInputRequest(e))return;const a=P.normalizePrompt(e.prompt);return{message:{id:e.request_id,timestamp:P.generateTimestamp(e),request_id:t.requestId||e.request_id,type:"input_request",content:[{type:"text",text:a}],prompt:a,password:P.isPasswordPrompt(e)},requestId:e.request_id}}},new class{canHandle(e){return"print"===e}isEndOfWorkflow(e){if("string"==typeof e)return R.WORKFLOW_END_MARKERS.some((t=>e.includes(t)));if("object"!=typeof e&&!e.content&&!e.data)return!1;const t="data"in e?e.data:e.content,a="string"==typeof t?t:JSON.stringify(t);return R.WORKFLOW_END_MARKERS.some((e=>a.includes(e)))}handle(e){if(!D.isValidPrintMessage(e))return this.isEndOfWorkflow(e)?{isWorkflowEnd:!0}:void 0;if(this.isEndOfWorkflow(e.content))return{isWorkflowEnd:!0};const t=e.content.data;return"string"==typeof t&&t.includes(R.PARTICIPANTS_KEY)||"object"==typeof t&&null!==t?this.extractParticipants(t):void 0}extractParticipants(e){try{const t="string"==typeof e?JSON.parse(e):e;if(D.isValidParticipantsData(t)){if("string"==typeof t){const e=JSON.parse(t);return this.extractParticipants(e)}const e=t.participants.map((e=>e.name)).filter(Boolean);return{isWorkflowEnd:!1,participants:{all:e,users:t.participants.filter((e=>{var t;return"ALWAYS"===(null==(t=e.humanInputMode)?void 0:t.toUpperCase())})).map((e=>e.name)).filter(Boolean)}}}}catch(t){}}},new class{canHandle(e){return"text"===e}handle(e,t){if(!D.isValidTextMessage(e))return;let a=P.normalizeContent(e.content.content,t.imageUrl);t.imageUrl&&(a=P.replaceImageUrls(a,t.imageUrl));return{message:{id:P.generateMessageId(e),timestamp:P.generateTimestamp(e),type:e.type,content:a,sender:e.content.sender,recipient:e.content.recipient},requestId:null}}},new class{canHandle(e){return"termination"===e}handle(e){if(!D.isValidTerminationMessage(e))return;return{message:{id:a.nanoid(),timestamp:(new Date).toISOString(),type:"system",content:[{type:"text",text:e.content.termination_reason}]}}}},new class{canHandle(e){return"group_chat_run_chat"===e}handle(e){if(!D.isValidGroupChatRun(e))return;return{message:{id:e.content.uuid,timestamp:(new Date).toISOString(),type:"system",content:[{type:"text",text:R.SYSTEM_MESSAGES.GROUP_CHAT_RUN}],sender:e.content.speaker}}}},new class{canHandle(e){return"select_speaker"===e||"select_speaker_invalid_input"===e}handle(e){if(!D.isValidSpeakerSelection(e))return;return{message:{id:e.content.uuid,timestamp:(new Date).toISOString(),type:"system",content:[{type:"text",text:P.generateSpeakerSelectionMarkdown(e.content.agents)}]}}}},new class{canHandle(e){return"generate_code_execution_reply"===e}handle(e){if(!D.isValidCodeExecutionReply(e))return;return{message:{id:a.nanoid(),timestamp:(new Date).toISOString(),type:"system",content:[{type:"text",text:R.SYSTEM_MESSAGES.CODE_EXECUTION_REPLY}],sender:e.content.sender,recipient:e.content.recipient}}}},new O,new class{canHandle(e){return"termination_and_human_reply_no_input"===e}handle(e){if(!e||"object"!=typeof e||"termination_and_human_reply_no_input"!==e.type)return;return{message:{id:e.content.uuid,timestamp:(new Date).toISOString(),type:"system",content:[{type:"text",text:"Termination and human reply without input"}],sender:e.content.sender,recipient:e.content.recipient}}}},new class{canHandle(e){return"using_auto_reply"===e}handle(e){if(!e||"object"!=typeof e||"using_auto_reply"!==e.type)return;return{message:{id:e.content.uuid,timestamp:(new Date).toISOString(),type:"system",content:[{type:"text",text:"Using auto reply"}],sender:e.content.sender,recipient:e.content.recipient}}}}]);let z=L;const F=()=>{if(window.crypto&&window.crypto.subtle)return window.crypto;if(globalThis.crypto&&globalThis.crypto.subtle)return globalThis.crypto;throw new Error("Web Crypto API not supported in this browser. Please use a modern browser with HTTPS.")},U=async e=>{try{const t=F(),a=(new TextEncoder).encode(e),n=await t.subtle.digest("SHA-256",a);return Array.from(new Uint8Array(n)).map((e=>e.toString(16).padStart(2,"0"))).join("")}catch(t){throw new Error("Failed to compute SHA-256 hash. Ensure you are using a supported environment.")}},q=async(e,t,a="")=>{try{const n=F(),s="string"==typeof e?(new TextEncoder).encode(e):e,o=(new TextEncoder).encode(t),i=await n.subtle.importKey("raw",s,{name:"HMAC",hash:"SHA-256"},!1,["sign"]),r=await n.subtle.sign("HMAC",i,o);return"hex"===a?Array.from(new Uint8Array(r)).map((e=>e.toString(16).padStart(2,"0"))).join(""):new Uint8Array(r)}catch(n){throw new Error(`Error computing HMAC SHA-256: ${n instanceof Error?n.message:String(n)}`)}},B=e=>{let t=".waldiez";return"flow"!==e&&(t+=e.charAt(0).toUpperCase()+e.slice(1)),(()=>{if("userAgentData"in navigator&&"object"==typeof navigator.userAgentData){const e=navigator.userAgentData;if(e&&"platform"in e&&"string"==typeof e.platform){const t=e.platform.toLowerCase();return t.includes("mac")||t.includes("ios")}}const e=navigator.userAgent;return/Macintosh|Mac OS X|iPhone|iPad|iPod/i.test(e)})()&&(t+=".zip"),t},H=(e,t)=>{const a=URL.createObjectURL(e),n=document.createElement("a");n.href=a,n.download=t,n.click(),URL.revokeObjectURL(a)},W=async(e,t,a,s=()=>{})=>{const o=a();if(o){const a=JSON.stringify(o,null,2),i=((e,t)=>{const a=B(t);let n=e||"flow";return n.length<3&&(n="flow"),n.length>100&&(n=n.slice(0,100)),`${n}${a}`})(e,t);if(i.endsWith(".zip"))await(async(e,t,a)=>{try{const a=e.replace(/\.zip$/,""),s=new n;s.file(a,t);const o=await s.generateAsync({type:"blob"});H(o,e)}catch{a()}})(i,a,s);else{const e=new Blob([a],{type:"application/json; charset=utf-8"});H(e,i)}}else s()},V=()=>`${Date.now()}${a.nanoid()}`,G=(e,t,a)=>{var n;const s=null==(n=e.target.files)?void 0:n[0];if(s){const e=new FileReader;e.onload=()=>{const n=t();if(n){const t=e.result;try{const e=JSON.parse(t);a(n,e)}catch(s){}}},e.readAsText(s)}},K=(e,t=!1)=>{let a=document.getElementById(`rf-root-${e}`);return!a&&t&&(a=document.body),a},Q=e=>e.charAt(0).toUpperCase()+e.slice(1).toLowerCase();class Z{constructor(e){S(this,"id"),S(this,"type","agent"),S(this,"agentType"),S(this,"name"),S(this,"description"),S(this,"tags"),S(this,"requirements"),S(this,"createdAt"),S(this,"updatedAt"),S(this,"data"),S(this,"rest"),this.id=e.id,this.agentType=e.agentType,this.name=e.name,this.description=e.description,this.tags=e.tags,this.requirements=e.requirements,this.createdAt=e.createdAt,this.updatedAt=e.updatedAt,this.data=e.data,this.rest=e.rest}static create(e){let t="",a="";"group_manager"===e?(t="Manager",a="The group manager agent"):(t=Q(e.replace("_proxy","").replace("_"," ")),a=`A new ${t} agent`);const n=new Z({id:`wa-${V()}`,agentType:e,name:t,description:a,tags:[],requirements:[],createdAt:(new Date).toISOString(),updatedAt:(new Date).toISOString(),data:new E});return X(n,e),n}}const X=(e,t)=>{e.data.humanInputMode="NEVER",["user_proxy","rag_user_proxy"].includes(t)&&(e.data.humanInputMode="ALWAYS","rag_user_proxy"===t&&J(e.data)),"reasoning"===t&&Y(e.data),"captain"===t&&$(e.data),"group_manager"===t&&_(e.data)},J=e=>{e.retrieveConfig={task:"default",vectorDb:"chroma",dbConfig:{model:"all-MiniLM-L6-v2",useMemory:!1,useLocalStorage:!1,localStoragePath:null,connectionUrl:null,waitUntilIndexReady:null,waitUntilDocumentReady:null,metadata:null},docsPath:[],newDocs:!0,model:null,chunkTokenSize:null,contextMaxTokens:null,chunkMode:"multi_lines",mustBreakAtEmptyLine:!0,useCustomEmbedding:!1,embeddingFunction:null,customizedPrompt:null,customizedAnswerPrefix:null,updateContext:!0,collectionName:"autogen-docs",getOrCreate:!0,overwrite:!1,useCustomTokenCount:!1,customTokenCountFunction:null,useCustomTextSplit:!1,customTextSplitFunction:null,customTextTypes:[],recursive:!0,distanceThreshold:-1,nResults:null}},Y=e=>{e.verbose=!0,e.reasonConfig={method:"beam_search",maxDepth:3,forestSize:1,ratingScale:10,beamSize:3,answerApproach:"pool",nsim:3,explorationConstant:1.41}},$=e=>{e.agentLib=[],e.toolLib=null,e.maxRound=10,e.maxTurns=5},_=e=>{e.groupName="Group",e.maxRound=20,e.adminName=null,e.contextVariables={},e.enableClearHistory=!1,e.sendIntroductions=!1,e.initialAgentId=void 0,e.speakers={selectionMethod:"auto",selectionCustomMethod:"",maxRetriesForSelecting:null,selectionMode:"repeat",allowRepeat:!0,allowedOrDisallowedTransitions:{},transitionsType:"allowed"}};class ee extends Z{constructor(e){super(e),S(this,"data"),S(this,"agentType","assistant"),this.agentType="assistant",this.data=e.data,this.rest=e.rest||{}}}class te extends E{constructor(e={humanInputMode:"NEVER",systemMessage:null,codeExecutionConfig:!1,agentDefaultAutoReply:null,maxConsecutiveAutoReply:null,termination:{type:"none",keywords:[],criterion:null,methodContent:null},modelIds:[],tools:[],parentId:void 0,nestedChats:[{messages:[],triggeredBy:[],condition:{conditionType:"string_llm",prompt:""},available:{type:"none",value:""}}],contextVariables:{},updateAgentStateBeforeReply:[],afterWork:null,handoffs:[],isMultimodal:!1}){super(e),S(this,"isMultimodal"),this.isMultimodal=e.isMultimodal}}class ae extends Z{constructor(e){super(e),S(this,"data"),S(this,"agentType","captain"),this.data=e.data,this.agentType="captain",this.rest=e.rest||{}}}class ne extends E{constructor(e={humanInputMode:"NEVER",systemMessage:null,codeExecutionConfig:!1,agentDefaultAutoReply:null,maxConsecutiveAutoReply:null,termination:{type:"none",keywords:[],criterion:null,methodContent:null},modelIds:[],tools:[],parentId:void 0,nestedChats:[{messages:[],triggeredBy:[],condition:{conditionType:"string_llm",prompt:""},available:{type:"none",value:""}}],contextVariables:{},updateAgentStateBeforeReply:[],handoffs:[],afterWork:null,agentLib:[],toolLib:null,maxRound:10,maxTurns:5}){super(e),S(this,"agentLib"),S(this,"toolLib"),S(this,"maxRound"),S(this,"maxTurns"),this.agentLib=e.agentLib,this.toolLib=e.toolLib,this.maxRound=e.maxRound,this.maxTurns=e.maxTurns}}class se extends Z{constructor(e){super(e),S(this,"data"),S(this,"agentType","group_manager"),this.agentType="group_manager",this.data=e.data,this.rest=e.rest||{}}}class oe extends E{constructor(e={humanInputMode:"NEVER",systemMessage:null,codeExecutionConfig:!1,agentDefaultAutoReply:null,maxConsecutiveAutoReply:null,termination:{type:"none",keywords:[],criterion:null,methodContent:null},modelIds:[],tools:[],parentId:void 0,nestedChats:[{messages:[],triggeredBy:[],condition:{conditionType:"string_llm",prompt:""},available:{type:"none",value:""}}],contextVariables:{},updateAgentStateBeforeReply:[],afterWork:null,handoffs:[],maxRound:20,adminName:null,speakers:{selectionMethod:"auto",selectionCustomMethod:"",maxRetriesForSelecting:null,selectionMode:"repeat",allowRepeat:!0,allowedOrDisallowedTransitions:{},transitionsType:"allowed",order:[]},enableClearHistory:void 0,sendIntroductions:void 0,groupName:void 0,initialAgentId:void 0}){e.parentId=void 0,super(e),S(this,"maxRound"),S(this,"adminName"),S(this,"speakers"),S(this,"enableClearHistory"),S(this,"sendIntroductions"),S(this,"groupName"),S(this,"initialAgentId"),this.maxRound=e.maxRound,this.adminName=e.adminName,this.speakers=e.speakers,this.enableClearHistory=e.enableClearHistory,this.sendIntroductions=e.sendIntroductions,this.groupName=e.groupName,this.initialAgentId=e.initialAgentId}}class ie extends Z{constructor(e){super(e),S(this,"data"),S(this,"agentType","rag_user_proxy"),this.data=e.data,this.agentType="rag_user_proxy",this.rest=e.rest||{}}}const re={task:"default",vectorDb:"chroma",dbConfig:{model:"all-MiniLM-L6-v2",useMemory:!1,useLocalStorage:!1,localStoragePath:null,connectionUrl:null,waitUntilIndexReady:null,waitUntilDocumentReady:null,metadata:null},docsPath:[],newDocs:!0,model:null,chunkTokenSize:null,contextMaxTokens:null,chunkMode:"multi_lines",mustBreakAtEmptyLine:!0,useCustomEmbedding:!1,embeddingFunction:null,customizedPrompt:null,customizedAnswerPrefix:null,updateContext:!0,collectionName:"autogen-docs",getOrCreate:!0,overwrite:!1,useCustomTokenCount:!1,customTokenCountFunction:null,useCustomTextSplit:!1,customTextSplitFunction:null,customTextTypes:[],recursive:!0,distanceThreshold:-1,nResults:null};class le extends E{constructor(e={humanInputMode:"ALWAYS",systemMessage:null,codeExecutionConfig:!1,agentDefaultAutoReply:null,maxConsecutiveAutoReply:null,termination:{type:"none",keywords:[],criterion:null,methodContent:null},modelIds:[],tools:[],parentId:void 0,nestedChats:[{messages:[],triggeredBy:[],condition:{conditionType:"string_llm",prompt:""},available:{type:"none",value:""}}],contextVariables:{},updateAgentStateBeforeReply:[],afterWork:null,handoffs:[],retrieveConfig:re}){super(e),S(this,"retrieveConfig"),this.retrieveConfig=e.retrieveConfig}}let de=class extends Z{constructor(e){super(e),S(this,"data"),S(this,"agentType","reasoning"),this.data=e.data,this.agentType="reasoning",this.rest=e.rest||{}}};const ce={method:"beam_search",maxDepth:3,forestSize:1,ratingScale:10,beamSize:3,answerApproach:"pool",nsim:3,explorationConstant:1.41};class ue extends E{constructor(e={humanInputMode:"NEVER",systemMessage:null,codeExecutionConfig:!1,agentDefaultAutoReply:null,maxConsecutiveAutoReply:null,termination:{type:"none",keywords:[],criterion:null,methodContent:null},modelIds:[],tools:[],parentId:void 0,nestedChats:[{messages:[],triggeredBy:[],condition:{conditionType:"string_llm",prompt:""},available:{type:"none",value:""}}],contextVariables:{},updateAgentStateBeforeReply:[],handoffs:[],afterWork:null,verbose:!0,reasonConfig:ce}){super(e),S(this,"verbose"),S(this,"reasonConfig"),this.verbose=e.verbose,this.reasonConfig=e.reasonConfig}}class ge extends Z{constructor(e){super(e),S(this,"data"),S(this,"agentType","user_proxy"),this.agentType="user_proxy",this.data=e.data,this.rest=e.rest||{}}}const me=["user_proxy","assistant","rag_user_proxy","reasoning","captain","group_manager"];class pe{constructor(e={sourceType:"user_proxy",targetType:"assistant",name:"Chat",description:"New connection",clearHistory:!0,maxTurns:null,summary:{method:"lastMsg",prompt:"",args:{}},position:1,order:-1,message:{type:"none",useCarryover:!1,content:null,context:{}},nestedChat:{message:null,reply:null},prerequisites:[],condition:{conditionType:"string_llm",prompt:""},available:{type:"none",value:""},afterWork:null,realSource:null,realTarget:null,silent:!1}){S(this,"sourceType"),S(this,"targetType"),S(this,"name"),S(this,"description"),S(this,"position"),S(this,"order"),S(this,"clearHistory"),S(this,"message"),S(this,"maxTurns"),S(this,"summary"),S(this,"nestedChat"),S(this,"prerequisites",[]),S(this,"realSource",null),S(this,"realTarget",null),S(this,"available",{type:"none",value:""}),S(this,"condition",{conditionType:"string_llm",prompt:""}),S(this,"afterWork",null),S(this,"silent",!1);const{sourceType:t,targetType:a,name:n,description:s,clearHistory:o,maxTurns:i,summary:r,message:l,position:d,order:c,nestedChat:u,prerequisites:g,condition:m,available:p,afterWork:h,realSource:f,realTarget:y,silent:b}=e;this.sourceType=t,this.targetType=a,this.name=n,this.description=s,this.clearHistory=o,this.maxTurns=i,this.summary=r,this.message=l,this.position=d,this.order=c,this.nestedChat=u,this.prerequisites=g,this.condition=m,this.available=p,this.afterWork=h,this.realSource=f,this.realTarget=y,this.silent=b}}class he{constructor(e){S(this,"id"),S(this,"type","chat"),S(this,"source"),S(this,"target"),S(this,"data"),S(this,"rest"),this.id=e.id,this.source=e.source,this.target=e.target,this.type=e.type,this.data=e.data,this.rest=e.rest||{}}static create(e){const t=new pe;return new he({id:`wc-${V()}`,source:e.source,target:e.target,type:e.type,data:t})}}const fe=["chat","nested","group","hidden"],ye=["AgentTarget","RandomAgentTarget","GroupChatTarget","NestedChatTarget","AskUserTarget","GroupManagerTarget","RevertToUserTarget","StayTarget","TerminateTarget"],be=["string_llm","context_str_llm","string_context","expression_context"];class ve{constructor(e){S(this,"type","flow"),S(this,"version","0.4.9"),S(this,"id"),S(this,"name"),S(this,"description"),S(this,"tags"),S(this,"requirements"),S(this,"data"),S(this,"storageId"),S(this,"createdAt"),S(this,"updatedAt"),S(this,"rest",{}),this.id=e.id,this.name=e.name,this.description=e.description,this.tags=e.tags,this.requirements=e.requirements,this.data=e.data,this.storageId=e.storageId,this.createdAt=e.createdAt,this.updatedAt=e.updatedAt,this.rest=e.rest||{}}}const xe=`wf-${(new Date).getTime()}${a.nanoid()}`,Ce={type:"flow",version:"0.4.9",id:xe,storageId:xe,name:"Waldiez Flow",description:"A waldiez flow",tags:[],requirements:[],data:{agents:{userProxyAgents:[],assistantAgents:[],ragUserProxyAgents:[],reasoningAgents:[],captainAgents:[],groupManagerAgents:[]},models:[],tools:[],chats:[],isAsync:!1,cacheSeed:42,silent:!1,nodes:[],edges:[],viewport:{zoom:1,x:0,y:0}},createdAt:(new Date).toISOString(),updatedAt:(new Date).toISOString(),rest:{}};class we{constructor(e={nodes:[],edges:[],viewport:{x:0,y:0,zoom:1},agents:{userProxyAgents:[],assistantAgents:[],ragUserProxyAgents:[],reasoningAgents:[],captainAgents:[],groupManagerAgents:[]},models:[],tools:[],chats:[],isAsync:!1,cacheSeed:42,silent:!1}){S(this,"nodes"),S(this,"edges"),S(this,"viewport"),S(this,"agents"),S(this,"models"),S(this,"tools"),S(this,"chats"),S(this,"isAsync",!1),S(this,"cacheSeed",42),S(this,"silent",!1),this.nodes=e.nodes,this.edges=e.edges,this.viewport=e.viewport,this.agents=e.agents,this.models=e.models,this.tools=e.tools,this.chats=e.chats,this.isAsync=e.isAsync,this.cacheSeed=e.cacheSeed,this.silent=e.silent}}class ke{constructor(e={baseUrl:null,apiKey:null,apiType:"openai",apiVersion:null,temperature:null,topP:null,maxTokens:null,aws:{accessKey:null,profileName:null,region:null,secretKey:null,sessionToken:null},extras:{},defaultHeaders:{},price:{promptPricePer1k:null,completionTokenPricePer1k:null}}){S(this,"baseUrl"),S(this,"apiKey"),S(this,"apiType"),S(this,"apiVersion"),S(this,"temperature"),S(this,"topP"),S(this,"maxTokens"),S(this,"aws"),S(this,"extras"),S(this,"defaultHeaders"),S(this,"price");const{baseUrl:t,apiKey:a,apiType:n,apiVersion:s,temperature:o,topP:i,maxTokens:r,aws:l,extras:d,defaultHeaders:c,price:u}=e;this.baseUrl=t,this.apiKey=a,this.apiType=n,this.apiVersion=s,this.temperature=o,this.topP=i,this.maxTokens=r,this.aws=l||null,this.extras=d,this.defaultHeaders=c,this.price=u}}class je{constructor(e){S(this,"type","model"),S(this,"id"),S(this,"name"),S(this,"description"),S(this,"tags"),S(this,"requirements"),S(this,"createdAt"),S(this,"updatedAt"),S(this,"data"),S(this,"rest",{}),this.id=e.id,this.name=e.name,this.description=e.description,this.tags=e.tags,this.requirements=e.requirements,this.createdAt=e.createdAt,this.updatedAt=e.updatedAt,this.data=e.data,this.rest=e.rest}static create(){return new je({id:`wt-${V()}`,name:"Model",description:"A new model",tags:[],requirements:[],createdAt:(new Date).toISOString(),updatedAt:(new Date).toISOString(),data:new ke})}}class Ae{constructor(e={content:Ne,toolType:"custom",secrets:{}}){S(this,"content"),S(this,"toolType"),S(this,"secrets");const{content:t,toolType:a,secrets:n}=e;this.toolType=a,this.content=t,this.secrets=n}}const Ne='\n"""Replace this with your code.\n\nmake sure a function with the same name\nas the tool is defined in the code.\n"""\n\n# Example:\n# tool name: \'new_tool\'\n#\n# def new_tool() -> str:\n#     """Tool entry point."""\n#     return "Hello, world!"\n#\n# Add your code below\n\ndef new_tool() -> None:\n    """Tool entry point."""\n    ...\n',Te={shared:'\n"""Replace this with your code.\n\nAdd any code here that will be placed at the top of the whole flow.\n"""\n\n# Example:\n# global variable\n# DATABASE = {\n#     "users": [\n#         {"id": 1, "name": "Alice"},\n#         {"id": 2, "name": "Bob"},\n#     ],\n#     "posts": [\n#         {"id": 1, "title": "Hello, world!", "author_id": 1},\n#         {"id": 2, "title": "Another post", "author_id": 2},\n#     ],\n# }\n#\n# Add your code below\n\n',custom:Ne,langchain:'\n"""Replace this with your code.\n\nYou can define any of the tools available in the langchain_community package.\nYou can explore the available tools in the LangChain Community Tools folder:\nhttps://github.com/langchain-ai/langchain/tree/master/libs/community/langchain_community/tools\n\nMake sure you have a variable named with the same name as the tool\n"""\n\n# Example:\n# # tool name: \'wiki_tool\'\n#\n# from langchain_community.tools import WikipediaQueryRun\n# from langchain_community.utilities import WikipediaAPIWrapper\n#\n# api_wrapper = WikipediaAPIWrapper(top_k_results=1, doc_content_chars_max=1000)\n# wiki_tool = WikipediaQueryRun(api_wrapper=api_wrapper)\n#\n# Add your code below\n\n',crewai:'\n"""Replace this with your code.\n\nYou can define any of the tools available in the crewai_tools package.\nYou can explore the full list of available tools in the CrewAI Tools repository:\nhttps://github.com/crewAIInc/crewAI-tools/tree/main\n\nMake sure you have a variable named with the same name as the tool.\n"""\n\n# Example:\n# # tool name: \'scrape_tool\'\n#\n# from crewai_tools import ScrapeWebsiteTool\n# scrape_tool = ScrapeWebsiteTool()\n#\n# Add your code below\n\n'};class Se{constructor(e){S(this,"type","tool"),S(this,"id"),S(this,"name"),S(this,"description"),S(this,"tags"),S(this,"requirements"),S(this,"createdAt"),S(this,"updatedAt"),S(this,"data"),S(this,"rest",{}),this.id=e.id,this.name=e.name,this.description=e.description,this.tags=e.tags,this.requirements=e.requirements,this.createdAt=e.createdAt,this.updatedAt=e.updatedAt,this.data=e.data,this.rest=e.rest}static create(){return new Se({id:`wt-${V()}`,name:"new_tool",description:"A new tool",tags:[],requirements:[],createdAt:(new Date).toISOString(),updatedAt:(new Date).toISOString(),data:new Ae})}}const Me=e=>{const t=[];if("agentLib"in e&&Array.isArray(e.agentLib))for(const a of e.agentLib)"object"==typeof a&&"name"in a&&"description"in a&&"systemMessage"in a&&t.push(a);return t},Ie=e=>!("toolLib"in e)||"default"!==e.toolLib&&null!==e.toolLib?null:e.toolLib,Ee=e=>{if("maxRound"in e&&"number"==typeof e.maxRound){const t=parseInt(e.maxRound.toString(),10);if(t>0)return t}return 10},De=e=>{if("maxTurns"in e&&"number"==typeof e.maxTurns){const t=parseInt(e.maxTurns.toString(),10);if(t>0)return t}return 5},Re=e=>{let t=`wt-${V()}`;return"id"in e&&"string"==typeof e.id&&(t=e.id),t},Pe=(e,t)=>{let a=t;return"name"in e&&"string"==typeof e.name?a=e.name:"label"in e&&"string"==typeof e.label&&(a=e.label),a},Oe=(e,t)=>{let a=t;return"description"in e&&"string"==typeof e.description&&(a=e.description),a},Le=e=>{let t=[];return"tags"in e&&Array.isArray(e.tags)&&(t=e.tags.filter((e=>"string"==typeof e))),t},ze=e=>{let t=[];return"requirements"in e&&Array.isArray(e.requirements)&&(t=e.requirements.filter((e=>"string"==typeof e))),t},Fe=e=>{let t=(new Date).toISOString();return"createdAt"in e&&"string"==typeof e.createdAt&&(t=e.createdAt),t},Ue=e=>{let t=(new Date).toISOString();return"updatedAt"in e&&"string"==typeof e.updatedAt&&(t=e.updatedAt),t},qe=(e,t)=>{const a={};return Object.keys(e).forEach((n=>{t.includes(n)||(a[n]=e[n])})),a},Be=(e,t)=>{const a={x:20,y:20};return t&&(a.x=t.x,a.y=t.y),"rest"in e&&"object"==typeof e.rest&&e.rest&&"position"in e.rest&&e.rest.position?"object"==typeof e.rest.position&&"x"in e.rest.position&&"number"==typeof e.rest.position.x&&"y"in e.rest.position&&"number"==typeof e.rest.position.y&&(a.x=e.rest.position.x,a.y=e.rest.position.y):"position"in e&&"object"==typeof e.position&&e.position&&"x"in e.position&&"number"==typeof e.position.x&&"y"in e.position&&"number"==typeof e.position.y&&(a.x=e.position.x,a.y=e.position.y),a},He=e=>{const t={type:"none",value:""};return"available"in e&&e.available&&"object"==typeof e.available&&("type"in e.available&&"string"==typeof e.available.type&&["string","expression","none"].includes(e.available.type)&&(t.type=e.available.type),"value"in e.available&&"string"==typeof e.available.value&&(t.value=e.available.value)),t},We=(e,t="")=>{let a={conditionType:"string_llm",prompt:t};if("condition"in e&&e.condition&&"object"==typeof e.condition&&"conditionType"in e.condition&&e.condition.conditionType&&be.includes(e.condition.conditionType)){switch(e.condition.conditionType){case"string_llm":a=((e,t="")=>{let a={conditionType:"string_llm",prompt:t};return"conditionType"in e&&"string_llm"===e.conditionType&&"prompt"in e&&"string"==typeof e.prompt&&(a={conditionType:"string_llm",prompt:e.prompt}),a})(e.condition,t);break;case"context_str_llm":a=(e=>{let t={conditionType:"context_str_llm",context_str:""};return"conditionType"in e&&"context_str_llm"===e.conditionType&&"context_str"in e&&"string"==typeof e.context_str&&(t={conditionType:"context_str_llm",context_str:e.context_str}),t})(e.condition);break;case"string_context":a=(e=>{let t={conditionType:"string_context",variable_name:""};return"conditionType"in e&&"string_context"===e.conditionType&&"variable_name"in e&&"string"==typeof e.variable_name&&(t={conditionType:"string_context",variable_name:e.variable_name}),t})(e.condition);break;case"expression_context":a=(e=>{let t={conditionType:"expression_context",expression:""};return"conditionType"in e&&"expression_context"===e.conditionType&&"expression"in e&&"string"==typeof e.expression&&(t={conditionType:"expression_context",expression:e.expression}),t})(e.condition)}}return a},Ve=e=>"afterWork"in e&&"object"==typeof e.afterWork&&e.afterWork&&(e=>{if(!e||"object"!=typeof e)return!1;const t=e;return"targetType"in t&&"string"==typeof t.targetType&&!!ye.includes(t.targetType)&&"value"in t&&Array.isArray(t.value)&&t.value.every((e=>"string"==typeof e))})(e.afterWork)?e.afterWork:null,Ge=["user_proxy","assistant","captain","rag_user_proxy","reasoning","group_manager"],Ke=(e,t)=>{const a=((e,t)=>{let a="Agent";return"user_proxy"===t?a="user_proxy":"assistant"===t?a="Assistant":"rag_user_proxy"===t?a="RAG User":"reasoning"===t?a="Reasoning Agent":"captain"===t?a="Captain":"group_manager"===t&&(a="Group Manager"),Pe(e,a)})(e,t),n=(e=>{let t="An agent";return"user_proxy"===e?t="A user agent":"assistant"===e?t="An assistant agent":"rag_user_proxy"===e?t="A RAG user agent":"reasoning"===e?t="A reasoning agent":"captain"===e&&(t="A captain agent"),t})(t);return{name:a,description:Oe(e,n),tags:Le(e),requirements:ze(e),createdAt:Fe(e),updatedAt:Ue(e)}},Qe=e=>"isMultimodal"in e&&"boolean"==typeof e.isMultimodal?e.isMultimodal:"is_multimodal"in e&&"boolean"==typeof e.is_multimodal&&e.is_multimodal,Ze=e=>{let t=[];return"messages"in e&&Array.isArray(e.messages)&&(t=e.messages.filter((e=>"object"==typeof e&&e&&"id"in e&&"string"==typeof e.id&&"isReply"in e&&"boolean"==typeof e.isReply))),t},Xe=e=>{let t={selectionMethod:"auto",selectionCustomMethod:"",maxRetriesForSelecting:null,selectionMode:"repeat",allowRepeat:!0,allowedOrDisallowedTransitions:{},transitionsType:"allowed",order:[]};if("speakers"in e&&"object"==typeof e.speakers){const a=e.speakers;t={selectionMethod:at(a),selectionCustomMethod:nt(a),maxRetriesForSelecting:st(a),selectionMode:ot(a),allowRepeat:it(a),allowedOrDisallowedTransitions:rt(a),transitionsType:lt(a),order:dt(a)}}return t},Je=e=>{let t=20;if("maxRound"in e&&"number"==typeof e.maxRound)try{t=parseInt(e.maxRound.toString(),10)}catch(a){}return t},Ye=e=>{let t=null;return"adminName"in e&&"string"==typeof e.adminName&&(t=e.adminName),t},$e=e=>{let t=!1;return"enableClearHistory"in e&&"boolean"==typeof e.enableClearHistory&&(t=e.enableClearHistory),t},_e=e=>{let t=!1;return"sendIntroductions"in e&&"boolean"==typeof e.sendIntroductions&&(t=e.sendIntroductions),t},et=e=>{let t;return"groupName"in e&&"string"==typeof e.groupName&&(t=e.groupName),t},tt=e=>{let t;return"initialAgentId"in e&&"string"==typeof e.initialAgentId&&(t=e.initialAgentId),t},at=e=>{let t="auto";return"selectionMethod"in e&&"string"==typeof e.selectionMethod&&["auto","manual","random","round_robin","default"].includes(e.selectionMethod)&&(t=e.selectionMethod),t},nt=e=>{let t="";return"selectionCustomMethod"in e&&"string"==typeof e.selectionCustomMethod&&(t=e.selectionCustomMethod),t},st=e=>{let t=null;return"maxRetriesForSelecting"in e&&"number"==typeof e.maxRetriesForSelecting&&(t=e.maxRetriesForSelecting),t},ot=e=>{let t="repeat";return"selectionMode"in e&&"string"==typeof e.selectionMode&&["repeat","transition"].includes(e.selectionMode)&&(t=e.selectionMode),t},it=e=>{let t=!0;return"allowRepeat"in e&&"boolean"==typeof e.allowRepeat&&(t=e.allowRepeat),t},rt=e=>{let t={};if("allowedOrDisallowedTransitions"in e&&"object"==typeof e.allowedOrDisallowedTransitions&&e.allowedOrDisallowedTransitions){const a={};for(const[t,n]of Object.entries(e.allowedOrDisallowedTransitions))"string"==typeof t&&Array.isArray(n)&&(a[t]=n.filter((e=>"string"==typeof e)));t=a}return t},lt=e=>{let t="allowed";return"transitionsType"in e&&"string"==typeof e.transitionsType&&["allowed","disallowed"].includes(e.transitionsType)&&(t=e.transitionsType),t},dt=e=>{let t=[];return"order"in e&&Array.isArray(e.order)&&(t=e.order.filter((e=>"string"==typeof e))),t},ct=e=>"object"!=typeof e||("verbose"in e&&"boolean"==typeof e.verbose?e.verbose:!("data"in e)||"object"!=typeof e.data||!("verbose"in e.data)||"boolean"!=typeof e.data.verbose||e.data.verbose),ut=e=>{if("object"!=typeof e)return ce;let t=null;return"reasonConfig"in e&&"object"==typeof e.reasonConfig&&e.reasonConfig?t=e.reasonConfig:"data"in e&&"object"==typeof e.data&&e.data&&"reasonConfig"in e.data&&"object"==typeof e.data.reasonConfig&&e.data.reasonConfig&&(t=e.data.reasonConfig),t?{method:gt(t),maxDepth:mt(t),forestSize:pt(t),ratingScale:ht(t),beamSize:ft(t),answerApproach:yt(t),nsim:bt(t),explorationConstant:vt(t)}:ce},gt=e=>"method"in e&&"string"==typeof e.method&&["beam_search","mcts","lats","dfs"].includes(e.method)?e.method:"beam_search",mt=e=>"maxDepth"in e&&"number"==typeof e.maxDepth?e.maxDepth:3,pt=e=>"forestSize"in e&&"number"==typeof e.forestSize?e.forestSize:1,ht=e=>"ratingScale"in e&&"number"==typeof e.ratingScale?e.ratingScale:10,ft=e=>"beamSize"in e&&"number"==typeof e.beamSize?e.beamSize:3,yt=e=>"answerApproach"in e&&"string"==typeof e.answerApproach&&["pool","best"].includes(e.answerApproach)?e.answerApproach:"pool",bt=e=>"nsim"in e&&"number"==typeof e.nsim?e.nsim:3,vt=e=>"explorationConstant"in e&&"number"==typeof e.explorationConstant?e.explorationConstant:1.41,xt=e=>{if("object"!=typeof e)return re;let t=null;return"retrieveConfig"in e&&"object"==typeof e.retrieveConfig&&e.retrieveConfig?t=e.retrieveConfig:"data"in e&&"object"==typeof e.data&&e.data&&"retrieveConfig"in e.data&&"object"==typeof e.data.retrieveConfig&&e.data.retrieveConfig&&(t=e.data.retrieveConfig),t?{task:Ct(t),vectorDb:wt(t),dbConfig:Et(t),docsPath:Dt(t),newDocs:Rt(t),model:Pt(t),chunkTokenSize:Ot(t),contextMaxTokens:Lt(t),chunkMode:zt(t),mustBreakAtEmptyLine:Ft(t),useCustomEmbedding:Ut(t),embeddingFunction:qt(t),customizedPrompt:Bt(t),customizedAnswerPrefix:Ht(t),updateContext:Wt(t),collectionName:Vt(t),getOrCreate:Gt(t),overwrite:Kt(t),useCustomTokenCount:Qt(t),customTokenCountFunction:Zt(t),useCustomTextSplit:Xt(t),customTextSplitFunction:Jt(t),customTextTypes:Yt(t),recursive:$t(t),distanceThreshold:_t(t),nResults:ea(t)}:re},Ct=e=>{let t="default";return"task"in e&&"string"==typeof e.task&&["code","qa","default"].includes(e.task)&&(t=e.task),t},wt=e=>{let t="chroma";return"vectorDb"in e&&"string"==typeof e.vectorDb&&["chroma","pgvector","mongodb","qdrant"].includes(e.vectorDb)&&(t=e.vectorDb),t},kt=e=>{let t="all-MiniLM-L6-v2";return"model"in e&&"string"==typeof e.model&&e.model.length>0&&(t=e.model),t},jt=e=>{let t=!1;return"useMemory"in e&&"boolean"==typeof e.useMemory&&(t=e.useMemory),t},At=e=>{let t=!1;return"useLocalStorage"in e&&"boolean"==typeof e.useLocalStorage&&(t=e.useLocalStorage),t},Nt=e=>{let t=null;return"localStoragePath"in e&&"string"==typeof e.localStoragePath&&e.localStoragePath.length>0&&(t=e.localStoragePath),t},Tt=e=>{let t=null;return"connectionUrl"in e&&"string"==typeof e.connectionUrl&&e.connectionUrl.length>0&&(t=e.connectionUrl),t},St=e=>{let t=null;return"waitUntilIndexReady"in e&&"boolean"==typeof e.waitUntilIndexReady&&(t=e.waitUntilIndexReady),t},Mt=e=>{let t=null;return"waitUntilDocumentReady"in e&&"boolean"==typeof e.waitUntilDocumentReady&&(t=e.waitUntilDocumentReady),t},It=e=>{let t=null;return"metadata"in e&&"object"==typeof e.metadata&&e.metadata&&(t=e.metadata),t},Et=e=>{let t={model:"all-MiniLM-L6-v2",useMemory:!1,useLocalStorage:!1,localStoragePath:null,connectionUrl:null,waitUntilIndexReady:null,waitUntilDocumentReady:null,metadata:null};return"dbConfig"in e&&"object"==typeof e.dbConfig&&(t={model:kt(e.dbConfig),useMemory:jt(e.dbConfig),useLocalStorage:At(e.dbConfig),localStoragePath:Nt(e.dbConfig),connectionUrl:Tt(e.dbConfig),waitUntilIndexReady:St(e.dbConfig),waitUntilDocumentReady:Mt(e.dbConfig),metadata:It(e.dbConfig)}),t},Dt=e=>{let t=[];return"docsPath"in e&&Array.isArray(e.docsPath)&&e.docsPath.length>0&&(t=e.docsPath.filter((e=>"string"==typeof e&&e.length>0))),t},Rt=e=>{let t=!0;return"newDocs"in e&&"boolean"==typeof e.newDocs&&(t=e.newDocs),t},Pt=e=>{let t=null;return"model"in e&&"string"==typeof e.model&&(t=e.model),t},Ot=e=>{let t=null;return"chunkTokenSize"in e&&"number"==typeof e.chunkTokenSize&&(t=e.chunkTokenSize),t},Lt=e=>{let t=null;return"contextMaxTokens"in e&&"number"==typeof e.contextMaxTokens&&(t=e.contextMaxTokens),t},zt=e=>{let t="multi_lines";return"chunkMode"in e&&"string"==typeof e.chunkMode&&["multi_lines","one_line"].includes(e.chunkMode)&&(t=e.chunkMode),t},Ft=e=>{let t=!0;return"mustBreakAtEmptyLine"in e&&"boolean"==typeof e.mustBreakAtEmptyLine&&(t=e.mustBreakAtEmptyLine),t},Ut=e=>{let t=!1;return"useCustomEmbedding"in e&&"boolean"==typeof e.useCustomEmbedding&&(t=e.useCustomEmbedding),t},qt=e=>{let t=null;return"embeddingFunction"in e&&"string"==typeof e.embeddingFunction&&(t=e.embeddingFunction),t},Bt=e=>{let t=null;return"customizedPrompt"in e&&"string"==typeof e.customizedPrompt&&(t=e.customizedPrompt),t},Ht=e=>{let t=null;return"customizedAnswerPrefix"in e&&"string"==typeof e.customizedAnswerPrefix&&(t=e.customizedAnswerPrefix),t},Wt=e=>{let t=!0;return"updateContext"in e&&"boolean"==typeof e.updateContext&&(t=e.updateContext),t},Vt=e=>{let t="autogen-docs";return"collectionName"in e&&"string"==typeof e.collectionName&&(t=e.collectionName),t},Gt=e=>{let t=!0;return"getOrCreate"in e&&"boolean"==typeof e.getOrCreate&&(t=e.getOrCreate),t},Kt=e=>{let t=!1;return"overwrite"in e&&"boolean"==typeof e.overwrite&&(t=e.overwrite),t},Qt=e=>{let t=!1;return"useCustomTokenCount"in e&&"boolean"==typeof e.useCustomTokenCount&&(t=e.useCustomTokenCount),t},Zt=e=>{let t=null;return"customTokenCountFunction"in e&&"string"==typeof e.customTokenCountFunction&&(t=e.customTokenCountFunction),t},Xt=e=>{let t=!1;return"useCustomTextSplit"in e&&"boolean"==typeof e.useCustomTextSplit&&(t=e.useCustomTextSplit),t},Jt=e=>{let t=null;return"customTextSplitFunction"in e&&"string"==typeof e.customTextSplitFunction&&(t=e.customTextSplitFunction),t},Yt=e=>{let t=[];return"customTextTypes"in e&&Array.isArray(e.customTextTypes)&&e.customTextTypes.length>0&&(t=e.customTextTypes.filter((e=>"string"==typeof e&&e.length>0))),t},$t=e=>{let t=!0;return"recursive"in e&&"boolean"==typeof e.recursive&&(t=e.recursive),t},_t=e=>{let t=-1;return"distanceThreshold"in e&&"number"==typeof e.distanceThreshold&&(t=e.distanceThreshold),t},ea=e=>{let t=null;return"nResults"in e&&"number"==typeof e.nResults&&(t=e.nResults),t},ta=e=>"type"in e&&"string"==typeof e.type&&["none","keyword","method"].includes(e.type)?e.type:"none",aa=e=>{let t=[];return"keywords"in e&&Array.isArray(e.keywords)&&(t=e.keywords.filter((e=>"string"==typeof e))),t},na=e=>"criterion"in e&&"string"==typeof e.criterion&&["found","ending","exact"].includes(e.criterion)?e.criterion:null,sa=e=>"methodContent"in e&&"string"==typeof e.methodContent?e.methodContent:null,oa={agent:"#005490",assistant:"#66bc57",captain:"#0e2766",user_proxy:"#bc76f5",rag_user_proxy:"#e34561",reasoning:"#63D0D4",group_manager:"#ed8a34"},ia={agent:"#005490",assistant:"#66bc57",captain:"#284ca4",user_proxy:"#bc76f5",rag_user_proxy:"#e34561",reasoning:"#63D0D4",group_manager:"#ed8a34"},ra="data:image/svg+xml,%3csvg%20fill='none'%20xmlns='http://www.w3.org/2000/svg'%20viewBox='0%200%2016%2016'%3e%3cpath%20d='M16%208.016A8.522%208.522%200%20008.016%2016h-.032A8.521%208.521%200%20000%208.016v-.032A8.521%208.521%200%20007.984%200h.032A8.522%208.522%200%200016%207.984v.032z'%20fill='url(%23prefix__paint0_radial_980_20147)'/%3e%3cdefs%3e%3cradialGradient%20id='prefix__paint0_radial_980_20147'%20cx='0'%20cy='0'%20r='1'%20gradientUnits='userSpaceOnUse'%20gradientTransform='matrix(16.1326%205.4553%20-43.70045%20129.2322%201.588%206.503)'%3e%3cstop%20offset='.067'%20stop-color='%239168C0'/%3e%3cstop%20offset='.343'%20stop-color='%235684D1'/%3e%3cstop%20offset='.672'%20stop-color='%231BA1E3'/%3e%3c/radialGradient%3e%3c/defs%3e%3c/svg%3e",la="data:image/svg+xml,%3c?xml%20version='1.0'%20encoding='UTF-8'%20standalone='no'?%3e%3csvg%20viewBox='0%200%20320%20320'%20version='1.1'%20id='svg7'%20width='320'%20height='320'%20xmlns='http://www.w3.org/2000/svg'%20xmlns:svg='http://www.w3.org/2000/svg'%3e%3cdefs%20id='defs7'%20/%3e%3cpath%20d='M%20298.89867,130.97427%20C%20306.25636,109.18381%20303.72272,85.313302%20291.9565,65.492879%20274.26156,35.092232%20238.68927,19.451898%20203.94801,26.812055%20188.49281,9.6316894%20166.288,-0.13851872%20143.00893,0.00148426%20107.49744,-0.07851744%2075.989107,22.481963%2065.064056,55.822673%2042.25117,60.432772%2022.559727,74.523072%2011.036736,94.493497%20-6.7899476,124.81414%20-2.7259906,163.03495%2021.090216,189.03551%20c%20-7.357688,21.79046%20-4.824049,45.66097%206.942171,65.48139%2017.694935,30.40065%2053.267228,46.04098%2088.008483,38.68083%2015.44507,17.18036%2037.66001,26.95057%2060.93909,26.80057%2035.53175,0.09%2067.05022,-22.49048%2077.97527,-55.86119%2022.81289,-4.6101%2042.50433,-18.7004%2054.02732,-38.67083%2017.80642,-30.32064%2013.73233,-68.51146%20-10.07375,-94.51201%20z%20M%20177.00023,299.08785%20c%20-14.21879,0.02%20-27.99165,-4.8901%20-38.90656,-13.88029%200.49659,-0.26001%201.35803,-0.73002%201.91543,-1.07003%20l%2064.57739,-36.80078%20c%203.30386,-1.85004%205.33078,-5.32011%205.31051,-9.07019%20v%20-89.83192%20l%2027.29236,15.55033%20c%200.2939,0.14001%200.48646,0.42001%200.52699,0.74002%20v%2074.39158%20c%20-0.0405,33.08071%20-27.19101,59.90128%20-60.71612,59.97128%20z%20M%2046.426607,244.05668%20c%20-7.124593,-12.14026%20-9.688636,-26.37056%20-7.246208,-40.18086%200.476324,0.28001%201.317492,0.79002%201.915431,1.13003%20l%2064.57739,36.80078%20c%203.27346,1.89004%207.32728,1.89004%2010.61088,0%20l%2078.83671,-44.92096%20v%2031.10067%20c%200.0203,0.32%20-0.13175,0.63001%20-0.38511,0.83002%20l%20-65.27668,37.19079%20C%20100.38298,282.5275%2063.24997,272.70729%2046.436741,244.05668%20Z%20M%2029.430956,104.96372%20c%207.094189,-12.160259%2018.292874,-21.460457%2031.62995,-26.29056%200,0.550012%20-0.0304,1.520033%20-0.0304,2.200047%20v%2073.611563%20c%20-0.02027,3.74008%202.006642,7.21016%205.300373,9.06019%20l%2078.836711,44.91096%20-27.29236,15.55033%20c%20-0.27364,0.18001%20-0.61821,0.21001%20-0.92225,0.08%20L%2051.666172,186.86546%20C%2022.650938,170.28511%2012.698804,133.65433%2029.420821,104.97372%20Z%20m%20224.237184,51.49109%20-78.83671,-44.92095%2027.29236,-15.540331%20c%200.27363,-0.180004%200.61821,-0.210004%200.92225,-0.08%20l%2065.28681,37.190791%20c%2029.0659,16.57035%2039.02817,53.26113%2022.23521,81.94174%20-7.10432,12.14026%20-18.29287,21.44046%20-31.61981,26.28056%20v%20-75.81161%20c%200.0304,-3.74008%20-1.98637,-7.20016%20-5.26997,-9.0602%20z%20m%2027.16062,-40.34086%20c%20-0.47633,-0.29%20-1.3175,-0.79001%20-1.91544,-1.13002%20L%20214.33593,78.18315%20c%20-3.27346,-1.890041%20-7.32728,-1.890041%20-10.61088,0%20L%20124.88834,123.1041%20V%2092.003444%20c%20-0.0203,-0.320007%200.13175,-0.630013%200.38511,-0.830017%20l%2065.27668,-37.160792%20c%2029.07604,-16.550353%2066.24959,-6.700143%2083.01215,22.000469%207.08405,12.120258%209.6481,26.310556%207.24621,40.100846%20z%20M%20110.05135,171.54513%2082.748856,155.9948%20c%20-0.293902,-0.14%20-0.486458,-0.42001%20-0.526997,-0.74001%20V%2080.863207%20c%200.02027,-33.120706%2027.251821,-59.961278%2060.817471,-59.941277%2014.19851,0%2027.94097,4.920105%2038.85589,13.880295%20-0.4966,0.260006%20-1.3479,0.730016%20-1.91543,1.070023%20l%20-64.5774,36.800784%20c%20-3.30386,1.85004%20-5.33077,5.310113%20-5.3105,9.060193%20l%20-0.0405,89.791905%20z%20m%2014.82685,-31.54067%2035.11624,-20.01042%2035.11624,20.00042%20v%2040.01086%20l%20-35.11624,20.00042%20-35.11624,-20.00042%20z'%20id='path7'%20style='stroke-width:1.00672'%20/%3e%3c/svg%3e",da={openai:la,azure:"data:image/svg+xml,%3csvg%20width='150'%20height='150'%20viewBox='0%200%2096%2096'%20xmlns='http://www.w3.org/2000/svg'%3e%3cdefs%3e%3clinearGradient%20id='e399c19f-b68f-429d-b176-18c2117ff73c'%20x1='-1032.172'%20x2='-1059.213'%20y1='145.312'%20y2='65.426'%20gradientTransform='matrix(1%200%200%20-1%201075%20158)'%20gradientUnits='userSpaceOnUse'%3e%3cstop%20offset='0'%20stop-color='%23114a8b'/%3e%3cstop%20offset='1'%20stop-color='%230669bc'/%3e%3c/linearGradient%3e%3clinearGradient%20id='ac2a6fc2-ca48-4327-9a3c-d4dcc3256e15'%20x1='-1023.725'%20x2='-1029.98'%20y1='108.083'%20y2='105.968'%20gradientTransform='matrix(1%200%200%20-1%201075%20158)'%20gradientUnits='userSpaceOnUse'%3e%3cstop%20offset='0'%20stop-opacity='.3'/%3e%3cstop%20offset='.071'%20stop-opacity='.2'/%3e%3cstop%20offset='.321'%20stop-opacity='.1'/%3e%3cstop%20offset='.623'%20stop-opacity='.05'/%3e%3cstop%20offset='1'%20stop-opacity='0'/%3e%3c/linearGradient%3e%3clinearGradient%20id='a7fee970-a784-4bb1-af8d-63d18e5f7db9'%20x1='-1027.165'%20x2='-997.482'%20y1='147.642'%20y2='68.561'%20gradientTransform='matrix(1%200%200%20-1%201075%20158)'%20gradientUnits='userSpaceOnUse'%3e%3cstop%20offset='0'%20stop-color='%233ccbf4'/%3e%3cstop%20offset='1'%20stop-color='%232892df'/%3e%3c/linearGradient%3e%3c/defs%3e%3cpath%20fill='url(%23e399c19f-b68f-429d-b176-18c2117ff73c)'%20d='M33.338%206.544h26.038l-27.03%2080.087a4.152%204.152%200%200%201-3.933%202.824H8.149a4.145%204.145%200%200%201-3.928-5.47L29.404%209.368a4.152%204.152%200%200%201%203.934-2.825z'/%3e%3cpath%20fill='%230078d4'%20d='M71.175%2060.261h-41.29a1.911%201.911%200%200%200-1.305%203.309l26.532%2024.764a4.171%204.171%200%200%200%202.846%201.121h23.38z'/%3e%3cpath%20fill='url(%23ac2a6fc2-ca48-4327-9a3c-d4dcc3256e15)'%20d='M33.338%206.544a4.118%204.118%200%200%200-3.943%202.879L4.252%2083.917a4.14%204.14%200%200%200%203.908%205.538h20.787a4.443%204.443%200%200%200%203.41-2.9l5.014-14.777%2017.91%2016.705a4.237%204.237%200%200%200%202.666.972H81.24L71.024%2060.261l-29.781.007L59.47%206.544z'/%3e%3cpath%20fill='url(%23a7fee970-a784-4bb1-af8d-63d18e5f7db9)'%20d='M66.595%209.364a4.145%204.145%200%200%200-3.928-2.82H33.648a4.146%204.146%200%200%201%203.928%202.82l25.184%2074.62a4.146%204.146%200%200%201-3.928%205.472h29.02a4.146%204.146%200%200%200%203.927-5.472z'/%3e%3c/svg%3e",bedrock:"data:image/svg+xml,%3csvg%20fill='currentColor'%20fill-rule='evenodd'%20height='1em'%20style='flex:none;line-height:1'%20viewBox='0%200%2024%2024'%20width='1em'%20xmlns='http://www.w3.org/2000/svg'%3e%3ctitle%3eBedrock%3c/title%3e%3cpath%20d='M13.05%2015.513h3.08c.214%200%20.389.177.389.394v1.82a1.704%201.704%200%20011.296%201.661c0%20.943-.755%201.708-1.685%201.708-.931%200-1.686-.765-1.686-1.708%200-.807.554-1.484%201.297-1.662v-1.425h-2.69v4.663a.395.395%200%2001-.188.338l-2.69%201.641a.385.385%200%2001-.405-.002l-4.926-3.086a.395.395%200%2001-.185-.336V16.3L2.196%2014.87A.395.395%200%20012%2014.555L2%2014.528V9.406c0-.14.073-.27.192-.34l2.465-1.462V4.448c0-.129.062-.249.165-.322l.021-.014L9.77%201.058a.385.385%200%2001.407%200l2.69%201.675a.395.395%200%2001.185.336V7.6h3.856V5.683a1.704%201.704%200%2001-1.296-1.662c0-.943.755-1.708%201.685-1.708.931%200%201.685.765%201.685%201.708%200%20.807-.553%201.484-1.296%201.662v2.311a.391.391%200%2001-.389.394h-4.245v1.806h6.624a1.69%201.69%200%20011.64-1.313c.93%200%201.685.764%201.685%201.707%200%20.943-.754%201.708-1.685%201.708a1.69%201.69%200%2001-1.64-1.314H13.05v1.937h4.953l.915%201.18a1.66%201.66%200%2001.84-.227c.931%200%201.685.764%201.685%201.707%200%20.943-.754%201.708-1.685%201.708-.93%200-1.685-.765-1.685-1.708%200-.346.102-.668.276-.937l-.724-.935H13.05v1.806zM9.973%201.856L7.93%203.122V6.09h-.778V3.604L5.435%204.669v2.945l2.11%201.36L9.712%207.61V5.334h.778V7.83c0%20.136-.07.263-.184.335L7.963%209.638v2.081l1.422%201.009-.446.646-1.406-.998-1.53%201.005-.423-.66%201.605-1.055v-1.99L5.038%208.29l-2.26%201.34v1.676l1.972-1.189.398.677-2.37%201.429V14.3l2.166%201.258%202.27-1.368.397.677-2.176%201.311V19.3l1.876%201.175%202.365-1.426.398.678-2.017%201.216%201.918%201.201%202.298-1.403v-5.78l-4.758%202.893-.4-.675%205.158-3.136V3.289L9.972%201.856zM16.13%2018.47a.913.913%200%2000-.908.92c0%20.507.406.918.908.918a.913.913%200%2000.907-.919.913.913%200%2000-.907-.92zm3.63-3.81a.913.913%200%2000-.908.92c0%20.508.406.92.907.92a.913.913%200%2000.908-.92.913.913%200%2000-.908-.92zm1.555-4.99a.913.913%200%2000-.908.92c0%20.507.407.918.908.918a.913.913%200%2000.907-.919.913.913%200%2000-.907-.92zM17.296%203.1a.913.913%200%2000-.907.92c0%20.508.406.92.907.92a.913.913%200%2000.908-.92.913.913%200%2000-.908-.92z'%3e%3c/path%3e%3c/svg%3e",deepseek:"data:image/svg+xml,%3c?xml%20version='1.0'%20encoding='UTF-8'%20standalone='no'?%3e%3csvg:svg%20width='64'%20height='64'%20viewBox='0%200%2064%2064.000039'%20fill='none'%20version='1.1'%20id='svg7'%20xmlns:svg='http://www.w3.org/2000/svg'%3e%3csvg:path%20id='path7'%20d='m%2059.511568,14.791492%20c%20-0.5953,-0.29175%20-0.8517,0.26416%20-1.1998,0.54663%20-0.1191,0.09107%20-0.2198,0.20947%20-0.3206,0.31885%20-0.8701,0.9292%20-1.8867,1.53979%20-3.2148,1.4668%20-1.9417,-0.10938%20-3.5995,0.50122%20-5.065,1.98632%20-0.3114,-1.83129%20-1.3463,-2.9248%20-2.9217,-3.62622%20-0.8242,-0.3645%20-1.6577,-0.729%20-2.2348,-1.52172%20-0.4029,-0.5647%20-0.5129,-1.19336%20-0.7143,-1.812993%20-0.1283,-0.373535%20-0.2565,-0.756347%20-0.687,-0.820068%20-0.4671,-0.07275%20-0.6503,0.318848%20-0.8335,0.646973%20-0.7327,1.339358%20-1.0166,2.815428%20-0.9892,4.309568%200.0641,3.36206%201.4838,6.04057%204.3048,7.94487%200.3206,0.2187%200.403,0.4372%200.3023,0.7563%20-0.1924,0.656%20-0.4214,1.2937%20-0.6228,1.9497%20-0.1283,0.4192%20-0.3207,0.5103%20-0.7694,0.3279%20-1.5479,-0.6467%20-2.8852,-1.6035%20-4.0667,-2.7605%20-2.0058,-1.9407%20-3.8193,-4.08179%20-6.0815,-5.75831%20-0.5313,-0.39184%20-1.0625,-0.7561%20-1.6121,-1.10254%20-2.3081,-2.24121%200.3023,-4.08178%200.9068,-4.30029%200.6319,-0.22778%200.2198,-1.01147%20-1.8227,-1.0022%20-2.0425,0.009%20-3.9109,0.69239%20-6.2922,1.60352%20-0.348,0.13672%20-0.7145,0.23682%20-1.09,0.31885%20-2.1615,-0.40992%20-4.4055,-0.50122%20-6.7502,-0.23682%20-4.414689,0.49194%20-7.9408194,2.57837%20-10.5328594,6.14087%20-3.1141341,4.28222%20-3.8468001,9.14742%20-2.9492171,14.22242%200.9433571,5.3481%203.6727271,9.7761%207.8675575,13.2385%204.350619,3.5896%209.360619,5.3482%2015.075819,5.011%203.4713,-0.2004%207.3364,-0.665%2011.6961,-4.355%201.099,0.5467%202.2531,0.7652%204.1674,0.9292%201.4746,0.1367%202.8943,-0.0727%203.9933,-0.3005%201.7219,-0.3645%201.6029,-1.959%200.9801,-2.2505%20-5.0466,-2.3506%20-3.9385,-1.394%20-4.9459,-2.1685%202.5645,-3.0339%206.4297,-6.1865%207.9409,-16.4001%200.119,-0.8108%200.0183,-1.3211%200,-1.9771%20-0.0092,-0.4008%200.0824,-0.5556%200.5404,-0.6013%201.2639,-0.1457%202.4912,-0.4919%203.6178,-1.1115%203.2698,-1.7857%204.5886,-4.71953%204.9,-8.23638%200.0459,-0.53759%20-0.0091,-1.0935%20-0.577,-1.37573%20z%20m%20-28.4938,31.65181%20c%20-4.8909,-3.8447%20-7.263,-5.1113%20-8.2431,-5.0566%20-0.9159,0.0547%20-0.751,1.1025%20-0.5496,1.7859%200.2107,0.6741%200.4855,1.1389%200.8701,1.731%200.2656,0.3918%200.4489,0.9748%20-0.2655,1.4123%20-1.5754,0.9749%20-4.314,-0.3281%20-4.4423,-0.3918%20-3.1872,-1.877%20-5.852489,-4.3553%20-7.730179,-7.7444%20-1.8134704,-3.262%20-2.8667004,-6.7605%20-3.0407704,-10.4961%20-0.04577,-0.9019%200.21985,-1.221%201.11743,-1.3848%201.18152,-0.2187%202.3996604,-0.2644%203.5811804,-0.0913%204.991739,0.729%209.241439,2.9612%2012.804339,6.4963%202.0333,2.0135%203.572,4.419%205.1566,6.7696%201.6852,2.4963%203.4987,4.8745%205.8068,6.8242%200.8151,0.6833%201.4654,1.2026%202.0882,1.5854%20-1.8775,0.2095%20-5.01,0.2552%20-7.1532,-1.4397%20z%20m%202.3447,-15.0788%20c%200,-0.4009%200.3206,-0.7197%200.7237,-0.7197%200.0915,0%200.1739,0.018%200.2472,0.0454%200.1008,0.0366%200.1924,0.0913%200.2656,0.1731%200.1283,0.1277%200.2015,0.3098%200.2015,0.5012%200,0.4009%20-0.3205,0.7197%20-0.7235,0.7197%20-0.4031,0%20-0.7145,-0.3188%20-0.7145,-0.7197%20z%20m%207.2815,3.7356%20c%20-0.4671,0.1914%20-0.9342,0.3552%20-1.383,0.3735%20-0.6961,0.0364%20-1.4563,-0.2461%20-1.8684,-0.5923%20-0.6411,-0.5376%20-1.0991,-0.8381%20-1.2915,-1.7766%20-0.0824,-0.4009%20-0.0367,-1.0205%200.0367,-1.3757%200.1648,-0.7654%20-0.0184,-1.2573%20-0.5587,-1.7039%20-0.4397,-0.3645%20-0.9984,-0.4646%20-1.6121,-0.4646%20-0.229,0%20-0.4395,-0.1003%20-0.5953,-0.1823%20-0.2565,-0.1275%20-0.467,-0.4463%20-0.2656,-0.8382%200.0641,-0.1274%200.3756,-0.4372%200.4488,-0.4919%200.8335,-0.4739%201.7952,-0.3189%202.6836,0.0364%200.8244,0.3371%201.4472,0.9567%202.3447,1.8313%200.9159,1.0568%201.0807,1.3486%201.6028,2.1411%200.4123,0.6196%200.7878,1.2573%201.0442,1.9863%200.1557,0.4556%20-0.0458,0.8291%20-0.5862,1.0569%20z'%20fill-rule='nonzero'%20fill='%234d6bfe'%20/%3e%3cscript%20/%3e%3c/svg:svg%3e",google:ra,gemini:ra,anthropic:"data:image/svg+xml,%3c?xml%20version='1.0'%20encoding='UTF-8'%20standalone='no'?%3e%3csvg%20version='1.1'%20viewBox='0%200%20149.99999%20150'%20width='150'%20height='150'%20id='svg1'%20xmlns='http://www.w3.org/2000/svg'%20xmlns:svg='http://www.w3.org/2000/svg'%3e%3cdefs%20id='defs1'%3e%3cstyle%20id='style1'%3e%20.cls-1%20{%20fill:%20%230f0f0d;%20}%20.cls-1,%20.cls-2%20{%20stroke-width:%200px;%20}%20.cls-2%20{%20fill:%20%23d97757;%20}%20%3c/style%3e%3c/defs%3e%3cpath%20class='cls-2'%20d='m%2030.005,99.45%2029.14,-16.35%200.49,-1.42%20-0.49,-0.79%20h%20-1.42%20l%20-4.87,-0.3%20-16.65,-0.45%20-14.44,-0.6%20-13.99,-0.75%20-3.52,-0.75%20-3.3,-4.35%200.34,-2.17%202.96,-1.99%204.24,0.37%209.37,0.64%2014.06,0.97%2010.2,0.6%2015.11,1.57%20h%202.4%20l%200.34,-0.97%20-0.82,-0.6%20-0.64,-0.6%20-14.55,-9.86%20-15.75,-10.42%20-8.25,-6%20-4.46,-3.04%20-2.25,-2.85%20-0.97,-6.22%204.05,-4.46%205.44,0.37%201.39,0.37%205.51,4.24%2011.77,9.11%2015.37,11.32%202.25,1.87%200.9,-0.64%200.11,-0.45%20-1.01,-1.69%20-8.36,-15.11%20-8.92,-15.37%20-3.97,-6.37%20-1.05,-3.82%20c%20-0.37,-1.57%20-0.64,-2.89%20-0.64,-4.5%20l%204.61,-6.26%202.55,-0.82%206.15,0.82%202.59,2.25%203.82,8.74%206.19,13.76%209.6,18.71%202.81,5.55%201.5,5.14%200.56,1.57%20h%200.97%20v%20-0.9%20l%200.79,-10.54%201.46,-12.94%201.42,-16.65%200.49,-4.69%202.32,-5.62%204.61,-3.04%203.6,1.72%202.96,4.24%20-0.41,2.74%20-1.76,11.44%20-3.45,17.92%20-2.25,12%20h%201.31%20l%201.5,-1.5%206.07,-8.06%2010.2,-12.75%204.5,-5.06%205.25,-5.59%203.37,-2.66%20h%206.37%20l%204.69,6.97%20-2.1,7.2%20-6.56,8.32%20-5.44,7.05%20-7.8,10.5%20-4.87,8.4%200.45,0.67%201.16,-0.11%2017.62,-3.75%209.52,-1.72%2011.36,-1.95%205.14,2.4%200.56,2.44%20-2.02,4.99%20-12.15,3%20-14.25,2.85%20-21.22,5.02%20-0.26,0.19%200.3,0.37%209.56,0.9%204.09,0.22%20h%2010.01%20l%2018.64,1.39%204.87,3.22%202.92,3.94%20-0.49,3%20-7.5,3.82%20-10.12,-2.4%20-23.62,-5.62%20-8.1,-2.02%20h%20-1.12%20v%200.67%20l%206.75,6.6%2012.37,11.17%2015.49,14.4%200.79,3.56%20-1.99,2.81%20-2.1,-0.3%20-13.61,-10.24%20-5.25,-4.61%20-11.89,-10.01%20h%20-0.79%20v%201.05%20l%202.74,4.01%2014.47,21.75%200.75,6.67%20-1.05,2.17%20-3.75,1.31%20-4.12,-0.75%20-8.47,-11.89%20-8.74,-13.39%20-7.05,-12%20-0.86,0.49%20-4.16,44.81%20-1.95,2.29%20-4.5,1.72%20-3.75,-2.85%20-1.99,-4.61%201.99,-9.11%202.4,-11.89%201.95,-9.45%201.76,-11.74%201.05,-3.9%20-0.07,-0.26%20-0.86,0.11%20-8.85,12.15%20-13.46,18.19%20-10.65,11.4%20-2.55,1.01%20-4.42,-2.29%200.41,-4.09%202.47,-3.64%2014.74,-18.75%208.89,-11.62%205.74,-6.71%20-0.04,-0.97%20h%20-0.34%20l%20-39.15,25.42%20-6.97,0.9%20-3,-2.81%200.37,-4.61%201.42,-1.5%2011.77,-8.1%20-0.04,0.04%20z'%20shape-rendering='optimizeQuality'%20id='path1'%20/%3e%3c/svg%3e",cohere:"data:image/svg+xml,%3csvg%20height='1em'%20style='flex:none;line-height:1'%20viewBox='0%200%2024%2024'%20width='1em'%20xmlns='http://www.w3.org/2000/svg'%3e%3ctitle%3eCohere%3c/title%3e%3cpath%20clip-rule='evenodd'%20d='M8.128%2014.099c.592%200%201.77-.033%203.398-.703%201.897-.781%205.672-2.2%208.395-3.656%201.905-1.018%202.74-2.366%202.74-4.18A4.56%204.56%200%200018.1%201H7.549A6.55%206.55%200%20001%207.55c0%203.617%202.745%206.549%207.128%206.549z'%20fill='%2339594D'%20fill-rule='evenodd'%3e%3c/path%3e%3cpath%20clip-rule='evenodd'%20d='M9.912%2018.61a4.387%204.387%200%20012.705-4.052l3.323-1.38c3.361-1.394%207.06%201.076%207.06%204.715a5.104%205.104%200%2001-5.105%205.104l-3.597-.001a4.386%204.386%200%2001-4.386-4.387z'%20fill='%23D18EE2'%20fill-rule='evenodd'%3e%3c/path%3e%3cpath%20d='M4.776%2014.962A3.775%203.775%200%20001%2018.738v.489a3.776%203.776%200%20007.551%200v-.49a3.775%203.775%200%2000-3.775-3.775z'%20fill='%23FF7759'%3e%3c/path%3e%3c/svg%3e",mistral:"data:image/svg+xml,%3c?xml%20version='1.0'%20encoding='UTF-8'%20standalone='no'?%3e%3csvg%20version='1.1'%20id='Layer_1'%20x='0px'%20y='0px'%20viewBox='0%200%20500%20500'%20style='enable-background:new%200%200%20500%20500;'%20xml:space='preserve'%20xmlns='http://www.w3.org/2000/svg'%20xmlns:svg='http://www.w3.org/2000/svg'%3e%3cdefs%20id='defs119'%20/%3e%3cg%20id='g94'%3e%3c/g%3e%3cg%20id='g119'%3e%3crect%20x='352.273'%20y='45.455'%20width='81.818'%20height='81.818'%20id='rect94'%20/%3e%3crect%20x='393.182'%20y='45.455'%20style='fill:%23F7D046;'%20width='81.818'%20height='81.818'%20id='rect95'%20/%3e%3crect%20x='25'%20y='45.455'%20width='81.818'%20height='81.818'%20id='rect96'%20/%3e%3crect%20x='25'%20y='127.273'%20width='81.818'%20height='81.818'%20id='rect97'%20/%3e%3crect%20x='25'%20y='209.091'%20width='81.818'%20height='81.818'%20id='rect98'%20/%3e%3crect%20x='25'%20y='290.909'%20width='81.818'%20height='81.818'%20id='rect99'%20/%3e%3crect%20x='25'%20y='372.727'%20width='81.818'%20height='81.818'%20id='rect100'%20/%3e%3crect%20x='65.909'%20y='45.455'%20style='fill:%23F7D046;'%20width='81.818'%20height='81.818'%20id='rect101'%20/%3e%3crect%20x='393.182'%20y='127.273'%20style='fill:%23F2A73B;'%20width='81.818'%20height='81.818'%20id='rect102'%20/%3e%3crect%20x='65.909'%20y='127.273'%20style='fill:%23F2A73B;'%20width='81.818'%20height='81.818'%20id='rect103'%20/%3e%3crect%20x='270.455'%20y='127.273'%20width='81.818'%20height='81.818'%20id='rect104'%20/%3e%3crect%20x='311.364'%20y='127.273'%20style='fill:%23F2A73B;'%20width='81.818'%20height='81.818'%20id='rect105'%20/%3e%3crect%20x='147.727'%20y='127.273'%20style='fill:%23F2A73B;'%20width='81.818'%20height='81.818'%20id='rect106'%20/%3e%3crect%20x='229.545'%20y='209.091'%20style='fill:%23EE792F;'%20width='81.818'%20height='81.818'%20id='rect107'%20/%3e%3crect%20x='311.364'%20y='209.091'%20style='fill:%23EE792F;'%20width='81.818'%20height='81.818'%20id='rect108'%20/%3e%3crect%20x='147.727'%20y='209.091'%20style='fill:%23EE792F;'%20width='81.818'%20height='81.818'%20id='rect109'%20/%3e%3crect%20x='188.636'%20y='290.909'%20width='81.818'%20height='81.818'%20id='rect110'%20/%3e%3crect%20x='229.545'%20y='290.909'%20style='fill:%23EB5829;'%20width='81.818'%20height='81.818'%20id='rect111'%20/%3e%3crect%20x='393.182'%20y='209.091'%20style='fill:%23EE792F;'%20width='81.818'%20height='81.818'%20id='rect112'%20/%3e%3crect%20x='65.909'%20y='209.091'%20style='fill:%23EE792F;'%20width='81.818'%20height='81.818'%20id='rect113'%20/%3e%3crect%20x='352.273'%20y='290.909'%20width='81.818'%20height='81.818'%20id='rect114'%20/%3e%3crect%20x='393.182'%20y='290.909'%20style='fill:%23EB5829;'%20width='81.818'%20height='81.818'%20id='rect115'%20/%3e%3crect%20x='352.273'%20y='372.727'%20width='81.818'%20height='81.818'%20id='rect116'%20/%3e%3crect%20x='65.909'%20y='290.909'%20style='fill:%23EB5829;'%20width='81.818'%20height='81.818'%20id='rect117'%20/%3e%3crect%20x='393.182'%20y='372.727'%20style='fill:%23EA3326;'%20width='81.818'%20height='81.818'%20id='rect118'%20/%3e%3crect%20x='65.909'%20y='372.727'%20style='fill:%23EA3326;'%20width='81.818'%20height='81.818'%20id='rect119'%20/%3e%3c/g%3e%3c/svg%3e",groq:"data:image/svg+xml,%3c?xml%20version='1.0'%20encoding='UTF-8'%20standalone='no'?%3e%3csvg%20width='120'%20height='120'%20viewBox='0%200%2031.749999%2031.75'%20version='1.1'%20id='svg1'%20xmlns='http://www.w3.org/2000/svg'%20xmlns:svg='http://www.w3.org/2000/svg'%3e%3cdefs%20id='defs1'%20/%3e%3cg%20id='layer1'%20transform='translate(-1.0583336,-1.0583335)'%3e%3cg%20id='g1'%20transform='matrix(0.0839389,0,0,0.0839389,5.9375622,2.6051197)'%20style='fill:%23f55036;fill-opacity:1'%3e%3cpath%20d='M%20131.6,6.5%20C%2069.5,6%2018.7,55.8%2018.1,117.9%2017.5,180%2067.4,230.8%20129.5,231.4%20c%200.7,0%201.4,0%202.1,0%20h%2037%20v%20-42.1%20h%20-37%20C%2092.8,189.8%2061,158.7%2060.5,119.9%2060,81.1%2091.1,49.3%20129.9,48.8%20c%200.5,0%201.1,0%201.6,0%2038.7,0%2070.4,31.5%2070.4,70.3%20v%200%20103.5%200%20c%200,38.5%20-31.3,69.8%20-69.7,70.3%20-18.4,-0.2%20-35.9,-7.5%20-48.9,-20.6%20L%2053.5,302%20c%2020.7,20.8%2048.7,32.6%2078,32.9%20v%200%20h%201.5%20v%200%20C%20194.3,334%20243.6,284.3%20243.9,223%20V%20116.2%20C%20242.4,55.2%20192.5,6.6%20131.6,6.5%20Z'%20id='path2'%20style='fill:%23f55036;fill-opacity:1'%20/%3e%3c/g%3e%3c/g%3e%3c/svg%3e",together:"data:image/svg+xml,%3c?xml%20version='1.0'%20encoding='UTF-8'%20standalone='no'?%3e%3c!--%20Created%20with%20Inkscape%20(http://www.inkscape.org/)%20--%3e%3csvg%20width='74'%20height='74'%20viewBox='0%200%2019.579168%2019.579168'%20version='1.1'%20id='svg1'%20xmlns='http://www.w3.org/2000/svg'%20xmlns:svg='http://www.w3.org/2000/svg'%3e%3cdefs%20id='defs1'%20/%3e%3cg%20id='layer1'%3e%3cg%20id='g1'%20transform='translate(-0.147916,-0.147916)'%3e%3ccircle%20style='fill:%230f6eff;fill-opacity:1;stroke:none;stroke-width:0.244828;stroke-opacity:1'%20id='path1'%20cx='9.9375'%20cy='4.1166668'%20r='2'%20/%3e%3ccircle%20style='fill:%23d3d3d3;fill-opacity:1;stroke:none;stroke-width:0.244828;stroke-opacity:1'%20id='path1-5-7-6'%20cx='4.1166668'%20cy='9.9375'%20r='2'%20/%3e%3ccircle%20style='fill:%23d3d3d3;fill-opacity:1;stroke:none;stroke-width:0.244828;stroke-opacity:1'%20id='path1-5-7-6-2'%20cx='9.9375'%20cy='9.9375'%20r='2'%20/%3e%3ccircle%20style='fill:%23d3d3d3;fill-opacity:1;stroke:none;stroke-width:0.244828;stroke-opacity:1'%20id='path1-5-7-6-2-7'%20cx='15.758333'%20cy='9.9375'%20r='2'%20/%3e%3ccircle%20style='fill:%23d3d3d3;fill-opacity:1;stroke:none;stroke-width:0.244828;stroke-opacity:1'%20id='path1-5-7-6-9'%20cx='4.1166668'%20cy='15.758333'%20r='2'%20/%3e%3ccircle%20style='fill:%23d3d3d3;fill-opacity:1;stroke:none;stroke-width:0.244828;stroke-opacity:1'%20id='path1-5-7-6-2-3'%20cx='9.9920893'%20cy='15.758333'%20r='2'%20/%3e%3ccircle%20style='fill:%23d3d3d3;fill-opacity:1;stroke:none;stroke-width:0.244828;stroke-opacity:1'%20id='path1-5-7-6-2-7-1'%20cx='15.758333'%20cy='15.758333'%20r='2'%20/%3e%3ccircle%20style='fill:%23d3d3d3;fill-opacity:1;stroke:none;stroke-width:0.244828;stroke-opacity:1'%20id='path1-5-7-6-2-7-1-37'%20cx='15.758333'%20cy='4.1166668'%20r='2'%20/%3e%3c/g%3e%3c/g%3e%3c/svg%3e",nim:"data:image/svg+xml,%3c?xml%20version='1.0'%20encoding='UTF-8'%20standalone='no'?%3e%3csvg:svg%20version='1.1'%20x='0px'%20y='0px'%20width='196'%20height='196'%20viewBox='0%200%20196%20196'%20enable-background='new%200%200%20700%20550'%20xml:space='preserve'%20xmlns:svg='http://www.w3.org/2000/svg'%3e%3csvg:defs%20id='defs1'%20/%3e%3csvg:path%20id='Eye_Mark_1_'%20fill='%2374b71b'%20d='M%2073.456372,72.194042%20V%2060.631527%20c%201.12198,-0.07937%202.255948,-0.139319%203.411415,-0.176111%2031.622563,-0.993824%2052.369263,27.171848%2052.369263,27.171848%200,0%20-22.40735,31.122346%20-46.43236,31.122346%20-3.460197,0%20-6.55701,-0.55769%20-9.348318,-1.49488%20V%2082.193886%20c%2012.310363,1.487017%2014.78583,6.924941%2022.189081,19.262174%20L%20112.10639,87.577242%20c%200,0%20-12.0156,-15.759812%20-32.271598,-15.759812%20-2.204274,4.13e-4%20-4.310571,0.155853%20-6.37842,0.376612%20m%200,-38.194042%20v%2017.270393%20c%201.134795,-0.09013%202.271245,-0.161642%203.411415,-0.203395%2043.975923,-1.481642%2072.626093,36.065421%2072.626093,36.065421%200,0%20-32.90865,40.016331%20-67.191477,40.016331%20-3.141461,0%20-6.082834,-0.29021%20-8.846445,-0.77927%20v%2010.67535%20c%202.363435,0.30054%204.811617,0.47748%207.366457,0.47748%2031.904925,0%2054.977025,-16.29186%2077.319065,-35.57636%203.70121,2.96618%2018.86737,10.18133%2021.9861,13.34346%20-21.24446,17.78301%20-70.74883,32.11575%20-98.81404,32.11575%20-2.704906,0%20-5.306049,-0.16329%20-7.857582,-0.40844%20V%20162%20H%20194.71746%20V%2034%20Z%20m%200,83.25473%20v%209.11475%20c%20-29.508411,-5.26099%20-37.69837,-35.934786%20-37.69837,-35.934786%200,0%2014.167377,-15.697388%2037.69837,-18.241066%20v%2010.000258%20c%20-0.0182,0%20-0.03018,-0.0045%20-0.0463,-0.0045%20-12.347156,-1.482881%20-21.995608,10.054415%20-21.995608,10.054415%200,0%205.40568,19.421749%2022.04191,25.010979%20M%2021.046171,89.105598%20c%200,0%2017.48867,-25.805957%2052.409787,-28.474484%20v%20-9.360721%20c%20-38.678551,3.103842%20-72.173423,35.86244%20-72.173423,35.86244%200,0%2018.969486,54.843917%2072.173423,59.864297%20v%20-9.95189%20C%2034.414436,132.13317%2021.046171,89.105598%2021.046171,89.105598%20Z'%20style='stroke-width:0.413405'%20/%3e%3cscript%20/%3e%3c/svg:svg%3e",other:la},ca={user_proxy:"data:image/webp;base64,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",rag_user_proxy:"data:image/webp;base64,UklGRiQaAABXRUJQVlA4WAoAAAAQAAAAfwAAfwAAQUxQSJcGAAAB8IZtnyFJ/v9F9dgzu2+sbdu2bVvdM2vbtm3btsc2293VWZVZSGfeDzIzMuIVUc8jYgKYHgdufvzVL/zVgwW3D2ONdu0Dznvi20XgnL9CA1np6Pu+t5D/qwYx4vAn5kH0Jg1g9OlfeMjvVcyKnzhLd00Hvu8hp1mu1UpmhMzz9Tbm6lbwVqtW3aog7yY6W+HBKrLterXoQeghBaWWv/LDHx7eQdSY+21k2obtQHzp3RNGK3O4ieTLg0X0H1dGulOqepAdfn5EQYn9AqS/J2D7GUiv9dRAc94JCgxqRfaReQY/iHSr7EJyNcwAfl6X3HHg/CnHRrOQWq24kF2EZ1e9NNTPpPY0T9iP6/Q6kkHRh3SvCgBBUI8SwNP9aX3GgxU5mh5GqlEBwRIywyAF3wwh9RrX8KwhnyHp90QgWHWzgDBO4JehlK7lWcYyh/+GZL0Mil11cMdBAl8NILRGxHFHxrA/kez1QbFahdiXCLGHszrHpA39FUnDB8Go6EL0pYQGfZlmbMdSCx8i2QaKVhnig13osKaWVsB5dVWWfh+SBgRGrsvnmH2QumQUHcbuBCaxzGOQbIdgx6l7RhxGlbpRsyH7eUXWsBIGtLgLoTt4fgYAy9XDzAF0budoBgC7Dk2ercB/LQBhCbrsGEjvWQDohj7PI7deBKDqaWQ2uVcAwIJO9yW2UgigEmnldWJ3A0AJWq0NIdWvB0Al1gtOIHUQAJSg2XdIvQLAqeum1ETG/GtRCKAG7U798YWWDaT993tkF/WTOvn0JinnVsBpaQqYsY24Qa8gNQoBVKFvv1lU/y8AIOyt1QDA0FGfFzhI3ijoaQAoW0i3dOQC8GIAOF/IcQBQ9qDzGrLtzQSM6AZQDKH1CgfGF/JdAaDmQ5+xkIAHR+cqdAHoAc2ABnwRFtcfufYDUAbVQBmTC+vkuR9AkUydBlwBEd8lef4AUCOzlIgpIOR7K083YIBsmUhdgMM3KQ+AmE6JhlOV1SogIBPUaFgQ2CklBmIy3SBpVUU4fG15FgF1WXFatAxy47S6AWnT8nwBoMpnCXA9H5ZlQXLo2ohKZR9CI76381wPwOWr5UtWQNLxINrkG5tn40TI5YhRvcq3fh42CYDLBVtDBte/LPdJAOKYq64hh+u4fGwS8pY1VOeZ0iRgMzePE2sntjn8rZjIc/LA1Y4JznFM7FWN414m+hyXLwp1kx1ezsRvPp4Lulq8K5NZOPr3mCOKdDT/koFM9ipn3Pvmu298DQC+VrrHzxj//rXbFxjV0SaAINLJ4Yz6TQAQyglzxJGkv5vIDe8GEIdScoeStmf0zwAASr4j50Wm4q8AENHphNTu0UqsZwNATKUzlnMEU7M5QbXHg9RHmKofJwJhrsfhFCH3n4HKjJgLua7jJkpGFXLbV2HqrlWUAwR2EJcgu7IpU3nHmiSS9j5M7d3qqtn7MNV3rall7sXU36JdpbaNmA5XnqjOXyswPQ58UpX7BjBtHtKjwpI9mU5XmkHvy5FMn4WD36tDwWX3b6aJMVd1QNnfD1KssFXzs7/O8KD0+D0V2uypXmjxo3UUGfkaBFtmzoRl5ueDe3N/FYZNAeEQYp0s4K9VFbgZyoZeRpEHbZvT+1MdP8jo5YK5A7mJ6pSRbiK7EgOo7NgwahldHEuRNDclNk2dclrVy4W2lUmdC3XjtG7kw+TBhLZ1FfJSaqYIvEBn+GIoX4IQnETmeajspxiCyqsS2QXqd0AQ3ifyiwZ6hGELElsC8By1ShD3JokXAJRAtBokKmacp1OC+x8Co6tAWKXhGIDvouIiCvnMQAIuJ3AtgAoIRn2mA17PrXN0QEb7IGlb1wH0yYqsmllH/sCx/URfKAXPyFphGYASZIcRuP0M8XnQLOkWAKhIg8+HQJaZx5R0YYKiz2WA2GxJ/V+iEmdVDYtY20aSGLs6JoEgi2KO8Ssw+UfUSMBX5PUhjOLGi0nEsQrh1QVGc/QXFBDG9Hr3ZxSvmjRj1pwZAQXCcVbNMEolo+9COfujAXorSfmgEWCslNaG8LKMQtQQfpUSN4S/ZLBiQ/hIyncN4R4pLQ1hLylD56dEUcytSByJjn9hcv937IknnXLaGWedfc4555577nnJ81NvXkrK+2Bcc3Nz80WcF1544UUXXdTc3HzRmcMlyWw6+D2PytRL/8c0PfLkT8rS4n9v35hpvd+WLa9O80Ut/fz2Q8awhth/kyMve/ytP6YtbGs1WluXTvv7o+evPm3HMUxNAFZQOCBmEwAAsEkAnQEqgACAAD4xFIhDIiEhFMm3SCADBLMAYmsTbM8rvy3mvWD/Gf2Dgy6q8prnD/m/ct8z/8X6h/0r/1fcA/V79desr5jf2d/Zj3d/9H6tf7j6gH9X/wfpXexz6C37mem3+3vwnf2z/ff+D/Ze0V6gH//2Dn+S/iX4H/2n8fP3L8yfzr9h/Iv+w/83/L6JH6+/Yf7h+1n93/bf4w/0fgz8Q/4b+dftN8Av4p/Jf7H+Uv9n/cD1jO26ml/ID4AvVn5x/nf6v+4H+H9JT+v9Gfrd7AH8j/n3+W/Mb1kvCL8p9gL+R/1z/if5D9tP8p9L/8x/tv8V+U/to/Kv8J/zf8R+Sv2Dfx/+f/6r+8f4j/y/5H///+H7wPZr+4/sm/smlRihUbIA8u7ab9bekitTT+SbGv7V2U0ZRee+j3FunPcC9NPaLp4EE9/3mqmhsNvC8CBLGiCJCf/y1EbJQks9L5dPyjA/UiGZ1kwFbxGRboScZbw3yR5ooLNWMgO1XkceBMnPj47MduLRCTxfHLh+UDJOh8WALJCohSmN20KmQNUt/imkgrtt1DmPwwnr2rO5oS4h5CFpZBrpMNuMyn3JTmCKtvuKZbvOtMA9ELZJKjPtDU+VX2EaRhLH9Dcax2FFRSPdkVBmuKSOLtUmImlYqoowhOtqQF9TtnX9hZn2epwz5bX6jb8mvzdxJdCXDvYE76USx5ZHW1SY6Wt1RyhRyJ5fP5ctulttYSt+cqGbZO4obrREuKXoYgeXIqxlIwDNWd7TnkO7MWZKIRu24wJ/6qdWhbrIAAD+/oN2XIF/fa2cRaF0fRULZ0tTDsEID+DM/6N+30vQ8li9wfgeZc2HJ+pVNFGatL/inSuA3tRuB4DA7LmNZcs+FxrgSZ1po3B4Z+q2QZGDw0TfxU84RLGrxl4HM8S93KhDAjACxmsV341Cy7zBQjUFxISmvQf8sQOVbaLdxa+cNm5szJgdeUjhVOZWFzoROYUI0wK5EhnzRNKKWaV98NwaSCMSgd184k8HTUX3HsFwsN9XgTM5MdpiYWKVF5JhZyxG+TlqoudV9khR+RGSrWGNYOJqOwHFlj5vuRx0UKTp4/s0tx9SP2tZ7+HsRNNgMbh3gR+w2eimflgIg2QJ7BKloigTMlbiXP+4Dr9UWYbkHWkoudbUwwVKxGhsXdUe6m+iZLphbO23QXan6pouT/0EsQM+bDuaGTDW92yLLyRAOLzocqBdGosqmPwEUrY/3QV7TJWiRCi0rI8O6A0Vzy94cxH6YzHg8fSVATV7398AmtGUVpma5Xx+kfG53hwtaytVT9PPtJrUGUtQo5PIjy12IBd2areOyTF5+zMx+ceAO2ajRi8YqVhD3/RVAKQ5iQizu8gIIiiH9zD7jAy2LigDb+gnDczawjpQAm6KAj/eIldzERqU/Pp05HwXj2pGcHNJB2aH1UBcQlREFhOfQ1gJIVEuyq1Ns/gJJA8lHjdEe+sR8MOdjojjQxyTUyoIR4szEXRO3edQbYGITPBFztxs193Znh+CW1IaP1JhkXDP1IEod4dDrpdIbFDAepeNOx76uRdlfSx3yr8CXs77tvywTJARodTHUqZCXTVx9aTZDISXKspZTMfkf0HVSLHqFmIZToeg/zzDWhdaTZa5jaRDee3d3eqziyry+n/oa8wGTT98bFZ1rmFsD8UVXxy5S9FtfYAyT2NTpi/69cMtrSpvc0o625H1CpyAr/74pWS7nnoBPmGQHDFhKlWRAysIxizs+bJ/VsNN2BXdjWv8j6yqax6TqeMdIWn55sGtE6qzoSOI88FGzLnsobg2sQIuV3W8YxbG/XtTjomJr6Nye1FlsDzPyGliEVwFO8ceK//HGTeJR/bjYBjIsLpJUEpqTr5STaxPx+CffrtwjNE3mXX8HurQikDefwGOl+B+L2kcXdY2KATlkfXVMGxchHH/4d1MqFsbpblSyecXQG//ZrDjqSieW4OZOfv5nvlubeYh6blL4+yUqOIaqsN4UZRn3yHBySTQb/rXe8u/Ap+0meAqwAudsX4DgjwHs41ikat1VLHf0vEvMLaJBpvwqvSabVUWf19OUDUxDkVDaSv/y7kpYOFiuFtunNYjmb2H5v65Q06sOcfhnfYa4IeXvTc4Di8muGQpDmX5qbqA8s90VwvZUhDQdY/P5ehZEKKSdJQQoRX48RlNU1MbAVebZ/gI4OYd1YqJfmnvxq+J8R1hnfmIGeA9QhzP+5FV2NJyDoT/GXIohnvtu8t/t/dLq2EMQjvl59k7DQas6vqM1c98BjyB9RWE2roI/+O2ZyPufbM+rpzNzJhqudCqErw3CTnrbpSB7Sn+y1kzvp75LJXSRZGB01aVfMM1Zx+bvEAhGzJhnoq0gkpfSsd5FXgkkd0aAJTbuF9Deddmhhy3snaK75yOcnU7GNO9X4FPrM+oUWug+9PiQMrEaR37cguPx2601QNuJcupIp9WrayLE/cMxdksezi545ModxIAAgWlfWXJn0Ivlt0znJAoECPiDRa1uAdLjhY/8WHWJ/5CnspdtE64V3mhocWgvfv+hmWCsWArkQY9umnd0NtI/YGvYU4d0swxQERSIqh2Sy3Uk0C5JETZ2SCs4acT5Q71C+buULRGZcrDf9vPEh//AU4nWSledm/Yl5UxGSQLuM6RdWj20toPCDQl/lw/quGWL1jHBfrf6j6nalT0PHLxxsmJ3yDKkltLvFvq2+Op091iwLO/rlDOchr9l61gbu9re2W+h1cdczd3LQX1Hqrf7zo2UTA2ou5ts/rCTYYJz0v3I4PahV955fGKKZJi4MX+/qMdRy4vc/yo62eaCiYwsvD59XRktW1Up1vd4rVSJ0R5qruplgr/XA3tjAOtDM8/KGR4+VXXtX9nxMUnxZDTSFmc/Sxenj6DjKpa07kELkNRJAga3Vn/68dlF6/qLoh+vkXK3Uz8pEH6EE3BNW+SlDoBmo2Fn86TxPhAenEXK/wcOaPb8tnflCBosrNLJ6iuGXeKJpETxNVHvRjhcrkQ+/ADqWoMIslOymeeu0JPTDvasTyao9CUEaCmtS5t7OyfSOaJ0Vx1/5AQOJfG6aNSM+jAapgYWWDIC2fU50PT4+0utGV1AzVNju9yEsY8IC+HZlNdH4BHbXCN9CLi0UOdbBo3nfQxr8g+gtlhWY1ZEbD07vTfVMjK5uiku9VpghrrNtlMLDC1uaQp+Bi24gnRH9brJtqi4XC+5iJQJ5p+HjviUkGWD0VkrWNUlaLca6NzzqW5WH10QpK/9k84eSjNFC9aaGRmIu2Qiu3TiDj4uB5ihcL9olret/4TwCSOGh0EAz3U7vGNlkUGu0r05uDprMVRaTHOPFMmx2R/VPWzAw/AWiVLIg+Vc/k2dm//a/zdC/Mq8NEcBhvHxooBBLxUjNsuz3AtU7y1iU92KF6cckJxjEOfP4pf/mwS/z/QB4FDRsP8tAJd2+IaQT4TVt+TaDnnezBsqLXfvU8Tu7vqPTN/BHifrCbH+0Cj2qx9DvXjXQaEyVgxKWJmh6BQ9sIZj9Bhl5a5m3AdHtLXWqZfkQvh49/SxDvTGdVp1BNd1zMgV0CQn9Zjcv2Nhi40VPSiiZxMnReV4l2LWn/OgGQGuYJQZGG9+ULrHxrMf4bISR+MF5VGxdO0MchLnLmmctEtApLVKLmf4TAZmM+w2gywssIeDNT8lIiaPBfp33bwgoI5F4Gkkox3+z3f/LQnuN32shElciaYv89mM8xEeKStn+WMk+cWbI3izbjDJmCn5Np0Q8dK3g2d6R7b4xUoO+sMiNHKoGUsdBLZb8ia7ixl598xiJdmpku2TgRxxJirTZfFp20NI920tQAF94/v4vO3qRx5RT7nFAtZWy9uwahPY23cL5HamtnIOAba6bhMu0T+Bc9McE28voCZ2zHT9VZDAqG9Z7dU5Rmb+aEU/1m8g8ovk7JxkuN685DC1OfrG9fxt4jykh5yNOXdTHwlJuxvql72AnSsQHX3a5Nw6XlN8TsRS+BpCkL16shwPDKG88KFtRh+ZclkWIxXRnX5pl1xBVJuk3duOo/w+GPm7TRaziSHCEo/PlUQZpYBmKljZQCX2Zj22E5U9g89t+TwSdMALyf7VQNogziQnHapM+EhAPKZnn8cHcz5QSgazB+iYutQWb9HdJ7I914UV8JLkdbIWcRIVR4PM44rtOQFi+x61Cj8tfePBxb6bC6T7332R5/KUT2hW/3g/89D2p62a5SnQ4frCBdedLUuIYpoz1z9+8bJuC3IMyIVO0EUm3nQzz/VVh7Ak4tVgkfHkbvp+W+9Y8iXUFaajP938HEjt6nbh355ohV2v/QFzrZDq38zJwBXbDu9d5RkPsAZti3RCqYL9GQwjynor0QMEJPcHkErzTUe5Y4/yDTNZfrSP2M4O4ESyqSiO+Cpxo8bIoBZXUtG5Odlu8dbXy2zDMabDuaGTDVp59JhIINWoIz5lAK2yJ6TB5TKszbnYJnVhz9OrVqM62hdjnvF4jherE8n8Sjfaf22glHxegjcsSihL/nY7hJkW/BX/4NfG9hb4Rf4Ec1oMSXv6pIT9qDWQD5fZ2uL2v+CyLAcrPUkV5EmQJjaBtLKQh/SfgCn/8IL96ZqKccmury8MgM8JITbfYLODgTZY/9gi+H/xnqjzDocgsMN6wYfQF75qL7G6CVpIDuSZzw//zUnjkn+9ZTDI92ij6kZsc7KMtlJeEkja5JJeaHCu5Ty2/hdb8KXU4p03VeSACtWTxjvOwtYMpkfNSlB6VB2Jjinzp1eQpkYzRsAjZhHjgpztjOeI2k4V0giF9+bYmzpVSF7JSgarIkACO2VrWjC4Z1uy6UYjmXJbcwOT2eY9jBa9MXJTbnUxp58YtvV7BlnMFH0pVJr4coPuC7+N/Oa6fefYO3YjV1feZ280EFXq0zHOoTIEBm8s0LNi0KP3e25wdJ8TSgVxq2R+2K5+uEnjGjOYOn2lVBAa+ZwED85ZMb0GUzphUHwWRU2dZyUEddT5yDWr1OuMA6BEsNukG/Ewl1HyGtX1+rHDdqoElX6foItdkuRvULBUkdUlR8D/B5HXqGSBliJDc296zQeRdgdHXy44kaeqL4IDd3nau9syxlEV6Cq1MPAALBUTnoCK2/UkrZrXiUJKZ9uH1guySx2ExAYKEbLiB0E8xpr2MONHPCliu44Um8n05syvcveF8s12nrL6PrBn0cDjvu4NBsfHv2vXxd/3x2J/xEOGzW/CVm9e3klIZ05I4n3oXhdVnhw64CrQ3+vAfvEY66FdhN+Wux8JgeIO5d5KM7YapnC9CArhlsnhqODLIhBQQmD6dfOHi67A/w/iGqyAa0faa42daud3M6VGEtFN9nJA3dEqdGsr4BPs+izYdSlaJPQfsy0xY/QDYFUf+loZPD8w7AwG90p8iDqGXmHsCQv4L25h03Aep/u7MvOdFn/t9GDm7B7chPQUJ6Ly7jSGV5KWa8W9sQoa7Q3D8OQKBDnuxXsR5Xo3v1tGPAqjilKkkUA5yyoeLTIdZJSzINg7BAsnxGyjOxe4pdcCleIT64FKI23e9TCQAP8eYAcK1HeFp6I32uPe/IXdysCO1rq9Z5g22bqzvd4UgWxeU1R7Htaa+vy88EpSdykRMrH1Z3VFRatyhpGUmaerxi9rXZ4pn4Vfhw2NwFAh6fz9g2Jf7HKKvNzuv9L49pyt/pLt3z78hJCcEWRq14dz2JMZM7AJB+PEgJgmSapP/ossZDStLy0Mf945Nt1TRGnDuW08DMO2WQmybfaeQqzpdW3Sg6dPbXIRdUpJjHPLL3srKGZI/CaHXO3Xv+SW6iPK5VN+N7GbONz2kzRcymooDf2x4RTPhOdOiHYw96u1VAFSa9+PKpgoCSAHUdoCJUGY4iKWFi3JtjNn9M3lrpO41k16KKBLJ86flWYPHiuAm10F/EexerPgplCJ6fzMLbLB8LW67oExNY6uKzOQVJ1RJLpPZWZ5hIWUL0hvx4fq07mZvXCH7Prxp4KVn2a+6bi4DTAyw0cPaOieMTEYNZHpq7e/KfXLXz9o+GqPuy2l9TddRKVasrsrzQ19kTq1AxQkOnswp3zsqXJp5HwAKvsANleEem+N7UbzzTaouJtqdrRdWrnMwrwdP2iN0WEyAEwBpmdprs4kS8NS6zdp/kw2Ui0GpQj9Het9Nt3ax7vZ8Km3EbsXUsQ/XbMl8wpoye3+oqrrL4lCVTMhZxX5SM5FbA6hH4Do+gyYQQ1nl15s0LBK6qGFkmtnoomoQlu0hk4UQNbLhMO5ZsPrYHHGvypuIRn0qr/Z207KzzFPpnRD9GeA/ezrDZH1pif9nS4ZkdA/QVGoUCJ2WksqryqERWob8J6XToieVUbTaNHd5UImgGjao0lZ7Lof9pOt/iOs/luzN7vUkrDVdcZTvGQdU6aK+yi09lQoSPz10o4RU24qTUA17dJmYOe2IppqPcnjBLnOTjgNVUqXwSeRknUKwrEWiD0QlyaMXzmJgIV76yLO2/+EY1AtnFGtdplXCId26O+lKOCCRHl+SQNDFbfYaUjhQis0es58NzV9MAIlDGpwUZ8B7dCUddoO/oOsbv/CxfflL08gwrfUQcu9SUWkXmSJpgAAA==",captain:"data:image/webp;base64,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",assistant:"data:image/webp;base64,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",reasoning:"data:image/webp;base64,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",group_manager:"data:image/webp;base64,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"},ua=o.createContext(void 0),ga=()=>{const e=o.useContext(ua);if(!e)throw new Error("useWaldiezTheme must be used within a WaldiezThemeProvider context");return e},ma=()=>{if("undefined"==typeof window)return!1;if("localStorage"in window){if("dark"===localStorage.getItem("waldiez-theme"))return!0;if("light"===localStorage.getItem("waldiez-theme"))return!1}if(document.body.classList.contains("waldiez-dark"))return!0;if(document.body.classList.contains("waldiez-light"))return!1;return window.matchMedia("(prefers-color-scheme: dark)").matches},pa=e=>{ha(e),fa(e)},ha=e=>{e?(document.body.classList.remove("waldiez-light"),document.body.classList.add("waldiez-dark")):(document.body.classList.remove("waldiez-dark"),document.body.classList.add("waldiez-light"))},fa=e=>{"undefined"!=typeof window&&"localStorage"in window&&localStorage.setItem("waldiez-theme",e?"dark":"light")},ya=({children:e,initial:t})=>{const[a,n]=o.useState((()=>"boolean"==typeof t?t:ma()));return s.jsx(ua.Provider,{value:{isDark:a,toggleTheme:()=>{n((e=>(pa(!e),!e)))},setTheme:e=>{pa(e),n(e)}},children:e})},ba={width:130},va={width:490},xa={width:180},Ca=(e,t)=>{if(!e||"object"!=typeof e)throw new Error("Invalid agent data");const a=e,n=((e,t)=>{let a=`wa-${V()}`;return a=t&&"string"==typeof t?t:Re(e),a})(a,t),s=(e=>{let t="user_proxy",a=e;if(!("agentType"in e)||"string"!=typeof e.agentType){if(!("data"in e)||"object"!=typeof e.data||!("agentType"in e.data)||"string"!=typeof e.data.agentType)return t;a=e.data}return Ge.includes(a.agentType)&&(t=a.agentType),t})(a),{name:o,description:i,tags:r,requirements:l,createdAt:d,updatedAt:c}=Ke(a,s),u=a.data||a,g=Ta(u,s),m=Na(s);return((e,t,a,n,s,o,i,r,l,d)=>"user_proxy"===e?new ge({id:t,agentType:e,name:a,description:n,tags:s,requirements:o,createdAt:i,updatedAt:r,data:l,rest:d}):"assistant"===e?new ee({id:t,agentType:e,name:a,description:n,tags:s,requirements:o,createdAt:i,updatedAt:r,data:l,rest:d}):"rag_user_proxy"===e?new ie({id:t,agentType:e,name:a,description:n,tags:s,requirements:o,createdAt:i,updatedAt:r,data:l,rest:d}):"reasoning"===e?new de({id:t,agentType:e,name:a,description:n,tags:s,requirements:o,createdAt:i,updatedAt:r,data:l,rest:d}):"captain"===e?new ae({id:t,agentType:e,name:a,description:n,tags:s,requirements:o,createdAt:i,updatedAt:r,data:l,rest:d}):"group_manager"===e?new se({id:t,agentType:e,name:a,description:n,tags:s,requirements:o,createdAt:i,updatedAt:r,data:l,rest:d}):new Z({id:t,agentType:e,name:a,description:n,tags:s,requirements:o,createdAt:i,updatedAt:r,data:l,rest:d}))(s,n,o,i,r,l,d,c,g,qe(a,m))},wa=(e,t)=>{const a=t?Sa(e):{...e},n={...a.data},s=a.data.label;delete a.data;const o=n.agentType,i={systemMessage:n.systemMessage,humanInputMode:n.humanInputMode,codeExecutionConfig:n.codeExecutionConfig,agentDefaultAutoReply:n.agentDefaultAutoReply,maxConsecutiveAutoReply:n.maxConsecutiveAutoReply,termination:n.termination,modelIds:n.modelIds,tools:n.tools,parentId:n.parentId,nestedChats:n.nestedChats,handoffs:n.handoffs,contextVariables:n.contextVariables,updateAgentStateBeforeReply:n.updateAgentStateBeforeReply,afterWork:n.afterWork};Ma(o,i,n),ja(i);for(const r of["description","name","tags","requirements","createdAt","updatedAt","agentType","parentId"])delete a[r];return{type:"agent",agentType:o,name:s,description:n.description,tags:n.tags,requirements:n.requirements,createdAt:n.createdAt,updatedAt:n.updatedAt,data:i,...a}},ka=(e,t,a)=>{const n=Be(e,t),s={...e.data,agentType:e.agentType,label:e.name,description:e.description,tags:e.tags,requirements:e.requirements,createdAt:e.createdAt,updatedAt:e.updatedAt};delete s.name;const o={id:e.id,type:"agent",data:s,style:{width:"group_manager"===e.agentType?va.width:"user_proxy"!==e.agentType?xa.width:ba.width},...e.rest,parentId:null!==e.data.parentId?e.data.parentId:void 0,position:n};return!0===a?Sa(o):o},ja=e=>{e.nestedChats&&0!==e.nestedChats.length||(e.nestedChats=[{messages:[],triggeredBy:[],condition:{conditionType:"string_llm",prompt:""},available:{type:"none",value:""}}])},Aa=(e,t)=>{const a=(e=>"systemMessage"in e&&"string"==typeof e.systemMessage?e.systemMessage:null)(e),n=((e,t)=>{let a="NEVER";return["user_proxy","rag_user_proxy"].includes(t)&&(a="ALWAYS"),"humanInputMode"in e&&"string"==typeof e.humanInputMode&&["ALWAYS","NEVER","TERMINATE"].includes(e.humanInputMode)&&(a=e.humanInputMode),a})(e,t),s=(e=>!(!("codeExecutionConfig"in e)||"object"!=typeof e.codeExecutionConfig||!e.codeExecutionConfig)&&e.codeExecutionConfig)(e),o=(e=>"agentDefaultAutoReply"in e&&"string"==typeof e.agentDefaultAutoReply?e.agentDefaultAutoReply:null)(e),i=(e=>"maxConsecutiveAutoReply"in e&&"number"==typeof e.maxConsecutiveAutoReply?e.maxConsecutiveAutoReply:null)(e),r=(e=>{if("termination"in e&&"object"==typeof e.termination&&e.termination){const t=e.termination;return{type:ta(t),keywords:aa(t),criterion:na(t),methodContent:sa(t)}}return{type:"none",keywords:[],criterion:null,methodContent:null}})(e),l=(e=>{const t=[];if("modelIds"in e&&Array.isArray(e.modelIds))for(const a of e.modelIds)"string"==typeof a&&t.push(a);return t})(e),d=(e=>{let t=[];return"tools"in e&&Array.isArray(e.tools)&&(t=e.tools.filter((e=>"object"==typeof e&&e&&"id"in e&&"executorId"in e&&"string"==typeof e.id&&"string"==typeof e.executorId))),t})(e),c=(e=>{if("parentId"in e&&"string"==typeof e.parentId)return e.parentId})(e),u=(e=>{const t=[],a={conditionType:"string_llm",prompt:""};if("nestedChats"in e&&Array.isArray(e.nestedChats))for(const n of e.nestedChats){let e=[];"triggeredBy"in n&&Array.isArray(n.triggeredBy)&&(e=n.triggeredBy.filter((e=>"string"==typeof e)));const a=Ze(n),s=We(n,""),o=He(n);t.push({triggeredBy:e,messages:a,condition:s,available:o})}return 0===t.length&&t.push({triggeredBy:[],messages:[],condition:a,available:{type:"none",value:""}}),t})(e),g=(e=>"contextVariables"in e&&"object"==typeof e.contextVariables?e.contextVariables:{})(e),m=(e=>{if("updateAgentStateBeforeReply"in e&&"object"==typeof e.updateAgentStateBeforeReply&&e.updateAgentStateBeforeReply)if("type"in e.updateAgentStateBeforeReply&&"content"in e.updateAgentStateBeforeReply){if("string"==typeof e.updateAgentStateBeforeReply.type&&"string"==typeof e.updateAgentStateBeforeReply.content){if("string"===e.updateAgentStateBeforeReply.type)return[{type:"string",content:e.updateAgentStateBeforeReply.content}];if("callable"===e.updateAgentStateBeforeReply.type)return[{type:"callable",content:e.updateAgentStateBeforeReply.content}]}}else if(Array.isArray(e.updateAgentStateBeforeReply))return e.updateAgentStateBeforeReply.filter((e=>"object"==typeof e&&e&&"type"in e&&"string"==typeof e.type&&"content"in e&&"string"==typeof e.content));return[]})(e),p=Ve(e),h=(e=>"handoffs"in e&&Array.isArray(e.handoffs)?e.handoffs.filter((e=>"string"==typeof e)):[])(e);return new E({systemMessage:a,humanInputMode:n,codeExecutionConfig:s,agentDefaultAutoReply:o,maxConsecutiveAutoReply:i,termination:r,modelIds:l,tools:d,parentId:c,nestedChats:u,contextVariables:g,updateAgentStateBeforeReply:m,afterWork:p,handoffs:h})},Na=e=>{const t=["id","name","description","tags","requirements","createdAt","updatedAt","data"];return"rag_user_proxy"===e&&t.push("retrieveConfig"),"assistant"===e&&t.push("isMultimodal"),"reasoning"===e&&t.push("verbose","reasonConfig"),"captain"===e&&t.push("agentLib","toolLib","maxRound","maxTurns"),"group_manager"===e&&t.push("initialAgentId","maxRound","adminName","speakers","enableClearHistory","sendIntroductions","groupName"),t},Ta=(e,t)=>{const a=Aa(e,t);return"rag_user_proxy"===t?new le({...a,retrieveConfig:xt(e)}):"assistant"===t?new te({...a,isMultimodal:Qe(e)}):"reasoning"===t?new ue({...a,verbose:ct(e),reasonConfig:ut(e)}):"captain"===t?new ne({...a,agentLib:Me(e),toolLib:Ie(e),maxRound:Ee(e),maxTurns:De(e)}):"group_manager"===t?new oe({...a,initialAgentId:tt(e),maxRound:Je(e),adminName:Ye(e),speakers:Xe(e),enableClearHistory:$e(e),sendIntroductions:_e(e),groupName:et(e)}):a},Sa=e=>{const t={...e};return t.data.modelIds=[],t.data.tools=[],t.data.nestedChats=[],t.data.handoffs=[],t.data.codeExecutionConfig&&(t.data.codeExecutionConfig.functions=[]),"rag_user_proxy"===e.data.agentType&&(t.data.retrieveConfig={...t.data.retrieveConfig,model:null,docsPath:[]}),"group_manager"===e.data.agentType&&(t.data.speakers={...t.data.speakers,allowRepeat:[],allowedOrDisallowedTransitions:{},order:[]},t.data.initialAgentId=void 0),t},Ma=(e,t,a)=>{"rag_user_proxy"===e&&Ia(t,a),"reasoning"===e&&Ea(t,a),"captain"===e&&Da(t,a),"assistant"===e&&(t.isMultimodal=Qe(a)),"group_manager"===e&&Ra(t,a)},Ia=(e,t)=>{e.retrieveConfig=xt(t)},Ea=(e,t)=>{e.verbose=ct(t),e.reasonConfig=ut(t)},Da=(e,t)=>{e.agentLib=Me(t),e.toolLib=Ie(t),e.maxRound=Ee(t),e.maxTurns=De(t)},Ra=(e,t)=>{e.maxRound=Je(t),e.adminName=Ye(t),e.speakers=Xe(t),e.enableClearHistory=$e(t),e.sendIntroductions=_e(t),e.initialAgentId=tt(t),e.groupName=et(t)},Pa=["string","method","rag_message_generator","none"],Oa=e=>za(e),La=e=>({type:e.type,content:e.content,context:e.context,useCarryover:e.useCarryover}),za=e=>{const t={type:"none",useCarryover:!1,content:null,context:{}};return"message"in e&&e.message&&(t.type=Fa(e.message),t.content=Ua(e.message),t.context=qa(e.message),t.useCarryover=Ba(e.message)),t},Fa=e=>{let t="none";return"type"in e&&e.type&&"string"==typeof e.type&&Pa.includes(e.type)&&(t=e.type),t},Ua=e=>{let t=null;return"content"in e&&e.content&&"string"==typeof e.content&&(t=e.content),t},qa=e=>{let t={};return"context"in e&&e.context&&"object"==typeof e.context&&(t=Object.keys(e.context).reduce(((t,a)=>(t[a.toString()]=e.context[a],t)),{})),t},Ba=e=>{let t=!1;return"useCarryover"in e&&"boolean"==typeof e.useCarryover&&(t=e.useCarryover),"useCarryover"in e&&"boolean"==typeof e.useCarryover&&(t=e.useCarryover),t},Ha=e=>"summary"in e?Va(e):{method:null,prompt:"",args:{}},Wa=e=>({method:e.method,prompt:e.prompt,args:e.args}),Va=e=>{const t={method:null,prompt:"",args:{}};return"summary"in e&&e.summary&&(t.method=Ga(e),t.prompt=Ka(e),t.args=Qa(e)),t},Ga=e=>{let t=null;return"method"in e.summary&&e.summary.method&&("reflectionWithLlm"===e.summary.method||"reflectionWithLlm"===e.summary.method?t="reflectionWithLlm":"lastMsg"!==e.summary.method&&"lastMsg"!==e.summary.method||(t="lastMsg")),t},Ka=e=>{let t="";return"prompt"in e.summary&&"string"==typeof e.summary.prompt&&(t=e.summary.prompt),t},Qa=e=>{let t={};return"args"in e.summary&&e.summary.args&&"object"==typeof e.summary.args&&(t=Object.keys(e.summary.args).reduce(((t,a)=>(t[a.toString()]=e.summary.args[a],t)),{})),t},Za=e=>{let t=!0;return"clearHistory"in e&&"boolean"==typeof e.clearHistory&&(t=e.clearHistory),t},Xa=e=>{let t="Chat";return"label"in e&&e.label&&"string"==typeof e.label&&(t=e.label),t},Ja=e=>{let t="Chat Description";return"description"in e&&e.description&&"string"==typeof e.description&&(t=e.description),t},Ya=(e,t)=>{let a=t;return"position"in e&&"number"==typeof e.position&&(a=Math.floor(e.position)),a},$a=e=>{let t=null;return"maxTurns"in e&&"number"==typeof e.maxTurns&&(t=Math.floor(e.maxTurns)),t},_a=e=>{const t={message:null,reply:null};return"nestedChat"in e&&e.nestedChat&&("message"in e.nestedChat&&e.nestedChat.message&&(t.message=Oa({message:e.nestedChat.message})),"reply"in e.nestedChat&&e.nestedChat.reply&&(t.reply=Oa({message:e.nestedChat.reply}))),t},en=e=>{const t=[];return"prerequisites"in e&&Array.isArray(e.prerequisites)&&e.prerequisites.forEach((e=>{"string"==typeof e&&t.push(e)})),t},tn=e=>{let t=-1;if("order"in e&&"number"==typeof e.order){const a=Math.floor(e.order);t=a>=0?a:-1}return t},an=(e,t,a,n,s,o)=>{const i=n.data.agentType;let r=((e,t)=>{let a="chat";"type"in t&&"string"==typeof t.type&&t.type&&fe.includes(t.type)?a=t.type:"data"in t&&"object"==typeof t.data&&null!==t.data&&"type"in t.data&&"string"==typeof t.data.type&&t.data.type&&fe.includes(t.data.type)&&(a=t.data.type);let n=(null==e?void 0:e.type)??a;return fe.includes(n)||(n="chat"),n})(e,a);"type"in o&&"string"==typeof o.type&&fe.includes(o.type)&&(e.type=o.type,r=e.type),delete o.type,delete o.source,delete o.target;const l=oa[i];e.type=r,"hidden"!==e.type&&(e.animated=sn(r)),nn(e,r,l);const d=n.data.label,c=s.data.label;d&&c&&(t.name=`${d} => ${c}`),e.data={...t,label:t.name,order:"nested"===r?-1:t.order},delete e.data.name,t.order="nested"===r?-1:t.order,on(e,o),rn(e,o);return{...e,...o}},nn=(e,t,a)=>{"hidden"!==e.type&&(e.markerEnd="nested"!==t?{type:i.MarkerType.ArrowClosed,color:a,width:10,height:10}:void 0,e.style={stroke:a,strokeWidth:1})},sn=(e,t,a)=>"nested"===e,on=(e,t)=>{let a=null;if("sourceHandle"in t&&"string"==typeof t.sourceHandle&&(t.sourceHandle.includes("-source")||t.sourceHandle.includes("-target"))){const n=t.sourceHandle.includes("-source"),s=["top","left","right","bottom"].find((e=>t.sourceHandle.includes(e)));s&&(a=`agent-handle-${s}-${n?"source":"target"}-${n?e.source:e.target}`)}t.sourceHandle=a,e.sourceHandle=a},rn=(e,t)=>{let a=null;if("targetHandle"in t&&"string"==typeof t.targetHandle&&(t.targetHandle.includes("-source")||t.targetHandle.includes("-target"))){const n=t.targetHandle.includes("source"),s=["top","left","right","bottom"].find((e=>t.targetHandle.includes(e)));s&&(a=`agent-handle-${s}-${n?"source":"target"}-${n?e.source:e.target}`)}t.targetHandle=a,e.targetHandle=a},ln=e=>{if(!e||"object"!=typeof e)throw new Error("Invalid edge data");const t="id"in e&&"string"==typeof e.id&&"data"in e&&"object"==typeof e.data&&null!==e.data,a=(e=>{if("source"in e&&"string"==typeof e.source)return e.source;if("data"in e&&"object"==typeof e.data&&null!==e.data&&"source"in e.data&&"string"==typeof e.data.source)return e.data.source;throw new Error("Source not found in chat data")})(e);e.source=a;const n=(e=>{if("target"in e&&"string"==typeof e.target)return e.target;if("data"in e&&"object"==typeof e.data&&null!==e.data&&"target"in e.data&&"string"==typeof e.data.target)return e.data.target;throw new Error("Target not found in chat data")})(e);if(e.target=n,!t)throw new Error((e=>{const t=[];return"id"in e&&"string"==typeof e.id||t.push("id must be a string"),"data"in e&&"object"==typeof e.data&&null!==e.data||t.push("data must be an object"),"source"in e&&"string"==typeof e.source||t.push("source must be a string"),"target"in e&&"string"==typeof e.target||t.push("target must be a string"),t.length>0?`Invalid edge data: ${t.join(", ")}`:"Invalid edge data ?"})(e))},dn=e=>{let t=!1;return"silent"in e&&"boolean"==typeof e.silent&&(t=e.silent),t},cn=(e,t,a)=>{ln(e),(e=>{"type"in e&&"string"==typeof e.type&&fe.includes(e.type)?e.type=e.type:"data"in e&&"object"==typeof e.data&&null!==e.data&&"type"in e.data&&"string"==typeof e.data.type&&fe.includes(e.data.type)?e.type=e.data.type:e.type="chat"})(e);const n=t.find((t=>t.id===e.id));if(!n)throw new Error(`Edge not found: ${e.id}`);const s=a.find((t=>t.id===e.source));if(!s||"agent"!==s.type)throw new Error(`Source node not found: ${e.source}`);if(n.source!==e.source)throw new Error(`Source node does not match edge source: ${e.source}`);const o=a.find((t=>t.id===e.target));if(!o||"agent"!==o.type)throw new Error(`Target node not found: ${e.target}`);if(n.target!==e.target)throw new Error(`Target node does not match edge target: ${e.target}`);return{edge:n,sourceNode:s,targetNode:o}},un=e=>{let t="user_proxy";return"sourceType"in e&&"string"==typeof e.sourceType&&(t=e.sourceType),me.includes(t)?t:"assistant"},gn=e=>{let t="assistant";return"targetType"in e&&"string"==typeof e.targetType&&(t=e.targetType),me.includes(t)?t:"user_proxy"},mn=(e,t,a,n)=>{if(!e||"object"!=typeof e)throw new Error("Invalid edge data");const s=e;let o=null;try{o=cn(s,t,a)}catch(p){throw new Error(p.message)}const{edge:i,sourceNode:r,targetNode:l}=o,d=s.id,c=fn(i),u=yn(s.data,n),g=(e=>{const t={...e};return delete t.id,delete t.data,delete t.type,delete t.source,delete t.target,t})({...s,...i}),m=an(i,u,s,r,l,g);Object.entries(m).forEach((([e,t])=>{"data"!==e&&"source"!==e&&"target"!==e&&"id"!==e&&"type"!==e&&(g[e]=t)}));return{chat:new he({id:d,data:u,type:c,source:r.id,target:l.id,rest:g}),edge:m}},pn=(e,t)=>{const a=e.data,n=e.type||fn(e),s={...a},o={sourceType:un(s),targetType:gn(s),name:Xa(s),order:tn(s),description:Ja(s),position:Ya(s,t),clearHistory:Za(s),maxTurns:$a(s),message:La(s.message),summary:Wa(s.summary),nestedChat:_a(s),prerequisites:en(s),condition:We(s),available:He(s),afterWork:Ve(s),silent:dn(s),realSource:s.realSource,realTarget:s.realTarget},i={...e};"hidden"===i.type&&(i.hidden=!0),delete i.data,delete i.type,delete i.source,delete i.target,delete i.id;const r=new he({id:e.id,data:o,type:n,source:e.source,target:e.target,rest:i}),l={...r,...r.rest};return delete l.rest,l},hn=e=>{var t,a;const n={label:e.data.name,sourceType:e.data.sourceType,targetType:e.data.targetType,description:e.data.description,position:e.data.position,order:e.data.order,clearHistory:e.data.clearHistory,message:e.data.message,nestedChat:e.data.nestedChat,prerequisites:e.data.prerequisites,summary:e.data.summary,maxTurns:e.data.maxTurns,condition:e.data.condition,available:e.data.available,afterWork:e.data.afterWork,realSource:e.data.realSource,realTarget:e.data.realTarget,silent:e.data.silent},s=(null==(t=e.rest)?void 0:t.style)||{};return s.strokeWidth=1,{id:e.id,source:e.source,target:e.target,type:e.type,data:n,hidden:!0===(null==(a=e.rest)?void 0:a.hidden)||"hidden"===e.type,...e.rest,style:s}},fn=e=>"data"in e&&"object"==typeof e.data&&"type"in e.data&&"string"==typeof e.data.type&&fe.includes(e.data.type.toLocaleLowerCase())?e.data.type:"type"in e&&"string"==typeof e.type&&fe.includes(e.type.toLocaleLowerCase())?e.type:"chat",yn=(e,t)=>{if(!e||"object"!=typeof e)throw new Error("Invalid chat data");const a=Pe(e,"New connection"),n=Oe(e,"New connection"),s=un(e),o=gn(e),i=Za(e),r=$a(e),l=Ya(e,t),d=tn(e),c=Oa(e),u=Ha(e),g=_a(e),m=en(e),p=(e=>{let t=null;return"realSource"in e&&"string"==typeof e.realSource&&(t=e.realSource),t})(e),h=(e=>{let t=null;return"realTarget"in e&&"string"==typeof e.realTarget&&(t=e.realTarget),t})(e),f=We(e),y=He(e),b=Ve(e),v=dn(e);return new pe({sourceType:s,targetType:o,name:a,description:n,clearHistory:i,maxTurns:r,position:l,order:d,message:c,summary:u,nestedChat:g,prerequisites:m,condition:f,available:y,realSource:p,realTarget:h,afterWork:b,silent:v})},bn=(e,t,a,n)=>{const s=wa(e,n),o=t.find((t=>t.id===e.id));return o&&Object.keys(o).forEach((e=>{["id","type","parentId","data"].includes(e)||delete s[e]})),s.agentType=e.data.agentType,vn(s,t,a),s},vn=(e,t,a)=>{const n=t.filter((e=>"agent"===e.type)),s=e.data.parentId,o=((e,t,a,n)=>{const s=n.filter((t=>t.source===e));return a?s.filter((e=>{const n=t.find((t=>t.id===e.source)),s=t.find((t=>t.id===e.target));return n&&s&&n.data.parentId===a&&s.data.parentId!==a})):s.filter((e=>"nested"===e.type))})(e.id,n,s,a),i=e.data.nestedChats||[];0===o.length||i.length>0&&i[0].messages.length>0?e.data.nestedChats=i:e.data.nestedChats=[{triggeredBy:[e.id],messages:o.map((e=>({id:e.id,isReply:!1}))),condition:{conditionType:"string_llm",prompt:""},available:{type:"none",value:""}}]},xn=e=>{if(!e||"object"!=typeof e)return new je({id:"wt-"+V(),name:"Model",description:"A new model",tags:[],requirements:[],createdAt:(new Date).toISOString(),updatedAt:(new Date).toISOString(),data:new ke});const t=e,a=Re(t),{name:n,description:s,tags:o,requirements:i,createdAt:r,updatedAt:l}=An(t),d=t.data||t,c=Nn(d),u=qe(t,["id","type","name","description","tags","requirements","createdAt","updatedAt","data"]);return new je({id:a,name:n,description:s,tags:o,requirements:i,createdAt:r,updatedAt:l,data:c,rest:u})},Cn=(e,t)=>{const a=e.data.apiKey?t?"REPLACE_ME":e.data.apiKey:null,n=qe(e,["id","type","parentId","data"]),{defaultHeaders:s,extras:o,aws:i}=t?kn(e):e.data;return{id:e.id,type:"model",name:e.data.label,description:e.data.description,tags:e.data.tags,requirements:e.data.requirements,createdAt:e.data.createdAt,updatedAt:e.data.updatedAt,data:{apiKey:a,apiType:e.data.apiType,apiVersion:e.data.apiVersion,baseUrl:e.data.baseUrl,temperature:e.data.temperature,topP:e.data.topP,maxTokens:e.data.maxTokens,aws:i,extras:o,defaultHeaders:s,price:e.data.price},...n}},wn=(e,t)=>{const a=Be(e,t),n={...e.data,label:e.name,description:e.description,tags:e.tags,requirements:e.requirements,createdAt:e.createdAt,updatedAt:e.updatedAt};n.label=e.name,e.rest&&"position"in e.rest&&delete e.rest.position;const s=n;return{id:e.id,type:"model",data:s,position:a,...e.rest}},kn=e=>{const t={...e.data.defaultHeaders},a={...e.data.extras},n={...e.data.aws||{region:null,accessKey:null,secretKey:null,sessionToken:null,profileName:null}};for(const s in t)"string"==typeof t[s]&&(t[s]="REPLACE_ME");for(const s in a)"string"==typeof a[s]&&(a[s]="REPLACE_ME");for(const s in n)"string"==typeof n[s]&&(n[s]="REPLACE_ME");return{defaultHeaders:t,extras:a,aws:n}},jn=e=>{let t=null;return"region"in e&&"string"==typeof e.region&&(t=e.region),t},An=e=>{const t=((e,t)=>{let a=e??"Model";return"name"in t&&"string"==typeof t.name&&(a=t.name),a})(Pe(e,null),e);return{name:t,description:Oe(e,"A new model"),tags:Le(e),requirements:ze(e),createdAt:Fe(e),updatedAt:Ue(e)}},Nn=e=>{const t=(e=>{let t=null;return"baseUrl"in e&&"string"==typeof e.baseUrl&&(t=e.baseUrl),t})(e),a=(e=>{let t=null;return"apiKey"in e&&"string"==typeof e.apiKey&&(t=e.apiKey),t})(e),n=(e=>{let t="openai";return"apiType"in e&&"string"==typeof e.apiType&&["openai","azure","bedrock","deepseek","google","anthropic","cohere","mistral","groq","together","nim","other"].includes(e.apiType)&&(t=e.apiType),t})(e),s=(e=>{let t=null;return"apiVersion"in e&&"string"==typeof e.apiVersion&&(t=e.apiVersion),t})(e),o=(e=>{let t=null;return"temperature"in e&&"number"==typeof e.temperature&&(t=e.temperature),t})(e),i=(e=>{let t=null;return"topP"in e&&"number"==typeof e.topP&&(t=e.topP),t})(e),r=(e=>{let t=null;return"maxTokens"in e&&"number"==typeof e.maxTokens&&(t=e.maxTokens),t})(e),l=(e=>{const t={region:null,accessKey:null,secretKey:null,sessionToken:null,profileName:null};return"aws"in e&&"object"==typeof e.aws&&e.aws&&(t.region=jn(e.aws),t.accessKey=(e=>{let t=null;return"accessKey"in e&&"string"==typeof e.accessKey&&(t=e.accessKey),t})(e.aws),t.secretKey=(e=>{let t=null;return"secretKey"in e&&"string"==typeof e.secretKey&&(t=e.secretKey),t})(e.aws),t.sessionToken=(e=>{let t=null;return"sessionToken"in e&&"string"==typeof e.sessionToken&&(t=e.sessionToken),t})(e.aws),t.profileName=jn(e.aws)),t})(e),d=(e=>{let t={};return"extras"in e&&"object"==typeof e.extras&&(t=e.extras),t})(e),c=(e=>{let t={};return"defaultHeaders"in e&&"object"==typeof e.defaultHeaders&&(t=e.defaultHeaders),t})(e),u=(e=>{const t={promptPricePer1k:null,completionTokenPricePer1k:null};return"price"in e&&"object"==typeof e.price&&e.price&&("promptPricePer1k"in e.price&&"number"==typeof e.price.promptPricePer1k&&(t.promptPricePer1k=e.price.promptPricePer1k),"completionTokenPricePer1k"in e.price&&"number"==typeof e.price.completionTokenPricePer1k&&(t.completionTokenPricePer1k=e.price.completionTokenPricePer1k)),t})(e);return new ke({baseUrl:t,apiKey:a,apiType:n,apiVersion:s,temperature:o,topP:i,maxTokens:r,aws:l,extras:d,defaultHeaders:c,price:u})},Tn=e=>{if(!e||"object"!=typeof e)return new Se({id:"wt-"+V(),name:"new_tool",description:"A new tool",tags:[],requirements:[],createdAt:(new Date).toISOString(),updatedAt:(new Date).toISOString(),data:new Ae});const t=e,a=Re(t),{name:n,description:s,tags:o,requirements:i,createdAt:r,updatedAt:l}=Dn(t),d=qe(t,["id","type","name","description","tags","requirements","createdAt","updatedAt","data"]),c=Rn(t.data||t,n),u=In(t.data||t),g=En(t.data||t),m=new Ae({toolType:c,content:u,secrets:g});return new Se({id:a,name:n,description:s,tags:o,requirements:i,createdAt:r,updatedAt:l,data:m,rest:d})},Sn=(e,t)=>{const a={...e.data.secrets};if(t)for(const i in a)"string"==typeof a[i]&&(a[i]="REPLACE_ME");const n=qe(e,["id","type","parentId","data"]),s=e.data.label,o="waldiez_shared"===s?"shared":e.data.toolType;return{id:e.id,type:"tool",name:s,description:e.data.description,tags:e.data.tags,requirements:e.data.requirements,createdAt:e.data.createdAt,updatedAt:e.data.updatedAt,data:{content:e.data.content,toolType:o,secrets:a},...n}},Mn=(e,t)=>{const a=Be(e,t),n={...e.data,label:e.name,description:e.description,tags:e.tags,requirements:e.requirements,createdAt:e.createdAt,updatedAt:e.updatedAt};e.rest&&"position"in e.rest&&delete e.rest.position;const s=n;return{id:e.id,type:"tool",data:s,position:a,...e.rest}},In=e=>{let t=Ne;return"content"in e&&"string"==typeof e.content&&(t=e.content),t},En=e=>{let t={};return"secrets"in e&&"object"==typeof e.secrets&&null!==e.secrets&&(t=Object.entries(e.secrets).reduce(((e,[t,a])=>(e[t]=a.toString(),e)),{})),t},Dn=e=>({name:Pe(e,"new_tool"),description:Oe(e,"A new tool"),tags:Le(e),requirements:ze(e),createdAt:Fe(e),updatedAt:Ue(e)}),Rn=(e,t)=>{let a="custom";return"toolType"in e&&"string"==typeof e.toolType&&["shared","custom","langchain","crewai"].includes(e.toolType)&&(a=e.toolType),"waldiez_shared"===t&&(a="shared"),a},Pn=(e,t)=>{let a=t;return"storageId"in e&&"string"==typeof e.storageId&&(a=e.storageId),a},On=(e,t,a,n,s,o)=>{let i=`${e}_agents`;if(!(i in t&&Array.isArray(t[i])||(i=i.replace(/([a-z])([A-Z])/g,"$1 $2").replace(/([0-9])([A-Z])/g,"$1 $2").replace(/_/g," ").replace(/-/g," ").trim().toLowerCase().split(" ").map((e=>Q(e))).join("").replace(/^[A-Z]/,(e=>e.toLowerCase())),i in t&&Array.isArray(t[i]))))return[];const r=t[i],l=[],d=a.map((e=>e.id));return a.forEach((e=>{if("agent"===e.type){const t=r.find((t=>Re(t)===e.id));if(t){const a={...e};delete a.id,delete a.data,delete a.type,delete a.parentId;const n=Ca({...t,...a});l.push(n)}}})),Ln(e,l,n,s,o,d)},Ln=(e,t,a,n,s,o)=>{const i=t.map((e=>zn(e,a))).map((e=>Fn(e,n))).map((e=>Un(e,o,s)));return"rag_user_proxy"===e?qn(i,a):i},zn=(e,t)=>(e.data.modelIds&&(e.data.modelIds=e.data.modelIds.filter((e=>t.includes(e)))),e),Fn=(e,t)=>{const a=t.filter((t=>e.data.tools.some((e=>e.id===t))));return e.data.tools=e.data.tools.filter((e=>a.includes(e.id))),e},Un=(e,t,a)=>(e.data.nestedChats=e.data.nestedChats.filter((e=>e.triggeredBy.some((e=>a.includes(e)||t.includes(e))))),e.data.nestedChats.forEach((e=>{e.messages=e.messages.filter((e=>a.includes(e.id)||t.includes(e.id)))})),e),qn=(e,t)=>e.map((e=>{if("data"in e&&"object"==typeof e.data&&"retrieveConfig"in e.data&&"object"==typeof e.data.retrieveConfig&&e.data.retrieveConfig&&"model"in e.data.retrieveConfig&&"string"==typeof e.data.retrieveConfig.model){const a=e.data.retrieveConfig.model;t.includes(a)||(e.data.retrieveConfig.model=null)}return e})),Bn=["model","tool","agent"],Hn=["user_proxy","assistant","rag_user_proxy"],Wn=e=>{if(!("type"in e)||"string"!=typeof e.type||!Bn.includes(e.type))return null;const t=Vn(e);if(!t)return null;const a=Gn(e,e.type);return a?{type:e.type,position:t,data:a}:null},Vn=e=>{if(!("position"in e)||"object"!=typeof e.position)return null;const t=e.position;return"x"in t&&"number"==typeof t.x&&"y"in t&&"number"==typeof t.y?t:null},Gn=(e,t)=>{const a={};if("agent"===t){const t=e.data||{};if(!("agentType"in t)||"string"!=typeof t.agentType||!Hn.includes(t.agentType))return a;a.agentType=t.agentType}return a},Kn=(e,t)=>{if("data"in t&&"object"==typeof t.data&&t.data){const a=t.data;"label"in a&&"string"==typeof a.label&&(e.data.label=a.label)}},Qn=(e,t)=>{["models","tools"].forEach((a=>{if(!(a in e)||!Array.isArray(e[a]))return;const n=e[a];t.forEach((e=>{const t=n.find((t=>Re(t)===e.id));t&&Kn(e,t)}))})),Zn(e,t)},Zn=(e,t)=>{if(!("agents"in e)||"object"!=typeof e.agents)return;const a=e.agents;t.forEach((e=>{"agent"===e.type&&Hn.forEach((t=>{const n=`${t}s`;n in a&&Array.isArray(a[n])&&a[n].forEach((a=>{if(e.id===a.id&&(e.data.agentType=t,Kn(e,a)),"data"in a&&"object"==typeof a.data&&a.data){const t=a.data;"parentId"in t&&"string"==typeof t.parentId&&(e.data.parentId=t.parentId)}}))}))}))},Xn={importFlow:(e,t)=>{const a=ts(e);if(!a.type||"flow"!==a.type)return Ce;const{id:n,storageId:s,name:o,description:i,tags:r,requirements:l,createdAt:d,updatedAt:c,rest:u}=(e=>{const t=Re(e),a=Pe(e,"Waldiez Flow"),n=Oe(e,"A waldiez flow"),s=Le(e),o=ze(e),i=Fe(e),r=Ue(e),l=qe(e,["id","storageId","name","description","tags","requirements","createdAt","updatedAt","data"]);return{id:t,storageId:Pn(e,t),name:a,description:n,tags:s,requirements:o,createdAt:i,updatedAt:r,rest:l}})(a),g=a.data||a,m=t||n,p=Jn(g);let h=s;return s===n&&"string"==typeof t&&(h=t),new ve({id:m,storageId:h,name:o,description:i,tags:r,requirements:l,data:p,createdAt:d,updatedAt:c,rest:u})},toReactFlow(e){const t=_n(e),a=$n(e);return{flowId:e.id,isAsync:e.data.isAsync??!1,cacheSeed:e.data.cacheSeed,storageId:e.storageId,name:e.name,description:e.description,tags:e.tags,requirements:e.requirements,createdAt:e.createdAt,updatedAt:e.updatedAt,edges:t,nodes:a,viewport:e.data.viewport||{zoom:1,position:{x:0,y:0}},...e.rest}},exportFlow:(e,t,a=!1)=>({id:e.flowId,type:"flow",version:"0.4.9",storageId:e.storageId,name:e.name,description:e.description,tags:e.tags,requirements:e.requirements,createdAt:e.createdAt||(new Date).toISOString(),updatedAt:e.updatedAt||(new Date).toISOString(),data:Yn(e,t,a)})},Jn=e=>{const t=(e=>{let t=!1;return"isAsync"in e&&"boolean"==typeof e.isAsync&&(t=e.isAsync),t})(e),a=(e=>{let t=null;if("cacheSeed"in e)if("number"==typeof e.cacheSeed)t=parseInt(`${e.cacheSeed}`,10);else if(null===e.cacheSeed)t=null;else if("string"==typeof e.cacheSeed)try{const a=parseInt(e.cacheSeed,10);isNaN(a)||(t=a)}catch(a){}return t})(e),n=(e=>{let t={zoom:1,x:0,y:0};return"viewport"in e&&"object"==typeof e.viewport&&e.viewport&&"zoom"in e.viewport&&"x"in e.viewport&&"y"in e.viewport&&"number"==typeof e.viewport.zoom&&"number"==typeof e.viewport.x&&"number"==typeof e.viewport.y&&(t=e.viewport),t})(e),s=(e=>{const t=[];return"nodes"in e&&Array.isArray(e.nodes)?(e.nodes.forEach((e=>{const a=Wn(e);if(!a)return;const{type:n,position:s,data:o}=a;let i;"parentId"in e&&"string"==typeof e.parentId&&(i=e.parentId);const r=Re(e),l=qe(e,["id","type","parentId","data"]);t.push({id:r,type:n,position:{x:s.x,y:s.y},parentId:i,data:o,...l})})),Qn(e,t),t):t})(e);let o=(e=>{if(!("edges"in e)||!Array.isArray(e.edges))return[];const t=[];return e.edges.forEach((e=>{if(!("id"in e)||"string"!=typeof e.id)return;if(!("type"in e)||"string"!=typeof e.type||!fe.includes(e.type))return;if(!("source"in e)||"string"!=typeof e.source)return;if(!("target"in e)||"string"!=typeof e.target)return;const a=qe(e,["id","type","source","target","data","hidden"]);t.push({id:e.id,type:e.type,source:e.source,target:e.target,hidden:"hidden"===e.type,data:{},...a})})),t})(e);const i=((e,t,a)=>{if(!("chats"in e)||!Array.isArray(e.chats))return{chats:[],edges:a};const n=[],s=[];return e.chats.forEach(((e,o)=>{try{const{chat:i,edge:r}=mn(e,a,t,o);n.push(i),s.push(r)}catch(i){}})),{chats:n,edges:s}})(e,s,o);o=i.edges;const r=i.chats,l=((e,t)=>{const a=[];if(!("models"in e)||!Array.isArray(e.models))return a;const n=e.models;return t.forEach((e=>{if("model"===e.type){const t=n.find((t=>Re(t)===e.id));if(t){const n={...e};delete n.id,delete n.data,delete n.type,delete n.parentId;const s=xn({...t,...n});a.push(s)}}})),a})(e,s),d=((e,t)=>{const a=[];if(!("tools"in e)||!Array.isArray(e.tools))return a;const n=e.tools;return t.forEach((e=>{if("tool"===e.type){const t=n.find((t=>Re(t)===e.id));if(t){const n={...e};delete n.id,delete n.data,delete n.type,delete n.parentId;const s=Tn({...t,...n});a.push(s)}}})),a})(e,s),c=((e,t,a,n,s)=>{if(!("agents"in e)||"object"!=typeof e.agents)return{userProxyAgents:[],assistantAgents:[],ragUserProxyAgents:[],reasoningAgents:[],captainAgents:[],groupManagerAgents:[]};const o=e.agents;return{userProxyAgents:On("user_proxy",o,t,a,n,s),assistantAgents:On("assistant",o,t,a,n,s),ragUserProxyAgents:On("rag_user_proxy",o,t,a,n,s),reasoningAgents:On("reasoning",o,t,a,n,s),captainAgents:On("captain",o,t,a,n,s),groupManagerAgents:On("group_manager",o,t,a,n,s)}})(e,s,l.map((e=>e.id)),d.map((e=>e.id)),o.map((e=>e.id)));return new we({nodes:s,edges:o,agents:c,models:l,tools:d,chats:r,isAsync:t,cacheSeed:a,viewport:n})},Yn=(e,t,a)=>{const n=e.nodes||[],s=e.edges||[],o=n.filter((e=>"model"===e.type)),i=n.filter((e=>"tool"===e.type)),{userAgentNodes:r,assistantAgentNodes:l,ragUserNodes:d,reasoningAgentNodes:c,captainAgentNodes:u,groupManagerAgentNodes:g}=(e=>{const t=e.filter((e=>"agent"===e.type)),a=t.filter((e=>"data"in e&&"object"==typeof e.data&&e.data&&"agentType"in e.data&&"user_proxy"===e.data.agentType)),n=t.filter((e=>"data"in e&&"object"==typeof e.data&&e.data&&"agentType"in e.data&&"assistant"===e.data.agentType)),s=t.filter((e=>"data"in e&&"object"==typeof e.data&&e.data&&"agentType"in e.data&&"rag_user_proxy"===e.data.agentType)),o=t.filter((e=>"data"in e&&"object"==typeof e.data&&e.data&&"agentType"in e.data&&"reasoning"===e.data.agentType)),i=t.filter((e=>"data"in e&&"object"==typeof e.data&&e.data&&"agentType"in e.data&&"captain"===e.data.agentType)),r=t.filter((e=>"data"in e&&"object"==typeof e.data&&e.data&&"agentType"in e.data&&"group_manager"===e.data.agentType));return{agentNodes:t,userAgentNodes:a,assistantAgentNodes:n,ragUserNodes:s,reasoningAgentNodes:o,captainAgentNodes:i,groupManagerAgentNodes:r}})(n);return new we({nodes:n.map((e=>{const t={...e};return delete t.data,delete t.agentType,t})),edges:s.map((e=>{const t={...e};return delete t.data,t})),agents:{groupManagerAgents:g.map((e=>bn(e,n,s,a))),userProxyAgents:r.map((e=>bn(e,n,s,a))),assistantAgents:l.map((e=>bn(e,n,s,a))),ragUserProxyAgents:d.map((e=>bn(e,n,s,a))),reasoningAgents:c.map((e=>bn(e,n,s,a))),captainAgents:u.map((e=>bn(e,n,s,a)))},models:o.map((e=>((e,t,a)=>{const n=Cn(e,a),s=t.find((t=>t.id===e.id));return s&&Object.keys(s).forEach((e=>{["id","type","data"].includes(e)||delete n[e]})),n})(e,n,t))),tools:i.map((e=>((e,t,a)=>{const n=Sn(e,a),s=t.find((t=>t.id===e.id));return s&&Object.keys(s).forEach((e=>{["id","type","data"].includes(e)||delete n[e]})),n})(e,n,t))),chats:s.map(((e,t)=>((e,t,a)=>{const n=pn(e,a),s=t.find((t=>t.id===e.id));return s&&Object.keys(s).forEach((e=>{["id","data","type","source","target"].includes(e)||delete n[e]})),n})(e,s,t))),isAsync:e.isAsync,cacheSeed:e.cacheSeed,viewport:e.viewport,silent:e.silent||!1})},$n=e=>{const t=[];return e.data.models.forEach((e=>{t.push(wn(e))})),e.data.tools.forEach((e=>{t.push(Mn(e))})),e.data.agents.groupManagerAgents.forEach((e=>{t.push(ka(e))})),e.data.agents.userProxyAgents.forEach((e=>{t.push(ka(e))})),e.data.agents.assistantAgents.forEach((e=>{t.push(ka(e))})),e.data.agents.ragUserProxyAgents.forEach((e=>{t.push(ka(e))})),e.data.agents.reasoningAgents.forEach((e=>{t.push(ka(e))})),e.data.agents.captainAgents.forEach((e=>{t.push(ka(e))})),t},_n=e=>{const t=[];return e.data.chats.forEach((a=>{const n=hn(a),{sourceHandle:s,targetHandle:o}=es(e,a);n.sourceHandle=s,n.targetHandle=o,t.push(n)})),t},es=(e,t)=>{var a,n;let s,o;if((null==(a=t.rest)?void 0:a.sourceHandle)&&"string"==typeof t.rest.sourceHandle&&(s=t.rest.sourceHandle),(null==(n=t.rest)?void 0:n.targetHandle)&&"string"==typeof t.rest.targetHandle&&(o=t.rest.targetHandle),!s||!o){const a=e.data.edges.find((e=>e.id===t.id));a&&(s=a.sourceHandle||s,o=a.targetHandle||o)}return s||(s=`agent-handle-right-source-${t.source}`),o||(o=`agent-handle-left-target-${t.target}`),{sourceHandle:s,targetHandle:o}},ts=e=>{let t={};if("string"==typeof e)try{t=JSON.parse(e)}catch(a){return{}}else"object"==typeof e&&(t=e);return t};void 0===Promise.withResolvers&&("undefined"!=typeof window?window.Promise.withResolvers=function(){let e,t;return{promise:new Promise(((a,n)=>{e=a,t=n})),resolve:e,reject:t}}:global.Promise.withResolvers=function(){let e,t;return{promise:new Promise(((a,n)=>{e=a,t=n})),resolve:e,reject:t}});const as=[{animate:{rotate:[0,-10,10,0]},transition:{repeat:1/0,duration:2.2}},{animate:{y:[0,-10,0]},transition:{repeat:1/0,duration:2.5,delay:.3}},{animate:{rotate:[0,6,-6,0]},transition:{repeat:1/0,duration:2.8,delay:.6}},{animate:{y:[0,8,0]},transition:{repeat:1/0,duration:2,delay:.9}},{animate:{rotate:[0,-8,8,0]},transition:{repeat:1/0,duration:3,delay:1.2}},{animate:{x:[0,7,-7,0]},transition:{repeat:1/0,duration:2.6,delay:1.5}}],ns=[{src:ca.assistant,alt:"Assistant Waldiez"},{src:ca.rag_user_proxy,alt:"RAG Waldiez"},{src:ca.group_manager,alt:"Manager Waldiez"},{src:ca.reasoning,alt:"Reasoning Waldiez"},{src:ca.captain,alt:"Captain Waldiez"},{src:ca.user_proxy,alt:"User Waldiez"}],ss=({error:e})=>s.jsxs("div",{className:"waldiez-error-container","data-testid":"error-boundary",children:[s.jsx("div",{className:"waldiez-bots-row",children:ns.map(((e,t)=>s.jsx(c.motion.img,{src:e.src,alt:e.alt,className:"waldiez-bot-img",animate:as[t].animate,transition:as[t].transition,style:{zIndex:10+t}},e.alt)))}),s.jsx(c.motion.div,{className:"waldiez-error-sign",initial:{opacity:0,scale:.9},animate:{opacity:[0,1,.7,1],scale:[.9,1.1,1]},transition:{repeat:1/0,repeatType:"reverse",duration:1.2,delay:.5},children:s.jsx("span",{children:"🚨 ERROR"})}),s.jsxs(c.motion.div,{className:"waldiez-error-message",initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:1.3},children:[s.jsx("div",{className:"waldiez-error-title",children:"Oops, something went wrong!"}),s.jsx("div",{className:"waldiez-error-desc",children:"The Waldiez team is on the case. Please wait while we investigate..."}),s.jsx("div",{className:"waldiez-refresh-btn-container",children:s.jsx("button",{onClick:()=>window.location.reload(),className:"waldiez-refresh-btn",onMouseDown:e=>e.currentTarget.style.transform="scale(0.97)",onMouseUp:e=>e.currentTarget.style.transform="scale(1)",onMouseLeave:e=>e.currentTarget.style.transform="scale(1)",children:"Refresh Page"})}),e&&s.jsxs("div",{className:"waldiez-error-details",children:[s.jsx("strong",{children:"Error:"})," ",e.message,e.stack&&s.jsx("pre",{children:e.stack})]})]})]});let os=null;const is=e=>{if(!e.flowId){const t=document.querySelectorAll("[data-flow-id]");1===t.length&&(e.flowId=t[0].getAttribute("data-flow-id")||void 0)}os&&os(e)},rs=o.createContext(void 0),ls=({flowId:e,message:t,level:a="info",details:n,withCloseButton:i,onClose:r})=>{const[l,d]=o.useState(null);if(o.useLayoutEffect((()=>{let t=e?document.getElementById(`rf-root-${e}`):null;t||(t=document.body);const a=null==t?void 0:t.querySelector("dialog[open] .modal-content");d(a instanceof HTMLElement?a:t)}),[e]),!l)return null;const c=n&&!("string"==typeof n&&n.length<=50);return u.createPortal(s.jsxs("div",{className:`snackbar show ${a} ${n?"with-details":""}`,role:"alert","aria-live":"error"===a?"assertive":"polite",id:`${e}-snackbar`,"data-testid":"snackbar",children:[s.jsx("div",{className:"message","data-testid":"snackbar-message",children:t}),n&&(c?s.jsxs("details",{children:[s.jsx("summary",{children:"Details"}),s.jsx("div",{className:"details-content","data-testid":"snackbar-details",children:(e=>{if(e instanceof Error)return e.message;if("string"==typeof e)return e;if("object"==typeof e&&null!==e){if("detail"in e&&"string"==typeof e.detail)return e.detail;if("message"in e&&"string"==typeof e.message)return e.message;if("statusText"in e&&"string"==typeof e.statusText)return`Error: ${e.statusText}`;try{return JSON.stringify(e,null,2)}catch{return String(e)}}return"An unexpected error occurred."})(n)})]}):s.jsx("span",{className:"details-content","data-testid":"snackbar-details",children:n})),i&&s.jsx("button",{className:"close","aria-label":"Close notification",type:"button",onClick:r,"data-testid":"snackbar-close",children:"×"})]}),l)},ds=({children:e})=>{const[t,a]=o.useState({}),[n,i]=o.useState({}),r=o.useRef({}),l=o.useCallback((e=>{a((t=>{const a=Math.random().toString(36).slice(2),n=e.flowId||"default";return{...t,[n]:[...t[n]??[],{...e,id:a}]}}))}),[]);o.useEffect((()=>(os=l,()=>{os=null})),[l]),o.useEffect((()=>{Object.keys(t).forEach((e=>{!n[e]&&t[e]&&t[e].length>0&&(i((a=>({...a,[e]:t[e][0]}))),a((t=>({...t,[e]:t[e].slice(1)}))))}))}),[t,n]);const d=o.useCallback((e=>{i((t=>({...t,[e]:null})))}),[]);return o.useEffect((()=>(Object.entries(n).forEach((([e,t])=>{if(!t)return;const{duration:a,withCloseButton:n}=t;n&&void 0===a||(r.current[e]&&clearTimeout(r.current[e]),r.current[e]=window.setTimeout((()=>{d(e)}),a??3e3))})),()=>{Object.values(r.current).forEach(clearTimeout),r.current={}})),[n,d]),s.jsxs(rs.Provider,{value:{enqueueSnackbar:l},children:[e,Object.entries(n).map((([e,t])=>t?s.jsx(ls,{...t,onClose:()=>d(e)},t.id):null))]})},cs=o.createContext(null);function us(e){const t=o.useContext(cs);if(!t)throw new Error("Missing WaldiezContext.Provider in the tree");return m.useStoreWithEqualityFn(t,e,g.shallow)}const gs=(e,t,a,n)=>{let s,o;return t.target!==e||n.targetsOnly||(o=a.find((e=>e.id===t.source))),t.source!==e||n.sourcesOnly||(s=a.find((e=>e.id===t.target))),{sourceNode:o,targetNode:s}},ms=(e,t,a,n={x:200,y:140})=>{const s=K(t);if(!s)return{x:0,y:0};const o=s.querySelector(".react-flow-wrapper");return o?((e,t,a,n)=>{const s=(null==e?void 0:e.getZoom())??1,o=t.getBoundingClientRect().width/s,i=Math.floor(o/(1.1*n.x)),r=a%i*n.x;let l=Math.floor(a/i)*n.y;return 0===l?l+=10:l-=5,{x:r,y:l}})(a,o,e,n):{x:0,y:0}},ps=e=>{if(e){const t=e.getZoom();e.setViewport({zoom:t,x:20,y:40})}},hs=(e,t,a,n)=>{let s=0;const o=[];return e.forEach((e=>{if(e.type===a){const a=ms(s,t,n);o.push({...e,position:a}),s++}else o.push(e)})),o};function fs(e,t){if("function"==typeof e)return e(t);null!=e&&(e.current=t)}function ys(...e){return t=>{let a=!1;const n=e.map((e=>{const n=fs(e,t);return a||"function"!=typeof n||(a=!0),n}));if(a)return()=>{for(let t=0;t<n.length;t++){const a=n[t];"function"==typeof a?a():fs(e[t],null)}}}}function bs(...e){return I.useCallback(ys(...e),e)}function vs(e,t=[]){let a=[];const n=()=>{const t=a.map((e=>I.createContext(e)));return function(a){const n=(null==a?void 0:a[e])||t;return I.useMemo((()=>({[`__scope${e}`]:{...a,[e]:n}})),[a,n])}};return n.scopeName=e,[function(t,n){const o=I.createContext(n),i=a.length;a=[...a,n];const r=t=>{var a;const{scope:n,children:r,...l}=t,d=(null==(a=null==n?void 0:n[e])?void 0:a[i])||o,c=I.useMemo((()=>l),Object.values(l));return s.jsx(d.Provider,{value:c,children:r})};return r.displayName=t+"Provider",[r,function(a,s){var r;const l=(null==(r=null==s?void 0:s[e])?void 0:r[i])||o,d=I.useContext(l);if(d)return d;if(void 0!==n)return n;throw new Error(`\`${a}\` must be used within \`${t}\``)}]},xs(n,...t)]}function xs(...e){const t=e[0];if(1===e.length)return t;const a=()=>{const a=e.map((e=>({useScope:e(),scopeName:e.scopeName})));return function(e){const n=a.reduce(((t,{useScope:a,scopeName:n})=>({...t,...a(e)[`__scope${n}`]})),{});return I.useMemo((()=>({[`__scope${t.scopeName}`]:n})),[n])}};return a.scopeName=t.scopeName,a}function Cs(e,t,{checkForDefaultPrevented:a=!0}={}){return function(n){if(null==e||e(n),!1===a||!n.defaultPrevented)return null==t?void 0:t(n)}}var ws=(null==globalThis?void 0:globalThis.document)?I.useLayoutEffect:()=>{},ks=I[" useInsertionEffect ".trim().toString()]||ws;function js({prop:e,defaultProp:t,onChange:a=()=>{},caller:n}){const[s,o,i]=function({defaultProp:e,onChange:t}){const[a,n]=I.useState(e),s=I.useRef(a),o=I.useRef(t);return ks((()=>{o.current=t}),[t]),I.useEffect((()=>{var e;s.current!==a&&(null==(e=o.current)||e.call(o,a),s.current=a)}),[a,s]),[a,n,o]}({defaultProp:t,onChange:a}),r=void 0!==e,l=r?e:s;{const t=I.useRef(void 0!==e);I.useEffect((()=>{const e=t.current;if(e!==r){}t.current=r}),[r,n])}const d=I.useCallback((t=>{var a;if(r){const n=function(e){return"function"==typeof e}(t)?t(e):t;n!==e&&(null==(a=i.current)||a.call(i,n))}else o(t)}),[r,e,o,i]);return[l,d]}function As(e){const t=I.useRef({value:e,previous:e});return I.useMemo((()=>(t.current.value!==e&&(t.current.previous=t.current.value,t.current.value=e),t.current.previous)),[e])}function Ns(e){const[t,a]=I.useState(void 0);return ws((()=>{if(e){a({width:e.offsetWidth,height:e.offsetHeight});const t=new ResizeObserver((t=>{if(!Array.isArray(t))return;if(!t.length)return;const n=t[0];let s,o;if("borderBoxSize"in n){const e=n.borderBoxSize,t=Array.isArray(e)?e[0]:e;s=t.inlineSize,o=t.blockSize}else s=e.offsetWidth,o=e.offsetHeight;a({width:s,height:o})}));return t.observe(e,{box:"border-box"}),()=>t.unobserve(e)}a(void 0)}),[e]),t}var Ts=e=>{const{present:t,children:a}=e,n=function(e){const[t,a]=I.useState(),n=I.useRef(null),s=I.useRef(e),o=I.useRef("none"),i=e?"mounted":"unmounted",[r,l]=function(e,t){return I.useReducer(((e,a)=>t[e][a]??e),e)}(i,{mounted:{UNMOUNT:"unmounted",ANIMATION_OUT:"unmountSuspended"},unmountSuspended:{MOUNT:"mounted",ANIMATION_END:"unmounted"},unmounted:{MOUNT:"mounted"}});return I.useEffect((()=>{const e=Ss(n.current);o.current="mounted"===r?e:"none"}),[r]),ws((()=>{const t=n.current,a=s.current;if(a!==e){const n=o.current,i=Ss(t);if(e)l("MOUNT");else if("none"===i||"none"===(null==t?void 0:t.display))l("UNMOUNT");else{l(a&&n!==i?"ANIMATION_OUT":"UNMOUNT")}s.current=e}}),[e,l]),ws((()=>{if(t){let e;const a=t.ownerDocument.defaultView??window,i=o=>{const i=Ss(n.current).includes(o.animationName);if(o.target===t&&i&&(l("ANIMATION_END"),!s.current)){const n=t.style.animationFillMode;t.style.animationFillMode="forwards",e=a.setTimeout((()=>{"forwards"===t.style.animationFillMode&&(t.style.animationFillMode=n)}))}},r=e=>{e.target===t&&(o.current=Ss(n.current))};return t.addEventListener("animationstart",r),t.addEventListener("animationcancel",i),t.addEventListener("animationend",i),()=>{a.clearTimeout(e),t.removeEventListener("animationstart",r),t.removeEventListener("animationcancel",i),t.removeEventListener("animationend",i)}}l("ANIMATION_END")}),[t,l]),{isPresent:["mounted","unmountSuspended"].includes(r),ref:I.useCallback((e=>{n.current=e?getComputedStyle(e):null,a(e)}),[])}}(t),s="function"==typeof a?a({present:n.isPresent}):I.Children.only(a),o=bs(n.ref,function(e){var t,a;let n=null==(t=Object.getOwnPropertyDescriptor(e.props,"ref"))?void 0:t.get,s=n&&"isReactWarning"in n&&n.isReactWarning;if(s)return e.ref;if(n=null==(a=Object.getOwnPropertyDescriptor(e,"ref"))?void 0:a.get,s=n&&"isReactWarning"in n&&n.isReactWarning,s)return e.props.ref;return e.props.ref||e.ref}(s));return"function"==typeof a||n.isPresent?I.cloneElement(s,{ref:o}):null};function Ss(e){return(null==e?void 0:e.animationName)||"none"}function Ms(e){const t=Is(e),a=I.forwardRef(((e,a)=>{const{children:n,...o}=e,i=I.Children.toArray(n),r=i.find(Ds);if(r){const e=r.props.children,n=i.map((t=>t===r?I.Children.count(e)>1?I.Children.only(null):I.isValidElement(e)?e.props.children:null:t));return s.jsx(t,{...o,ref:a,children:I.isValidElement(e)?I.cloneElement(e,void 0,n):null})}return s.jsx(t,{...o,ref:a,children:n})}));return a.displayName=`${e}.Slot`,a}function Is(e){const t=I.forwardRef(((e,t)=>{const{children:a,...n}=e;if(I.isValidElement(a)){const e=function(e){var t,a;let n=null==(t=Object.getOwnPropertyDescriptor(e.props,"ref"))?void 0:t.get,s=n&&"isReactWarning"in n&&n.isReactWarning;if(s)return e.ref;if(n=null==(a=Object.getOwnPropertyDescriptor(e,"ref"))?void 0:a.get,s=n&&"isReactWarning"in n&&n.isReactWarning,s)return e.props.ref;return e.props.ref||e.ref}(a),s=function(e,t){const a={...t};for(const n in t){const s=e[n],o=t[n];/^on[A-Z]/.test(n)?s&&o?a[n]=(...e)=>{const t=o(...e);return s(...e),t}:s&&(a[n]=s):"style"===n?a[n]={...s,...o}:"className"===n&&(a[n]=[s,o].filter(Boolean).join(" "))}return{...e,...a}}(n,a.props);return a.type!==I.Fragment&&(s.ref=t?ys(t,e):e),I.cloneElement(a,s)}return I.Children.count(a)>1?I.Children.only(null):null}));return t.displayName=`${e}.SlotClone`,t}Ts.displayName="Presence";var Es=Symbol("radix.slottable");function Ds(e){return I.isValidElement(e)&&"function"==typeof e.type&&"__radixId"in e.type&&e.type.__radixId===Es}var Rs=["a","button","div","form","h2","h3","img","input","label","li","nav","ol","p","select","span","svg","ul"].reduce(((e,t)=>{const a=Ms(`Primitive.${t}`),n=I.forwardRef(((e,n)=>{const{asChild:o,...i}=e,r=o?a:t;return"undefined"!=typeof window&&(window[Symbol.for("radix-ui")]=!0),s.jsx(r,{...i,ref:n})}));return n.displayName=`Primitive.${t}`,{...e,[t]:n}}),{}),Ps="Checkbox",[Os,Ls]=vs(Ps),[zs,Fs]=Os(Ps);function Us(e){const{__scopeCheckbox:t,checked:a,children:n,defaultChecked:o,disabled:i,form:r,name:l,onCheckedChange:d,required:c,value:u="on",internal_do_not_use_render:g}=e,[m,p]=js({prop:a,defaultProp:o??!1,onChange:d,caller:Ps}),[h,f]=I.useState(null),[y,b]=I.useState(null),v=I.useRef(!1),x=!h||(!!r||!!h.closest("form")),C={checked:m,disabled:i,setChecked:p,control:h,setControl:f,name:l,form:r,value:u,hasConsumerStoppedPropagationRef:v,required:c,defaultChecked:!Zs(o)&&o,isFormControl:x,bubbleInput:y,setBubbleInput:b};return s.jsx(zs,{scope:t,...C,children:Qs(g)?g(C):n})}var qs="CheckboxTrigger",Bs=I.forwardRef((({__scopeCheckbox:e,onKeyDown:t,onClick:a,...n},o)=>{const{control:i,value:r,disabled:l,checked:d,required:c,setControl:u,setChecked:g,hasConsumerStoppedPropagationRef:m,isFormControl:p,bubbleInput:h}=Fs(qs,e),f=bs(o,u),y=I.useRef(d);return I.useEffect((()=>{const e=null==i?void 0:i.form;if(e){const t=()=>g(y.current);return e.addEventListener("reset",t),()=>e.removeEventListener("reset",t)}}),[i,g]),s.jsx(Rs.button,{type:"button",role:"checkbox","aria-checked":Zs(d)?"mixed":d,"aria-required":c,"data-state":Xs(d),"data-disabled":l?"":void 0,disabled:l,value:r,...n,ref:f,onKeyDown:Cs(t,(e=>{"Enter"===e.key&&e.preventDefault()})),onClick:Cs(a,(e=>{g((e=>!!Zs(e)||!e)),h&&p&&(m.current=e.isPropagationStopped(),m.current||e.stopPropagation())}))})}));Bs.displayName=qs;var Hs=I.forwardRef(((e,t)=>{const{__scopeCheckbox:a,name:n,checked:o,defaultChecked:i,required:r,disabled:l,value:d,onCheckedChange:c,form:u,...g}=e;return s.jsx(Us,{__scopeCheckbox:a,checked:o,defaultChecked:i,disabled:l,required:r,onCheckedChange:c,name:n,form:u,value:d,internal_do_not_use_render:({isFormControl:e})=>s.jsxs(s.Fragment,{children:[s.jsx(Bs,{...g,ref:t,__scopeCheckbox:a}),e&&s.jsx(Ks,{__scopeCheckbox:a})]})})}));Hs.displayName=Ps;var Ws="CheckboxIndicator",Vs=I.forwardRef(((e,t)=>{const{__scopeCheckbox:a,forceMount:n,...o}=e,i=Fs(Ws,a);return s.jsx(Ts,{present:n||Zs(i.checked)||!0===i.checked,children:s.jsx(Rs.span,{"data-state":Xs(i.checked),"data-disabled":i.disabled?"":void 0,...o,ref:t,style:{pointerEvents:"none",...e.style}})})}));Vs.displayName=Ws;var Gs="CheckboxBubbleInput",Ks=I.forwardRef((({__scopeCheckbox:e,...t},a)=>{const{control:n,hasConsumerStoppedPropagationRef:o,checked:i,defaultChecked:r,required:l,disabled:d,name:c,value:u,form:g,bubbleInput:m,setBubbleInput:p}=Fs(Gs,e),h=bs(a,p),f=As(i),y=Ns(n);I.useEffect((()=>{const e=m;if(!e)return;const t=window.HTMLInputElement.prototype,a=Object.getOwnPropertyDescriptor(t,"checked").set,n=!o.current;if(f!==i&&a){const t=new Event("click",{bubbles:n});e.indeterminate=Zs(i),a.call(e,!Zs(i)&&i),e.dispatchEvent(t)}}),[m,f,i,o]);const b=I.useRef(!Zs(i)&&i);return s.jsx(Rs.input,{type:"checkbox","aria-hidden":!0,defaultChecked:r??b.current,required:l,disabled:d,name:c,value:u,form:g,...t,tabIndex:-1,ref:h,style:{...t.style,...y,position:"absolute",pointerEvents:"none",opacity:0,margin:0,transform:"translateX(-100%)"}})}));function Qs(e){return"function"==typeof e}function Zs(e){return"indeterminate"===e}function Xs(e){return Zs(e)?"indeterminate":e?"checked":"unchecked"}Ks.displayName=Gs;const Js=o.memo((({id:e,label:t,isChecked:a,onCheckedChange:n})=>{const o="string"==typeof t?t:"Label for checkbox";return s.jsxs("div",{className:"flex","data-testid":`checkbox-input-container-${e}`,children:[s.jsx(Hs,{className:"checkbox-root",id:`checkbox-input-${e}`,checked:a,onCheckedChange:n,"data-testid":e,"aria-label":o,children:s.jsx(Vs,{className:"checkbox-indicator",children:"✓"})}),s.jsx("label",{className:"clickable no-padding padding-10",style:{width:"max-content"},htmlFor:`checkbox-input-${e}`,children:t})]})})),Ys=o.memo((e=>{const{id:t,label:a,info:n,checked:o,onChange:i}=e,r="function"==typeof a?a():a,l="function"==typeof n?n():n;return s.jsx("div",{className:"info-checkbox-container",children:s.jsxs("div",{className:"info-checkbox-wrapper",children:[s.jsx(Js,{id:t,label:r,isChecked:o,onCheckedChange:i}),s.jsxs("div",{className:"info-label margin-left--10",children:[s.jsx(y.FaInfoCircle,{className:"info-checkbox-icon"}),s.jsx("div",{className:"info-description",children:l})]})]})})}));Ys.displayName="InfoCheckbox";const $s=o.forwardRef(((e,t)=>s.jsx(b,{ref:t,...e,className:"select "+(e.className?` ${e.className}`:""),classNamePrefix:"w-select",menuPlacement:"auto",styles:{menuPortal:e=>({...e,zIndex:10001}),menu:e=>({...e,zIndex:10001,width:"max-content",minWidth:"100%"}),...e.styles}}))),_s=["GroupChatTarget","NestedChatTarget","StayTarget"],eo=[..._s,"AgentTarget","RandomAgentTarget","GroupManagerTarget"],to={AgentTarget:"Pass the floor to another agent",RevertToUserTarget:"Revert to the user agent",RandomAgentTarget:"Choose a random agent",AskUserTarget:"Ask the user",TerminateTarget:"Terminate the flow",GroupChatTarget:"Group Chat",NestedChatTarget:"Trigger a nested chat",GroupManagerTarget:"Return to the group chat manager",StayTarget:"Do Nothing"},ao=o.memo((({target:e,agents:t,onChange:a,isForGroupChat:n=!0})=>{const[i,r]=o.useState(!!e),[l,d]=o.useState(null==e?void 0:e.targetType),[c,u]=o.useState("AgentTarget"===(null==e?void 0:e.targetType)?e.value[0]:void 0),[g,m]=o.useState("RandomAgentTarget"===(null==e?void 0:e.targetType)?e.value:[]),p=o.useMemo((()=>n?eo:_s),[n]),h=o.useMemo((()=>ye.filter((e=>!p.includes(e))).map((e=>({value:e,label:to[e]})))),[p]),f=o.useMemo((()=>t.map((e=>({value:e.id,label:e.data.label})))),[t]),y=o.useMemo((()=>l?{label:to[l],value:l}:null),[l]),b=o.useMemo((()=>{var e;return{label:null==(e=f.find((e=>e.value===c)))?void 0:e.label,value:c}}),[f,c]),v=o.useCallback((e=>{r(e),e||(d(void 0),a(null))}),[a]),x=o.useCallback((e=>{if(!(null==e?void 0:e.value))return;const t=e.value;switch(d(t),t){case"AgentTarget":c&&a({targetType:t,value:[c]});break;case"TerminateTarget":case"RevertToUserTarget":case"AskUserTarget":case"GroupManagerTarget":a({targetType:t,value:[]});break;case"RandomAgentTarget":g.length>0&&a({targetType:t,value:g})}}),[a,c,g]),C=o.useCallback((e=>{(null==e?void 0:e.value)&&"AgentTarget"===l&&(u(e.value),a({targetType:"AgentTarget",value:[e.value]}))}),[a,l]),w=o.useCallback((e=>{if(!e||"RandomAgentTarget"!==l)return;const t=e.map((e=>e.value));m(t),a({targetType:"RandomAgentTarget",value:t})}),[a,l]),k=n?"the chat ends":"the Agent has no more work to do";return s.jsxs("div",{className:"waldiez-after-work",children:[s.jsx(Ys,{label:`Include an action to perform after ${k}?`,info:"Check this to handle conversation continuation when no further options are available. If no agent is selected and no tool calls have output, we will use this property to determine the next action.",checked:i,id:"afterWork",onChange:v}),i&&s.jsxs("div",{className:"flex flex-column margin-bottom-10",children:[s.jsxs("div",{className:"full-width margin-bottom-10",children:[s.jsx("label",{htmlFor:"afterWorkTargetType",children:"Action to perform after work:"}),s.jsx("div",{className:"margin-top-10"}),s.jsx($s,{inputId:"afterWorkTargetType",options:h,value:y,onChange:x,isMulti:!1})]}),"AgentTarget"===l&&s.jsxs("div",{className:"full-width margin-bottom-10",children:[s.jsx("label",{htmlFor:"afterWorkTargetId",children:"Agent to pass the floor to:"}),s.jsx("div",{className:"margin-top-10"}),s.jsx($s,{inputId:"afterWorkTargetId",options:f,value:b,onChange:C,isClearable:!1,isSearchable:!1,isMulti:!1})]}),"RandomAgentTarget"===l&&s.jsxs("div",{className:"full-width",children:[s.jsx("label",{htmlFor:"afterWorkTargetIds",children:"Agents to choose from:"}),s.jsx("div",{className:"margin-top-10"}),s.jsx($s,{inputId:"afterWorkTargetIds",options:f,value:g.map((e=>{var t;return{label:null==(t=f.find((t=>t.value===e)))?void 0:t.label,value:e}})),onChange:w,isClearable:!0,isSearchable:!1,isMulti:!0})]})]})]})}));ao.displayName="AfterWork";const no=({isOpen:e,imageUrl:t,onClose:a})=>{const[n,i]=o.useState(!1);if(o.useEffect((()=>{i(!1)}),[t]),o.useEffect((()=>{const t=t=>{"Escape"===t.key&&e&&a()};return document.addEventListener("keydown",t),()=>{document.removeEventListener("keydown",t)}}),[e,a]),!e||!t)return null;return s.jsxs("div",{className:"image-modal "+(e?"open":""),onClick:a,"data-testid":"modal-overlay",children:[n?s.jsxs("div",{className:"modal-error-message",children:[s.jsx("p",{children:"The image could not be displayed in full size."}),s.jsx("p",{children:"It may still be available in the chat or might have been removed."})]}):s.jsx("img",{src:t,alt:"Fullscreen preview",className:"modal-image",onClick:e=>{e.stopPropagation()},onError:()=>{i(!0)}}),s.jsx("button",{type:"button",title:"Close preview",className:"modal-close",onClick:a,"data-testid":"modal-close",children:s.jsx(v.FaX,{})})]})},so=(e=3,t=1e3)=>{const a=o.useRef(new Map);return{registerImage:o.useCallback(((n,s)=>{n.onload=()=>{n.classList.remove("loading","failed"),n.style.opacity="1",a.current.delete(s)},n.onerror=()=>{const o=a.current.get(s)||0;o<e?(a.current.set(s,o+1),setTimeout((()=>{const e=`${s}${s.includes("?")?"&":"?"}retry=${o+1}`;n.src=e}),t)):(n.classList.remove("loading"),n.classList.add("failed"),n.style.opacity="0.8")}}),[e,t]),resetRetries:o.useCallback((()=>{a.current.clear()}),[])}},oo=({src:e,alt:t="Chat image",className:a,onClick:n})=>{const i=o.useRef(null),{registerImage:r}=so();return o.useEffect((()=>{i.current&&r(i.current,e)}),[e,r]),s.jsx("img",{ref:i,src:e,alt:t,className:`loading ${a}`,loading:"lazy",onClick:n})},io=e=>{if(t=e,o.isValidElement(t)&&"object"==typeof t.props&&null!==t.props&&e.props.className)return(e=>{const t=/language-(\w+)/.exec(e);return t&&"md"!==t[1]?t[1]:null})(e.props.className);var t;if(Array.isArray(e))for(const a of e){const e=io(a);if(e)return e}return null},ro=({content:e,isDarkMode:t=!1,onImageClick:a})=>{const n=o.useMemo((()=>{return e.length>5&&(t=e,[/\*\*(.*?)\*\*/,/__(.*?)__/,/\[(.*?)\]\((.*?)\)/,/```([\s\S]*?)```/,/#+\s+.*/,/>\s+.*/,/\d+\.\s+.*/,/[\*\-\+]\s+.*/,/\|(.*?)\|/,/!\[(.*?)\]\((.*?)\)/].some((e=>e.test(t))));var t}),[e]),i=o.useMemo((()=>(e=>{let t=e;return t=t.replace(/```md\n([\s\S]*?)```/g,((e,t)=>t)),t=t.replace(/```([a-z]*)\n([\s\S]*?)```/g,((e,t,a)=>t&&"md"!==t?`\`\`\`${t}\n${a}\`\`\``:`\`\`\`\n${a}\`\`\``)),t})(e)),[e]);if(!n)return s.jsx("span",{children:e});const r=t?"markdown-dark":"markdown-light";return s.jsx("div",{className:`markdown-renderer ${r}`,children:s.jsx(w,{remarkPlugins:[C],rehypePlugins:[x],components:{a:({children:e,...t})=>s.jsx("a",{...t,target:"_blank",rel:"noopener noreferrer",className:"markdown-link",children:e}),img:({src:e,alt:t,...n})=>s.jsx("img",{src:e,alt:t||"Image",className:"chat-image markdown-image",onClick:()=>e&&a&&a(e),...n}),h1:({children:e,...t})=>s.jsx("h1",{className:"markdown-h1",...t,children:e}),h2:({children:e,...t})=>s.jsx("h2",{className:"markdown-h2",...t,children:e}),h3:({children:e,...t})=>s.jsx("h3",{className:"markdown-h3",...t,children:e}),h4:({children:e,...t})=>s.jsx("h4",{className:"markdown-h4",...t,children:e}),h5:({children:e,...t})=>s.jsx("h5",{className:"markdown-h5",...t,children:e}),h6:({children:e,...t})=>s.jsx("h6",{className:"markdown-h6",...t,children:e}),ul:({children:e,...t})=>s.jsx("ul",{className:"markdown-ul",...t,children:e}),ol:({children:e,...t})=>s.jsx("ol",{className:"markdown-ol",...t,children:e}),li:({children:e,...t})=>s.jsx("li",{className:"markdown-li",...t,children:e}),blockquote:({children:e,...t})=>s.jsx("blockquote",{className:"markdown-blockquote",...t,children:e}),table:({children:e,...t})=>s.jsx("table",{className:"markdown-table",...t,children:e}),thead:({children:e,...t})=>s.jsx("thead",{className:"markdown-thead",...t,children:e}),tbody:({children:e,...t})=>s.jsx("tbody",{className:"markdown-tbody",...t,children:e}),tr:({children:e,...t})=>s.jsx("tr",{className:"markdown-tr",...t,children:e}),th:({children:e,...t})=>s.jsx("th",{className:"markdown-th",...t,children:e}),td:({children:e,...t})=>s.jsx("td",{className:"markdown-td",...t,children:e}),code:({children:e,className:t,...a})=>!t?s.jsx("code",{className:"markdown-inline-code",...a,children:e}):s.jsx("code",{className:`markdown-code ${t||""}`,...a,children:e}),pre:({children:e,...t})=>{const a=io(e);return a?s.jsxs("div",{className:"markdown-code-block-wrapper",children:[s.jsx("div",{className:"markdown-code-block-header",children:s.jsx("span",{className:"markdown-code-language",children:a})}),s.jsx("pre",{className:"markdown-pre",...t,children:e})]}):s.jsx("pre",{className:"markdown-pre",...t,children:e})},p:({children:e,...t})=>s.jsx("p",{className:"markdown-p",...t,children:e}),hr:e=>s.jsx("hr",{className:"markdown-hr",...e})},children:i})})};ro.displayName="Markdown";const lo=(e,t,a)=>{const n=e.map(((e,n)=>{var o,i;return e&&e.type?"text"===e.type&&e.text.trim().length>0?s.jsx(ro,{content:e.text,isDarkMode:t,onImageClick:a},`text-${n}`):"image_url"===e.type&&(null==(o=e.image_url)?void 0:o.url)?s.jsx(oo,{src:e.image_url.url,className:"chat-image",onClick:()=>a(e.image_url.url)},`img-${n}`):"image"===e.type&&(null==(i=e.image)?void 0:i.url)?s.jsx(oo,{src:e.image.url,className:"chat-image",onClick:()=>a(e.image.url)},`img-${n}`):null:null})).filter(Boolean);return 0===n.length?null:s.jsx("div",{className:"structured-content",children:n})},co=(e,t,a)=>{const n=/\[Image:\s*(.+?)\]/g,o=[];let i,r=0;for(;i=n.exec(e);){const[l,d]=i,c=e.slice(r,i.index);c&&o.push(s.jsx(ro,{content:c,isDarkMode:t,onImageClick:a},`text-${r}`)),o.push(s.jsx(oo,{src:d,className:"chat-image",onClick:()=>a(d)},`img-${i.index}`)),r=n.lastIndex}const l=e.slice(r);return l&&o.push(s.jsx("span",{children:l},"text-end")),s.jsx("div",{className:"content-with-images",children:o})},uo=({messages:e,isDarkMode:t,userParticipants:a})=>{const[n,i]=o.useState(null),r=o.useRef(null),{resetRetries:l}=so(),d=o.useRef(0),c=o.useCallback((e=>i(e)),[]),u=o.useCallback((()=>i(null)),[]);o.useEffect((()=>{l()}),[e.length,l]);const g=o.useCallback((e=>{const{id:a,timestamp:n,type:s,content:o,sender:i,recipient:r}=e;try{const e=((e,t,a)=>{if("string"==typeof e)try{const n=JSON.parse(e);return Array.isArray(n)?lo(n,t,a):co(e,t,a)}catch{return co(e,t,a)}else{if("content"in e&&e.content)return Array.isArray(e.content)?lo(e.content,t,a):co(String(e.content),t,a);if(Array.isArray(e))return lo(e,t,a)}return co(String(e.content),t,a)})(o,t,c);return{id:a,timestamp:n,type:s,sender:i,recipient:r,node:e}}catch(l){return{id:a,timestamp:n,type:s,sender:i,recipient:r,node:null}}}),[c,t]),m=o.useCallback((e=>["system","termination"].includes(e.type)?"system-message":e.sender&&a.includes(e.sender)?"user-message":"error"===e.type?"error-message":"input_request"===e.type?"request-message":"assistant-message"),[a]),p=o.useCallback(((e,t)=>`msg-${t}-${e.id}-${e.timestamp}`),[]);return o.useEffect((()=>{const t=e.length>d.current;if(d.current=e.length,!t)return;const a=()=>{const e=r.current;if(e)e.scrollTop=e.scrollHeight;else{document.querySelectorAll(".chat-container").forEach((e=>{e.scrollTop=e.scrollHeight}))}};setTimeout(a,10),setTimeout(a,100),setTimeout(a,300)}),[e.length]),s.jsxs(s.Fragment,{children:[s.jsx("div",{className:"chat-container",ref:r,children:e.map(((e,t)=>{const a=g(e);if(!a.node)return null;const n=m(a),o="user-message"===n||"assistant-message"===n;return s.jsxs("div",{className:`message-bubble ${m(a)}`,"data-testid":"rf-chat-message",children:[s.jsx("div",{className:`message-header ${o&&n}`,children:"assistant-message"===n?s.jsxs(s.Fragment,{children:[o&&s.jsx("div",{className:"avatar-container",children:s.jsx("div",{className:"avatar assistant-avatar",children:s.jsx("img",{src:"data:image/webp;base64,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",alt:"Assistant Avatar",className:"avatar-image"})})}),a.sender&&s.jsx("span",{className:"message-sender",children:a.sender}),s.jsx("span",{className:"message-timestamp",children:new Date(e.timestamp).toLocaleTimeString()})]}):"user-message"===n?s.jsxs(s.Fragment,{children:[s.jsx("span",{className:"message-timestamp",children:new Date(e.timestamp).toLocaleTimeString()}),a.sender&&s.jsx("span",{className:"message-sender",children:a.sender}),o&&s.jsx("div",{className:"avatar-container",children:s.jsx("div",{className:"avatar user-avatar",children:s.jsx(v.FaRegUser,{size:24})})})]}):s.jsxs(s.Fragment,{children:[a.sender&&s.jsx("span",{className:"message-sender",children:a.sender}),s.jsx("span",{className:"message-timestamp",children:new Date(e.timestamp).toLocaleTimeString()})]})}),s.jsx("div",{className:"message-content",children:a.node})]},p(e,t))}))}),s.jsx(no,{isOpen:Boolean(n),imageUrl:n,onClose:u})]})};uo.displayName="ChatUI";const go=o.memo((e=>{const{title:t,children:a,dataTestId:n,fullWidth:i=!1,expanded:r=!1,className:l="",contentClassName:d=""}=e,[c,u]=o.useState(r);o.useEffect((()=>{u(r)}),[r]);const g=o.useCallback((()=>{u((e=>!e))}),[]),m=`collapsible ${i?"full-width":""} ${l}`.trim(),p=`collapsible-header ${l}`.trim();return s.jsxs("div",{className:m,"data-testid":n,children:[s.jsxs("div",{className:p,onClick:g,children:[s.jsx("span",{children:t}),s.jsx("span",{className:"margin-left-5","aria-hidden":"true",children:c?"▲":"▼"})]}),c&&s.jsx("div",{className:`collapsible-content ${d||""}`,children:a})]})}));go.displayName="Collapsible";const mo=e=>{const{htmlFor:t,label:a,info:n}=e,o="function"==typeof a?a():a,i="function"==typeof n?n():n;return s.jsxs("div",{className:"info-label",children:[s.jsx("label",{htmlFor:t,children:o}),s.jsx(y.FaInfoCircle,{className:"info-icon"}),s.jsx("div",{className:"info-description",children:i})]})};mo.displayName="InfoLabel";const po=e=>{const{viewLabel:t,viewLabelInfo:a,items:n,itemsType:i,areValuesSecret:r=!1}=e,{visible:l,newEntry:d,onAddEntry:c,onDeleteEntry:u,onSaveEntry:g,onKeyChange:m,onValueChange:p,onVisibilityChange:h,onNewEntryKeyChange:f,onNewEntryValueChange:b,isDirty:v}=(e=>{const{items:t,onUpdate:a,onDelete:n,onAdd:s,allowEmptyValues:i=!0}=e,[r,l]=o.useState({}),[d,c]=o.useState(Object.entries(t)),[u,g]=o.useState({key:"",value:""});o.useEffect((()=>{c(Object.entries(t))}),[t]);const m=o.useCallback(((e,t)=>{const a=t.target.value;c((t=>t.map((([t,n],s)=>s===e?[a,n]:[t,n]))))}),[]),p=o.useCallback(((e,t)=>{const a=t.target.value;c((t=>t.map((([t,n],s)=>s===e?[t,a]:[t,n]))))}),[]),h=o.useCallback((e=>{l((t=>({...t,[e]:!t[e]})))}),[]),f=o.useCallback((()=>{u.key&&(i||u.value)&&(s(u.key,u.value),c((e=>[...e,[u.key,u.value]])),g({key:"",value:""}))}),[u,i,s]),y=o.useCallback((e=>{const t=e.target.value;g((e=>({...e,key:t})))}),[]),b=o.useCallback((e=>{const t=e.target.value;g((e=>({...e,value:t})))}),[]),v=o.useCallback((e=>{n(e),c((t=>t.filter((([t])=>t!==e))))}),[n]),x=o.useCallback((()=>{const e=d.reduce(((e,[t,a])=>(e[t]=a,e)),{});a(e)}),[d,a]),C=o.useCallback((e=>{if(e>=d.length)return!0;const[a,n]=d[e];return!(a in t)||t[a]!==n}),[d,t]);return{stateItems:d,newEntry:u,visible:r,onKeyChange:m,onValueChange:p,onVisibilityChange:h,onAddEntry:f,onNewEntryKeyChange:y,onNewEntryValueChange:b,onDeleteEntry:v,onSaveEntry:x,isDirty:C}})(e);return s.jsxs("div",{className:"dict-entries-view",children:[a?s.jsx(mo,{htmlFor:`dict-entry-${i}`,label:t,info:a}):s.jsx("label",{className:"margin-bottom-5",children:t}),s.jsx("div",{className:"dict-entries-list",children:Object.entries(n).map((([e,t],a)=>s.jsxs("div",{className:"dict-entry",children:[s.jsx("input",{type:"text",defaultValue:e,onChange:m.bind(null,a),"data-testid":`key-input-${i}-${a}`,placeholder:"Key"},`${e}-${t}-${a}`),s.jsx("input",{type:r?l[e]?"text":"password":"text",defaultValue:String(t),onChange:p.bind(null,a),"data-testid":`value-input-${i}-${a}`,id:`dict-value-input-${i}-${a}`,placeholder:"Value"},`${t}-${a}-${e}`),r&&s.jsx("button",{type:"button",className:"toggle-visibility-btn",onClick:h.bind(null,e),title:"Toggle visibility",id:`visibility-${i}-${a}`,"data-testid":`visibility-${i}-${a}`,children:l[e]?s.jsx(y.FaEyeSlash,{}):s.jsx(y.FaEye,{})}),s.jsx("button",{type:"button",onClick:u.bind(null,e),title:"Delete",className:"trash-button",id:`delete-dict-item-${i}-${a}`,"data-testid":`delete-dict-item-${i}-${a}`,children:s.jsx(y.FaTrash,{})}),v(a)&&s.jsx("button",{onClick:g,title:"Save",id:`save-dict-item-${i}-${a}`,"data-testid":`save-dict-item-${i}-${a}`,type:"button",className:"save-button",children:s.jsx(y.FaSave,{})})]},e)))}),s.jsxs("div",{className:"add-dict-entry-view",children:[s.jsx("input",{type:"text",placeholder:"Key","data-testid":`new-dict-${i}-key`,id:`new-dict-${i}-key`,value:d.key,onChange:f}),s.jsx("input",{placeholder:"Value","data-testid":`new-dict-${i}-value`,id:`new-dict-${i}-value`,type:r?l._NEW?"text":"password":"text",value:d.value,onChange:b}),r&&s.jsx("button",{type:"button",className:"toggle-visibility-btn",onClick:h.bind(null,"_NEW"),title:"Toggle visibility",id:`visibility-${i}-new`,"data-testid":`visibility-${i}-new`,children:l._NEW?s.jsx(y.FaEyeSlash,{}):s.jsx(y.FaEye,{})}),s.jsx("button",{onClick:c,title:"Add",className:"plus-button",id:`add-new-dict-${i}-item`,"data-testid":`add-new-dict-${i}-item`,disabled:""===d.key,type:"button",children:s.jsx(y.FaPlus,{})})]})]})};po.displayName="Dict";const ho=e=>{const{flowId:t,multiple:a=!1}=e,{onFileDragOver:n,onFileDragLeave:i,onOpenUploadDialog:r,onFileDrop:l}=(e=>{const{flowId:t,onUpload:a,allowedFileExtensions:n,multiple:s=!1}=e,i=o.useCallback((e=>{var a;const s=null==(a=e.name.split(".").pop())?void 0:a.toLowerCase();return s&&n.some((e=>e.toLowerCase()===`.${s}`))?!(e.size>10485760&&(is({flowId:t,message:"File size limit exceeded. Maximum file size is 10MB.",level:"error"}),1)):(is({flowId:t,message:"Invalid file extension. Please upload a valid file.",level:"error"}),!1)}),[t,n]),r=o.useCallback((e=>{const t=e.filter(i);t.length&&a(t)}),[i,a]),l=o.useCallback((e=>Array.from(e).filter((e=>n.some((t=>e.name.toLowerCase().endsWith(t.toLowerCase())))))),[n]);return{onFileDragOver:o.useCallback((e=>{e.preventDefault(),e.stopPropagation(),e.currentTarget.classList.add("drag-over")}),[]),onFileDragLeave:o.useCallback((e=>{e.preventDefault(),e.stopPropagation(),e.currentTarget.classList.remove("drag-over")}),[]),onFileDrop:o.useCallback((e=>{if(e.preventDefault(),e.stopPropagation(),e.currentTarget.classList.remove("drag-over"),e.dataTransfer.files.length>0){const t=l(e.dataTransfer.files);t.length&&r(t)}}),[l,r]),onOpenUploadDialog:o.useCallback((()=>{const e=document.createElement("input");e.type="file",e.multiple=s,e.style.display="none",e.setAttribute("data-testid","drop-zone-file-input"),e.accept=n.join(","),e.onchange=t=>{if(t.target instanceof HTMLInputElement&&t.target.files&&t.target.files.length){const e=l(t.target.files);e.length&&r(e)}e.remove()},document.body.appendChild(e),e.click()}),[s,n,l,r])}})(e),d=a?"Drop files here or click to upload":"Drop a file here or click to upload";return s.jsx("div",{className:"drop_zone clickable",onDrop:l,onDragOver:n,onClick:r,onDragLeave:i,"data-testid":`drop-zone-${t}`,children:s.jsxs("div",{className:"drop_zone_content",children:[s.jsx("div",{className:"drop_zone_icon",children:s.jsx(y.FaCloudUploadAlt,{})}),s.jsx("div",{className:"drop_zone_text",children:d})]})})};ho.displayName="DropZone";const fo=e=>{const{value:t,onChange:a,darkMode:n}=e,o=n?"vs-dark":"vs-light";return s.jsx("div",{className:"code-editor",children:s.jsx(d,{defaultLanguage:"python",theme:o,value:t,className:o,options:{wordWrap:"on",automaticLayout:!0,fontSize:16,formatOnType:!0,autoClosingBrackets:"always",tabSize:4,minimap:{scale:1}},onChange:a})})};fo.displayName="Editor";const yo=({value:e,onChange:t,autoFocus:a=!1,...n})=>{const i=o.useRef(null),r=o.useRef({selectionStart:(null==e?void 0:e.length)||0,selectionEnd:(null==e?void 0:e.length)||0}),l=o.useRef(!0),d=o.useCallback((e=>{const{selectionStart:a,selectionEnd:n}=e.target;r.current={selectionStart:a,selectionEnd:n},t(e)}),[t]);return o.useEffect((()=>{a&&i.current&&i.current.focus()}),[a]),o.useEffect((()=>{l.current?l.current=!1:i.current&&document.activeElement===i.current&&requestAnimationFrame((()=>{i.current&&i.current.setSelectionRange(r.current.selectionStart,r.current.selectionEnd)}))}),[e]),s.jsx("textarea",{ref:i,value:e,onChange:d,...n})};yo.displayName="TextareaInput";const bo=[{value:"string",label:"Check a variable"},{value:"expression",label:"Use an expression"}],vo=e=>{const{available:t,onDataChange:a}=e,[n,i]=o.useState(t);o.useEffect((()=>{i(t)}),[t]);const r=o.useMemo((()=>"expression"===n.type),[n]),l=o.useMemo((()=>"string"===n.type),[n]),d=o.useMemo((()=>bo.find((e=>e.value===n.type))),[n.type]),c=o.useCallback((e=>{const t=e?"string":"none",s={...n,type:t,value:n.value};i(s),a(s)}),[n,a]),u=o.useCallback((e=>{if(e){const t={...n,type:e.value,value:""};i(t),a(t)}}),[n,a]),g=o.useCallback((e=>{const t={...n,value:e.target.value};i(t),a(t)}),[n,a]);return s.jsxs("div",{className:"flex-column",children:[s.jsxs("div",{className:"info margin-bottom-5",children:["You can optionally handle the availability of this transition by checking a variable or using an expression.",s.jsxs("ul",{children:[s.jsxs("li",{children:[s.jsx("strong",{children:"Check a variable"}),": Confirm if a certain variable (like"," ",s.jsx("code",{children:"order_is_found"}),") is set and is truthy."]}),s.jsxs("li",{children:[s.jsx("strong",{children:"Use Expression"}),": Write a short logic rule using variables, like:",s.jsx("br",{}),s.jsxs("code",{children:["$","{","is_logged_in","}"," and not $","{","is_banned","}"]})]})]})]}),s.jsx("div",{children:s.jsx(Js,{label:"Enable Availability Check",isChecked:"none"!==n.type,onCheckedChange:c,id:"availability-enabled-checkbox","data-testid":"availability-enabled-checkbox","aria-label":"Enable availability check"})}),"none"!==t.type&&s.jsxs("div",{className:"flex-column margin-top-10",children:[s.jsx("label",{className:"hidden",htmlFor:"select-availability-type",children:"Availability Type"}),s.jsx($s,{options:bo,value:d,onChange:u,inputId:"select-availability-type",className:"flex-1 margin-right-10",isClearable:!0,"data-testid":"availability-type-select"}),r&&s.jsxs("div",{className:"flex-column margin-top-10",children:[s.jsx("label",{className:"hidden",htmlFor:"expression-input",children:"Expression"}),s.jsx(yo,{rows:2,className:"margin-top-5",title:"Expression",placeholder:"Enter the expression to evaluate",value:n.value||"",onChange:g,"data-testid":"expression-input"})]}),l&&s.jsxs("div",{className:"flex-column margin-top-10",children:[s.jsx("label",{className:"hidden",htmlFor:"string-input",children:"Variable Name"}),s.jsx("input",{type:"text",id:"string-input",value:n.value,onChange:g,className:"flex-1",placeholder:"Enter variable name","data-testid":"string-input"})]})]})]})};vo.displayName="HandoffAvailability";const xo=o.memo((e=>{const{name:t,label:a,value:n,onChange:i,onNull:r="",disabled:l=!1,labelInfo:d=null,dataTestId:c="text-input",placeholder:u="...",style:g={},className:m="",isPassword:p=!1,fullWidth:h=!1,labelClassName:f=""}=e,[b,v]=o.useState(!1),x=o.useCallback((e=>{l||i(e)}),[l,i]),C=o.useCallback((()=>{v((e=>!e))}),[]),w=o.useMemo((()=>p?b?"text":"password":"text"),[p,b]),k=o.useMemo((()=>h?{flex:"1",...g}:{...g}),[h,g]);return s.jsxs(s.Fragment,{children:[d?s.jsx(mo,{label:a,info:d,htmlFor:`id-${t}`}):"string"==typeof a?s.jsx("label",{htmlFor:`id-${t}`,className:f,children:a}):a,s.jsxs("div",{className:"flex",children:[s.jsx("input",{className:m,placeholder:u,type:w,value:null!==n?n:r,onChange:x,disabled:l,"data-testid":c,id:`id-${t}`,name:t,style:k,"aria-label":"string"==typeof a?a:void 0}),p&&s.jsx("button",{type:"button",className:"toggle-visibility-btn margin-left-5",onClick:C,title:b?"Hide password":"Show password","aria-label":b?"Hide password":"Show password","data-testid":`visibility-${c}`,children:b?s.jsx(y.FaEyeSlash,{}):s.jsx(y.FaEye,{})})]})]})}));xo.displayName="TextInput";const Co={string_llm:"Static LLM prompt",string_context:"Variable check",context_str_llm:"Dynamic LLM Prompt",expression_context:"Expression check"},wo=[{value:"string_llm",label:Co.string_llm},{value:"context_str_llm",label:Co.context_str_llm},{value:"string_context",label:Co.string_context},{value:"expression_context",label:Co.expression_context}],ko=e=>{const{condition:t,onDataChange:a}=e,[n,i]=o.useState(t);o.useEffect((()=>{i(t)}),[t]);const r=o.useCallback(((e,t)=>{if(!n)return;const s={...n,[e]:t};i(s),a(s)}),[n,a]),l=o.useCallback((e=>{if(e){const t={conditionType:e.value};i(t),a(t)}}),[a]),d=o.useMemo((()=>({string_llm:{field:"prompt",handler:e=>r("prompt",e.target.value)},context_str_llm:{field:"context_str",handler:e=>r("context_str",e.target.value)},string_context:{field:"variable_name",handler:e=>r("variable_name",e.target.value)},expression_context:{field:"expression",handler:e=>r("expression",e.target.value)}})),[r]),c=o.useMemo((()=>(null==n?void 0:n.conditionType)?{label:Co[n.conditionType],value:n.conditionType}:null),[null==n?void 0:n.conditionType]),u=o.useCallback((()=>{if(!(null==n?void 0:n.conditionType))return null;const e=n.conditionType,t=d[e];switch(e){case"string_llm":return s.jsxs("div",{className:"margin-top-10",children:[s.jsx("label",{children:"LLM Prompt:"}),s.jsx("div",{className:"margin-top-5"}),s.jsx(yo,{rows:2,title:"LLM Prompt",placeholder:"Enter the LLM prompt",value:n.prompt||"",onChange:t.handler,"data-testid":"llm-prompt-input"})]});case"context_str_llm":return s.jsxs("div",{className:"margin-top-10",children:[s.jsx("label",{children:"Prompt:"}),s.jsx(yo,{rows:2,className:"margin-top-5",title:"Prompt",placeholder:"Enter the prompt to evaluate",value:n.context_str||"",onChange:t.handler,"data-testid":"context-llm-prompt-input"})]});case"string_context":return s.jsx("div",{className:"margin-top-10",children:s.jsx(xo,{name:"variable-name",label:"Variable Name:",className:"margin-top-5",placeholder:"Enter the variable name to check",value:n.variable_name||"",onChange:t.handler,dataTestId:"variable-name-input"})});case"expression_context":return s.jsxs("div",{className:"margin-top-10",children:[s.jsx("label",{children:"Expression:"}),s.jsx(yo,{rows:2,className:"margin-top-5",title:"Expression",placeholder:"Enter the expression to evaluate",value:n.expression||"",onChange:t.handler,"data-testid":"expression-input"})]});default:return null}}),[n,d]);return s.jsxs("div",{className:"flex-column",children:[s.jsxs("div",{className:"info margin-bottom-5",children:["You can control when this transition happens. Conditions allow you to check values or evaluate logic based on the current context. There are four types of conditions you can choose from:",s.jsxs("ul",{className:"no-margin",children:[s.jsxs("li",{children:[s.jsx("strong",{children:"Static LLM prompt"}),": A fixed message sent to a language model (LLM) to decide whether the transition should happen."]}),s.jsxs("li",{children:[s.jsx("strong",{children:"Dynamic LLM prompt"}),": A message that includes context variables, like the user's name or order count. It's sent to the LLM for evaluation.",s.jsx("br",{}),s.jsx("em",{children:"Example:"}),s.jsx("ul",{children:s.jsx("li",{children:s.jsxs("code",{children:['"User is ',"{","user_name","}"," and has ","{","num_orders","}",' orders."']})})})]}),s.jsxs("li",{children:[s.jsx("strong",{children:"Variable check"}),": Simply checks if a specific variable exists and is truthy."]}),s.jsxs("li",{children:[s.jsx("strong",{children:"Expression check"}),": Allows you to write a small logic expression using context variables. You can use operators like ",s.jsx("code",{children:"and"}),", ",s.jsx("code",{children:"or"}),","," ",s.jsx("code",{children:"not"}),", as well as comparison signs like ",s.jsx("code",{children:">"}),", ",s.jsx("code",{children:"=="}),", etc.",s.jsx("br",{}),s.jsx("em",{children:"Examples:"}),s.jsxs("ul",{children:[s.jsx("li",{children:s.jsxs("code",{children:["not $","{","logged_in","}"," and $","{","is_admin","}"," or $","{","guest_checkout","}"]})}),s.jsx("li",{children:s.jsxs("code",{children:["len($","{","orders","}",") > 0 and $","{","user_active","}"]})})]})]})]})]}),s.jsxs("div",{className:"flex-column margin-top-10",children:[s.jsx("label",{className:"hidden",htmlFor:"select-condition-type",children:"Condition Type"}),s.jsx($s,{options:wo,value:c,onChange:l,inputId:"select-condition-type",className:"flex-1 margin-right-10",isClearable:!0}),u()]})]})};ko.displayName="HandoffCondition";const jo=(e,t,a,n,s)=>{const{groupEdges:i,nestedChats:r}=((e,t,a,n)=>{const s=o.useMemo((()=>t.parentId),[t.parentId]),i=o.useMemo((()=>s?a.filter((t=>t.data.parentId===s&&t.id!==e)):[]),[a,s,e]),r=o.useMemo((()=>n.filter((t=>t.source===e))),[n,e]),l=o.useMemo((()=>{if(!s)return r;const e=i.map((e=>e.id));return r.filter((t=>e.includes(t.target)))}),[r,i,s]),d=o.useMemo((()=>r.filter((t=>{const n=a.find((e=>e.id===t.source)),o=a.find((e=>e.id===t.target));return n&&o&&n.id===e&&n.data.parentId===s&&o.data.parentId!==s}))),[e,r,a,s]),c=o.useMemo((()=>r.filter((e=>{const t=a.find((t=>t.id===e.target));return t&&t.data.parentId===s}))),[r,a,s]),u=o.useMemo((()=>{const a=t.nestedChats||[];return 0===d.length||a.length>0&&a[0].messages.length>0?a:[{triggeredBy:[e],messages:d.map((e=>({id:e.id,isReply:!1}))),condition:{conditionType:"string_llm",prompt:""},available:{type:"none",value:""}}]}),[e,d,t.nestedChats]);return{parentGroupId:s,groupAgents:i,agentEdges:r,groupEdges:l,nestedEdges:d,nestedChats:u,agentGroupOnlyEdges:c}})(e,t,a,n),{getTransitionTargetName:l}=((e,t,a)=>{const n=o.useCallback((t=>{const a=e.find((e=>e.id===t));return(null==a?void 0:a.data.label)||(null==a?void 0:a.data.name)||t}),[e]),s=o.useCallback(((e=0)=>{if(0===a.length||e>=a.length||0===a[e].messages.length)return"Nested Chat";const s=a[e].messages.map((e=>{const a=t.find((t=>t.id===e.id));return a?n(a.target):""})).filter(Boolean);return 0===s.length?"Nested Chat":1===s.length?`Nested Chat: ${s[0]}`:`Nested Chat: ${s[0]} +${s.length-1} more`}),[a,t,n]),i=e=>{switch(e.targetType){case"AgentTarget":return n(e.value[0]);case"RandomAgentTarget":return`Random (${e.value.map(n).join(", ")})`;case"GroupChatTarget":return`Group Chat: ${n(e.value[0])}`;case"NestedChatTarget":return s(0);case"AskUserTarget":return"Ask User";case"GroupManagerTarget":return"Group Manager";case"RevertToUserTarget":return"Revert to User";case"StayTarget":return"Stay";case"TerminateTarget":return"Terminate";default:return"Unknown"}};return{getAgentName:n,getTransitionTargetName:i,getAfterWorkTargetName:e=>i(e),getNestedChatDisplayName:s}})(a,n,r),d=o.useMemo((()=>{const e=[],a=new Set,n="nested-chat",s=r.length>0&&r.some((e=>e.messages.length>0));if(t.handoffs.forEach(((t,o)=>{if(t===n){if(s){const t={targetType:"NestedChatTarget",value:[n]};e.push({id:n,...t,value:[l(t)],order:o})}}else{const n=i.find((e=>e.id===t));if(n){a.add(n.id);const t={targetType:"AgentTarget",value:[n.target]};e.push({id:n.id,...t,value:[l(t)],order:o})}}})),i.forEach((t=>{if(!a.has(t.id)){const a={targetType:"AgentTarget",value:[t.target]};e.push({id:t.id,...a,value:[l(a)],order:e.length})}})),s&&!t.handoffs.includes(n)){const t={targetType:"NestedChatTarget",value:[]};e.push({id:n,...t,value:[l(t)],order:e.length})}return e.sort(((e,t)=>e.order-t.order))}),[t.handoffs,i,r,l]),c=o.useCallback((e=>{if(e<=0)return;const t=[...d];[t[e],t[e-1]]=[t[e-1],t[e]];const a=t.map((e=>e.id));s({handoffs:a})}),[d,s]),u=o.useCallback((e=>{if(e>=d.length-1)return;const t=[...d];[t[e],t[e+1]]=[t[e+1],t[e]];const a=t.map((e=>e.id));s({handoffs:a})}),[d,s]);return{orderedTransitionTargets:d,getTransitionTargetName:l,onMoveTransitionTargetUp:c,onMoveTransitionTargetDown:u}},Ao=o.memo((e=>{const{id:t,data:a,agents:n,edges:o,onDataChange:i}=e,{orderedTransitionTargets:r,getTransitionTargetName:l,onMoveTransitionTargetDown:d,onMoveTransitionTargetUp:c}=jo(t,a,n,o,i),u=r.length>0||!!a.afterWork;return s.jsxs("div",{className:"handoffs-container","data-testid":`handoffs-container-${t}`,children:[s.jsx("div",{className:"info margin-left--5",children:"Handoffs control where the conversation flow goes from this agent. They include connections to other agents, nested chats, and what happens after the agent's work is done."}),s.jsx("div",{className:"handoffs-list",children:u?s.jsxs("div",{className:"handoffs-items",children:[r.length>0&&s.jsxs("div",{className:"handoffs-section",children:[s.jsx("h4",{className:"handoffs-section-title",children:"Handoffs"}),s.jsxs("p",{className:"handoff-order-instructions",children:["If the group's speakers selection mode allows it (e.g. set to"," ",s.jsx("em",{children:s.jsx("b",{children:"default"})}),"), you can use the up and down arrows to reorder handoffs. The ordering will then determine the sequence in which handoffs are processed."]}),s.jsx("div",{className:"ordered-items-list",children:r.map(((e,t)=>s.jsxs("div",{className:"ordered-item","data-testid":`handoff-item-${t}`,children:[s.jsxs("div",{className:"reorder-buttons",children:[t>0&&s.jsx("button",{type:"button",title:"Move up",className:"reorder-btn up-btn","data-testid":`move-handoff-up-button-${t}`,onClick:()=>c(t),"aria-label":"Move up",children:"↑"}),t<r.length-1&&s.jsx("button",{type:"button",title:"Move down",className:"reorder-btn down-btn","data-testid":`move-handoff-down-button-${t}`,onClick:()=>d(t),"aria-label":"Move down",children:"↓"})]})," ",s.jsxs("div",{className:"ordered-item-content",children:[s.jsx("div",{className:"order-badge",children:t+1}),s.jsx("div",{className:"handoff-type",children:"AgentTarget"===e.targetType?"Agent Connection":"NestedChatTarget"===e.targetType?"Nested Chat":e.targetType}),s.jsxs("div",{className:"handoff-target",children:[s.jsx("span",{className:"target-label",children:"Target:"})," ",e.value]})]})]},`handoff-${t}`)))})]}),a.afterWork&&s.jsxs("div",{className:"handoffs-section",children:[s.jsx("h4",{className:"handoffs-section-title",children:"After Work"}),s.jsx("div",{className:"ordered-item after-work-handoff","data-testid":"handoff-after-work-item",children:s.jsxs("div",{className:"ordered-item-content",children:[s.jsx("div",{className:"handoff-type",children:"AfterWork"}),s.jsxs("div",{className:"handoff-target",children:[s.jsx("span",{className:"target-label",children:"Target:"})," ",l(a.afterWork)]}),s.jsx("div",{className:"handoff-info",children:s.jsx("em",{children:"AfterWork handoff always executes last"})})]})})]})]}):s.jsx("div",{className:"no-handoffs-message",children:'This agent has no handoffs configured. You can add connections to other agents in the flow editor, configure nested chats in the agent settings, or set what happens after the agent\'s work is done in the "Afterwards" tab.'})})]})}));Ao.displayName="Handoffs";const No=e=>{const{current:t,darkMode:a,defaultContent:n,selectLabel:i,selectTestId:r,notNoneLabel:l,notNoneLabelInfo:d,includeContext:c,skipRagOption:u,skipCarryoverOption:g,skipNone:m,onTypeChange:p}=e,{onContentUpdate:h,onRagProblemUpdate:f,onMethodContentUpdate:y,onUseCarryoverChange:b,onAddContextEntry:v,onRemoveContextEntry:x,onUpdateContextEntries:C}=(e=>{const{current:t,onMessageChange:a,onAddContextEntry:n,onRemoveContextEntry:s,onUpdateContextEntries:i}=e,r=o.useCallback((e=>{a(e)}),[a]),l=o.useCallback(((e,t)=>{null==n||n(e,t)}),[n]),d=o.useCallback((e=>{null==s||s(e)}),[s]),c=o.useCallback((e=>{null==i||i(e)}),[i]);return{onContentUpdate:o.useCallback((e=>{r({type:"string",useCarryover:t.useCarryover,content:e.target.value,context:t.context})}),[t.useCarryover,t.context,r]),onRagProblemUpdate:o.useCallback((e=>{r({type:"rag_message_generator",content:null,useCarryover:t.useCarryover,context:{...t.context,problem:e.target.value}})}),[t.useCarryover,t.context,r]),onMethodContentUpdate:o.useCallback((e=>{e&&r({type:"method",useCarryover:t.useCarryover,content:e,context:t.context})}),[t.useCarryover,t.context,r]),onUseCarryoverChange:o.useCallback((e=>{r({type:t.type,useCarryover:e,content:t.content,context:t.context})}),[t.type,t.content,t.context,r]),onAddContextEntry:l,onRemoveContextEntry:d,onUpdateContextEntries:c}})(e),w="none"!==t.type&&"rag_message_generator"!==t.type&&l&&(d?s.jsx(mo,{label:l,info:d,htmlFor:"message-input"}):s.jsx("label",{htmlFor:"message-input",children:l})),k=c&&"rag_message_generator"!==t.type&&"none"!==t.type;let j=u?So.filter((e=>"rag_message_generator"!==e.value)):So;return!0===m&&(j=j.filter((e=>"none"!==e.value))),s.jsxs(s.Fragment,{children:[s.jsx("label",{htmlFor:`message-select-test-${r}`,children:i}),s.jsx("div",{className:"margin-bottom-5"}),s.jsx($s,{options:j,value:{label:Mo[t.type],value:t.type},onChange:e=>{p(e?e.value:"none")},inputId:`message-select-test-${r}`}),w,"string"===t.type&&s.jsx("div",{className:"full-width",children:s.jsx(yo,{placeholder:"Enter the message",className:"fill-available-width",rows:3,value:t.content??"",onChange:h,"data-testid":"message-text"})}),"rag_message_generator"===t.type&&s.jsxs("div",{children:[s.jsx("div",{className:"info margin-bottom-20",children:"Use the RAG user's `sender.message_generator` method to generate a message."}),s.jsx("label",{children:"Problem:"}),s.jsx("div",{className:"full-width",children:s.jsx(yo,{placeholder:"Enter the problem",rows:3,className:"fill-available-width margin-top-5",value:String(t.context.problem??""),onChange:f,"data-testid":"rag-message-generator-problem"})})]}),"method"===t.type&&s.jsx(fo,{value:t.content??n,onChange:y,darkMode:a}),k&&s.jsx(po,{items:t.context,itemsType:"message-context",viewLabel:"Message Context",viewLabelInfo:"Additional context to be included.",onAdd:v,onDelete:x,onUpdate:C}),!g&&("string"===t.type||"rag_message_generator"===t.type)&&s.jsx(Ys,{label:"Carryover ",info:To,checked:t.useCarryover??!1,id:"message-use-carryover",onChange:b})]})},To=s.jsxs("div",{children:[s.jsx("div",{children:"This should not be checked if this is the first message in the flow."}),s.jsx("br",{}),"Append the context's last carryover to the message.",s.jsx("br",{}),"Example final message:",s.jsx("br",{}),s.jsx("pre",{children:'"Write a blogpost.\\nContext:\\n" + carryover'})]}),So=[{label:"None",value:"none"},{label:"Text",value:"string"},{label:"Use RAG Message Generator",value:"rag_message_generator"},{label:"Custom method",value:"method"}],Mo={none:"None",string:"Text",rag_message_generator:"Use RAG Message Generator",method:"Method"};No.displayName="MessageInput";const Io=e=>{const{onSaveAndClose:t,hideConfirmation:a,handleSaveAndClose:n,handleCloseModal:o}=e;return s.jsx("div",{className:"modal-confirmation padding-10",children:s.jsxs("div",{className:"modal-confirmation-content",children:[s.jsx("h4",{className:"warning",children:"Are you sure you want to close this modal? Any unsaved changes will be lost."}),s.jsx("div",{className:"modal-actions",children:t?s.jsxs(s.Fragment,{children:[s.jsx("div",{className:"modal-actions flex-center margin-top--10 margin-bottom--10",children:s.jsx("button",{className:"secondary","data-testid":"modal-action-confirm-cancel",onClick:a,type:"button",title:"Don't Close",children:"Don't Close"})}),s.jsxs("div",{className:"modal-actions flex-center margin-top--10 margin-bottom--10",children:[s.jsx("button",{className:"save margin-right-10","data-testid":"modal-action-confirm-save",onClick:n,type:"button",title:"Save & Close",children:"Save & Close"}),s.jsx("button",{className:"primary","data-testid":"modal-action-confirm-close",onClick:o,type:"button",title:"Close",children:"Close"})]})]}):s.jsxs(s.Fragment,{children:[s.jsx("button",{className:"modal-action-cancel","data-testid":"modal-action-confirm-cancel",onClick:a,type:"button",title:"Don't Close",children:"Don't Close"}),s.jsx("button",{className:"modal-action-submit","data-testid":"modal-action-confirm-close",onClick:o,type:"button",title:"Close",children:"Close"})]})})]})})},Eo=o.memo((e=>{const{id:t,isOpen:a,dataTestId:n="modal-dialog",beforeTitle:i,title:r,hasCloseBtn:l=!0,hasMaximizeBtn:d=!0,hasMinimizeBtn:c=!0,children:u,className:g="",onSaveAndClose:m}=e,p=o.useRef(null),h=o.useRef(null),[f,y]=o.useState(void 0),[b,x]=o.useState(0),{showConfirmation:C,isFullScreen:w,isMinimized:k,position:j,hideConfirmation:A,onToggleFullScreen:N,onToggleMinimize:T,handleCloseModal:S,handleSaveAndClose:M,handleCancel:I,onKeyDown:E,onMouseDown:D}=(e=>{const{isOpen:t,hasUnsavedChanges:a=!1,preventCloseIfUnsavedChanges:n=!1,onClose:s,onSaveAndClose:i,onCancel:r,modalRef:l}=e,[d,c]=o.useState(!1),[u,g]=o.useState(!1),[m,p]=o.useState(!1),[h,f]=o.useState({x:10,y:20}),[y,b]=o.useState(!1),[v,x]=o.useState({x:0,y:0}),[C,w]=o.useState(""),k=n&&a,j=!k,A=o.useCallback((()=>{f({x:10,y:50}),g(!1),p(!1),c(!1),l.current&&(l.current.style.width="",l.current.style.height="")}),[l]),N=o.useCallback((e=>{const t=l.current;t&&(e?t.showModal():t.close())}),[l]),T=o.useCallback((()=>{m&&(p(!1),l.current&&(l.current.style.height=C||"")),g((e=>!e))}),[l,m,C]),S=o.useCallback((()=>{u&&!m&&g(!1),p((e=>(e?l.current&&C&&(l.current.style.height=C):l.current&&w(l.current.style.height||window.getComputedStyle(l.current).height),!e)))}),[l,m,u,C]),M=o.useCallback((()=>{c(!1)}),[]),I=o.useCallback((()=>{if(k&&!d)return c(!0),void(m&&S());A(),null==s||s(),N(!1)}),[m,k,d,S,A,s,N]),E=o.useCallback((()=>{A(),null==i||i(),N(!1)}),[A,i,N]),D=o.useCallback((e=>{r?r(e):(e.preventDefault(),e.stopPropagation(),I())}),[r,I]),R=o.useCallback((e=>{"Escape"===e.key&&j&&D(e)}),[j,D]),P=o.useCallback((e=>{if(!l.current||u)return;b(!0);const t=window.getComputedStyle(l.current),a=parseInt(t.left,10)||0,n=parseInt(t.top,10)||0;x({x:e.clientX-a,y:e.clientY-n})}),[u,l]),O=o.useCallback((e=>{y&&f({x:e.clientX-v.x,y:e.clientY-v.y})}),[y,v]),L=o.useCallback((()=>{b(!1)}),[]);return o.useEffect((()=>(y?(document.addEventListener("mousemove",O,{passive:!0}),document.addEventListener("mouseup",L,{passive:!0})):(document.removeEventListener("mousemove",O),document.removeEventListener("mouseup",L)),()=>{document.removeEventListener("mousemove",O),document.removeEventListener("mouseup",L)})),[y,O,L]),o.useEffect((()=>{N(t)}),[t,N]),{showConfirmation:d,isFullScreen:u,isMinimized:m,position:h,hideConfirmation:M,onToggleFullScreen:T,onToggleMinimize:S,handleCloseModal:I,handleSaveAndClose:E,handleCancel:D,onKeyDown:R,onMouseDown:P}})({...e,modalRef:p});o.useEffect((()=>{var e,t;a?null==(e=p.current)||e.showModal():null==(t=p.current)||t.close()}),[a]),o.useLayoutEffect((()=>{if(a&&p.current&&!f){const e=()=>{if(p.current){const t=p.current.getBoundingClientRect().width;if(t>0){y(`${t}px`);const e=p.current.querySelectorAll(".tab-btn");x(e.length)}else requestAnimationFrame(e)}};requestAnimationFrame(e)}a||(y(void 0),x(0))}),[a,f]);const R=o.useCallback((()=>{if(!p.current||!f)return;const e=p.current.querySelector(".tab-list");if(!e)return;const t=e.scrollWidth+40;t>parseFloat(f)&&y(`${t}px`)}),[f]);o.useLayoutEffect((()=>{if(a&&p.current&&f){const e=p.current.querySelectorAll(".tab-btn").length;e!==b&&(x(e),R())}}),[u,a,b,f,R]);const P=["modal","no-wheel no-pan no-drag",w?"modal-fullscreen":"",k?"modal-minimized":"",C?"confirmation":"",g].filter(Boolean).join(" ");return s.jsxs("dialog",{ref:p,id:t,"data-testid":n,onKeyDown:E,onCancel:I,className:P,style:{...f?{width:f}:{},...w?{}:{top:j.y,left:j.x}},children:[s.jsxs("div",{className:"modal-header",ref:h,onMouseDown:D,children:[s.jsx("div",{children:i}),s.jsx("h3",{className:"modal-title",children:r}),s.jsxs("div",{className:"modal-header-actions",children:[c&&s.jsx("div",{className:"modal-minimize-btn clickable",role:"button",title:k?"Restore":"Minimize",onClick:T,children:k?s.jsx(v.FaChevronDown,{}):s.jsx(v.FaChevronUp,{})}),d&&s.jsx("div",{className:"modal-fullscreen-btn clickable",role:"button",title:w?"Restore":"Maximize",onClick:N,children:w?s.jsx(v.FaCompress,{}):s.jsx(v.FaExpand,{})}),l&&s.jsx("div",{className:"modal-close-btn clickable",role:"button",title:"Close","data-testid":"modal-close-btn",onClick:S,children:s.jsx(v.FaCircleXmark,{})})]})]}),s.jsx("div",{className:"modal-content "+(k?"hidden":""),children:C?Io({onSaveAndClose:m,hideConfirmation:A,handleSaveAndClose:M,handleCloseModal:S}):u})]})}));function Do(e,[t,a]){return Math.min(a,Math.max(t,e))}Eo.displayName="Modal";var Ro=I.createContext(void 0);var Po=["PageUp","PageDown"],Oo=["ArrowUp","ArrowDown","ArrowLeft","ArrowRight"],Lo={"from-left":["Home","PageDown","ArrowDown","ArrowLeft"],"from-right":["Home","PageDown","ArrowDown","ArrowRight"],"from-bottom":["Home","PageDown","ArrowDown","ArrowLeft"],"from-top":["Home","PageDown","ArrowUp","ArrowLeft"]},zo="Slider",[Fo,Uo,qo]=function(e){const t=e+"CollectionProvider",[a,n]=vs(t),[i,r]=a(t,{collectionRef:{current:null},itemMap:new Map}),l=e=>{const{scope:t,children:a}=e,n=o.useRef(null),r=o.useRef(new Map).current;return s.jsx(i,{scope:t,itemMap:r,collectionRef:n,children:a})};l.displayName=t;const d=e+"CollectionSlot",c=Ms(d),u=o.forwardRef(((e,t)=>{const{scope:a,children:n}=e,o=bs(t,r(d,a).collectionRef);return s.jsx(c,{ref:o,children:n})}));u.displayName=d;const g=e+"CollectionItemSlot",m="data-radix-collection-item",p=Ms(g),h=o.forwardRef(((e,t)=>{const{scope:a,children:n,...i}=e,l=o.useRef(null),d=bs(t,l),c=r(g,a);return o.useEffect((()=>(c.itemMap.set(l,{ref:l,...i}),()=>{c.itemMap.delete(l)}))),s.jsx(p,{[m]:"",ref:d,children:n})}));return h.displayName=g,[{Provider:l,Slot:u,ItemSlot:h},function(t){const a=r(e+"CollectionConsumer",t);return o.useCallback((()=>{const e=a.collectionRef.current;if(!e)return[];const t=Array.from(e.querySelectorAll(`[${m}]`));return Array.from(a.itemMap.values()).sort(((e,a)=>t.indexOf(e.ref.current)-t.indexOf(a.ref.current)))}),[a.collectionRef,a.itemMap])},n]}(zo),[Bo,Ho]=vs(zo,[qo]),[Wo,Vo]=Bo(zo),Go=I.forwardRef(((e,t)=>{const{name:a,min:n=0,max:o=100,step:i=1,orientation:r="horizontal",disabled:l=!1,minStepsBetweenThumbs:d=0,defaultValue:c=[n],value:u,onValueChange:g=()=>{},onValueCommit:m=()=>{},inverted:p=!1,form:h,...f}=e,y=I.useRef(new Set),b=I.useRef(0),v="horizontal"===r?Zo:Xo,[x=[],C]=js({prop:u,defaultProp:c,onChange:e=>{var t;null==(t=[...y.current][b.current])||t.focus(),g(e)}}),w=I.useRef(x);function k(e,t,{commit:a}={commit:!1}){const s=function(e){return(String(e).split(".")[1]||"").length}(i),r=function(e,t){const a=Math.pow(10,t);return Math.round(e*a)/a}(Math.round((e-n)/i)*i+n,s),l=Do(r,[n,o]);C(((e=[])=>{const n=function(e=[],t,a){const n=[...e];return n[a]=t,n.sort(((e,t)=>e-t))}(e,l,t);if(function(e,t){if(t>0){const a=function(e){return e.slice(0,-1).map(((t,a)=>e[a+1]-t))}(e);return Math.min(...a)>=t}return!0}(n,d*i)){b.current=n.indexOf(l);const t=String(n)!==String(e);return t&&a&&m(n),t?n:e}return e}))}return s.jsx(Wo,{scope:e.__scopeSlider,name:a,disabled:l,min:n,max:o,valueIndexToChangeRef:b,thumbs:y.current,values:x,orientation:r,form:h,children:s.jsx(Fo.Provider,{scope:e.__scopeSlider,children:s.jsx(Fo.Slot,{scope:e.__scopeSlider,children:s.jsx(v,{"aria-disabled":l,"data-disabled":l?"":void 0,...f,ref:t,onPointerDown:Cs(f.onPointerDown,(()=>{l||(w.current=x)})),min:n,max:o,inverted:p,onSlideStart:l?void 0:function(e){const t=function(e,t){if(1===e.length)return 0;const a=e.map((e=>Math.abs(e-t))),n=Math.min(...a);return a.indexOf(n)}(x,e);k(e,t)},onSlideMove:l?void 0:function(e){k(e,b.current)},onSlideEnd:l?void 0:function(){const e=w.current[b.current];x[b.current]!==e&&m(x)},onHomeKeyDown:()=>!l&&k(n,0,{commit:!0}),onEndKeyDown:()=>!l&&k(o,x.length-1,{commit:!0}),onStepKeyDown:({event:e,direction:t})=>{if(!l){const a=Po.includes(e.key)||e.shiftKey&&Oo.includes(e.key)?10:1,n=b.current;k(x[n]+i*a*t,n,{commit:!0})}}})})})})}));Go.displayName=zo;var[Ko,Qo]=Bo(zo,{startEdge:"left",endEdge:"right",size:"width",direction:1}),Zo=I.forwardRef(((e,t)=>{const{min:a,max:n,dir:o,inverted:i,onSlideStart:r,onSlideMove:l,onSlideEnd:d,onStepKeyDown:c,...u}=e,[g,m]=I.useState(null),p=bs(t,(e=>m(e))),h=I.useRef(void 0),f=function(e){const t=I.useContext(Ro);return e||t||"ltr"}(o),y="ltr"===f,b=y&&!i||!y&&i;function v(e){const t=h.current||g.getBoundingClientRect(),s=ii([0,t.width],b?[a,n]:[n,a]);return h.current=t,s(e-t.left)}return s.jsx(Ko,{scope:e.__scopeSlider,startEdge:b?"left":"right",endEdge:b?"right":"left",direction:b?1:-1,size:"width",children:s.jsx(Jo,{dir:f,"data-orientation":"horizontal",...u,ref:p,style:{...u.style,"--radix-slider-thumb-transform":"translateX(-50%)"},onSlideStart:e=>{const t=v(e.clientX);null==r||r(t)},onSlideMove:e=>{const t=v(e.clientX);null==l||l(t)},onSlideEnd:()=>{h.current=void 0,null==d||d()},onStepKeyDown:e=>{const t=Lo[b?"from-left":"from-right"].includes(e.key);null==c||c({event:e,direction:t?-1:1})}})})})),Xo=I.forwardRef(((e,t)=>{const{min:a,max:n,inverted:o,onSlideStart:i,onSlideMove:r,onSlideEnd:l,onStepKeyDown:d,...c}=e,u=I.useRef(null),g=bs(t,u),m=I.useRef(void 0),p=!o;function h(e){const t=m.current||u.current.getBoundingClientRect(),s=ii([0,t.height],p?[n,a]:[a,n]);return m.current=t,s(e-t.top)}return s.jsx(Ko,{scope:e.__scopeSlider,startEdge:p?"bottom":"top",endEdge:p?"top":"bottom",size:"height",direction:p?1:-1,children:s.jsx(Jo,{"data-orientation":"vertical",...c,ref:g,style:{...c.style,"--radix-slider-thumb-transform":"translateY(50%)"},onSlideStart:e=>{const t=h(e.clientY);null==i||i(t)},onSlideMove:e=>{const t=h(e.clientY);null==r||r(t)},onSlideEnd:()=>{m.current=void 0,null==l||l()},onStepKeyDown:e=>{const t=Lo[p?"from-bottom":"from-top"].includes(e.key);null==d||d({event:e,direction:t?-1:1})}})})})),Jo=I.forwardRef(((e,t)=>{const{__scopeSlider:a,onSlideStart:n,onSlideMove:o,onSlideEnd:i,onHomeKeyDown:r,onEndKeyDown:l,onStepKeyDown:d,...c}=e,u=Vo(zo,a);return s.jsx(Rs.span,{...c,ref:t,onKeyDown:Cs(e.onKeyDown,(e=>{"Home"===e.key?(r(e),e.preventDefault()):"End"===e.key?(l(e),e.preventDefault()):Po.concat(Oo).includes(e.key)&&(d(e),e.preventDefault())})),onPointerDown:Cs(e.onPointerDown,(e=>{const t=e.target;t.setPointerCapture(e.pointerId),e.preventDefault(),u.thumbs.has(t)?t.focus():n(e)})),onPointerMove:Cs(e.onPointerMove,(e=>{e.target.hasPointerCapture(e.pointerId)&&o(e)})),onPointerUp:Cs(e.onPointerUp,(e=>{const t=e.target;t.hasPointerCapture(e.pointerId)&&(t.releasePointerCapture(e.pointerId),i(e))}))})})),Yo="SliderTrack",$o=I.forwardRef(((e,t)=>{const{__scopeSlider:a,...n}=e,o=Vo(Yo,a);return s.jsx(Rs.span,{"data-disabled":o.disabled?"":void 0,"data-orientation":o.orientation,...n,ref:t})}));$o.displayName=Yo;var _o="SliderRange",ei=I.forwardRef(((e,t)=>{const{__scopeSlider:a,...n}=e,o=Vo(_o,a),i=Qo(_o,a),r=bs(t,I.useRef(null)),l=o.values.length,d=o.values.map((e=>oi(e,o.min,o.max))),c=l>1?Math.min(...d):0,u=100-Math.max(...d);return s.jsx(Rs.span,{"data-orientation":o.orientation,"data-disabled":o.disabled?"":void 0,...n,ref:r,style:{...e.style,[i.startEdge]:c+"%",[i.endEdge]:u+"%"}})}));ei.displayName=_o;var ti="SliderThumb",ai=I.forwardRef(((e,t)=>{const a=Uo(e.__scopeSlider),[n,o]=I.useState(null),i=bs(t,(e=>o(e))),r=I.useMemo((()=>n?a().findIndex((e=>e.ref.current===n)):-1),[a,n]);return s.jsx(ni,{...e,ref:i,index:r})})),ni=I.forwardRef(((e,t)=>{const{__scopeSlider:a,index:n,name:o,...i}=e,r=Vo(ti,a),l=Qo(ti,a),[d,c]=I.useState(null),u=bs(t,(e=>c(e))),g=!d||(r.form||!!d.closest("form")),m=Ns(d),p=r.values[n],h=void 0===p?0:oi(p,r.min,r.max),f=function(e,t){return t>2?`Value ${e+1} of ${t}`:2===t?["Minimum","Maximum"][e]:void 0}(n,r.values.length),y=null==m?void 0:m[l.size],b=y?function(e,t,a){const n=e/2,s=ii([0,50],[0,n]);return(n-s(t)*a)*a}(y,h,l.direction):0;return I.useEffect((()=>{if(d)return r.thumbs.add(d),()=>{r.thumbs.delete(d)}}),[d,r.thumbs]),s.jsxs("span",{style:{transform:"var(--radix-slider-thumb-transform)",position:"absolute",[l.startEdge]:`calc(${h}% + ${b}px)`},children:[s.jsx(Fo.ItemSlot,{scope:e.__scopeSlider,children:s.jsx(Rs.span,{role:"slider","aria-label":e["aria-label"]||f,"aria-valuemin":r.min,"aria-valuenow":p,"aria-valuemax":r.max,"aria-orientation":r.orientation,"data-orientation":r.orientation,"data-disabled":r.disabled?"":void 0,tabIndex:r.disabled?void 0:0,...i,ref:u,style:void 0===p?{display:"none"}:e.style,onFocus:Cs(e.onFocus,(()=>{r.valueIndexToChangeRef.current=n}))})}),g&&s.jsx(si,{name:o??(r.name?r.name+(r.values.length>1?"[]":""):void 0),form:r.form,value:p},n)]})}));ai.displayName=ti;var si=I.forwardRef((({__scopeSlider:e,value:t,...a},n)=>{const o=I.useRef(null),i=bs(o,n),r=As(t);return I.useEffect((()=>{const e=o.current;if(!e)return;const a=window.HTMLInputElement.prototype,n=Object.getOwnPropertyDescriptor(a,"value").set;if(r!==t&&n){const a=new Event("input",{bubbles:!0});n.call(e,t),e.dispatchEvent(a)}}),[r,t]),s.jsx(Rs.input,{style:{display:"none"},...a,ref:i,defaultValue:t})}));function oi(e,t,a){return Do(100/(a-t)*(e-t),[0,100])}function ii(e,t){return a=>{if(e[0]===e[1]||t[0]===t[1])return t[0];const n=(t[1]-t[0])/(e[1]-e[0]);return t[0]+n*(a-e[0])}}si.displayName="RadioBubbleInput";var ri=Go,li=$o,di=ei,ci=ai;const ui=o.memo((e=>{const{name:t,value:a,label:n,onChange:i,onNull:r,onUpperLabel:l=null,onLowerLabel:d=null,setNullOnUpper:c=!1,setNullOnLower:u=!1,labelInfo:g=null,min:m=0,max:p=100,step:h=1,forceInt:f=!1,disabled:y=!1,dataTestId:b}=e,v=o.useMemo((()=>r??u?m:c?p:m),[r,u,c,m,p]),x=o.useMemo((()=>null!==a?a:v),[a,v]),C=o.useCallback((e=>{const t=e[0];i(t===p&&c||t===m&&u?null:f?Math.round(t):t)}),[i,p,m,c,u,f]),w=o.useCallback((e=>{try{const t=f?parseInt(e.target.value,10):parseFloat(e.target.value);isNaN(t)||C([t])}catch(t){}}),[f,C]),k=o.useCallback((()=>a!==p&&null!==a||!c&&null===l?a!==m&&null!==a||!u&&null===d?s.jsx("input",{id:`id-for-${t}`,name:t,placeholder:`${x}`,inputMode:"decimal",type:"number",min:m,max:p,step:h,value:x,onChange:w,"data-testid":b}):d??"Not set":l??"No limit"),[t,a,m,p,x,h,l,d,c,u,w,b]),j=o.useMemo((()=>{const e=k();return g?s.jsx("div",{className:"number-input-info-label-wrapper",children:s.jsx(mo,{label:s.jsxs("div",{className:"number-input-info-label-inner",children:[n,"  ",e]}),info:g,htmlFor:`id-for-${t}`})}):s.jsx("div",{className:"number-input-label-wrapper",children:s.jsxs("label",{htmlFor:`id-for-${t}`,children:[n," ",e]})})}),[t,n,k,g]);return s.jsxs(s.Fragment,{children:[j,s.jsxs(ri,{className:"slider-root",value:[x],max:p,step:h,min:m,onValueChange:C,disabled:y,children:[s.jsx(li,{className:"slider-track",children:s.jsx(di,{className:"slider-range"})}),s.jsx(ci,{className:"slider-thumb"})]})]})}));ui.displayName="NumberInput";const gi=o.memo((e=>{const{viewLabel:t,viewLabelInfo:a,items:n=[],itemsType:i="default",placeholder:r="..."}=e,{newEntry:l,onAddEntry:d,onDeleteEntry:c,onEntryChange:u,onNewEntryChange:g,onNewEntryKeyDown:m}=(e=>{const[t,a]=o.useState(""),{items:n,onItemAdded:s,onItemChange:i,onItemDeleted:r}=e,l=o.useCallback((()=>{s&&t.trim()&&(s(t),a(""))}),[t,s]),d=o.useCallback((e=>{if(!r)return;const t=e.currentTarget.value;r(t)}),[r]),c=o.useCallback((e=>{if(!i)return;const t=parseInt(e.currentTarget.getAttribute("data-index")||"0"),a=e.target.value,s=n[t];null!=s&&i(s,a)}),[i,n]),u=o.useCallback((e=>{a(e.target.value)}),[]),g=o.useCallback((e=>{"Enter"===e.key&&(e.preventDefault(),l())}),[l]);return{newEntry:t,onAddEntry:l,onDeleteEntry:d,onEntryChange:c,onNewEntryChange:u,onNewEntryKeyDown:g}})(e),p=o.useMemo((()=>"function"==typeof t?t():t),[t]),h=o.useMemo((()=>n.map(((e,t)=>s.jsxs("div",{className:"list-entry",children:[s.jsx("input",{placeholder:r,type:"text",value:e,"data-index":t,id:`list-entry-item-${i}-${t}`,onChange:u,"data-testid":`list-entry-item-${i}-${t}`}),s.jsx("button",{type:"button",onClick:c,value:e,title:"Delete",className:"trash-button",id:`delete-list-entry-${i}-${t}`,"aria-label":`Delete item: ${e}`,"data-testid":`delete-list-entry-${i}-${t}`,children:s.jsx(y.FaTrash,{})})]},`${i}-${t}`)))),[n,i,r,u,c]),f=!l.trim();return s.jsxs("div",{className:"list-entries-view",children:[a?s.jsx(mo,{label:t,info:a,htmlFor:"list-entries"}):s.jsx("label",{className:"list-entries-label",htmlFor:"list-entries",children:p}),n.length>0&&s.jsx("div",{className:"list-entries-list",children:h}),s.jsx("div",{className:"list-entries-list",children:s.jsxs("div",{className:"add-list-entry-view",children:[s.jsx("input",{placeholder:r,type:"text",value:l,onChange:g,onKeyDown:m,"data-testid":`new-list-entry-${i}-item`,"aria-label":`New ${i} input`,id:`new-list-entry-${i}`}),s.jsx("button",{type:"button",onClick:d,title:"Add",disabled:f,className:"plus-button","aria-label":"Add item",id:`add-list-entry-${i}-button`,"data-testid":`add-list-entry-${i}-button`,children:s.jsx(y.FaPlus,{})})]})})]})}));gi.displayName="StringList";const mi=o.memo((e=>{const{id:t,children:a}=e;return s.jsx("div",{className:"tab-panel",role:"tabpanel","aria-labelledby":`tab-id-${t}`,"data-testid":`panel-${t}`,id:`panel-${t}`,children:a})})),pi=o.memo((e=>{const{activeTabIndex:t=0,children:a,onTabChange:n}=e,[i,r]=o.useState(t);o.useEffect((()=>{r(t)}),[t]);const l=o.useCallback((e=>{r(e),null==n||n(e)}),[n]),d=o.useMemo((()=>o.Children.toArray(a).filter((e=>o.isValidElement(e)&&e.type===mi))),[a]),c=o.useMemo((()=>d.map(((e,t)=>{const a=i===t,n=a?"tab-btn--active":"",o=e.props.id;return s.jsx("li",{role:"tab","aria-selected":a,children:s.jsx("div",{role:"button","data-testid":`tab-id-${o}`,id:`tab-id-${o}`,"aria-controls":`panel-${o}`,onClick:()=>l(t),className:`tab-btn ${n}`,tabIndex:a?0:-1,children:e.props.label})},`tab-li-${o}-${t}`)}))),[d,i,l]),u=d[i]||null;return s.jsxs("div",{className:"tabs",children:[s.jsx("nav",{className:"tab-list-wrapper",children:s.jsx("ul",{className:"tab-list",role:"tablist","aria-orientation":"horizontal",children:c})}),u]})}));mi.displayName="TabItem",pi.displayName="TabItems";const hi='"""Custom update system message function."""\n\n# provide the function to define the system message before replying\n# complete the `custom_update_system_message` below. Do not change the name or the arguments of the function.\n# only complete the function body and the docstring and return the final message.\n# the function should accept the agent and the messages as arguments.\n# example:\n# def custom_update_system_message(\n#     agent: ConversableAgent,\n#     messages: List[Dict[str, Any]]\n# ) -> str:\n#     return "Hello, I am a custom system message"\n\ndef custom_update_system_message(\n     agent: ConversableAgent,\n     messages: List[Dict[str, Any]]\n) -> str:\n    ...\n',fi=e=>{const{data:t,onDataChange:a,darkMode:n}=e,i=o.useMemo((()=>t.updateAgentStateBeforeReply.length>0),[t.updateAgentStateBeforeReply]),r=o.useMemo((()=>i?t.updateAgentStateBeforeReply[0]:{type:"string",content:""}),[i,t.updateAgentStateBeforeReply]),[l,d]=o.useState(i),[c,u]=o.useState(r.type);o.useEffect((()=>{d(i),i&&u(r.type)}),[i,r.type]);const g=o.useMemo((()=>[{label:"Text",value:"string"},{label:"Function",value:"callable"}]),[]),m=o.useMemo((()=>g.find((e=>e.value===c))),[g,c]),p=o.useCallback((e=>{if(d(e),e){a({updateAgentStateBeforeReply:[{type:c,content:"string"===c?"":hi}]})}else a({updateAgentStateBeforeReply:[]})}),[a,c]),h=o.useCallback((e=>{if(!e)return void a({updateAgentStateBeforeReply:[]});const t=e.value;u(t);a({updateAgentStateBeforeReply:[{type:t,content:"string"===t?"":hi}]})}),[a]),f=o.useCallback((e=>{a({updateAgentStateBeforeReply:[{type:"string",content:e.target.value}]})}),[a]),y=o.useCallback((e=>{a({updateAgentStateBeforeReply:[{type:"callable",content:e??hi}]})}),[a]),b=o.useMemo((()=>i&&"string"===r.type?r.content:""),[i,r]),v=o.useMemo((()=>i&&"callable"===r.type?r.content:hi),[i,r]);return s.jsxs("div",{className:"agent-panel agent-update-state-panel",children:[s.jsx("div",{className:"info margin-bottom-10",children:"You can update the agent's system message before replying. This can be useful if you need to control the system message based on the current conversation context. If enabled, it can be a string or a function. If text, it will be used as a template and substitute the context variables. If a function, it should accept the agent and messages as arguments and return a string."}),s.jsxs("div",{className:"flex-column",children:[s.jsx(Js,{label:"Update system message before reply",isChecked:l,onCheckedChange:p,id:"enable-update-system-message","aria-label":"Enable update system message"}),l&&s.jsxs(s.Fragment,{children:[s.jsx("label",{htmlFor:"update-system-message-type-select-input",children:"Message update type"}),s.jsx($s,{options:g,value:m,onChange:h,inputId:"update-system-message-type-select-input"}),s.jsx("label",{htmlFor:"update-system-message-string",children:"Message update"}),"string"===c?s.jsx(yo,{rows:4,value:b,placeholder:"Enter a string template with {variable}s",onChange:f,"data-testid":"update-system-message-string",id:"update-system-message-string"}):s.jsx(fo,{value:v,onChange:y,darkMode:n,"data-testid":"update-system-message-callable"})]})]})]})};fi.displayName="UpdateState";const yi=o.memo((e=>{const{children:t,id:a}=e;return s.jsx("div",{className:"wizard-step-view","data-testid":`wizard-step-${a}`,children:t})})),bi=o.memo((e=>{const{children:t,activeStep:a=0,canGoForward:n=!0,canGoBack:i=!0,firstBackTitle:r="Cancel",lastNextTitle:l="Finish",onBack:d,onForward:c}=e,[u,g]=o.useState(a);o.useEffect((()=>{g(a)}),[a]);const m=o.useMemo((()=>o.Children.toArray(t).filter((e=>o.isValidElement(e)&&e.type===yi))),[t]),p=o.useMemo((()=>"function"==typeof i?i(u):i),[i,u]),h=o.useMemo((()=>"function"==typeof n?n(u):n),[n,u]),f=o.useMemo((()=>0===u&&!d||!p),[u,d,p]),y=o.useMemo((()=>u===m.length-1&&!c||!h),[u,m.length,c,h]),b=o.useMemo((()=>0===u?r:"Back"),[u,r]),v=o.useMemo((()=>u===m.length-1?l:"Next"),[u,m.length,l]),x=o.useCallback((()=>{u>0&&g((e=>e-1)),d&&d(u)}),[u,d]),C=o.useCallback((()=>{u<m.length-1&&g((e=>e+1)),c&&c(u)}),[u,m.length,c]),w=o.useMemo((()=>m.map(((e,t)=>{const a=u===t,n=a?"wizard-step--active":"";return s.jsx("div",{role:"tab",className:`wizard-step ${n}`,"data-testid":`step-id-${e.props.id}`,"aria-selected":a,"aria-controls":`wizard-step-${e.props.id}`,children:e},`wizard-step-${t}`)}))),[m,u]);return s.jsxs("div",{className:"wizard",children:[s.jsx("div",{className:"wizard-steps",role:"tablist",children:w}),s.jsxs("div",{className:"modal-actions",children:[s.jsx("button",{type:"button",title:b,onClick:x,"data-testid":"wizard-back-btn",disabled:f,className:"wizard-action-btn wizard-action-btn-prev","aria-label":b,children:b}),s.jsx("button",{type:"button",title:v,onClick:C,disabled:y,"data-testid":"wizard-next-btn",className:"wizard-action-btn wizard-action-btn-next primary","aria-label":v,children:v})]})]})}));yi.displayName="WizardStep",bi.displayName="Wizard";const vi=(e,t)=>({markerEnd:"nested"!==e?{type:i.MarkerType.ArrowClosed,color:t,width:10,height:10}:void 0,style:{stroke:t,strokeWidth:1}}),xi=(e,t)=>`${e.data.label.slice(0,15)} => ${t.data.label.slice(0,15)}`,Ci=e=>{const{flowId:t,hidden:a,positionGetter:n,sourceNode:s,targetNode:o,edges:i}=e;if(((e,t)=>void 0!==e.data.parentId||void 0!==t.data.parentId||"group_manager"===e.data.agentType||"group_manager"===t.data.agentType)(s,o)&&((e,t,a,n)=>{if("string"!=typeof e.data.agentType||"string"!=typeof t.data.agentType)return is({flowId:n,message:`Could not create a connection from ${e.data.label} to ${t.data.label}`,level:"warning",details:"Invalid agent type",withCloseButton:!0}),!0;if(!e.data.parentId&&!["user_proxy","rag_user_proxy","group_manager"].includes(e.data.agentType))return is({flowId:n,message:`Invalid source agent type: ${s=e.data.agentType,s.replace(/([A-Z])/g," $1").replace(/([0-9])/g," $1").replace(/_/g," ").replace(/-/g," ").trim().toLowerCase().split(" ").map((e=>Q(e))).join(" ")}`,level:"warning",details:void 0,withCloseButton:!0}),!0;var s;if(!e.data.parentId&&t.data.parentId)return is({flowId:n,message:"A connection from a non-group member to a group member is not allowed",level:"warning",details:void 0,withCloseButton:!0}),!0;if("group_manager"===t.data.agentType&&a.filter((e=>e.target===t.id)).length>0)return is({flowId:n,message:"A connection to this group manager already exists",level:"warning",details:void 0,withCloseButton:!0}),!0;return!1})(s,o,i,t))return null;const r=s.data.agentType,{chat:l,chatType:d}=wi(s,o,a,n),c=hn(l),u=oa[r];return{...c,type:d,animated:!!s.data.parentId&&!o.data.parentId,selected:!0,...vi(d,u)}},wi=(e,t,a,n)=>{const s=xi(e,t),o=e.data.agentType,i=t.data.agentType,r=new pe;r.sourceType=o,r.targetType=i,r.description=`${e.data.label} to ${t.data.label}`,r.condition={conditionType:"string_llm",prompt:""},r.name=s,r.order=-1;const l=((e,t,a)=>a?"hidden":"group_manager"===e.data.agentType||"group_manager"===t.data.agentType||void 0!==e.data.parentId||void 0!==t.data.parentId?"group":"chat")(e,t,a);r.position=n(l);return{chat:new he({id:`wc-${V()}`,data:r,type:l,source:e.id,target:t.id,rest:{}}),chatType:l}},ki=(e,t)=>{const a=e.filter((e=>e.type===t)),n={};return a.forEach((e=>{n[e.source]||(n[e.source]=[]),n[e.source].push(e)})),a.map(((e,t)=>({...e,data:{...e.data,position:t+1}})))},ji=(e,t)=>{Ti(e,t),Ni(e,t)},Ai=(e,t,a)=>{var n;const s=(new Date).toISOString(),o=new Map(e.map((e=>[e.id,e]))),i=t=>t.data&&t.data.prerequisites&&0!==t.data.prerequisites.length?Math.max(...t.data.prerequisites.map((t=>{var a;const n=e.find((e=>e.id===t));return(null==(a=null==n?void 0:n.data)?void 0:a.order)??0})))+1:0;let r=!0;for(;r;){r=!1;for(const t of e){const e=i(t);(null==(n=o.get(t.id).data)?void 0:n.order)!==e&&(o.get(t.id).data.order=e,r=!0)}}const l=Array.from(o.values()),d=t().edges.filter((e=>!l.find((t=>t.id===e.id)))).map((e=>({...e,data:{...e.data,order:-1,prerequisites:[]}})));a({edges:[...l,...d],updatedAt:s})},Ni=(e,t)=>{!0===e().isAsync?((e,t)=>{const a=e().edges.filter((e=>{var t;return void 0!==(null==(t=e.data)?void 0:t.order)&&e.data.order>=0}));Ai(a,e,t)})(e,t):((e,t)=>{t({edges:e().edges.map(((e,t)=>{var a;let n=null==(a=e.data)?void 0:a.order;return void 0===n&&(n=-1),{...e,data:{...e.data,order:n<0?n:t}}})),updatedAt:(new Date).toISOString()})})(e,t)},Ti=(e,t)=>{const a=e().edges.map((e=>({...e,data:{...e.data,position:1}}))),n=(e=>ki(e,"chat"))(a),s=(e=>ki(e,"nested"))(a),o=(e=>ki(e,"hidden"))(a),i=(e=>ki(e,"group"))(a),r=[...n,...s,...o,...i],l=r.map((e=>e.id)),d=Array.from(new Set(l));t({edges:r.filter((e=>d.includes(e.id))),updatedAt:(new Date).toISOString()}),((e,t)=>{const a=e().nodes.filter((e=>"agent"===e.type)),n=[],s=[];a.forEach((t=>{(t.data.nestedChats??[]).forEach((t=>{const a=t.messages;let o=0;a.forEach((t=>{const a=e().edges.find((e=>e.id===t.id));a&&"nested"===a.type&&!s.includes(a.id)&&(n.push({...a,data:{...a.data,position:o+1}}),s.push(a.id),o++)}))}))})),t({edges:[...e().edges.filter((e=>!s.includes(e.id))),...n],updatedAt:(new Date).toISOString()})})(e,t)},Si=(e,t)=>Array.from(new Set([...e,...t])),Mi=(e,t)=>Array.from(new Set([...e,...t])),Ii=(e,t,a)=>{if(0===e.length&&0===t.length)return a.map((t=>{const a=Pi(t,e),n="hidden"===t.type;return{...t,animated:a,hidden:n}}));const n=a.map((e=>({...e,data:{...e.data,order:-1}}))).filter((e=>!t.find((t=>t.id===e.id))));return[...t,...n].map((t=>{const a=Pi(t,e),n="hidden"===t.type;return{...t,animated:a,hidden:n}}))},Ei=(e,t,a)=>{const n=t.filter((t=>!e.find((e=>e.id===t.id))));return[...e,...n].map((e=>e.type===a?{...e,hidden:!1}:{...e,hidden:!0}))},Di=(e,t,a,n)=>0===a.length&&0===n.length?t:e,Ri=(e,t,a,n,s)=>{e.name&&(s.name=a.name),e.description&&(s.description=a.description),e.tags&&(s.tags=Si(t.tags,a.tags)),e.requirements&&(s.requirements=Mi(t.requirements,a.requirements)),e.isAsync&&(s.isAsync=a.isAsync??t.isAsync),e.cacheSeed&&(s.cacheSeed=a.cacheSeed??t.cacheSeed??42);const o=[...e.nodes.models,...e.nodes.tools,...e.nodes.agents].map((e=>e.id)),i=a.nodes.filter((e=>o.includes(e.id))),r=e.override?i:Ei(t.nodes,i,n);s.nodes=r;const l=e.override?a.edges:Ii(r,t.edges,a.edges);s.edges=l},Pi=(e,t)=>{if("nested"===e.type)return!0;t.find((t=>t.id===e.source)),t.find((t=>t.id===e.target));return!1},Oi=(e,t)=>{const a=hs(e().nodes,e().flowId,"model",e().rfInstance);return t({nodes:a,updatedAt:(new Date).toISOString()}),a},Li=(e,t)=>{const a=hs(e().nodes,e().flowId,"tool",e().rfInstance);return t({nodes:a,updatedAt:(new Date).toISOString()}),a};class zi{constructor(e,t){S(this,"get"),S(this,"set"),S(this,"getAgents",(()=>this.get().nodes.filter((e=>"agent"===e.type)))),S(this,"getAgentById",(e=>{const t=this.get().nodes.find((t=>t.id===e));return t&&"agent"===t.type?t:null})),S(this,"addAgent",((e,t,a)=>{const n=((e,t,a)=>{const n=Z.create(e),s=ka(n,t);if(s.data.parentId=a,"rag_user_proxy"===e){const e=new le;s.data={...s.data,...e}}else if("reasoning"===e){const e=new ue;s.data={...s.data,...e}}else if("captain"===e){const e=new ne;s.data={...s.data,...e}}else if("group_manager"===e){const e=new oe;e.groupName="Group",s.data={...s.data,...e}}return a&&(s.parentId=a,s.extent="parent"),s})(e,t,a);return n.style={width:"group_manager"===e?va.width:"user_proxy"!==e?xa.width:ba.width},"group_manager"===e?this.set({nodes:[n,...this.get().nodes],updatedAt:(new Date).toISOString()}):this.set({nodes:[...this.get().nodes,n],updatedAt:(new Date).toISOString()}),n})),S(this,"cloneAgent",(e=>{const t=this.get().nodes.find((t=>t.id===e));if(t){const e=t.data.label+" (copy)",a={x:t.position.x+(t.width??100)+40,y:t.position.y+(t.height??100)+40},n={...t,position:a,id:V(),data:{...t.data,label:e}};return this.set({nodes:[...this.get().nodes,n],updatedAt:(new Date).toISOString()}),setTimeout((()=>{this.set({nodes:this.get().nodes.map((e=>e.id===n.id?{...e,selected:!0}:{...e,selected:!1}))})}),10),n}return null})),S(this,"updateAgentData",((e,t)=>{this.set({nodes:this.get().nodes.map((a=>a.id===e?(t.parentId!==a.data.parentId&&(a.parentId=t.parentId??void 0,a.extent=t.parentId?"parent":void 0),{...a,data:{...a.data,...t}}):a)),updatedAt:(new Date).toISOString()}),ji(this.get,this.set)})),S(this,"deleteAgent",(e=>{const t=this.get().nodes.find((t=>t.id===e));if(t){const a=[e],n=[];if("group_manager"===t.data.agentType){const t=this.getGroupMembers(e);n.push(...t.map((e=>e.id)))}this.set({nodes:this.get().nodes.filter((e=>!a.includes(e.id))).map((e=>(n.includes(e.id)&&(e.parentId=void 0,e.data.parentId=void 0,e.extent=void 0),e))),edges:this.get().edges.filter((e=>!a.includes(e.source)&&!a.includes(e.target))).map((e=>n.includes(e.source)||n.includes(e.target)?{...e,animated:!1,type:"chat"}:e)),updatedAt:(new Date).toISOString()})}else this.set({nodes:this.get().nodes.filter((t=>t.id!==e)),edges:this.get().edges.filter((t=>t.source!==e&&t.target!==e)),updatedAt:(new Date).toISOString()});ji(this.get,this.set)})),S(this,"importAgent",((e,t,a,n,s=!0)=>{const o=Ca(e,t),i=ka(o,n,a);return n&&(i.position=n),s&&this.set({nodes:[...this.get().nodes,{...i}],updatedAt:(new Date).toISOString()}),i})),S(this,"exportAgent",((e,t)=>{const a=this.get().nodes.find((t=>t.id===e));return a?wa(a,t):{}})),S(this,"getAgentConnections",((e,t)=>(t||(t={sourcesOnly:!1,targetsOnly:!1}),((e,t,a,n)=>{n||(n={sourcesOnly:!1,targetsOnly:!1});const s=[],o=[],i=[],r=[];for(const l of t){const{sourceNode:t,targetNode:d}=gs(a,l,e,n);t&&(s.push(t),o.push(l)),d&&(i.push(d),r.push(l))}return{sources:{nodes:s,edges:o},targets:{nodes:i,edges:r}}})(this.get().nodes,this.get().edges,e,t)))),S(this,"setAgentGroup",((e,t,a)=>{this.set({nodes:this.get().nodes.map((n=>n.id===e?{...n,position:a??n.position,parentId:t,extent:"parent",data:{...n.data,parentId:t}}:n)),updatedAt:(new Date).toISOString()})})),S(this,"getGroupMembers",(e=>this.get().nodes.filter((t=>"agent"===t.type&&t.data.parentId===e)))),S(this,"addGroupMember",((e,t,a)=>{this.set({nodes:this.get().nodes.map((n=>n.id===t?{...n,position:a||n.position,parentId:e,extent:"parent",data:{...n.data,parentId:e}}:n)),updatedAt:(new Date).toISOString()}),ji(this.get,this.set)})),S(this,"removeGroupMember",((e,t)=>{const a=[...this.get().nodes.map((a=>(a.id===t&&a.data.parentId===e&&(a.data.parentId=void 0,a.parentId=void 0,a.extent=void 0,a.position={x:a.position.x+50,y:a.position.y+50}),{...a})))];this.set({nodes:a,updatedAt:(new Date).toISOString()}),ji(this.get,this.set)})),this.get=e,this.set=t}static create(e,t){return new zi(e,t)}}class Fi{constructor(e,t){S(this,"get"),S(this,"set"),S(this,"getEdges",(()=>this.get().edges)),S(this,"getEdgeById",(e=>this.get().edges.find((t=>t.id===e)))),S(this,"deleteEdge",(e=>{const t=this.get().nodes.filter((e=>"agent"===e.type)),a=[...this.get().nodes.filter((e=>"agent"!==e.type)),...t.map((t=>{const a=t.data.nestedChats??[];return{...t,data:{...t.data,nestedChats:a.map((t=>({...t,messages:t.messages.filter((t=>t.id!==e)),triggeredBy:t.triggeredBy})))}}}))],n=this.get().edges.filter((t=>t.id!==e));this.set({nodes:a,edges:n.map(((e,t)=>({...e,data:{...e.data,position:t+1}}))),updatedAt:(new Date).toISOString()}),this.resetEdgeOrdersAndPositions()})),S(this,"updateEdgeData",((e,t)=>{const a=this.get().edges.find((t=>t.id===e));if(a){const n={...a,data:{...a.data,...t}},s=this.get().edges.map((t=>t.id===e?n:t));this.set({edges:s,updatedAt:(new Date).toISOString()}),this.resetEdgeOrdersAndPositions()}})),S(this,"updateEdgeType",((e,t)=>{this.set({edges:this.get().edges.map((a=>{var n,s;if(a.id===e){const o=this.get().nodes.find((e=>e.id===a.source));if(!o)throw new Error(`Source node not found for edge ${e}`);const i=oa[o.data.agentType];return{...a,type:t,hidden:!1,data:{...a.data,type:t,order:"nested"===t?-1:(null==(n=a.data)?void 0:n.order)??-1,prerequisites:"nested"===t?[]:(null==(s=a.data)?void 0:s.prerequisites)??[]},animated:"nested"===t,...vi(t,i)}}return a})),updatedAt:(new Date).toISOString()}),this.resetEdgeOrdersAndPositions()})),S(this,"updateEdgePath",((e,t)=>{const a=this.get().edges.find((t=>t.id===e));if(!a)return;const n=a.type,s=oa[t],{style:o,markerEnd:i}=vi(n,s);this.set({edges:this.get().edges.map((t=>t.id===e?{...t,style:o,markerEnd:i}:{...t})),updatedAt:(new Date).toISOString()}),this.resetEdgeOrdersAndPositions()})),S(this,"addEdge",(e=>{const{flowId:t,connection:a,hidden:n}=e,s=this.get().nodes,o=this.get().edges,{source:i,target:r,sourceHandle:l,targetHandle:d}=a,{sourceNode:c,targetNode:u}=((e,t,a)=>{const n=e.find((e=>e.id===t));if(!n)return{sourceNode:null,targetNode:null};const s=e.find((e=>e.id===a));return s?{sourceNode:n,targetNode:s}:{sourceNode:null,targetNode:null}})(s,i,r);if(!c||!u)return null;const g=Ci({flowId:t,hidden:n,sourceNode:c,targetNode:u,positionGetter:e=>o.filter((t=>t.type===e)).length,edges:o});if(!g)return null;this.set({edges:[...this.get().edges,{...g,sourceHandle:l,targetHandle:d}],updatedAt:(new Date).toISOString()}),this.resetEdgeOrdersAndPositions();return this.get().edges.find((e=>e.id===g.id))??g})),S(this,"onEdgeDoubleClick",((e,t)=>{if(document.querySelectorAll("dialog[open]").length>0)return;const a=K(this.get().flowId);if(a){const e=a.querySelector(`[data-edge-node-id="${t.source}"]`);if(e)e.setAttribute("data-edge-id",t.id),e.click();else{const e=a.querySelector(`[data-edge-node-id="${t.target}"]`);e&&(e.setAttribute("data-edge-id",t.id),e.click())}}})),S(this,"getEdgeSourceAgent",(e=>{const t=this.get().nodes.find((t=>t.id===e.source));if(t&&"agent"===t.type)return t})),S(this,"getEdgeTargetAgent",(e=>{const t=this.get().nodes.find((t=>t.id===e.target));if(t&&"agent"===t.type)return t})),S(this,"onReconnect",((e,t)=>{var a;const n=this.get().nodes;if(!((e,t)=>{const a=t.find((t=>t.id===e.target));return!(!t.find((t=>t.id===e.source))||!a)})(t,n))return;const{oldSourceNode:s,oldTargetNode:o,newSourceNode:i,newTargetNode:r,color:l}=((e,t,a)=>{let n,s,o,i,r;for(const l of a)if(l.id===e.source&&(n=l),l.id===e.target&&(s=l),l.id===t.source&&(o=l,r=oa[o.data.agentType]),l.id===t.target&&(i=l),n&&s&&o&&i)break;return{oldSourceNode:n,oldTargetNode:s,newSourceNode:o,newTargetNode:i,color:r}})(e,t,n);if(!(s&&o&&i&&r))return;if(!l)return!1;const d=null==(a=e.data)?void 0:a.label;e.data&&d===`${s.data.agentType} => ${o.data.agentType}`&&(e.data.label=xi(i,r)),this.set({edges:[...this.get().edges.map((a=>a.id!==e.id?a:{...e,source:t.source,target:t.target,sourceHandle:t.sourceHandle,targetHandle:t.targetHandle,...vi(e.type,l),data:{...a.data,realSource:i.id,realTarget:r.id,sourceType:i.data.agentType,targetType:r.data.agentType}}))],updatedAt:(new Date).toISOString()}),this.resetEdgeOrdersAndPositions()})),S(this,"onEdgesChange",(e=>{const t=i.applyEdgeChanges(e,this.get().edges);this.set({edges:t,updatedAt:(new Date).toISOString()})})),S(this,"resetEdgeOrdersAndPositions",(()=>{ji(this.get,this.set)})),this.get=e,this.set=t}static create(e,t){return new Fi(e,t)}}class Ui{constructor(e,t){S(this,"get"),S(this,"set"),S(this,"getViewport",(()=>this.get().viewport)),S(this,"getRfInstance",(()=>this.get().rfInstance)),S(this,"setRfInstance",(e=>{const t=this.get().rfInstance;this.set({rfInstance:e}),t||(Oi(this.get,this.set),Li(this.get,this.set))})),S(this,"getFlowInfo",(()=>{const{flowId:e,storageId:t,name:a,description:n,tags:s,requirements:o,createdAt:i,updatedAt:r,isAsync:l,cacheSeed:d}=this.get();return{flowId:e,storageId:t??e,name:a??"Untitled Flow",description:n??"A new Waldiez flow",tags:s??[],requirements:o??[],createdAt:i,updatedAt:r,isAsync:l??!1,cacheSeed:void 0!==d?d:42}})),S(this,"onFlowChanged",(()=>{const{onChange:e}=this.get(),t=this.exportFlow(!1);return e&&e(JSON.stringify(t)),t})),S(this,"getFlowEdges",(()=>{const e=this.get().edges.filter((e=>"chat"===e.type)),t=[],a=[];e.forEach((e=>{var n;let s;s="number"==typeof(null==(n=e.data)?void 0:n.order)?e.data.order:-1,s>=0?t.push(e):a.push(e)}));return{used:t.sort(((e,t)=>{var a,n;return((null==(a=e.data)?void 0:a.order)??0)-((null==(n=t.data)?void 0:n.order)??0)})),remaining:a}})),S(this,"saveFlow",(()=>{const{onSave:e}=this.get();if("function"==typeof e){const t=this.exportFlow(!1);e(JSON.stringify(t))}})),S(this,"onViewportChange",((e,t)=>{var a;if("model"===t||"tool"===t){if(e.zoom!==(null==(a=this.get().viewport)?void 0:a.zoom)){const{nodes:a,rfInstance:n,flowId:s}=this.get();this.set({nodes:hs(a,s,t,n),updatedAt:(new Date).toISOString()}),setTimeout((()=>{ps(this.get().rfInstance),this.set({viewport:e})}),100)}}else this.set({viewport:e})})),S(this,"importFlow",((e,t,a)=>{const{storageId:n,name:s,description:o,tags:i,requirements:r,nodes:l,edges:d,isAsync:c,rfInstance:u}=this.get(),g={name:s??"Untitled Flow",description:o??"A new Waldiez flow",tags:i??[],requirements:r??[],nodes:l,edges:d,isAsync:c??!1},{name:m,createdAt:p,description:h,tags:f,requirements:y,isAsync:b,nodes:v,edges:x}=((e,t,a,n)=>{let s=e.override?{...a,nodes:[],edges:[]}:{...t};if(e.everything){const d=e.override?a.nodes:Ei(t.nodes,a.nodes,n);s=e.override?a:{...s,name:(o=t.name,i=a.name,r=t.nodes,l=t.edges,0===r.length&&0===l.length?i:o),description:Di(t.description,a.description,t.nodes,t.edges),tags:Si(t.tags,a.tags),requirements:Mi(t.requirements,a.requirements),isAsync:a.isAsync??t.isAsync,cacheSeed:a.cacheSeed??t.cacheSeed??42,nodes:d,edges:Ii(d,t.edges,a.edges)}}else Ri(e,t,a,n,s);var o,i,r,l;return s})(e,g,t,a);this.set({name:m,description:h,tags:f,requirements:y,isAsync:b,storageId:n??`wf-${V()}`,createdAt:p??(new Date).toISOString(),updatedAt:(new Date).toISOString(),nodes:v,edges:x}),ji(this.get,this.set),Oi(this.get,this.set),Li(this.get,this.set),setTimeout((()=>{null==u||u.fitView({includeHiddenNodes:!1,padding:.2,duration:100})}),200)})),S(this,"exportFlow",(e=>{const{isAsync:t,cacheSeed:a,viewport:n,rfInstance:s,name:o,description:i,tags:r,requirements:l,createdAt:d,updatedAt:c,flowId:u,storageId:g}=this.get(),m={nodes:this.get().nodes,edges:this.get().edges,viewport:(null==s?void 0:s.getViewport())??n??{zoom:1,x:20,y:20},name:o??"Untitled Flow",description:i??"A new Waldiez flow",tags:r??[],requirements:l??[],createdAt:d??(new Date).toISOString(),updatedAt:c??(new Date).toISOString(),flowId:u,storageId:g??u,isAsync:t??!1,cacheSeed:a};return Xn.exportFlow(m,e,!1)})),S(this,"updateFlowOrder",(e=>{const t=(new Date).toISOString();this.set({edges:this.get().edges.map((t=>{var a,n;const s=(null==(a=e.find((e=>e.id===t.id)))?void 0:a.order)??(null==(n=t.data)?void 0:n.order)??-1;return{...t,data:{...t.data,order:s}}})),updatedAt:t})})),S(this,"updateFlowPrerequisites",(e=>{Ai(e,this.get,this.set)})),S(this,"updateFlowInfo",(e=>{this.set({name:e.name,description:e.description,tags:e.tags,requirements:e.requirements,updatedAt:(new Date).toISOString(),isAsync:e.isAsync,cacheSeed:e.cacheSeed})})),this.get=e,this.set=t}static create(e,t){return new Ui(e,t)}}class qi{constructor(e,t){S(this,"get"),S(this,"set"),S(this,"getModels",(()=>this.get().nodes.filter((e=>"model"===e.type)))),S(this,"getModelById",(e=>{const t=this.get().nodes.find((t=>t.id===e));return t&&"model"===t.type?t:null})),S(this,"addModel",(()=>{const e=this.get().nodes.filter((e=>"model"===e.type)).length,t=this.get().flowId,a=this.get().rfInstance,n=ms(e,t,a),s=je.create(),o=wn(s,n);this.set({nodes:[...this.get().nodes,{...o,type:"model"}],updatedAt:(new Date).toISOString()}),Oi(this.get,this.set),ps(a);return this.get().nodes.find((e=>e.id===o.id))})),S(this,"cloneModel",(e=>{const t=this.get().nodes.find((t=>t.id===e));if(!t||"model"!==t.type)return null;const a=this.get().rfInstance;Oi(this.get,this.set),ps(a);const n=t.data.label+" (copy)",s=this.getClonedModel(e,a);s.data.label=n,this.set({nodes:[...this.get().nodes.map((t=>t.id===e?{...t,selected:!1}:t)),{...s,type:"model",selected:!0}],updatedAt:(new Date).toISOString()}),Oi(this.get,this.set),ps(a);return this.get().nodes.find((e=>e.id===s.id))})),S(this,"updateModelData",((e,t)=>{const a=this.get().nodes.find((t=>t.id===e));if(!a||"model"!==a.type)return;const n=(new Date).toISOString();this.set({nodes:[...this.get().nodes.map((a=>a.id===e?{...a,data:{...a.data,...t,updatedAt:n}}:a))],updatedAt:n})})),S(this,"deleteModel",(e=>{const t=this.get().rfInstance,a=this.getNodesAfterModelDeletion(e,t);this.set({nodes:a,updatedAt:(new Date).toISOString()}),Oi(this.get,this.set),ps(t)})),S(this,"importModel",((e,t,a,n=!0)=>{const s=xn(e),o=wn(s,a);return o.id=t,a&&(o.position=a),n&&this.set({nodes:this.get().nodes.map((e=>e.id===t?o:e))}),o})),S(this,"exportModel",((e,t)=>{const a=this.get().nodes.find((t=>t.id===e));if(!a||"model"!==a.type)throw new Error(`Model with id ${e} not found`);return Cn(a,t)})),S(this,"getClonedModel",((e,t)=>{if(!this.get().nodes.find((t=>t.id===e)))throw new Error(`Model with id ${e} not found`);const a=this.get().nodes.filter((e=>"model"===e.type)).length,n=this.get().flowId,s=ms(a,n,t),o=je.create();return wn(o,s)})),S(this,"getNodesAfterModelDeletion",((e,t)=>{const a=this.get().nodes.filter((t=>"model"===t.type&&t.id!==e)),n=a.length,s=this.get().flowId;for(let r=0;r<n;r++){const e=a[r],n=ms(r,s,t);a[r]={...e,position:n}}const o=a.concat(this.get().nodes.filter((e=>"model"!==e.type))),i=[];return o.forEach((t=>{if("agent"===t.type){const a=t;a.data.modelIds.includes(e)?i.push({...a,data:{...a.data,modelIds:a.data.modelIds.filter((t=>t!==e))}}):i.push(a)}else i.push(t)})),i})),this.get=e,this.set=t}static create(e,t){return new qi(e,t)}}class Bi{constructor(e,t){S(this,"get"),S(this,"set"),S(this,"showNodes",(e=>{"agent"!==e?(this.isShowingAgents()&&this.storePreviousViewport(),ps(this.get().rfInstance)):this.restorePreviousViewport(),this.set({nodes:this.get().nodes.map((t=>t.type===e?{...t,hidden:!1}:{...t,hidden:!0}))})})),S(this,"isShowingAgents",(()=>this.get().nodes.some((e=>"agent"===e.type&&!1===e.hidden)))),S(this,"storePreviousViewport",(()=>{const e=this.get().rfInstance;let t;t=e?{x:e.getViewport().x,y:e.getViewport().y,zoom:e.getViewport().zoom}:this.get().viewport,this.set({previousViewport:t,updatedAt:(new Date).toISOString()})})),S(this,"restorePreviousViewport",(()=>{const e=this.get().previousViewport;if(e){this.set({viewport:e,updatedAt:(new Date).toISOString()});const t=this.get().rfInstance;t&&t.setViewport(e)}})),S(this,"onNodesChange",(e=>{const t=i.applyNodeChanges(e,this.get().nodes);this.set({nodes:t,updatedAt:(new Date).toISOString()})})),S(this,"onNodeDoubleClick",((e,t)=>{if(document.querySelectorAll("dialog[open]").length>0)return;const a=this.get().flowId,n=K(a);if(n){const e=n.querySelector(`[data-node-id="${t.id}"]`);e&&e.click()}})),S(this,"reselectNode",(e=>{const t=this.get().nodes.find((t=>t.id===e));t&&(t.selected&&this.set({nodes:this.get().nodes.map((t=>t.id===e?{...t,selected:!1}:t))}),this.set({nodes:this.get().nodes.map((t=>t.id===e?{...t,selected:!0}:{...t,selected:!1}))}))})),S(this,"highlightNode",(e=>{this.set({nodes:this.get().nodes.map((t=>({...t,className:t.id===e?"highlight":""})))})})),S(this,"clearNodeHighlight",(()=>{this.set({nodes:this.get().nodes.map((e=>({...e,className:""})))})})),this.get=e,this.set=t}static create(e,t){return new Bi(e,t)}}class Hi{constructor(e,t){S(this,"get"),S(this,"set"),S(this,"getTools",(()=>this.get().nodes.filter((e=>"tool"===e.type)))),S(this,"getToolById",(e=>{const t=this.get().nodes.find((t=>t.id===e));return t&&"tool"===t.type?t:null})),S(this,"addTool",(()=>{const e=this.get().nodes.filter((e=>"tool"===e.type)),t=this.get().flowId,a=this.get().rfInstance,n=e.length,s=ms(n,t,a),o=Se.create(),i=Mn(o,s);this.set({nodes:[...this.get().nodes,{...i,type:"tool"}],updatedAt:(new Date).toISOString()}),Li(this.get,this.set),ps(a);return this.get().nodes.find((e=>e.id===i.id))})),S(this,"cloneTool",(e=>{const t=this.get().nodes.find((t=>t.id===e));if(!t||"tool"!==t.type)return null;const a=this.get().rfInstance,n=this.getClonedTool(t,a);this.set({nodes:[...this.get().nodes.map((t=>t.id===e?{...t,selected:!1}:t)),{...n,type:"tool",selected:!0}],updatedAt:(new Date).toISOString()}),Li(this.get,this.set),ps(a);return this.get().nodes.find((e=>e.id===n.id))})),S(this,"updateToolData",((e,t)=>{const a=this.get().nodes.find((t=>t.id===e));if(!a||"tool"!==a.type)return;const n=(new Date).toISOString();this.set({nodes:[...this.get().nodes.map((s=>"tool"===s.type&&s.id===e?{...s,data:{...a.data,...t,updatedAt:n}}:s))],updatedAt:n})})),S(this,"deleteTool",(e=>{const t=this.get().rfInstance,a=this.getAgentsAfterToolDeletion(e,t);this.set({nodes:a,updatedAt:(new Date).toISOString()}),Li(this.get,this.set),ps(t)})),S(this,"importTool",((e,t,a,n)=>{const s=Tn(e),o=Mn(s,a);return o.id=t,a&&(o.position=a),n&&this.set({nodes:this.get().nodes.map((e=>e.id===t?o:e))}),o})),S(this,"exportTool",((e,t)=>{const a=this.get().nodes.find((t=>t.id===e));return a&&"tool"===a.type?Sn(a,t):{}})),S(this,"getClonedTool",((e,t)=>{const a=(new Date).toISOString(),n=a,s=this.get().nodes.filter((e=>"tool"===e.type)).length,o=this.get().flowId,i=ms(s,o,t),r=e.data.label+" (copy)";return{...e,id:`wt-${V()}`,data:{...e.data,label:r,createdAt:a,updatedAt:n},position:i}})),S(this,"getAgentAfterToolDeletion",((e,t)=>{const a=t.data.tools.filter((t=>t.id!==e)),n=t.data.codeExecutionConfig;if("boolean"==typeof n)return{...t,data:{...t.data,tools:a}};const s=(n.functions??[]).filter((t=>t!==e));return{...t,data:{...t.data,tools:a,codeExecutionConfig:{...n,functions:s}}}})),S(this,"getAgentsAfterToolDeletion",((e,t)=>{const a=this.get().nodes.filter((t=>"tool"===t.type&&t.id!==e)),n=a.length,s=this.get().flowId;for(let r=0;r<n;r++){const e=a[r],n=ms(r,s,t);a[r]={...e,position:n}}const o=a.concat(this.get().nodes.filter((e=>"tool"!==e.type))),i=[];return o.forEach((t=>{if("agent"===t.type){const a=this.getAgentAfterToolDeletion(e,t);i.push(a)}else i.push(t)})),i})),this.get=e,this.set=t}static create(e,t){return new Hi(e,t)}}const Wi=(e,t)=>{const a=p(e,t);if(0===a.length)return!0;return a.every((e=>("CREATE"!==e.type||2!==e.path.length)&&((1!==e.path.length||"string"!=typeof e.path[0]||!["name","description","tags","requirements"].includes(e.path[0]))&&((!e.path.includes("nodes")||!e.path.includes("data"))&&!(e.path.includes("edges")&&e.path.includes("data")&&!e.path.includes("position"))))))};function Vi({children:e,...t}){const a=o.useRef(void 0),n="boolean"==typeof t.isReadOnly&&t.isReadOnly,i=t.nodes,r=t.edges,l=t.flowId,d=t.name,c=t.description,u=t.tags,g=t.requirements,m=t.createdAt,p=t.updatedAt,y=t.storageId,b=t.onUpload??null,v=t.onChange??null,x=t.onSave??null,C=t.onRun??null,w=t.onConvert??null,k=t.rfInstance,j=t.isAsync??!1;t.cacheSeed;const A=o.useMemo((()=>(a.current=(e=>{const{flowId:t=`wf-${V()}`,isAsync:a=!1,isReadOnly:n=!1,skipExport:s=!1,skipImport:o=!1,edges:i=[],nodes:r=[],name:l="Untitled Flow",description:d="A new Waldiez flow",tags:c=[],requirements:u=[],createdAt:g=(new Date).toISOString(),updatedAt:m=(new Date).toISOString(),viewport:p={zoom:1,x:50,y:50},onUpload:y=null,onChange:b=null,onSave:v=null,onRun:x=null,onConvert:C=null}=e,w=e.storageId??t;return f.createStore()(h.temporal(((h,f)=>({rfInstance:null==e?void 0:e.rfInstance,flowId:t,isAsync:a,isReadOnly:n,skipExport:s,skipImport:o,storageId:w,name:l,description:d,tags:c,requirements:u,createdAt:g,updatedAt:m,viewport:p,nodes:r,edges:i,onUpload:y,onChange:b,onSave:v,onRun:x,onConvert:C,...zi.create(f,h),...qi.create(f,h),...Hi.create(f,h),...Bi.create(f,h),...Fi.create(f,h),...Ui.create(f,h)})),{equality:Wi,partialize:e=>{const{flowId:t,nodes:a,edges:n,name:s,description:o,requirements:i,tags:r}=e;return{flowId:t,nodes:a,edges:n,name:s,description:o,requirements:i,tags:r}}}))})({flowId:l,isAsync:j,isReadOnly:n,name:d,description:c,tags:u,requirements:g,storageId:y,createdAt:m,updatedAt:p,nodes:i,edges:r,rfInstance:k,onUpload:b,onChange:v,onSave:x,onRun:C,onConvert:w}),a.current)),[l]);return s.jsx(cs.Provider,{value:A,children:e})}const Gi=(e,t)=>{const{undo:a,redo:n,futureStates:s,pastStates:i}=(e=>{const t=o.useContext(cs);if(!t)throw new Error("Missing WaldiezContext.Provider in the tree");return m.useStoreWithEqualityFn(t.temporal,e,g.shallow)})((e=>e)),r=!0===us((e=>e.isReadOnly)),d=us((e=>e.deleteAgent)),c=us((e=>e.deleteEdge)),u=us((e=>e.deleteModel)),p=us((e=>e.deleteTool)),h=us((e=>e.saveFlow)),f="function"==typeof t&&!1===r,y=()=>{const t=K(e);if(!t)return!1;const a=t.getBoundingClientRect();return a.width>0&&a.height>0};l.useHotkeys("mod+z",(()=>{i.length>0&&y()&&a()}),{scopes:e}),l.useHotkeys(["shift+mod+z","mod+y"],(()=>{s.length>0&&y()&&n()}),{scopes:e}),f&&l.useHotkeys("mod+s",(e=>{y()&&(e.preventDefault(),h())}),{scopes:e});const b=e=>{const t=e.getAttribute("data-id");if(t){const a=e.classList.contains("react-flow__node-agent"),n=e.classList.contains("react-flow__node-model"),s=e.classList.contains("react-flow__node-tool");a?d(t):n?u(t):s&&p(t)}},v=e=>{const t=e.getAttribute("data-id");t&&c(t)};return{onKeyDown:e=>{r||"Delete"!==(null==e?void 0:e.key)&&"Backspace"!==(null==e?void 0:e.key)||y()&&(e=>{if(r)return;const t=e.target;t instanceof Element&&t.classList.contains("react-flow__node")?b(t):t instanceof Element&&(t.classList.contains("react-flow__edge")||t.classList.contains("edge-data-view"))&&v(t)})(e)}}};var Ki={color:void 0,size:void 0,className:void 0,style:void 0,attr:void 0},Qi=o.createContext&&o.createContext(Ki),Zi=["attr","size","title"];function Xi(e,t){if(null==e)return{};var a,n,s=function(e,t){if(null==e)return{};var a={};for(var n in e)if(Object.prototype.hasOwnProperty.call(e,n)){if(t.indexOf(n)>=0)continue;a[n]=e[n]}return a}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(n=0;n<o.length;n++)a=o[n],t.indexOf(a)>=0||Object.prototype.propertyIsEnumerable.call(e,a)&&(s[a]=e[a])}return s}function Ji(){return Ji=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var n in a)Object.prototype.hasOwnProperty.call(a,n)&&(e[n]=a[n])}return e},Ji.apply(this,arguments)}function Yi(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,n)}return a}function $i(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?Yi(Object(a),!0).forEach((function(t){_i(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):Yi(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}function _i(e,t,a){var n;return(t="symbol"==typeof(n=function(e,t){if("object"!=typeof e||!e)return e;var a=e[Symbol.toPrimitive];if(void 0!==a){var n=a.call(e,t);if("object"!=typeof n)return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(t,"string"))?n:n+"")in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}function er(e){return e&&e.map(((e,t)=>o.createElement(e.tag,$i({key:t},e.attr),er(e.child))))}function tr(e){return t=>o.createElement(ar,Ji({attr:$i({},e.attr)},t),er(e.child))}function ar(e){var t=t=>{var a,{attr:n,size:s,title:i}=e,r=Xi(e,Zi),l=s||t.size||"1em";return t.className&&(a=t.className),e.className&&(a=(a?a+" ":"")+e.className),o.createElement("svg",Ji({stroke:"currentColor",fill:"currentColor",strokeWidth:"0"},t.attr,n,r,{className:a,style:$i($i({color:e.color||t.color},t.style),e.style),height:l,width:l,xmlns:"http://www.w3.org/2000/svg"}),i&&o.createElement("title",null,i),e.children)};return void 0!==Qi?o.createElement(Qi.Consumer,null,(e=>t(e))):t(Ki)}function nr(e){return tr({attr:{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},child:[{tag:"path",attr:{d:"M17.94 17.94A10.07 10.07 0 0 1 12 20c-7 0-11-8-11-8a18.45 18.45 0 0 1 5.06-5.94M9.9 4.24A9.12 9.12 0 0 1 12 4c7 0 11 8 11 8a18.5 18.5 0 0 1-2.16 3.19m-6.72-1.07a3 3 0 1 1-4.24-4.24"},child:[]},{tag:"line",attr:{x1:"1",y1:"1",x2:"23",y2:"23"},child:[]}]})(e)}function sr(e){return tr({attr:{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},child:[{tag:"path",attr:{d:"M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"},child:[]},{tag:"circle",attr:{cx:"12",cy:"12",r:"3"},child:[]}]})(e)}function or(e){return tr({attr:{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},child:[{tag:"path",attr:{d:"M21.44 11.05l-9.19 9.19a6 6 0 0 1-8.49-8.49l9.19-9.19a4 4 0 0 1 5.66 5.66l-9.2 9.19a2 2 0 0 1-2.83-2.83l8.49-8.48"},child:[]}]})(e)}function ir(e){return tr({attr:{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},child:[{tag:"line",attr:{x1:"18",y1:"6",x2:"6",y2:"18"},child:[]},{tag:"line",attr:{x1:"6",y1:"6",x2:"18",y2:"18"},child:[]}]})(e)}function rr(e){return tr({attr:{viewBox:"0 0 512 512"},child:[{tag:"path",attr:{d:"M435.9 64.9l-367.1 160c-6.5 3.1-6.3 12.4.3 15.3l99.3 56.1c5.9 3.3 13.2 2.6 18.3-1.8l195.8-168.8c1.3-1.1 4.4-3.2 5.6-2 1.3 1.3-.7 4.3-1.8 5.6L216.9 320.1c-4.7 5.3-5.4 13.1-1.6 19.1l64.9 104.1c3.2 6.3 12.3 6.2 15.2-.2L447.2 76c3.3-7.2-4.2-14.5-11.3-11.1z"},child:[]}]})(e)}const lr=o.memo((e=>{var t,a,n,i,r,l,d,c,u,g,m,p;const{flowId:h,chat:f}=e,[b,v]=o.useState(""),[x,C]=o.useState(!1),[w,k]=o.useState(null),[j,A]=o.useState(!1),N=o.useRef(null);o.useEffect((()=>{(null==f?void 0:f.showUI)&&(v(""),k(null),requestAnimationFrame((()=>{var e,t,a;(null==(e=f.activeRequest)?void 0:e.request_id)?null==(t=N.current)||t.focus():null==(a=N.current)||a.blur()})))}),[null==f?void 0:f.showUI,null==(t=null==f?void 0:f.activeRequest)?void 0:t.request_id,null==f?void 0:f.messages]);const T=o.useCallback(((e=!0)=>{var t;const a=[];return e&&(a.push({content:{type:"text",text:b.trim()}}),w&&a.push({content:{type:"image_url",image_url:{url:w}}})),{id:`${h}-${Date.now()}`,request_id:(null==(t=null==f?void 0:f.activeRequest)?void 0:t.request_id)||"",type:"input_response",timestamp:(new Date).toISOString(),data:a}}),[h,null==f?void 0:f.activeRequest,b,w]),S=o.useCallback((()=>{var e,t;null==(t=null==(e=null==f?void 0:f.handlers)?void 0:e.onUserInput)||t.call(e,T()),setTimeout((()=>{v(""),k(null)}),10)}),[null==f?void 0:f.handlers,T]),M=o.useCallback((e=>{"Enter"!==e.key||e.shiftKey||(e.preventDefault(),S())}),[S]),I=o.useCallback((e=>{v(e.target.value)}),[]),E=o.useCallback((e=>{var t;const a=null==(t=e.target.files)?void 0:t[0];if(a){const e=new FileReader;e.onloadend=()=>{k(e.result)},e.readAsDataURL(a)}e.target.value="",C(!1)}),[]),D=o.useCallback((()=>{k(null)}),[]),R=o.useCallback((()=>{var e,t;v(""),k(null),null==(t=null==(e=null==f?void 0:f.handlers)?void 0:e.onClose)||t.call(e)}),[null==f?void 0:f.handlers]),P=o.useCallback((()=>{C(!0)}),[]),O=o.useCallback((()=>{C(!1),setTimeout((()=>{var e;null==(e=N.current)||e.focus()}),0)}),[]),L=o.useCallback((e=>{e.preventDefault(),e.stopPropagation(),x?C(!1):R()}),[x,R]),z=`rf-${h}-chat-modal-input`,F=`rf-${h}-chat-modal-image`,U=`rf-${h}-chat-modal`,q=!0===(null==f?void 0:f.showUI)||void 0!==f&&f.messages.length>0,B=(null==(a=null==f?void 0:f.handlers)?void 0:a.onInterrupt)?s.jsx("div",{role:"button",className:"chat-modal-action clickable",onClick:f.handlers.onInterrupt,title:"Interrupt",children:s.jsx(y.FaStop,{size:18})}):void 0,H=!f||!(null==f?void 0:f.mediaConfig)||(null==(n=null==f?void 0:f.mediaConfig)?void 0:n.allowedTypes.includes("image"));return s.jsx(Eo,{id:U,title:"Chat",isOpen:q,onClose:R,onCancel:L,beforeTitle:B,className:"chat-modal",hasMaximizeBtn:!0,hasCloseBtn:!1===(null==f?void 0:f.showUI),dataTestId:U,children:s.jsxs("div",{className:"modal-body",children:[(null==f?void 0:f.messages)&&f.messages.length>0&&s.jsx("div",{className:"chat-wrapper","data-flow-id":h,children:s.jsx(uo,{isDarkMode:!1,messages:f.messages,userParticipants:f.userParticipants,activeRequest:f.activeRequest})}),s.jsx("div",{className:"input-prompt",children:null==(i=null==f?void 0:f.activeRequest)?void 0:i.prompt}),void 0!==(null==(r=null==f?void 0:f.activeRequest)?void 0:r.request_id)&&s.jsxs("div",{className:"chat-input-container",children:[w&&s.jsx("div",{className:"chat-image-preview",children:s.jsxs("div",{className:"chat-image-wrapper",children:[s.jsx("img",{src:w,alt:"Preview",className:"chat-preview-image"}),s.jsx("button",{type:"button",className:"chat-remove-image-button",onClick:D,title:"Remove Image","aria-label":"Remove uploaded image",children:s.jsx(ir,{size:14})})]})}),s.jsx("div",{className:"chat-input-field-container",children:!0===(null==(l=null==f?void 0:f.activeRequest)?void 0:l.password)?s.jsxs("div",{className:"password-toggle-container",children:[s.jsx("input",{type:j?"text":"password",ref:N,placeholder:"Enter your password",id:z,"data-testid":z,value:b,disabled:void 0===(null==(d=null==f?void 0:f.activeRequest)?void 0:d.request_id),onKeyDown:M,onChange:I,className:"chat-text-input password-input",autoComplete:"off",autoCorrect:"off",autoCapitalize:"none","aria-label":"Password input"}),s.jsx("button",{type:"button",className:"password-toggle-button",onClick:()=>A(!j),title:j?"Hide password":"Show password","aria-label":j?"Hide password":"Show password",disabled:void 0===(null==(c=null==f?void 0:f.activeRequest)?void 0:c.request_id),children:j?s.jsx(nr,{size:18}):s.jsx(sr,{size:18})})]}):s.jsx("input",{type:"text",ref:N,placeholder:"Enter your message here",id:z,"data-testid":z,value:b,disabled:void 0===(null==(u=null==f?void 0:f.activeRequest)?void 0:u.request_id),onKeyDown:M,onChange:I,className:"chat-text-input",autoComplete:"off",autoCorrect:"off",autoCapitalize:"none","aria-label":"User input"})}),void 0!==(null==(g=null==f?void 0:f.activeRequest)?void 0:g.request_id)&&s.jsxs("div",{className:"chat-input-actions",children:[H?s.jsxs("label",{htmlFor:F,className:"chat-upload-button",children:[s.jsx(or,{size:18,"aria-hidden":"true"}),s.jsx("span",{className:"hidden",children:"Upload an image"}),s.jsx("input",{type:"file",disabled:void 0===(null==(m=null==f?void 0:f.activeRequest)?void 0:m.request_id),"aria-label":"Upload an image",id:F,"data-testid":F,accept:"image/*",className:"chat-upload-input",onChange:E,onClick:P,onBlur:O})]}):s.jsx("div",{className:"chat-upload-button"}),s.jsx("button",{type:"button",title:"Send",disabled:void 0===(null==(p=null==f?void 0:f.activeRequest)?void 0:p.request_id),onClick:S,className:"chat-send-button","data-testid":`rf-${h}-chat-modal-submit`,"aria-label":"Send message",children:s.jsx(rr,{size:20,"aria-hidden":"true"})})]})]})]})})}));lr.displayName="ChatModal";const dr="https://hub.waldiez.io",cr=`${dr}/api/files`,ur=o.memo((e=>{const{flowId:t,isOpen:a,onClose:n,onExport:i,onDownload:r}=e,[l,d]=o.useState(!1),[c,u]=o.useState(""),[g,m]=o.useState(null),[p,h]=o.useState(!1),f=o.useCallback((e=>{d(e)}),[]),y=o.useCallback((e=>{u(e.target.value)}),[]),b=o.useCallback((e=>{is({flowId:t,message:e,level:"error",details:null,duration:5e3})}),[t]),v=o.useCallback((async e=>{if(!p)try{h(!0);const e=i();if(!e)return void b("Error exporting flow.");const a=new Blob([e],{type:"application/json"}),n=new FormData;n.append("file",a,`${t}.waldiez`);const s=await fetch(`${cr}/upload`,{method:"POST",headers:{Authorization:`Bearer ${c}`,content_type:"application/waldiez"},body:n,signal:AbortSignal.timeout(1e4)});if(!s.ok)throw new Error(`Error uploading to hub: ${s.statusText}`);const o=await s.json();if(g){const e=new FormData;e.append("file",g,g.name);const t=await fetch(`${cr}/${o.id}/example`,{method:"POST",headers:{Authorization:`Bearer ${c}`,content_type:"application/csv"},body:e,signal:AbortSignal.timeout(3e4)});if(!t.ok)throw new Error(`Error uploading additional file: ${t.statusText}`)}is({flowId:t,message:"Flow uploaded to hub.",level:"success",details:null,duration:5e3})}catch(a){b("Error uploading to hub.")}finally{h(!1)}}),[t,i,c,g,p,b]),x=o.useCallback((e=>{var t;if(0===e.length)return void m(null);const a=e[0];if(a.size>5242880)return void b("File size exceeds 5MB.");"csv"===(null==(t=a.name.split(".").pop())?void 0:t.toLowerCase())?m(a):b("File is not a CSV.")}),[b]);return s.jsxs(Eo,{isOpen:a,onClose:n,title:"Export Flow",dataTestId:`export-flow-modal-${t}`,children:[s.jsx("div",{className:"modal-body",children:s.jsxs("div",{className:"padding-10",children:[s.jsx(Js,{id:`export-flow-modal-upload-${t}`,label:s.jsx("span",{className:"checkbox-label-view",children:s.jsxs("div",{children:["Share this flow to"," ",s.jsx("a",{href:dr,target:"_blank",rel:"noopener noreferrer",className:"link",children:"Waldiez hub"})]})}),isChecked:l,onCheckedChange:f,"data-testid":`export-flow-modal-upload-checkbox-${t}`}),l&&s.jsxs("div",{className:"flex full-width flex-column",children:[s.jsx("div",{className:"margin-top-10 full-width",children:s.jsx(xo,{label:s.jsx("div",{className:"no-padding margin-bottom-5",children:"Hub API Token:"}),value:c,name:"hub-api-token",onChange:y,placeholder:"Enter your hub API token",dataTestId:`hub-api-token-${t}`,className:"full-width",isPassword:!0})}),s.jsxs("div",{className:"margin-top-10 margin-bottom-20 full-width",children:[s.jsx("div",{className:"margin-bottom-10 padding-10 center",children:"Additional CSV file (results.csv) to include:"}),s.jsx(ho,{allowedFileExtensions:[".csv"],flowId:t,onUpload:x,multiple:!1})]})]})]})}),s.jsxs("div",{className:"modal-actions",children:[s.jsx("button",{type:"reset",className:"modal-action-cancel",onClick:n,children:"Cancel"}),s.jsxs("div",{className:"flex flex-row",children:[l&&s.jsx("button",{type:"button",className:"save margin-right-20",onClick:v,"data-testid":`upload-to-hub-${t}`,disabled:p||!c,children:p?"Uploading...":"Upload to Hub"}),s.jsx("button",{type:"button",className:"primary",onClick:r,children:"Download"})]})]})]})}));ur.displayName="ExportFlowModal";const gr={searchTerm:"",remoteUrl:"",loadedFlowData:null,selectedProps:{everything:!0,override:!0,name:!1,description:!1,tags:!1,requirements:!1,isAsync:!1,nodes:{models:[],tools:[],agents:[]},edges:[]}},mr=e=>{const{flowId:t,state:a}=e,{remoteUrl:n,loadedFlowData:i}=a,{onUpload:r,onRemoteUrlChange:l,onRemoteUrlSubmit:d,onClearLoadedFlowData:c}=(e=>{const{flowId:t,state:a,initialState:n,onStateChange:s}=e,i=o.useCallback((e=>{s({loadedFlowData:e})}),[s]),r=o.useCallback((e=>{s({remoteUrl:e})}),[s]),l=o.useCallback((e=>{try{const a=Xn.toReactFlow(Xn.importFlow(e,t));if(0===a.nodes.length&&0===a.edges.length)return i(null),void is({flowId:t,message:"Failed to load flow",level:"error",details:null,duration:3e3});i(a)}catch(a){i(null),is({flowId:t,message:"Failed to parse flow data",level:"error",details:null,duration:3e3})}}),[t,i]);return{onUpload:o.useCallback((e=>{if(!e.length)return;const a=e[0];try{const e=new FileReader;e.onload=()=>{const t=e.result;"string"==typeof t&&l(t)},e.onerror=()=>{i(null),is({flowId:t,message:"Failed to read file",level:"error",details:null,duration:3e3})},e.readAsText(a)}catch(n){i(null),is({flowId:t,message:"Failed to upload file",level:"error",details:null,duration:3e3})}}),[t,l,i]),onRemoteUrlChange:o.useCallback((e=>{r(e.target.value)}),[r]),onRemoteUrlSubmit:o.useCallback((()=>{const e=new AbortController,o=e.signal;i(null);const r=setTimeout((()=>{e.abort()}),3e4);fetch(a.remoteUrl,{signal:o,mode:"cors",redirect:"follow",headers:{Accept:"application/json"}}).then((e=>{if(!e.ok)throw new Error(`Server responded with ${e.status}: ${e.statusText}`);return e.json()})).then((e=>{l(e)})).catch((e=>{is({flowId:t,message:`Failed to load flow: ${e.message}`,level:"error",duration:5e3}),s(n)})).finally((()=>{clearTimeout(r)}))}),[t,a.remoteUrl,l,i,s,n]),onSelectedPropsChange:o.useCallback((e=>{s({selectedProps:{...a.selectedProps,...e}})}),[a.selectedProps,s]),onClearLoadedFlowData:o.useCallback((()=>{i(null)}),[i])}})(e);return s.jsxs(s.Fragment,{children:[s.jsx(go,{title:"Upload a file",dataTestId:`import-flow-modal-collapsible-local-${t}`,expanded:!0,children:s.jsx("div",{className:"padding-10 margin-left--10 margin-right--10",children:s.jsx(ho,{flowId:t,onUpload:r,allowedFileExtensions:[".waldiez",".json"]})})}),s.jsx(go,{title:"Import from URL",dataTestId:`import-flow-modal-collapsible-url-${t}`,children:s.jsxs("div",{className:"margin-top-10 full-width flex-column",children:[s.jsx("div",{className:"warning margin-bottom-10",children:s.jsx("span",{children:"Warning: Importing from an untrusted source can be harmful"})}),s.jsxs("div",{className:"margin-top-10 full-width flex",children:[s.jsx("input",{type:"text",className:"text-input full-width margin-right-10",placeholder:"Enter URL",onChange:l,value:a.remoteUrl,"data-testid":`import-flow-modal-url-input-${t}`}),s.jsx("button",{type:"button",title:"Load flow from URL",className:"modal-action-submit",onClick:d,"data-testid":`import-flow-modal-url-submit-${t}`,disabled:!n.startsWith("https://"),children:"Load"})]})]})}),s.jsx("div",{className:"margin-top-20 center",children:i?s.jsxs("div",{className:"flex-center",children:["Loaded flow: ",s.jsx("span",{className:"bold italic",children:i.name}),s.jsx(v.FaXmark,{className:"margin-left-10 clickable","data-testid":"clear-loaded-flow-data",onClick:c})]}):s.jsx("div",{children:"No flow loaded"})})]})},pr=e=>{const{flowId:t,state:a}=e,{selectedProps:n}=a,{agentNodes:i,onAgentsChange:r,onAllNoneAgentsChange:l}=(e=>{const{flowId:t,state:a,onStateChange:n}=e,{selectedProps:s,loadedFlowData:i}=a,r=o.useMemo((()=>(null==i?void 0:i.nodes.filter((e=>"agent"===e.type)))||[]),[null==i?void 0:i.nodes]),l=o.useCallback((e=>{n({selectedProps:{...s,...e}})}),[s,n]),d=o.useCallback((()=>{const e=document.getElementById(`import-flow-modal-agents-all-none-${t}`);if(e)if(s.nodes.agents.length>0){const t=s.nodes.agents.length===r.length;e.indeterminate=!t,e.checked=t}else e.indeterminate=!1,e.checked=!1}),[t,s.nodes.agents.length,r.length]);o.useEffect((()=>{d()}),[d]);const c=o.useCallback((e=>{const t=s.nodes.agents.some((t=>t.id===e.id));l({nodes:{models:s.nodes.models,tools:s.nodes.tools,agents:t?s.nodes.agents.filter((t=>t.id!==e.id)):[...s.nodes.agents,e]}})}),[s.nodes,l]),u=o.useCallback((e=>{l({nodes:{models:s.nodes.models,tools:s.nodes.tools,agents:e?r:[]}})}),[r,s.nodes.models,s.nodes.tools,l]);return{agentNodes:r,onAgentsChange:c,onAllNoneAgentsChange:u}})(e);return s.jsxs("div",{className:"flow-data-preview-body-section",children:[s.jsx("h4",{children:"Agents"}),i&&(null==i?void 0:i.length)>1&&s.jsx("div",{className:"flow-data-preview-body-section-row",children:s.jsx(Js,{label:s.jsx("div",{className:"bold",children:"Select All | None"}),isChecked:n.nodes.agents.length===i.length,onCheckedChange:l,id:`import-flow-modal-agents-all-none-${t}`,"data-testid":`import-flow-modal-agent-all-none-${t}`})}),null==i?void 0:i.map((e=>{const t=e;return s.jsx("div",{className:"flow-data-preview-body-section-row",children:s.jsx(Js,{label:s.jsxs("div",{children:[t.data.label,": ",t.data.description]}),id:`import-flow-modal-agent-checkbox-${e.id}`,isChecked:n.nodes.agents.some((t=>t.id===e.id)),onCheckedChange:r.bind(null,e),"data-testid":`import-flow-modal-agent-checkbox-${e.id}`})},e.id)})),0===(null==i?void 0:i.length)&&s.jsx("div",{children:"No agents in this flow"})]})},hr=e=>{const{flowId:t,state:a}=e,{loadedFlowData:n,selectedProps:i}=a,r=(null==n?void 0:n.tags.length)?null==n?void 0:n.tags.join(", "):"None",l=(null==n?void 0:n.requirements.length)?null==n?void 0:n.requirements.join(", "):"None",{onOverrideChange:d,onAllNoneInfoChange:c,onNameChange:u,onDescriptionChange:g,onIsASyncChange:m,onTagsChange:p,onRequirementsChange:h,onImportEverythingChange:f}=(e=>{const{flowId:t,state:a,onStateChange:n}=e,{selectedProps:s}=a,i=o.useCallback((e=>{n({selectedProps:{...s,...e}})}),[s,n]),r=o.useMemo((()=>{const e=[s.name,s.description,s.tags,s.requirements],t=e.filter(Boolean).length;return{anySelected:t>0,allSelected:t===e.length,partiallySelected:t>0&&t<e.length}}),[s.name,s.description,s.tags,s.requirements]),l=o.useCallback((()=>{const e=document.getElementById(`import-flow-info-all-none-${t}`);e&&(r.anySelected?(e.indeterminate=r.partiallySelected,e.checked=r.allSelected):(e.indeterminate=!1,e.checked=!1))}),[t,r]);o.useEffect((()=>{l()}),[l]);const d=o.useCallback((e=>{i({name:e,description:e,tags:e,requirements:e,isAsync:e})}),[i]),c=o.useCallback((e=>{i({everything:e})}),[i]);return{onOverrideChange:o.useCallback((e=>{i({override:e})}),[i]),onNameChange:o.useCallback((e=>{i({name:e})}),[i]),onDescriptionChange:o.useCallback((e=>{i({description:e})}),[i]),onTagsChange:o.useCallback((e=>{i({tags:e})}),[i]),onRequirementsChange:o.useCallback((e=>{i({requirements:e})}),[i]),onIsASyncChange:o.useCallback((e=>{i({isAsync:e})}),[i]),onAllNoneInfoChange:d,onImportEverythingChange:c}})(e);return s.jsx(s.Fragment,{children:s.jsxs("div",{className:"flow-data-preview-body",children:[s.jsxs("div",{className:"flow-data-preview-body-section",children:[s.jsx("h4",{children:"Flow Override"}),s.jsx("div",{className:"flow-data-preview-body-section-row",children:s.jsx(Js,{label:"Override existing flow with imported flow",isChecked:i.override,onCheckedChange:d,id:`import-flow-modal-override-${t}`,"data-testid":"override-flow-checkbox"})})]}),s.jsxs("div",{className:"flow-data-preview-body-section",style:{marginTop:0},children:[s.jsx("h4",{children:"What to import"}),s.jsx("div",{className:"flow-data-preview-body-section-row",children:s.jsx(Js,{label:"Import Everything",isChecked:i.everything,onCheckedChange:f,id:`import-flow-modal-everything-${t}`,"data-testid":"import-everything-checkbox"})})]}),!i.everything&&s.jsxs("div",{className:"flow-data-preview-body-section",children:[s.jsx("h4",{children:"Flow Information"}),s.jsx("div",{className:"flow-data-preview-body-section-row",children:s.jsx(Js,{label:s.jsx("div",{className:"bold",children:"Select All | None"}),isChecked:i.name&&i.description&&i.tags&&i.requirements&&i.isAsync,onCheckedChange:c,id:`import-flow-info-all-none-${t}`,"data-testid":"import-flow-info-all-none"})}),s.jsx("div",{className:"flow-data-preview-body-section-row",children:s.jsx(Js,{label:s.jsxs("div",{"data-testid":"import-flow-info-name-preview",children:["Name: ",null==n?void 0:n.name]}),isChecked:i.name,onCheckedChange:u,id:`import-flow-info-name-${t}`,"data-testid":"import-flow-info-name"})}),s.jsx("div",{className:"flow-data-preview-body-section-row",children:s.jsx(Js,{label:s.jsxs("div",{"data-testid":"import-flow-info-description-preview",children:["Description: ",null==n?void 0:n.description]}),isChecked:i.description,onCheckedChange:g,id:`import-flow-info-description-${t}`,"data-testid":"import-flow-info-description"})}),s.jsx("div",{className:"flow-data-preview-body-section-row",children:s.jsx(Js,{label:s.jsxs("div",{"data-testid":"import-flow-info-tags-preview",children:["Tags: ",r]}),isChecked:i.tags,onCheckedChange:p,id:`import-flow-info-tags-${t}`,"data-testid":"import-flow-info-tags"})}),s.jsx("div",{className:"flow-data-preview-body-section-row",children:s.jsx(Js,{label:s.jsxs("div",{"data-testid":"import-flow-info-requirements-preview",children:["Requirements: ",l]}),isChecked:i.requirements,onCheckedChange:h,id:`import-flow-info-requirements-${t}`,"data-testid":"import-flow-info-requirements"})}),s.jsx("div",{className:"flow-data-preview-body-section-row",children:s.jsx(Js,{label:"Is Async",isChecked:i.isAsync,onCheckedChange:m,id:`import-flow-info-is-async-${t}`,"data-testid":"import-flow-info-is-async"})})]})]})})},fr=e=>{const{state:t}=e,{modelNodes:a,onModelsChange:n,onAllNoneModelsChange:i}=(e=>{const{flowId:t,state:a,onStateChange:n}=e,{selectedProps:s,loadedFlowData:i}=a,r=o.useMemo((()=>(null==i?void 0:i.nodes.filter((e=>"model"===e.type)))||[]),[null==i?void 0:i.nodes]),l=o.useCallback((e=>{n({selectedProps:{...s,...e}})}),[s,n]),d=o.useCallback((()=>{const e=document.getElementById(`import-flow-modal-models-all-none-${t}`);if(e)if(s.nodes.models.length>0){const t=s.nodes.models.length===r.length;e.indeterminate=!t,e.checked=t}else e.indeterminate=!1,e.checked=!1}),[t,s.nodes.models.length,r.length]);o.useEffect((()=>{d()}),[d]);const c=o.useCallback((e=>{const t=s.nodes.models.some((t=>t.id===e.id));l({nodes:{models:t?s.nodes.models.filter((t=>t.id!==e.id)):[...s.nodes.models,e],tools:s.nodes.tools,agents:s.nodes.agents}})}),[s.nodes,l]),u=o.useCallback((e=>{l({nodes:{models:e?r:[],tools:s.nodes.tools,agents:s.nodes.agents}})}),[r,s.nodes.tools,s.nodes.agents,l]);return{modelNodes:r,onModelsChange:c,onAllNoneModelsChange:u}})(e),{selectedProps:r}=t;return s.jsxs("div",{className:"flow-data-preview-body-section",children:[s.jsx("h4",{children:"Models"}),a&&(null==a?void 0:a.length)>1&&s.jsx(Js,{id:`import-flow-modal-models-all-none-${e.flowId}`,label:"Select All | None",isChecked:r.nodes.models.length===a.length,onCheckedChange:i,"data-testid":`import-flow-modal-model-all-none-${e.flowId}`}),null==a?void 0:a.map((e=>{const t=e;return s.jsx("div",{className:"flow-data-preview-body-section-row",children:s.jsx(Js,{label:s.jsxs("div",{children:[t.data.label,": ",t.data.description]}),id:`import-flow-modal-model-checkbox-${e.id}`,isChecked:r.nodes.models.some((t=>t.id===e.id)),onCheckedChange:n.bind(null,e),"data-testid":`import-flow-modal-model-checkbox-${e.id}`})},e.id)})),0===(null==a?void 0:a.length)&&s.jsx("div",{children:"No models in this flow"})]})},yr=e=>{const{flowId:t,state:a}=e,{selectedProps:n}=a,{toolNodes:i,onToolsChange:r,onAllNoneToolsChange:l}=(e=>{const{flowId:t,state:a,onStateChange:n}=e,{selectedProps:s,loadedFlowData:i}=a,r=o.useMemo((()=>(null==i?void 0:i.nodes.filter((e=>"tool"===e.type)))||[]),[null==i?void 0:i.nodes]),l=o.useCallback((e=>{n({selectedProps:{...s,...e}})}),[s,n]),d=o.useCallback((()=>{const e=document.getElementById(`import-flow-modal-tools-all-none-${t}`);if(e)if(s.nodes.tools.length>0){const t=s.nodes.tools.length===r.length;e.indeterminate=!t,e.checked=t}else e.indeterminate=!1,e.checked=!1}),[t,s.nodes.tools.length,r.length]);o.useEffect((()=>{d()}),[d]);const c=o.useCallback((e=>{const t=s.nodes.tools.some((t=>t.id===e.id));l({nodes:{models:s.nodes.models,tools:t?s.nodes.tools.filter((t=>t.id!==e.id)):[...s.nodes.tools,e],agents:s.nodes.agents}})}),[s.nodes,l]),u=o.useCallback((e=>{l({nodes:{models:s.nodes.models,tools:e?r:[],agents:s.nodes.agents}})}),[r,s.nodes.models,s.nodes.agents,l]);return{toolNodes:r,onToolsChange:c,onAllNoneToolsChange:u}})(e);return s.jsxs("div",{className:"flow-data-preview-body-section",children:[s.jsx("h4",{children:"Tools"}),i&&(null==i?void 0:i.length)>1&&s.jsx(Js,{id:`import-flow-modal-tools-all-none-${t}`,label:"Select All | None",isChecked:n.nodes.tools.length===i.length,onCheckedChange:l,"data-testid":`import-flow-modal-tool-all-none-${t}`}),null==i?void 0:i.map((e=>{const t=e;return s.jsx("div",{className:"flow-data-preview-body-section-row",children:s.jsx(Js,{label:s.jsxs("div",{children:[t.data.label,": ",t.data.description]}),id:`import-flow-modal-tool-checkbox-${e.id}`,isChecked:n.nodes.tools.some((t=>t.id===e.id)),onCheckedChange:r.bind(null,e),"data-testid":`import-flow-modal-tool-checkbox-${e.id}`})},e.id)})),0===(null==i?void 0:i.length)&&s.jsx("div",{children:"No tools in this flow"})]})},br=e=>{const{flowId:t,state:a,onStateChange:n}=e;return s.jsxs("div",{className:"flow-data-preview","data-testid":`import-flow-modal-preview-step-${t}-view`,children:[s.jsx(hr,{flowId:t,state:a,onStateChange:n}),!a.selectedProps.everything&&s.jsxs(s.Fragment,{children:[s.jsx("div",{className:"flow-data-preview-header",children:s.jsx("h3",{children:"Flow Nodes"})}),s.jsxs("div",{className:"flow-data-preview-body",children:[s.jsx(fr,{flowId:t,state:a,onStateChange:n}),s.jsx(yr,{flowId:t,state:a,onStateChange:n}),s.jsx(pr,{flowId:t,state:a,onStateChange:n})]})]})]})},vr=e=>{const{flowId:t,isOpen:a}=e,{state:n,initialState:i,onStateChange:r,onClose:l,onBack:d,onForward:c}=(e=>{const{onClose:t,typeShown:a,onTypeShownChange:n}=e,[s,i]=o.useState(gr),r=us((e=>e.importFlow)),l=us((e=>e.onFlowChanged)),d=o.useCallback((()=>{const{loadedFlowData:e,selectedProps:t}=s;e&&(r(t,e,a),n("agent"),l())}),[s,r,a,n,l]),c=o.useCallback((e=>{0===e&&t()}),[t]),u=o.useCallback((e=>{1===e&&(d(),t())}),[d,t]),g=o.useCallback((()=>{i(gr),t()}),[t]),m=o.useCallback((e=>{i((t=>({...t,...e})))}),[]);return o.useMemo((()=>({state:s,initialState:gr,onStateChange:m,onClose:g,onBack:c,onForward:u})),[s,m,g,c,u])})(e);return s.jsx(Eo,{isOpen:a,onClose:l,title:"Import Flow",dataTestId:`import-flow-modal-${t}`,children:s.jsx("div",{className:"modal-body padding-10",children:s.jsxs(bi,{activeStep:0,canGoForward:!!n.loadedFlowData,firstBackTitle:"Cancel",lastNextTitle:"Import",onBack:d,onForward:c,children:[s.jsx(yi,{id:`import-flow-modal-load-step-${t}`,title:"Load Flow",children:s.jsx(mr,{initialState:i,flowId:t,state:n,onStateChange:r})}),s.jsx(yi,{id:`import-flow-modal-preview-step-${t}`,title:"Preview Flow",children:n.loadedFlowData?s.jsx(br,{flowId:t,state:n,onStateChange:r}):null})]})})})};function xr(e){return tr({attr:{role:"img",viewBox:"0 0 24 24"},child:[{tag:"path",attr:{d:"M7.157 22.201A1.784 1.799 0 0 1 5.374 24a1.784 1.799 0 0 1-1.784-1.799 1.784 1.799 0 0 1 1.784-1.799 1.784 1.799 0 0 1 1.783 1.799zM20.582 1.427a1.415 1.427 0 0 1-1.415 1.428 1.415 1.427 0 0 1-1.416-1.428A1.415 1.427 0 0 1 19.167 0a1.415 1.427 0 0 1 1.415 1.427zM4.992 3.336A1.047 1.056 0 0 1 3.946 4.39a1.047 1.056 0 0 1-1.047-1.055A1.047 1.056 0 0 1 3.946 2.28a1.047 1.056 0 0 1 1.046 1.056zm7.336 1.517c3.769 0 7.06 1.38 8.768 3.424a9.363 9.363 0 0 0-3.393-4.547 9.238 9.238 0 0 0-5.377-1.728A9.238 9.238 0 0 0 6.95 3.73a9.363 9.363 0 0 0-3.394 4.547c1.713-2.04 5.004-3.424 8.772-3.424zm.001 13.295c-3.768 0-7.06-1.381-8.768-3.425a9.363 9.363 0 0 0 3.394 4.547A9.238 9.238 0 0 0 12.33 21a9.238 9.238 0 0 0 5.377-1.729 9.363 9.363 0 0 0 3.393-4.547c-1.712 2.044-5.003 3.425-8.772 3.425Z"},child:[]}]})(e)}const Cr=e=>{const{flowId:t,skipExport:a,skipImport:n,selectedNodeType:o,onAddNode:r,onRun:l,onConvertToPy:d,onConvertToIpynb:c,onOpenImportModal:u,onExport:g}=e,m=us((e=>e.isReadOnly)),p=us((e=>e.onRun)),h=us((e=>e.onConvert)),f="boolean"==typeof m&&m,b=!f&&("boolean"!=typeof n||!n),x=!f&&("boolean"!=typeof a||!a),C=!1===f&&"function"==typeof p,w=!1===f&&"function"==typeof h,{isDark:j,toggleTheme:A}=ga();return s.jsxs(s.Fragment,{children:["agent"!==o&&!1===m&&s.jsx(i.Panel,{position:"top-left",children:s.jsxs("button",{type:"button",className:"editor-nav-action add-node currentColor",onClick:r,title:`Add ${o}`,"data-testid":`add-${o}-node`,children:[s.jsx(y.FaPlusCircle,{}),"Add ",o]})}),s.jsx(i.Panel,{position:"top-right",children:s.jsxs("div",{className:"editor-nav-actions",children:[(C||w)&&s.jsxs(s.Fragment,{children:[C&&s.jsx("button",{type:"button",className:"editor-nav-action",onClick:l,title:"Run flow","data-testid":`run-${t}`,children:s.jsx(v.FaCirclePlay,{})}),w&&s.jsx("button",{type:"button",className:"editor-nav-action to-python",onClick:d,title:"Convert to Python","data-testid":`convert-${t}-to-py`,children:s.jsx(v.FaPython,{})}),w&&s.jsx("button",{type:"button",className:"editor-nav-action to-jupyter",onClick:c,title:"Convert to Jupyter Notebook","data-testid":`convert-${t}-to-ipynb`,children:s.jsx(xr,{})})]}),b&&s.jsx("button",{type:"button",className:"editor-nav-action",onClick:u,title:"Import flow","data-testid":`import-flow-${t}-button`,children:s.jsx(v.FaFileImport,{})}),x&&s.jsx("button",{type:"button",className:"editor-nav-action",onClick:g,title:"Export flow","data-testid":`export-flow-${t}-button`,children:s.jsx(k.MdIosShare,{size:24})}),s.jsx("button",{type:"button",className:"editor-nav-action",onClick:A,title:"Toggle theme","data-testid":`toggle-theme-${t}`,children:j?s.jsx(v.FaSun,{}):s.jsx(v.FaMoon,{})})]})})]})},wr=({edge:e,transform:t})=>{var a;if(!e)return null;const n=(null==(a=e.data)?void 0:a.label)??"";if(""===n)return null;const o=n.length>20?`${n.slice(0,20)}...`:n;return s.jsx("div",{style:{position:"absolute",width:"max-content",color:"currentcolor",fontSize:12,fontWeight:600,left:"50%",top:"50%",zIndex:10001,transform:t},className:"nodrag nopan",children:o})},kr=({edge:e,transform:t,edgeNumber:a,children:n})=>e?s.jsx("div",{style:{position:"absolute",color:"currentcolor",width:"max-content",fontSize:12,fontWeight:600,zIndex:10001,transform:t},className:"nodrag nopan",children:n||a||""}):null;kr.displayName="EdgePosition";const jr=(e,t,a,n,s,o,r,l,d,c={})=>{const{leftOffset:u=60,rightOffset:g=60,topOffset:m=50,bottomOffset:p=50,perpOffset:h=20}=c;if("source"===d){let a=e,n=t;switch(r){case i.Position.Right:a+=g,n+=h;break;case i.Position.Left:a-=u,n+=h;break;case i.Position.Top:n-=m,a+=h;break;case i.Position.Bottom:n+=p,a+=h}return`translate(-50%, -50%) translate(${a-s}px, ${n-o}px)`}{let e=a,t=n;switch(l){case i.Position.Right:e+=g,t+=h;break;case i.Position.Left:e-=u,t+=h;break;case i.Position.Top:t-=m,e+=h;break;case i.Position.Bottom:t+=p,e+=h}let r=`translate(-50%, -50%) translate(${e-s}px, ${t-o}px)`;return l===i.Position.Left?r+=" rotate(-90deg)":l===i.Position.Right&&(r+=" rotate(90deg)"),r}},Ar=o.memo((e=>s.jsx(Ir,{...e,type:"chat"}))),Nr=o.memo((e=>s.jsx(Ir,{...e,type:"nested"}))),Tr=o.memo((e=>s.jsx(Ir,{...e,type:"group"}))),Sr=o.memo((e=>s.jsx(Ir,{...e,type:"hidden"}))),Mr=(e,t,a)=>{if("group"===e)return((e,t)=>{switch(e){case"handoff":return s.jsx(j.GiShakingHands,{size:t});case"nested":return s.jsx(j.GiNestEggs,{size:t});default:return s.jsx(k.MdMessage,{size:t})}})(t,18);switch(e){case"chat":return s.jsx(k.MdMessage,{color:a,size:18});case"nested":return s.jsx(j.GiNestEggs,{color:a,size:18});default:return null}},Ir=o.memo((e=>{const{id:t,type:a,data:n,style:r={},sourceX:l,sourceY:d,targetX:c,targetY:u,markerEnd:g,sourcePosition:m,targetPosition:p}=e,{edgePath:h,labelX:f,labelY:b,sourceAgent:x,targetAgent:C,isReadOnly:w,onOpenModal:k,onDelete:j,getEdgeById:N,getEdgeColor:T,getEdgeNumber:S}=(e=>{const{id:t,source:a,target:n,type:s,data:r,sourceX:l,sourceY:d,targetX:c,targetY:u,sourcePosition:g,targetPosition:m}=e,p=us((e=>e.isReadOnly)),h=us((e=>e.deleteEdge)),f=us((e=>e.getEdgeById)),y=us((e=>e.getAgentById)),b=us((e=>e.onEdgeDoubleClick)),v=us((e=>e.updateEdgeData)),x=y(a),C=y(n),[w,k,j]=o.useMemo((()=>i.getSimpleBezierPath({sourceX:l,sourceY:d,sourcePosition:g,targetX:c,targetY:u,targetPosition:m})),[l,d,g,c,u,m]),A=o.useCallback((e=>{const a=f(t);a&&b(e,a)}),[t,f,b]),N=o.useCallback((()=>{h(t)}),[h,t]),T=o.useCallback((()=>{const e=y(a);if(!e)return;const t=e.data.agentType;return me.includes(t)?ia[t]:void 0}),[y,a]),S=o.useCallback((()=>{var e;if(!x||!r)return"";if("chat"===s)return"number"==typeof r.order&&r.order>=0?`${r.order+1}`:"0";if("nested"===s){const t=x.data.label;return`${(null==(e=null==t?void 0:t.charAt(0))?void 0:e.toUpperCase())||""}.${r.position}`}return""}),[x,r,s]),M=o.useCallback((e=>{const a=f(t);a&&v(t,{...a.data,description:e.target.value})}),[t,f,v]);return{edgePath:w,labelX:k,labelY:j,sourceAgent:x,targetAgent:C,isReadOnly:p,getEdgeById:f,onOpenModal:A,onDelete:N,getEdgeColor:T,getEdgeNumber:S,onDescriptionChange:M}})(e),[M,I]=o.useState(!1);if("hidden"===a||!x||!C||!n)return null;const E=o.useMemo((()=>"group"===a?((e,t)=>"group_manager"===t.data.agentType?"toManager":"group_manager"===e.data.agentType?"fromManager":e.data.parentId&&t.data.parentId?"handoff":"nested")(x,C):"toManager"),[a,x,C]),D=S(),R=N(t),P=T(),O=o.useMemo((()=>Mr(a,E,P)),[a,E,P]),L=o.useMemo((()=>({edgeStart:jr(l,d,c,u,f,b,m,p,"source",{leftOffset:10,rightOffset:20,topOffset:10,bottomOffset:20,perpOffset:20}),edgeEnd:jr(l,d,c,u,f,b,m,p,"target",{leftOffset:10,rightOffset:10,topOffset:10,bottomOffset:10,perpOffset:-10})})),[l,d,c,u,f,b,m,p]),z=o.useCallback((e=>{!0!==w&&(M?(e.target.blur(),I(!1)):(e.target.focus(),I(!0)))}),[w,M]),F=o.useCallback((e=>{e.target.blur(),I(!1)}),[]),U=o.useMemo((()=>""!==D?s.jsxs("div",{className:"agent-edge-view clickable",children:[s.jsx(kr,{edge:R,transform:L.edgeStart,children:"0"===D?s.jsx(A.GoAlert,{size:16,className:"edge-position-warning-icon"}):D}),O]}):"group"===a?s.jsxs("div",{className:"agent-edge-view clickable",children:["fromManager"===E&&s.jsx(kr,{edge:R,transform:L.edgeStart,children:s.jsx(A.GoAlert,{size:16,className:"edge-position-warning-icon"})}),"toManager"===E&&s.jsx(kr,{edge:R,transform:L.edgeStart,children:s.jsx("div",{className:"edge-position",children:"1"})}),s.jsx("div",{className:"edge-icon",children:O})]}):s.jsx("div",{className:"agent-edge-view clickable",children:O})),[D,a,O,R,L,E]);return s.jsxs(s.Fragment,{children:[s.jsx(i.BaseEdge,{path:h,markerEnd:g,style:{...r,color:P}}),s.jsx(i.EdgeLabelRenderer,{children:s.jsxs("div",{style:{position:"absolute",transform:`translate(-50%, -50%) translate(${f}px,${b}px)`,pointerEvents:"all"},className:`nodrag nopan clickable agent-edge-box ${x.data.agentType}`,onClick:z,"data-testid":`edge-${t}-box`,tabIndex:0,onBlur:F,children:[M&&s.jsxs("div",{className:"edge-actions",children:[s.jsx("div",{title:"Delete",role:"button",onClick:j,className:"delete-edge clickable","data-testid":`delete-edge-${t}`,"aria-label":"Delete edge",children:s.jsx(y.FaTrash,{size:12})}),s.jsx("div",{title:"Edit",role:"button",onClick:k,className:"open-edge-modal clickable","data-testid":`open-edge-modal-${t}`,"aria-label":"Edit edge",children:s.jsx(v.FaGear,{size:12})})]}),U,s.jsx(wr,{edge:R,transform:L.edgeEnd})]})})]})}));function Er(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}var Dr,Rr;Ar.displayName="WaldiezEdgeChat",Nr.displayName="WaldiezEdgeNested",Tr.displayName="WaldiezEdgeGroup",Sr.displayName="WaldiezEdgeHidden",Ir.displayName="WaldiezEdgeCommon";const Pr=Er(function(){if(Rr)return Dr;Rr=1;var e="undefined"!=typeof Element,t="function"==typeof Map,a="function"==typeof Set,n="function"==typeof ArrayBuffer&&!!ArrayBuffer.isView;function s(o,i){if(o===i)return!0;if(o&&i&&"object"==typeof o&&"object"==typeof i){if(o.constructor!==i.constructor)return!1;var r,l,d,c;if(Array.isArray(o)){if((r=o.length)!=i.length)return!1;for(l=r;0!==l--;)if(!s(o[l],i[l]))return!1;return!0}if(t&&o instanceof Map&&i instanceof Map){if(o.size!==i.size)return!1;for(c=o.entries();!(l=c.next()).done;)if(!i.has(l.value[0]))return!1;for(c=o.entries();!(l=c.next()).done;)if(!s(l.value[1],i.get(l.value[0])))return!1;return!0}if(a&&o instanceof Set&&i instanceof Set){if(o.size!==i.size)return!1;for(c=o.entries();!(l=c.next()).done;)if(!i.has(l.value[0]))return!1;return!0}if(n&&ArrayBuffer.isView(o)&&ArrayBuffer.isView(i)){if((r=o.length)!=i.length)return!1;for(l=r;0!==l--;)if(o[l]!==i[l])return!1;return!0}if(o.constructor===RegExp)return o.source===i.source&&o.flags===i.flags;if(o.valueOf!==Object.prototype.valueOf&&"function"==typeof o.valueOf&&"function"==typeof i.valueOf)return o.valueOf()===i.valueOf();if(o.toString!==Object.prototype.toString&&"function"==typeof o.toString&&"function"==typeof i.toString)return o.toString()===i.toString();if((r=(d=Object.keys(o)).length)!==Object.keys(i).length)return!1;for(l=r;0!==l--;)if(!Object.prototype.hasOwnProperty.call(i,d[l]))return!1;if(e&&o instanceof Element)return!1;for(l=r;0!==l--;)if(("_owner"!==d[l]&&"__v"!==d[l]&&"__o"!==d[l]||!o.$$typeof)&&!s(o[d[l]],i[d[l]]))return!1;return!0}return o!=o&&i!=i}return Dr=function(e,t){try{return s(e,t)}catch(a){if((a.message||"").match(/stack|recursion/i))return!1;throw a}}}()),Or=[{label:"System",value:"system"},{label:"User",value:"user"},{label:"Assistant",value:"assistant"}],Lr=[{label:"None",value:null},{label:"Reflection with LLM",value:"reflectionWithLlm"},{label:"Last Message",value:"lastMsg"}],zr=[{label:"Chat",value:"chat"},{label:"Nested Chat",value:"nested"}],Fr={reflectionWithLlm:"Reflection with LLM",lastMsg:"Last Message",none:"None"},Ur=e=>{const{data:t,edgeId:a,onTypeChange:n,skipDescription:i=!1}=e,{summaryRoleOptions:r,summaryOptions:l,edgeTypeOptions:d,summaryMethodLabel:c,summaryRoleValue:u,summaryRoleLabel:g,currentSelectedChatType:m,onLabelChange:p,onDescriptionChange:h,onClearHistoryChange:f,onMaxTurnsChange:y,onSummaryMethodChange:b,onLlmPromptChange:v,onLlmSummaryRoleChange:x}=(e=>{var t,a,n,s;const{data:i,edgeType:r,onDataChange:l}=e,d=o.useCallback((e=>{l({description:e.target.value})}),[l]),c=o.useCallback((e=>{l({label:e.target.value})}),[l]),u=o.useCallback((e=>{i.clearHistory!==e&&"function"==typeof l&&l({clearHistory:e})}),[l,i.clearHistory]),g=o.useCallback((e=>{l({maxTurns:e})}),[l]),m=o.useCallback((e=>{e&&l({summary:{method:e.value,prompt:i.summary.prompt,args:i.summary.args}})}),[l,i.summary.prompt,i.summary.args]),p=o.useCallback((e=>{l({summary:{method:i.summary.method,prompt:e.target.value,args:{...i.summary.args}}})}),[l,i.summary.method,i.summary.args]),h=o.useCallback((e=>{e&&l({summary:{method:i.summary.method,prompt:i.summary.prompt,args:{...i.summary.args,summary_role:e.value}}})}),[l,i.summary.method,i.summary.prompt,i.summary.args]),f=o.useCallback((()=>{var e;const t=(null==(e=i.summary)?void 0:e.args)||{};if("summary_role"in t&&["system","user","assistant"].includes(t.summary_role)){const e=t.summary_role;return e[0].toUpperCase()+e.slice(1)}return"System"}),[null==(t=i.summary)?void 0:t.args]),y=o.useMemo((()=>{var e;return Fr[(null==(e=i.summary)?void 0:e.method)??"none"]}),[null==(a=i.summary)?void 0:a.method]),b=o.useMemo((()=>{var e,t;return(null==(t=null==(e=i.summary)?void 0:e.args)?void 0:t.summary_role)??"system"}),[null==(s=null==(n=i.summary)?void 0:n.args)?void 0:s.summary_role]),v=o.useMemo((()=>f()),[f]),x=o.useMemo((()=>{var e;return{label:(null==(e=zr.find((e=>e.value===r)))?void 0:e.label)||"Chat",value:r}}),[r]);return{summaryRoleOptions:Or,summaryOptions:Lr,edgeTypeOptions:zr,summaryMethodLabel:y,summaryRoleValue:b,summaryRoleLabel:v,currentSelectedChatType:x,onLabelChange:c,onDescriptionChange:d,onClearHistoryChange:u,onMaxTurnsChange:g,onSummaryMethodChange:m,onLlmPromptChange:p,onLlmSummaryRoleChange:h}})(e);return s.jsxs("div",{className:"flex-column",children:[s.jsxs("div",{className:"margin-top--10",children:[s.jsx(mo,{htmlFor:`select-chat-type-${a}`,label:"Chat Type:",info:"The type of the chat. Could be Chat or Nested Chat. Chats are executed in a sequential order. Nested Chats are not always executed (i.e., triggered)."}),s.jsx("label",{className:"hidden",htmlFor:`select-chat-type-${a}`,children:"Chat Type:"}),s.jsx($s,{options:d,value:m,onChange:n,inputId:`select-chat-type-${a}`})]}),s.jsx(xo,{label:"Label:",name:"edge-label",value:t.label,onChange:p,dataTestId:`edge-${a}-label-input`}),!i&&s.jsxs("div",{className:"margin-top-10",children:[s.jsx("label",{htmlFor:`edge-${a}-description-input`,children:"Description:"}),s.jsx(yo,{rows:2,value:t.description,placeholder:"Enter a description",onChange:h,"data-testid":`edge-${a}-description-input`})]}),s.jsx("div",{className:"margin-top-10"}),s.jsx(Js,{label:"Clear History",isChecked:!0===t.clearHistory,onCheckedChange:f,id:`edge-${a}-clear-history-checkbox`}),s.jsx(ui,{name:"max-turns",label:"Max Turns:",min:0,max:100,value:t.maxTurns,onChange:y,onNull:0,setNullOnLower:!0,onLowerLabel:"No limit",labelInfo:"The maximum number of turns for the chat between the two agents. One turn means one conversation round trip. If set to 0, there is no limit.",dataTestId:`edge-${a}-max-turns-input`}),s.jsx(mo,{htmlFor:`select-summary-method-${a}`,label:"Summary Method:",info:()=>s.jsxs("div",{children:["The method to be used to summarize the conversation. ",s.jsx("br",{}),"Possible values are: ",s.jsx("br",{}),s.jsxs("ul",{children:[s.jsxs("li",{children:[s.jsx("b",{children:"Reflection with LLM:"})," the summary is generated by reflecting on the conversation and using the Language Model (LLM) to generate the summary."]}),s.jsxs("li",{children:[s.jsx("b",{children:"Last Message:"})," the last message of the conversation is used as the summary."]}),s.jsxs("li",{children:[s.jsx("b",{children:"None:"})," no summary is generated."]})]})]})}),s.jsx("label",{className:"hidden",htmlFor:`select-summary-method-${a}`,children:"Summary Method:"}),s.jsx($s,{options:l,value:{label:c,value:t.summary.method},onChange:b,inputId:`select-summary-method-${a}`}),"reflectionWithLlm"===t.summary.method&&s.jsxs(s.Fragment,{children:[s.jsx(mo,{htmlFor:`edge-${a}-llm-prompt-input`,label:"Summary Prompt:",info:"The prompt to be used for the summary generation."}),s.jsx(yo,{placeholder:"Enter the summary prompt",rows:2,value:t.summary.prompt,onChange:v,"data-testid":`edge-${a}-llm-prompt-input`}),s.jsx("label",{htmlFor:`select-summary-role-${a}`,children:"Summary Role:"}),s.jsx($s,{options:r,value:{label:g,value:u},onChange:x,inputId:`select-summary-role-${a}`})]})]})},qr=e=>{const{edgeId:t,data:a,darkMode:n,skipRagOption:i,skipCarryoverOption:r,skipContextVarsOption:l}=e,{onMessageTypeChange:d,onMessageChange:c,onAddMessageContextEntry:u,onRemoveMessageContextEntry:g,onUpdateMessageContextEntries:m}=(e=>{const{data:t,onDataChange:a}=e;return{onMessageTypeChange:o.useCallback((e=>{a({message:{...t.message,type:e,useCarryover:!1,content:null,context:{}}})}),[t.message,a]),onMessageChange:o.useCallback((e=>{a({message:e})}),[a]),onAddMessageContextEntry:o.useCallback(((e,n)=>{a({message:{...t.message,context:{...t.message.context,[e]:n}}})}),[t.message,a]),onRemoveMessageContextEntry:o.useCallback((e=>{const{[e]:n,...s}=t.message.context;a({message:{...t.message,context:s}})}),[t.message,a]),onUpdateMessageContextEntries:o.useCallback((e=>{a({message:{...t.message,context:e}})}),[t.message,a])}})(e),p=()=>{},h=!0===l?p:u,f=!0===l?p:g,y=!0===l?p:m;return s.jsx("div",{className:"margin-top-10",children:s.jsx(No,{darkMode:n,current:a.message,skipRagOption:!0===i,skipCarryoverOption:!0===r,selectLabel:"Message Type:",selectTestId:`select-message-type-${t}`,defaultContent:Br,notNoneLabel:"Message:",notNoneLabelInfo:"The message to be used when the chat is initiated.",includeContext:!0!==l,onTypeChange:d,onMessageChange:c,onAddContextEntry:h,onRemoveContextEntry:f,onUpdateContextEntries:y})})},Br='"""Custom message function."""\n# provide the message to be sent when the sender and the recipient are connected\n# complete the `callable_message` below. Do not change the name or the arguments of the function.\n# only complete the function body and the docstring and return the:\n# final message: (str) or a dictionary with the final message and additional data (dict)\n#\n# the recipient and the sender are \'autogen.ConversableAgent\' objects\n# the context is generated from the sender\'s initiate_chat additional keyword arguments\n# example:\n# def callable_message(sender, recipient, context):\n#   # type: (ConversableAgent, ConversableAgent, dict) -> Union[str, Dict]\n#   carryover = context.get("carryover", "")\n#    if isinstance(carryover, list):\n#        carryover = carryover[-1]\n#    final_msg = "Write a blogpost." + "\\nContext: \\n" + carryover\n#    return final_msg\n#\ndef callable_message(sender, recipient, context):\n    """Complete the message function"""\n    ...\n',Hr=e=>{var t,a;const{flowId:n,edgeId:i,darkMode:r,data:l}=e,{onNestedMessageTypeChange:d,onNestedMessageChange:c,onNestedReplyTypeChange:u,onNestedReplyChange:g}=(e=>{const{data:t,onDataChange:a}=e,n=o.useMemo((()=>t.nestedChat),[t.nestedChat]),s=o.useCallback((e=>({type:e,useCarryover:!1,content:null,context:{}})),[]);return{onNestedMessageTypeChange:o.useCallback((e=>{a({nestedChat:{reply:n.reply,message:s(e)}})}),[n.reply,a,s]),onNestedReplyTypeChange:o.useCallback((e=>{a({nestedChat:{message:n.message,reply:s(e)}})}),[n.message,a,s]),onNestedMessageChange:o.useCallback((e=>{a({nestedChat:{reply:n.reply,message:e}})}),[n.reply,a]),onNestedReplyChange:o.useCallback((e=>{a({nestedChat:{message:n.message,reply:e}})}),[n.message,a])}})(e),m=(null==(t=l.nestedChat)?void 0:t.message)??{type:"none",useCarryover:!1,content:null,context:{}},p=(null==(a=l.nestedChat)?void 0:a.reply)??{type:"none",useCarryover:!1,content:null,context:{}},h=()=>{};return s.jsxs("div",{className:"flex-column margin-top-10",children:[s.jsx("div",{className:"info margin-bottom-10",children:"When the connection is used in a nested chat, you can specify the messages to be sent and received, from the source and the target respectively."}),s.jsxs(pi,{activeTabIndex:0,children:[s.jsx(mi,{label:"Message",id:`wc-${n}-edge-nested-chat-${i}-message`,children:s.jsx("div",{className:"flex-column",children:s.jsx(No,{darkMode:r,current:m,selectLabel:"Message Type:",selectTestId:`select-nested-message-type-${i}`,defaultContent:Wr,notNoneLabel:"Message:",notNoneLabelInfo:"The message to be sent from the source.",includeContext:!1,skipCarryoverOption:!0,skipRagOption:!0,onTypeChange:d,onMessageChange:c,onAddContextEntry:h,onRemoveContextEntry:h,onUpdateContextEntries:h})})}),s.jsx(mi,{label:"Reply",id:`wc-${n}-edge-nested-chat-${i}-reply`,children:s.jsx("div",{className:"flex-column",children:s.jsx(No,{darkMode:r,current:p,selectLabel:"Reply Type:",selectTestId:`select-nested-reply-type-${i}`,defaultContent:Vr,notNoneLabel:"Reply:",notNoneLabelInfo:"The message to be sent from the target.",skipCarryoverOption:!0,skipRagOption:!0,includeContext:!1,onTypeChange:u,onMessageChange:g,onAddContextEntry:h,onRemoveContextEntry:h,onUpdateContextEntries:h})})})]})]})},Wr='"""Custom nested chat message function."""\n# provide the message to be sent from the sender to the recipient in a nested chat\n# complete the `nested_chat_message` below. Do not change the name or the arguments of the function.\n# only complete the function body and the docstring and return the final message.\n# example:\n# def nested_chat_message(recipient, messages, sender, config):\n#    # type: (ConversableAgent, Optional[list[dict]], Optional[ConversableAgent], Optional[dict]) -> str | dict\n#    return f"""Review the following content.\n#            \\n\\n {recipient.chat_messages_for_summary(sender)[-1][\'content\']}"""\n#\ndef nested_chat_message(recipient, messages, sender, config):\n    """Complete the nested chat message function"""\n    ...\n',Vr='"""Custom nested chat reply function."""\n# provide the reply to be sent when the recipient replies to the sender in a nested chat\n# complete the `nested_chat_reply` below. Do not change the name or the arguments of the function.\n# only complete the function body and the docstring and return the agent\'s reply.\n# example:\n# def nested_chat_reply(recipient, messages, sender, config):\n#    # type: (ConversableAgent, Optional[list[dict]], Optional[ConversableAgent], Optional[dict]) -> str | dict\n#    last_message = messages[-1][\'content\']\n#    return f"Great! You said: {last_message}"\n#\ndef nested_chat_reply(recipient, messages, sender, config):\n    """Complete the nested chat reply function"""\n    ...\n',Gr=o.memo((e=>{const{edgeId:t,isOpen:a,onClose:n}=e,{flowId:i,edge:r,edgeData:l,edgeType:d,isDark:c,isDirty:u,isRagUserProxy:g,sourceAgent:m,targetAgent:p,onDataChange:h,onTypeChange:f,onCancel:y,onDelete:b,onSubmit:x}=(e=>{var t;const{edgeId:a,onClose:n}=e,s=us((e=>e.getEdgeSourceAgent)),i=us((e=>e.getEdgeTargetAgent)),r=us((e=>e.updateEdgeData)),l=us((e=>e.updateEdgeType)),d=us((e=>e.getEdgeById)),c=us((e=>e.deleteEdge)),u=us((e=>e.flowId)),{isDark:g}=ga(),m=d(a),p=o.useMemo((()=>m?s(m):null),[m,s]),h=o.useMemo((()=>m?i(m):null),[m,i]),[f,y]=o.useState((null==m?void 0:m.type)??"chat"),[b,v]=o.useState(null==m?void 0:m.data),[x,C]=o.useState(!1),w=o.useMemo((()=>{var e;return"rag_user_proxy"===(null==(e=null==p?void 0:p.data)?void 0:e.agentType)}),[null==(t=null==p?void 0:p.data)?void 0:t.agentType]),k=o.useCallback((e=>{if(!b)return;const t={...b,...e};v(t),C(!Pr(t,null==m?void 0:m.data))}),[b,null==m?void 0:m.data]),j=o.useCallback((e=>{if(!e||!m)return;const t=e.value;y(t),C(t!==m.type)}),[m]),A=o.useCallback((()=>{m&&(v(m.data),m.type&&y(m.type)),C(!1),n()}),[m,n]),N=o.useCallback((()=>{A(),c(a)}),[A,c,a]),T=o.useCallback((()=>{b&&r(a,b),m&&f!==m.type&&l(a,f),C(!1)}),[b,f,m,a,r,l]);return{flowId:u,edge:m,edgeData:b,edgeType:f,isDirty:x,isRagUserProxy:w,isDark:g,sourceAgent:p,targetAgent:h,onDataChange:k,onTypeChange:j,onCancel:A,onSubmit:T,onDelete:N}})(e),[C,w]=o.useState(0);if(o.useEffect((()=>{a&&w(0)}),[a]),!(l&&r&&"hidden"!==d&&m&&p))return null;const k=o.useCallback((()=>{x(),n()}),[x,n]),j=o.useCallback((e=>{h({condition:e})}),[h]),A=o.useCallback((e=>{h({available:e})}),[h]),N=o.useMemo((()=>s.jsx(v.FaTrashCan,{className:"clickable",onClick:b,title:"Delete edge","aria-label":"Delete edge"})),[b]),T=o.useMemo((()=>"group"!==d?"none":"group_manager"===l.targetType?"toManager":"group_manager"===l.sourceType?"fromManager":p.parentId?"handoff":"nested"),[d,null==l?void 0:l.targetType,null==l?void 0:l.sourceType,null==p?void 0:p.parentId]),S=o.useMemo((()=>({properties:`wc-${i}-edge-properties-${t}`,message:`wc-${i}-edge-message-${t}`,nested:`wc-${i}-edge-nested-${t}`,condition:`wc-${i}-edge-condition-${t}`,availability:`wc-${i}-edge-availability-${t}`})),[i,t]),M=o.useMemo((()=>({modal:`edge-modal-${t}`,cancel:`modal-cancel-btn-${t}`,saveAndClose:`modal-submit-and-close-btn-${t}`,save:`modal-submit-btn-${t}`})),[t]),I=o.useMemo((()=>l.nestedChat.message||{type:"string",content:"",context:{}}),[l.nestedChat.message]),E=o.useCallback((()=>{}),[]),D=o.useCallback((e=>{var t,a;const n={...l.nestedChat.message,content:(null==(t=l.nestedChat.message)?void 0:t.content)||"",context:(null==(a=l.nestedChat.message)?void 0:a.context)||{},type:e};h({nestedChat:{...l.nestedChat,message:n}})}),[h,l.nestedChat]),R=o.useCallback((e=>{h({nestedChat:{...l.nestedChat,message:e}})}),[h,l.nestedChat]);return s.jsx(Eo,{isOpen:a,onClose:n,onSaveAndClose:k,beforeTitle:N,title:l.label,dataTestId:M.modal,hasUnsavedChanges:u,preventCloseIfUnsavedChanges:!0,children:s.jsxs("div",{className:"modal-body edge-modal",children:["group"===d?s.jsxs(pi,{activeTabIndex:C,children:[s.jsx(mi,{label:"Properties",id:S.properties,children:s.jsx(Ur,{edgeId:t,data:l,edgeType:d,onTypeChange:f,onDataChange:h,skipDescription:!0})}),"toManager"===T&&s.jsx(mi,{label:"Message",id:S.message,children:s.jsx(qr,{edgeId:t,data:l,darkMode:c,skipRagOption:!g,skipCarryoverOption:!g,skipContextVarsOption:!1,onDataChange:h})}),"nested"===T&&s.jsx(mi,{label:"Message",id:`wc-${i}-edge-nested-chat-${t}-message`,children:s.jsx("div",{className:"flex-column",children:s.jsx(No,{darkMode:c,current:I,selectLabel:"Message Type:",selectTestId:`select-nested-message-type-${t}`,defaultContent:Wr,notNoneLabel:"Message:",notNoneLabelInfo:"The message to be sent from the source.",includeContext:!1,skipCarryoverOption:!0,skipRagOption:!0,skipNone:!0,onTypeChange:D,onMessageChange:R,onAddContextEntry:E,onRemoveContextEntry:E,onUpdateContextEntries:E})})}),"handoff"===T&&s.jsx(mi,{label:"Condition",id:S.condition,children:s.jsx(ko,{condition:l.condition,onDataChange:j})}),"handoff"===T&&s.jsx(mi,{label:"Availability",id:S.availability,children:s.jsx(vo,{available:l.available,onDataChange:A})})]}):s.jsxs(pi,{activeTabIndex:C,children:[s.jsx(mi,{label:"Properties",id:S.properties,children:s.jsx(Ur,{edgeId:t,data:l,edgeType:d,onTypeChange:f,onDataChange:h})}),"chat"===d&&s.jsx(mi,{label:"Message",id:S.message,children:s.jsx(qr,{edgeId:t,data:l,darkMode:c,skipRagOption:!g,onDataChange:h})}),"nested"===d&&s.jsx(mi,{label:"Nested Chat",id:S.nested,children:s.jsx(Hr,{flowId:i,edgeId:t,darkMode:c,data:l,onDataChange:h})})]}),s.jsxs("div",{className:"modal-actions",children:[s.jsx("button",{type:"button",title:"Cancel",className:"secondary",onClick:y,id:M.cancel,"data-testid":M.cancel,children:"Cancel"}),s.jsxs("div",{className:"flex-row",children:[s.jsx("button",{title:"Save & Close",type:"button",className:"save margin-right-10 ",onClick:k,id:M.saveAndClose,"data-testid":M.saveAndClose,disabled:!u,"aria-disabled":!u,children:"Save & Close"}),s.jsx("button",{type:"button",title:u?"Save changes":"No changes to save",className:"primary",onClick:x,id:M.save,"data-testid":M.save,disabled:!u,"aria-disabled":!u,children:"Save"})]})]})]})})}));Gr.displayName="WaldiezEdgeModal";const Kr=o.memo((e=>{const{id:t,data:a}=e,n=a.agentType;if("group_manager"===n)return s.jsx("div",{className:"agent-content"});if("user_proxy"===n)return s.jsx("div",{className:"agent-content",children:s.jsx("div",{className:"agent-label margin-top-20","data-testid":`agent-${t}-label`,children:a.label})});return Qr(t,a)})),Qr=(e,t)=>{const a=us((e=>e.getModels)),n=us((e=>e.getTools)),[i,r]=o.useState(2),[l,d]=o.useState(2),[c,u]=o.useState(0),{tools:g,agentModelNames:m,agentWaldiezModelAPITypes:p,agentModelLogos:h}=o.useMemo((()=>{const e=a(),s=n(),o=t.modelIds.map((t=>{var a;return(null==(a=e.find((e=>e.id===t)))?void 0:a.data.label)??""})).filter((e=>""!==e)),i=t.modelIds.map((t=>{var a;return(null==(a=e.find((e=>e.id===t)))?void 0:a.data.apiType)??""})).filter((e=>""!==e)),r=i.map((e=>da[e]??"")).filter((e=>""!==e));return{tools:s,agentModelNames:o,agentWaldiezModelAPITypes:i,agentModelLogos:r}}),[a,n,t.modelIds]),f=o.useCallback((e=>{const a=Math.floor(e/18),n=m.length,s=t.tools.length;if(a<=0)return{models:0,tools:0};let o=0,i=0;if(0===n)i=Math.min(s,a);else if(0===s)o=Math.min(n,a);else{if(o=Math.min(n,Math.ceil(a/2)),i=Math.min(s,a-o),o<Math.ceil(a/2)){const e=Math.min(n-o,a-(o+i));o+=Math.max(0,e)}if(i<Math.floor(a/2)){const e=Math.min(s-i,a-(o+i));i+=Math.max(0,e)}}return{models:o,tools:i}}),[m.length,t.tools.length]),y=o.useCallback((e=>{if(!e)return;const t=()=>{const t=e.closest(".react-flow__node"),a=((null==t?void 0:t.offsetHeight)||e.offsetHeight)-20-20-40;u(a);const{models:n,tools:s}=f(a);r(n),d(s)};setTimeout(t,0);const a=new ResizeObserver(t);return a.observe(e),()=>{a.disconnect()}}),[f]);return o.useEffect((()=>{if(0===c){const{models:e,tools:t}=f(120);r(e),d(t)}}),[f,c]),o.useMemo((()=>{const a=m.length>0,n=t.tools.length>0,o=a&&i>0,r=n&&l>0;return s.jsxs("div",{ref:y,className:"agent-content",children:[s.jsx("div",{className:"agent-label","data-testid":`agent-${e}-label`,children:t.label}),o&&s.jsxs("div",{className:"agent-models-preview",children:[m.slice(0,i).map(((t,a)=>s.jsxs("div",{className:"agent-model-preview","data-testid":"agent-model-preview",children:[s.jsx("div",{className:`agent-model-img ${p[a]}`,children:s.jsx("img",{src:h[a],title:t,alt:t})}),s.jsx("div",{className:"font-small agent-model-name","data-testid":`agent-${e}-linked-model-${a}`,children:t})]},t))),m.length>i&&s.jsxs("div",{className:"agent-more-indicator",children:[s.jsx("div",{className:"agent-model-img",children:s.jsx("span",{children:"⋯"})}),s.jsxs("div",{className:"font-small agent-model-name",children:["+",m.length-i," more"]})]})]}),!a&&"user_proxy"!==t.agentType&&s.jsx("div",{className:"agent-models-preview",children:s.jsx("div",{className:"font-small agent-model-name",children:"No models"})}),r&&s.jsxs("div",{className:"agent-tools-preview",children:[t.tools.slice(0,l).map(((t,a)=>{const n=g.find((e=>e.id===t.id));return n?s.jsxs("div",{className:"agent-tool-preview","data-testid":"agent-tool-preview",children:[s.jsx("div",{className:"agent-tool-img",children:s.jsx(N.AiFillCode,{"aria-hidden":"true"})}),s.jsx("div",{className:"font-small agent-tool-name","data-testid":`agent-${e}-linked-tool-${a}`,children:n.data.label})]},n.id):null})),t.tools.length>l&&s.jsxs("div",{className:"agent-more-indicator",children:[s.jsx("div",{className:"agent-tool-img",children:s.jsx("span",{children:"⋯"})}),s.jsxs("div",{className:"font-small agent-tool-name",children:["+",t.tools.length-l," more"]})]})]}),!n&&"user_proxy"!==t.agentType&&s.jsx("div",{className:"agent-tools-preview",children:s.jsx("div",{className:"font-small agent-tool-name",children:"No tools"})})]})}),[m,t.tools,t.label,t.agentType,i,l,y,e,p,h,g])},Zr=e=>{const{agentType:t,id:a,handleClassNameBase:n,selected:o,onEdgeConnection:r}=e,l=[{pos:i.Position.Top,label:"top"},{pos:i.Position.Bottom,label:"bottom"},{pos:i.Position.Left,label:"left"},{pos:i.Position.Right,label:"right"}];let d=`${n}handle `;if(o||(d+="not-selected "),"group_manager"===t)return l.map((({pos:e,label:t})=>s.jsx(i.Handle,{className:`${d} ${t} target`,type:"target",isConnectableEnd:!0,position:e,onConnect:r,"data-testid":`agent-handle-${t}-target-${a}`,id:`agent-handle-${t}-target-${a}`},`target-${t}`)));const c={[i.Position.Top]:{target:{left:"75%"},source:{left:"25%"}},[i.Position.Bottom]:{target:{left:"25%"},source:{left:"75%"}},[i.Position.Left]:{target:{top:"25%"},source:{top:"75%"}},[i.Position.Right]:{target:{top:"75%"},source:{top:"25%"}}};return l.flatMap((({pos:e,label:t})=>[s.jsx(i.Handle,{className:`${d} ${t} target`,type:"target",isConnectableEnd:!0,position:e,onConnect:r,"data-testid":`agent-handle-${t}-target-${a}`,id:`agent-handle-${t}-target-${a}`,style:c[e].target},`target-${t}`),s.jsx(i.Handle,{className:`${d} ${t} source`,type:"source",isConnectableStart:!0,position:e,onConnect:r,"data-testid":`agent-handle-${t}-source-${a}`,id:`agent-handle-${t}-source-${a}`,style:c[e].source},`source-${t}`)]))},Xr=o.memo((e=>{const{id:t,data:a,models:n,onDataChange:i}=e,r=o.useMemo((()=>n.map((e=>({label:e.data.label,value:e.id})))),[n]),l=o.useMemo((()=>a.modelIds&&0!==a.modelIds.length?a.modelIds.map((e=>{const t=n.find((t=>t.id===e));return t?{label:t.data.label,value:t.id}:null})):[]),[a.modelIds,n]),d=o.useCallback((e=>{if(e){const t=(Array.isArray(e)?e:[e]).map((e=>e.value));i({modelIds:t})}else i({modelIds:[]})}),[i]);return s.jsxs("div",{className:"agent-panel margin-bottom-10","data-testid":"agent-models-panel",children:[s.jsxs("label",{htmlFor:`select-agent-models-${t}`,children:["Model","rag_user_proxy"===a.agentType?"":"s"," to use:"]}),s.jsx($s,{options:r,value:l,onChange:d,isMulti:"rag_user_proxy"!==a.agentType,inputId:`select-agent-models-${t}`,isClearable:!0,"aria-label":"Select agent's model"+("rag_user_proxy"===a.agentType?"":"s")})]})}));Xr.displayName="WaldiezAgentModels";const Jr=o.memo((e=>{var t,a,n,i;const{isModalOpen:r,flowId:l,id:d,data:c}=e,{groupMembers:u,models:g,initialAgent:m,initialAgentOptions:p,speakersOrder:h,onGroupNameChange:f,onManagerNameChange:y,onMaxRoundChange:b,onAddContextVariable:x,onDeleteContextVariable:C,onUpdateContextVariable:w,onInitialAgentChange:k,onEnableClearHistoryChange:j,onSendIntroductionsChange:A,onMaxRetriesForSelectingChange:N,onSpeakerSelectionMethodChange:T,onDescriptionChange:S,onSystemMessageChange:M,onAfterWorkChange:I,onMoveMemberUp:E,onMoveMemberDown:D}=(e=>{const{id:t,data:a,onDataChange:n}=e,s=us((e=>e.getGroupMembers)),i=us((e=>e.getAgentById)),r=us((e=>e.getModels)),l=o.useMemo((()=>{const e=s(t),n=a.speakers.order||[],o=new Set(e.map((e=>e.id))),i=n.filter((e=>o.has(e))),r=new Set(i),l=e.filter((e=>!r.has(e.id))).map((e=>e.id));let d=[...i,...l];return a.initialAgentId&&o.has(a.initialAgentId)&&(d=d.filter((e=>e!==a.initialAgentId)),d.unshift(a.initialAgentId)),d}),[s,t,a.speakers.order,a.initialAgentId]),d=o.useCallback((e=>{n({speakers:{...a.speakers,order:e}})}),[a.speakers,n]),c=o.useCallback((e=>{if(!l.includes(e))return;const t=l.indexOf(e);if(t<=0)return;if(a.initialAgentId&&1===t)return;const n=[...l];[n[t-1],n[t]]=[n[t],n[t-1]],d(n)}),[l,a.initialAgentId,d]),u=o.useCallback((e=>{if(!l.includes(e))return;const t=l.indexOf(e);if(t>=l.length-1)return;if(a.initialAgentId&&e===a.initialAgentId)return;const n=[...l];[n[t],n[t+1]]=[n[t+1],n[t]],d(n)}),[l,a.initialAgentId,d]),g=o.useMemo((()=>r()),[r]),m=o.useMemo((()=>s(t)),[s,t]),p=o.useMemo((()=>a.initialAgentId?i(a.initialAgentId):void 0),[a.initialAgentId,i]),h=o.useMemo((()=>p?{label:p.data.label,value:p}:void 0),[p]),f=o.useMemo((()=>m.map((e=>({label:e.data.label,value:e})))),[m]),y=o.useCallback((e=>{const t={...a.speakers,...e};n({speakers:t})}),[a.speakers,n]),b=o.useCallback((e=>{const t=e.target.value;n({groupName:t})}),[n]),v=o.useCallback((e=>{const t=e.target.value;n({name:t,label:t})}),[n]),x=o.useCallback((e=>{const t=e.target.value;n({description:t})}),[n]),C=o.useCallback((e=>{const t=e.target.value;n({systemMessage:t})}),[n]),w=o.useCallback((e=>{null!==e&&e>0&&n({maxRound:e})}),[n]),k=o.useCallback(((e,t)=>{const s={...a.contextVariables,[e]:t};n({contextVariables:s})}),[a.contextVariables,n]),j=o.useCallback((e=>{const t={...a.contextVariables};delete t[e],n({contextVariables:t})}),[a.contextVariables,n]),A=o.useCallback((e=>{n({contextVariables:e})}),[n]),N=o.useCallback((e=>{if(!e)return void n({initialAgentId:void 0});const t=e.value.id;n({initialAgentId:t})}),[n]),T=o.useCallback((e=>{n({enableClearHistory:e})}),[n]),S=o.useCallback((e=>{n({sendIntroductions:e})}),[n]),M=o.useCallback((e=>{y({maxRetriesForSelecting:e})}),[y]),I=o.useCallback((e=>{const t=(null==e?void 0:e.value)??void 0;y({selectionMethod:t})}),[y]),E=o.useCallback((e=>{n(e?{...a,afterWork:e}:{...a,afterWork:null})}),[a,n]);return{models:g,groupMembers:m,speakersOrder:l,initialAgent:h,initialAgentOptions:f,onGroupNameChange:b,onManagerNameChange:v,onDescriptionChange:x,onSystemMessageChange:C,onMaxRoundChange:w,onAddContextVariable:k,onDeleteContextVariable:j,onUpdateContextVariable:A,onInitialAgentChange:N,onEnableClearHistoryChange:T,onSendIntroductionsChange:S,onMaxRetriesForSelectingChange:M,onSpeakerSelectionMethodChange:I,onAfterWorkChange:E,onMoveMemberUp:c,onMoveMemberDown:u}})(e),[R,P]=o.useState(0);o.useEffect((()=>{P(0)}),[r]);const O=o.useMemo((()=>[{label:"Auto",value:"auto"},{label:"Manual",value:"manual"},{label:"Default",value:"default"},{label:"Random",value:"random"},{label:"Round Robin",value:"round_robin"}]),[]),L=o.useMemo((()=>{var e,t;return{label:(null==(e=O.find((e=>{var t;return e.value===(null==(t=c.speakers)?void 0:t.selectionMethod)})))?void 0:e.label)??"Auto",value:(null==(t=c.speakers)?void 0:t.selectionMethod)??"auto"}}),[null==(t=c.speakers)?void 0:t.selectionMethod,O]),z=!["manual","auto"].includes(null==(a=c.speakers)?void 0:a.selectionMethod);return s.jsxs(pi,{activeTabIndex:R,children:[s.jsx(mi,{label:"Group",id:`wf-${l}-agent-group-manager-config-${d}`,children:s.jsxs("div",{className:"modal-body  agent-panel",children:[s.jsx(xo,{label:"Group Name:",name:"group-name",value:c.groupName??"",onChange:f,dataTestId:`agent-name-input-${d}`,"aria-label":"Group name"}),s.jsx("label",{htmlFor:`wf-${l}-agent-config-${d}-select-initial-agent`,children:"Initial Agent:"}),s.jsx($s,{options:p,value:m,onChange:k,inputId:`wf-${l}-agent-config-${d}-select-initial-agent`,"aria-label":"Select initial agent"}),s.jsx(ui,{name:"max-rounds",label:"Max Rounds:",value:c.maxRound,onChange:b,min:1,max:1e3,step:1,setNullOnLower:!1,forceInt:!0,labelInfo:"The maximum number of conversation rounds in the group.",dataTestId:`manager-max-rounds-input-${d}`,"aria-label":"Maximum conversation rounds"}),s.jsx(po,{itemsType:"group-context-variables",viewLabel:"Context Variables",viewLabelInfo:"The context variables that will be available when the group chat starts.",onAdd:x,onDelete:C,onUpdate:w,items:c.contextVariables??{},allowEmptyValues:!0,"aria-label":"Group context variables"})]})}),s.jsx(mi,{label:"Group Manager",id:`wf-${l}-agent-group-manager-agent-${d}`,children:s.jsxs("div",{className:"modal-body agent-panel",children:[s.jsx("div",{children:s.jsx(Xr,{id:d,data:e.data,models:g,onDataChange:e.onDataChange})}),s.jsx("div",{children:s.jsx(xo,{label:"Group Manager's Name:",name:"group-manager-name",value:c.name??c.label??"",onChange:y,dataTestId:`agent-name-input-${d}`,placeholder:"Group Manager Name",className:"margin-top-5","aria-label":"Group manager name"})}),s.jsx("label",{htmlFor:`agent-description-input-${d}`,children:"Description:"}),s.jsx(yo,{id:`agent-description-input-${d}`,title:"Agent description",rows:2,value:c.description,onChange:S,"data-testid":`agent-description-input-${d}`,"aria-label":"Manager description"}),s.jsx("label",{htmlFor:`agent-system-message-input-${d}`,children:"System Message:"}),s.jsx(yo,{id:`agent-system-message-input-${d}`,title:"System message",rows:2,value:c.systemMessage??"",onChange:M,"data-testid":`agent-system-message-input-${d}`,"aria-label":"Manager system message"}),s.jsx(Ys,{label:"Send introductions",checked:!0===c.sendIntroductions,info:"Send a round of introductions at the start of the group chat, so agents know who they can speak to (default: False)",onChange:A,id:`manager-send-introductions-checkbox-${d}`,"aria-label":"Enable sending introductions"}),s.jsx(Ys,{label:"Enable clear history",checked:!0===c.enableClearHistory,info:"Enable the possibility to clear history of messages for agents manually by providing 'clear history' phrase in user prompt.",onChange:j,id:`manager-enable-clear-history-checkbox-${d}`,"aria-label":"Enable clear history functionality"})]})}),s.jsx(mi,{label:"Speakers",id:`wf-${l}-agent-group-manager-speakers-${d}`,children:s.jsxs("div",{className:"modal-body agent-panel",children:[s.jsx("div",{className:"margin-top-10",children:s.jsxs("div",{className:"info",children:["The method for selecting the next speaker. The default is"," ",s.jsx("strong",{className:"italic",children:"Auto"}),". Could be any of the following:",s.jsxs("ul",{children:[s.jsxs("li",{children:[s.jsx("strong",{className:"italic",children:"Auto"}),": the next speaker is selected automatically by LLM."]}),s.jsxs("li",{children:[s.jsx("strong",{className:"italic",children:"Manual"}),": the next speaker is selected manually by user input."]}),s.jsxs("li",{children:[s.jsx("strong",{className:"italic",children:"Default"}),": the transitions to the speakers are explicitly defined in the workflow."]}),s.jsxs("li",{children:[s.jsx("strong",{className:"italic",children:"Random"}),": the next speaker is selected randomly."]}),s.jsxs("li",{children:[s.jsx("strong",{className:"italic",children:"Round Robin"}),": the next speaker is selected in a round robin fashion, i.e., iterating in the same order as provided in agents."]})]})]})}),s.jsx("label",{htmlFor:`manager-speaker-selection-method-${d}`,children:"Speaker Selection Method:"}),s.jsx($s,{options:O,value:L,onChange:T,inputId:`manager-speaker-selection-method-${d}`,"aria-label":"Select speaker selection method"}),s.jsx(ui,{name:"max-retries-for-selecting",label:"Max Retries for selecting a speaker:",value:(null==(n=c.speakers)?void 0:n.maxRetriesForSelecting)??0,onChange:N,min:0,max:100,step:1,onNull:0,setNullOnLower:!0,onLowerLabel:"Unset",labelInfo:"The maximum number of times the speaker selection re-query process will run. If, during speaker selection, multiple agent names or no agent names are returned by the LLM as the next agent, it will be queried again up to the maximum number of times until a single agent is returned or it exhausts the maximum attempts. Applies only to 'auto' speaker selection method.",dataTestId:`manager-max-retries-for-selecting-input-${d}`,"aria-label":"Maximum retries for speaker selection"}),"round_robin"===(null==(i=c.speakers)?void 0:i.selectionMethod)&&s.jsxs("div",{className:"margin-top-10",children:[s.jsx("div",{className:"info",children:"The order in which the speakers will be selected in round robin mode. If not provided, the order will be automatically determined based on the agents in the group."}),s.jsx("div",{className:"ordered-items-list",children:h.map(((e,t)=>{const a=c.initialAgentId===e,n=t>0&&!(c.initialAgentId&&1===t),o=t<h.length-1&&!a,i=n||o;return s.jsxs("div",{className:"ordered-item "+(i?"has-buttons":"no-buttons"),"data-testid":`group-speaker-${t}`,children:[s.jsxs("div",{className:"reorder-buttons",children:[n&&s.jsx("button",{type:"button",title:"Move up",className:"reorder-btn up-btn",onClick:()=>E(e),children:"↑"}),o&&s.jsx("button",{type:"button",title:"Move down",className:"reorder-btn down-btn",onClick:()=>D(e),children:"↓"}),a&&s.jsx("button",{type:"button",className:"reorder-btn no-click",children:s.jsx(v.FaLock,{})})]}),s.jsx("div",{className:"ordered-item-content",children:(r=e,(null==(l=u.find((e=>e.id===r)))?void 0:l.data.label)??r)})]},`group-speaker-${e}`);var r,l}))})]})]})}),z&&s.jsx(mi,{label:"Afterwards",id:`wf-${l}-agent-group-manager-after-work-${d}`,children:s.jsx("div",{className:"modal-body agent-panel",children:s.jsx(ao,{target:c.afterWork,agents:u,onChange:I,isForGroupChat:!0,"aria-label":"After work configuration"})})})]})}));Jr.displayName="WaldiezNodeGroupManagerTabs";const Yr=o.memo((e=>{const{id:t,data:a}=e,{onMultimodalChange:n,onNameChange:i,onDescriptionChange:r,onSystemMessageChange:l,onHumanInputModeChange:d,onMaxConsecutiveAutoReplyChange:c,onAgentDefaultAutoReplyChange:u}=(e=>{const{onDataChange:t,onAgentTypeChange:a}=e;return{onRagChange:o.useCallback((e=>{a(e?"rag_user_proxy":"user_proxy")}),[a]),onMultimodalChange:o.useCallback((e=>{t({isMultimodal:e})}),[t]),onNameChange:o.useCallback((e=>{const a=e.target.value;t({label:a})}),[t]),onDescriptionChange:o.useCallback((e=>{const a=e.target.value;t({description:a})}),[t]),onSystemMessageChange:o.useCallback((e=>{const a=e.target.value;t({systemMessage:a})}),[t]),onHumanInputModeChange:o.useCallback((e=>{if(e){const a=e.value;t({humanInputMode:a})}}),[t]),onMaxConsecutiveAutoReplyChange:o.useCallback((e=>{t({maxConsecutiveAutoReply:e})}),[t]),onAgentDefaultAutoReplyChange:o.useCallback((e=>{const a=e.target.value;t({agentDefaultAutoReply:a})}),[t])}})(e),g=o.useMemo((()=>({ALWAYS:"Always",NEVER:"Never",TERMINATE:"Terminate"})),[]),m=o.useMemo((()=>[{label:"Always",value:"ALWAYS"},{label:"Never",value:"NEVER"},{label:"Terminate",value:"TERMINATE"}]),[]),p=o.useMemo((()=>({label:g[a.humanInputMode],value:a.humanInputMode})),[a.humanInputMode,g]);return s.jsxs("div",{className:"agent-panel agent-basic-panel",children:["assistant"===a.agentType&&s.jsx(Ys,{label:"Multimodal",info:"If checked, the agent will handle uploaded images from the user. NOTE: Make sure you use a compatible LLM model that supports multimodal inputs (e.g. GPT-4o-mini).",checked:a.isMultimodal??!1,onChange:n,id:`agent-multimodal-toggle-${t}`}),s.jsx(xo,{label:"Name:",name:"human-input-name",value:a.label,onChange:i,dataTestId:`agent-name-input-${t}`,"aria-label":"Agent name"}),s.jsx("label",{htmlFor:`agent-description-input-${t}`,children:"Description:"}),s.jsx(yo,{id:`agent-description-input-${t}`,title:"Agent description",rows:2,value:a.description,onChange:r,"data-testid":`agent-description-input-${t}`,"aria-label":"Agent description"}),s.jsx("label",{htmlFor:`agent-system-message-input-${t}`,children:"System Message:"}),s.jsx(yo,{id:`agent-system-message-input-${t}`,title:"System message",rows:2,value:a.systemMessage??"",onChange:l,"data-testid":`agent-system-message-input-${t}`,"aria-label":"System message"}),s.jsx(mo,{label:"Human Input mode:",info:()=>s.jsxs("div",{children:["Whether to ask for human inputs every time a message is received. ",s.jsx("br",{}),"Possible values are: ",s.jsx("br",{}),s.jsxs("ul",{children:[s.jsxs("li",{children:[s.jsx("b",{children:"Always:"}),' the agent prompts for human input every time a message is received. Under this mode, the conversation stops when the human input is "exit", or when is_termination_msg is True and there is no human input.']}),s.jsxs("li",{children:[s.jsx("b",{children:"Terminate:"})," the agent only prompts for human input only when a termination message is received or the number of auto reply reaches the max_consecutive_auto_reply."]}),s.jsxs("li",{children:[s.jsx("b",{children:"Never:"})," the agent will never prompt for human input. Under this mode, the conversation stops when the number of auto reply reaches the max_consecutive_auto_reply or when is_termination_msg is True."]})]})]}),htmlFor:`agent-human-input-mode-${t}`}),s.jsx("label",{htmlFor:`agent-human-input-mode-select-${t}`,className:"hidden",children:"Human Input mode:"}),s.jsx($s,{options:m,value:p,onChange:d,inputId:`agent-human-input-mode-select-${t}`,"aria-label":"Human input mode"}),s.jsx(ui,{name:"max-consecutive-auto-reply",label:"Max consecutive auto reply: ",value:a.maxConsecutiveAutoReply,onChange:c,min:0,max:1001,step:1,setNullOnUpper:!0,setNullOnLower:!1,onLowerLabel:"No auto reply",onUpperLabel:"Unset",labelInfo:"The maximum number of consecutive auto replies (i.e., when no code execution or llm-based reply is generated). Default is None (no limit provided). When set to 0, no auto reply will be generated.",dataTestId:`agent-max-consecutive-auto-reply-input-${t}`,"aria-label":"Maximum consecutive auto replies"}),s.jsx("label",{htmlFor:`agent-default-auto-reply-input-${t}`,children:"Default Auto Reply:"}),s.jsx(yo,{className:"full-width margin-top-5",value:a.agentDefaultAutoReply??"",onChange:u,"data-testid":`agent-default-auto-reply-input-${t}`,"aria-label":"Default auto reply message"}),s.jsx("div",{className:"margin-bottom-10"})]})}));Yr.displayName="WaldiezAgentBasic";const $r=o.memo((e=>{const{id:t,data:a,flowId:n}=e,{agentLib:i,enableAgentLib:r,onEnableAgentLibChange:l,onFileUpload:d,onToolLibChange:c,onMaxRoundChange:u}=(e=>{const{data:t,onDataChange:a}=e,[n,s]=o.useState(t.agentLib.length>0),[i,r]=o.useState(t.agentLib);o.useEffect((()=>{r(t.agentLib)}),[t]);const l=o.useCallback((e=>{a({...e})}),[a]),d=o.useCallback((e=>{"number"==typeof e&&l({maxRound:e})}),[l]),c=o.useCallback((e=>{l({toolLib:e?"default":null})}),[l]),u=o.useCallback((e=>{s(e),l(e?{agentLib:i}:{agentLib:[]})}),[l,i]),g=o.useCallback((e=>{const t=[];if(Array.isArray(e))for(const a of e)if("object"==typeof a&&null!==a){const{name:e,description:n}=a;if("string"==typeof e&&"string"==typeof n){const s=a,o="string"==typeof s.systemMessage?s.systemMessage:"string"==typeof s.system_message?s.system_message:null;o&&t.push({name:e,description:n,systemMessage:o})}}return t}),[]),m=o.useCallback((e=>{if(!e.length)return;const t=e[0],a=new FileReader;a.onload=()=>{try{const e=a.result,t=JSON.parse(e),n=g(t);r(n),l({agentLib:n})}catch(e){}},a.readAsText(t)}),[l,g]);return{agentLib:i,enableAgentLib:n,onEnableAgentLibChange:u,onFileUpload:m,onMaxRoundChange:d,onToolLibChange:c}})(e);return s.jsxs("div",{className:"agent-panel agent-codeExecution-panel margin-top--10",children:[s.jsx(ui,{name:"max-round",label:"Max Round",labelInfo:"The maximum number of conversation rounds to be used in the generated groupchat.",value:a.maxRound,onChange:u,dataTestId:`agent-captain-max-round-${t}`,min:1,max:100,"aria-label":"Maximum rounds"}),s.jsx(Ys,{id:`tool-lib-${t}`,label:"Include tool lib",info:"If enabled, the agents will be equipped with several tools",checked:"default"===a.toolLib,onChange:c,"aria-label":"Include tool library"}),s.jsxs("div",{className:"margin-bottom-10",children:["If selected, you can find the available tools"," ",s.jsx("a",{href:"https://github.com/ag2ai/ag2/tree/main/autogen/agentchat/contrib/captainagent/tools",target:"_blank",rel:"noreferrer nofollow noopener","aria-label":"View available tools on GitHub",children:"here"})]}),s.jsx(Ys,{label:"Include agent lib",info:"If enabled, the captain agent will generate agents from a dedicated agents library",checked:r,onChange:l,id:`agent-captain-toggle-agent-lib-${t}`,"aria-label":"Include agent library"}),s.jsxs("div",{className:"margin-bottom-10",children:["You can find an example of agents library"," ",s.jsx("a",{href:"https://github.com/ag2ai/ag2/blob/main/notebook/agent_library_example.json",target:"_blank",rel:"noreferrer nofollow noopener","aria-label":"View example agent library on GitHub",children:"here"})]}),r&&s.jsxs("div",{className:"agent-lib-container",children:[s.jsx(ho,{flowId:n,allowedFileExtensions:[".json"],onUpload:d,"aria-label":"Upload agent library JSON file"}),i.length>0&&s.jsx("div",{className:"margin-top-10",children:s.jsx(go,{title:`Agent Library (${i.length} entries)`,dataTestId:`agent-lib-${t}`,expanded:!1,fullWidth:!0,"aria-label":"Agent library entries",children:s.jsx("div",{className:"agent-lib-preview",style:{maxHeight:"300px",overflowY:"auto"},children:s.jsx("pre",{children:JSON.stringify(i,null,2)})})})})]})]})}));$r.displayName="WaldiezAgentCaptainTab";const _r=o.memo((e=>{var t,a,n,i,r,l;const{id:d,data:c,tools:u}=e,{codeExecutionValue:g,codeExecutionFunctionOptions:m,onUseCodeExecutionChange:p,onCodeExecutionWorkDirChange:h,onCodeExecutionLastNMessagesChange:f,onCodeExecutionTimeoutChange:y,onCodeExecutionUseDockerChange:b,onExecutionFunctionsChange:v}=(e=>{const{data:t,onDataChange:a,tools:n}=e,s=o.useCallback((e=>{const t=n.find((t=>t.id===e));return(null==t?void 0:t.data.label)??"Unknown Tool"}),[n]),i=o.useMemo((()=>n.map((e=>({label:e.data.label??"Unknown Tool",value:e.id})))),[n]),r=o.useMemo((()=>{var e;return!1===t.codeExecutionConfig?[]:((null==(e=t.codeExecutionConfig)?void 0:e.functions)??[]).map((e=>({label:s(e),value:e})))}),[t.codeExecutionConfig,s]),l=o.useCallback((e=>{const n=!!e&&{...t.codeExecutionConfig};a({codeExecutionConfig:n})}),[t.codeExecutionConfig,a]),d=o.useCallback((e=>{const n=e.target.value;a({codeExecutionConfig:"object"==typeof t.codeExecutionConfig?{...t.codeExecutionConfig,workDir:n}:{workDir:n}})}),[t.codeExecutionConfig,a]),c=o.useCallback((e=>{const n=e??0;a({codeExecutionConfig:"object"==typeof t.codeExecutionConfig?{...t.codeExecutionConfig,lastNMessages:n}:{lastNMessages:n}})}),[t.codeExecutionConfig,a]),u=o.useCallback((e=>{const n=e??0;a({codeExecutionConfig:"object"==typeof t.codeExecutionConfig?{...t.codeExecutionConfig,timeout:n}:{timeout:n}})}),[t.codeExecutionConfig,a]),g=o.useCallback((e=>{a({codeExecutionConfig:"object"==typeof t.codeExecutionConfig?{...t.codeExecutionConfig,useDocker:e}:{useDocker:e}})}),[t.codeExecutionConfig,a]),m=o.useCallback((e=>{if(!e)return;const n=(Array.isArray(e)?e:[e]).map((e=>null==e?void 0:e.value)).filter(Boolean);a({codeExecutionConfig:"object"==typeof t.codeExecutionConfig?{...t.codeExecutionConfig,functions:n}:{functions:n}})}),[t.codeExecutionConfig,a]);return{codeExecutionValue:r,codeExecutionFunctionOptions:i,getToolName:s,onUseCodeExecutionChange:l,onCodeExecutionWorkDirChange:d,onCodeExecutionLastNMessagesChange:c,onCodeExecutionTimeoutChange:u,onCodeExecutionUseDockerChange:g,onExecutionFunctionsChange:m}})(e),x=!1!==c.codeExecutionConfig,C=x&&!1!==c.codeExecutionConfig&&(null==(t=c.codeExecutionConfig)?void 0:t.lastNMessages)&&"auto"!==(null==(a=c.codeExecutionConfig)?void 0:a.lastNMessages)?null==(n=c.codeExecutionConfig)?void 0:n.lastNMessages:0,w=x&&!1!==c.codeExecutionConfig&&!0===(null==(i=c.codeExecutionConfig)?void 0:i.useDocker),k=x&&!w&&u.length>0;return s.jsxs("div",{className:"agent-panel agent-codeExecution-panel",children:[s.jsx(Ys,{label:"Enable Code Execution",info:"Whether the agent is capable of executing code.",checked:x,onChange:p,id:`agent-code-execution-toggle-${d}`,"aria-label":"Enable code execution"}),x&&!1!==c.codeExecutionConfig&&s.jsxs("div",{className:"agent-node-codeExecution-options margin-top-10",children:[s.jsx(xo,{label:"Working directory:",placeholder:"Working directory",className:"margin-top-10",name:"working-directory",value:(null==(r=c.codeExecutionConfig)?void 0:r.workDir)??"",onChange:h,dataTestId:`agent-code-execution-work-dir-${d}`,"aria-label":"Code execution working directory"}),s.jsx(ui,{name:"last-n-messages",label:"Last N messages:",value:C,onChange:f,min:0,max:1e3,step:1,setNullOnLower:!0,forceInt:!0,onLowerLabel:"auto",labelInfo:"Maximum number of messages to use for code execution. If set to auto(0), all messages will be used.",dataTestId:`agent-code-execution-last-n-messages-${d}`,"aria-label":"Number of messages to include for code execution"}),s.jsx(ui,{label:"Timeout:",name:"timeout",value:(null==(l=c.codeExecutionConfig)?void 0:l.timeout)??0,onChange:y,min:0,max:1e3,step:1,onNull:0,forceInt:!0,setNullOnLower:!0,onLowerLabel:"No timeout",labelInfo:"Maximum time in seconds to wait for code execution. If set to 0, no timeout will be used.",dataTestId:`agent-code-execution-timeout-${d}`,"aria-label":"Code execution timeout in seconds"}),s.jsx("div",{className:"margin-top-10 margin-bottom-10 sr-only hidden",children:s.jsx(Ys,{label:"Use Docker",info:"Whether to use Docker for code execution. If enabled, the agent will run code in a Docker container.",checked:w,onChange:b,id:`agent-code-execution-use-docker-${d}`,"aria-label":"Enable Docker for code execution"})}),k&&s.jsx("div",{className:"codeExecution-functions",children:s.jsxs("div",{className:"agent-node-functions",children:[s.jsx("label",{htmlFor:`agent-code-execution-functions-${d}`,children:"Functions:"}),s.jsx("div",{className:"margin-top-10",children:s.jsx($s,{isMulti:!0,options:m,value:g,onChange:v,inputId:`agent-code-execution-functions-${d}`,"aria-label":"Select code execution functions"})})]})})]})]})}));_r.displayName="WaldiezAgentCodeExecution";const el=o.memo((e=>{const{id:t,data:a,darkMode:n,agents:i,edges:r,onDataChange:l}=e,{groupOptions:d,currentGroupManager:c,selectedGroup:u,groupMembers:g,onSelectGroupChange:m,onJoinGroup:p,onLeaveGroup:h,onAfterWorkChange:f}=(e=>{const{id:t,agents:a,data:n,onDataChange:s}=e,i=o.useMemo((()=>a.filter((e=>"group_manager"===e.data.agentType))),[a]),r=o.useMemo((()=>n.parentId?a.filter((e=>e.data.parentId===n.parentId&&e.id!==t)):[]),[a,n.parentId,t]),l=o.useMemo((()=>n.parentId?i.find((e=>e.id===n.parentId)):void 0),[i,n.parentId]),d=o.useMemo((()=>i.map((e=>({label:e.data.label,value:e})))),[i]),[c,u]=o.useState(l);o.useEffect((()=>{u(l)}),[l]);const g=o.useCallback((e=>{u(e?e.value:void 0)}),[]),m=o.useCallback((()=>{s({parentId:null==c?void 0:c.id})}),[c,s]),p=o.useCallback((()=>{s({parentId:void 0})}),[s]),h=o.useCallback((e=>{s({afterWork:e})}),[s]);return{groupOptions:d,currentGroupManager:l,selectedGroup:c,groupMembers:r,onSelectGroupChange:g,onJoinGroup:m,onLeaveGroup:p,onAfterWorkChange:h}})(e),y=o.useMemo((()=>u?{label:u.data.label,value:u}:null),[u]),b=!!c,v=null===u;return s.jsx("div",{className:"agent-panel agent-group-panel",children:s.jsxs(pi,{activeTabIndex:0,children:[s.jsx(mi,{id:`wa-${t}-group-membership`,label:"Membership",children:s.jsxs("div",{style:{padding:"1rem"},"data-testid":`agent-group-panel-${t}`,children:[s.jsx("div",{className:"info margin-bottom-10",children:"Should this agent be part of a group chat?"}),b?s.jsxs("div",{className:"flex space-between current-group-info",children:[s.jsx("div",{className:"agent-panel-group-label","data-testid":`group-label-agent-${t}`,children:c.data.label}),s.jsx("div",{className:"agent-panel-group-actions",children:s.jsx("button",{title:"Leave group",type:"button",className:"agent-panel-group-action",onClick:h,"data-testid":`leave-group-button-agent-${t}`,"aria-label":"Leave current group",children:"Leave group"})})]}):s.jsxs("div",{children:[s.jsx("label",{htmlFor:`agent-select-group-${t}`,children:"Group:"}),s.jsx("div",{className:"margin-top-10"}),s.jsxs("div",{className:"flex space-between",children:[s.jsx($s,{options:d,value:y,onChange:m,inputId:`agent-select-group-${t}`,className:"flex-1 margin-right-10","aria-label":"Select a group to join"}),s.jsx("button",{type:"button",title:"Join group",className:"agent-panel-select-group-action",onClick:p,disabled:v,"data-testid":`join-group-button-agent-${t}`,"aria-label":"Join selected group",children:"Join group"})]})]})]})}),b&&s.jsx(mi,{id:`wa-${t}-group-handoffs`,label:"Handoffs",children:s.jsx(Ao,{agents:i,edges:r,id:t,data:a,onDataChange:l})}),b&&s.jsx(mi,{id:`wa-${t}-group-update-state`,label:"State",children:s.jsx(fi,{data:a,darkMode:n,onDataChange:l})}),b&&s.jsx(mi,{label:"Afterwards",id:`wa-${t}-group-after-work`,children:s.jsx("div",{style:{paddingLeft:"1rem",paddingRight:"1rem"},"data-testid":`after-work-panel-${t}`,children:s.jsx(ao,{target:a.afterWork,agents:g,onChange:f,isForGroupChat:!1,"aria-label":"After work configuration"})})})]})})}));el.displayName="WaldiezAgentGroupMember";const tl=o.memo((e=>{const{id:t,flowId:a,agentConnections:n,data:i,edges:r,onDataChange:l}=e,d=o.useMemo((()=>((e,t)=>{const a=[];return e.nestedChats.length>0&&e.nestedChats[0].messages.length>0?a.push(e.nestedChats[0]):a.push({triggeredBy:[],messages:[],condition:{conditionType:"string_llm",prompt:""},available:{type:"none",value:""}}),t.forEach((e=>{a.length>0&&-1===a[0].messages.findIndex((t=>t.id===e.id))&&a[0].messages.push({id:e.id,isReply:!1})})),structuredClone(a)})(i,r)),[i,r]);o.useEffect((()=>{var e;if(!(null==(e=null==i?void 0:i.nestedChats)?void 0:e.length))return;const t=new Set(i.nestedChats[0].messages.map((e=>e.id))),a=new Set(r.map((e=>e.id))),n=r.filter((e=>!t.has(e.id))),s=i.nestedChats[0].messages.filter((e=>!a.has(e.id)));if(n.length>0||s.length>0){const e=[...i.nestedChats[0].messages.filter((e=>a.has(e.id))),...n.map((e=>({id:e.id,isReply:!1})))],t=[{...i.nestedChats[0],messages:e}];l({nestedChats:t})}}),[i.nestedChats,r,l]);const c=o.useMemo((()=>d.length>0?d[0].messages.length:0),[d]),u=o.useCallback((e=>{const t=n.targets.edges.find((t=>t.id===e));if(!t)return"";const a=n.targets.nodes.find((e=>e.id===t.target));return a?a.data.label:""}),[n.targets.edges,n.targets.nodes]),g=o.useCallback((e=>{const t=[...d],a=t[0].messages[e];t[0].messages[e]=t[0].messages[e-1],t[0].messages[e-1]=a,l({nestedChats:t})}),[d,l]),m=o.useCallback((e=>{const t=[...d],a=t[0].messages[e];t[0].messages[e]=t[0].messages[e+1],t[0].messages[e+1]=a,l({nestedChats:structuredClone(t)})}),[d,l]),p=o.useCallback((e=>{const t=structuredClone(d);t[0].condition=e,l({nestedChats:t})}),[d,l]),h=o.useCallback((e=>{const t=structuredClone(d);t[0].available=e,l({nestedChats:t})}),[d,l]);return s.jsx("div",{className:"agent-panel","data-testid":`agent-group-nested-chat-tabs-${t}`,children:s.jsxs(pi,{activeTabIndex:0,children:[s.jsx(mi,{label:"Queue",id:`wf-${a}-wa-${t}-nested-chats-queue`,children:s.jsx("div",{className:"flex-column margin-10 nested-chat-queue",children:d[0].messages.map(((e,a)=>s.jsxs("div",{className:"flex margin-bottom-10 queue-item","data-testid":`nested-chat-queue-item-${a}`,children:[s.jsxs("div",{className:"margin-right-10 reorder-buttons",children:[a>0&&c>1&&s.jsx("button",{type:"button",title:"Move up",className:"reorder-btn up-btn","data-testid":`move-nested-recipient-up-button-${a}`,onClick:()=>g(a),"aria-label":`Move ${u(e.id)} up`,children:"↑"}),a<c-1&&s.jsx("button",{title:"Move down",type:"button",className:"reorder-btn down-btn","data-testid":`move-nested-recipient-down-button-${a}`,onClick:()=>m(a),"aria-label":`Move ${u(e.id)} down`,children:"↓"})]}),s.jsx("div",{className:"agent-nested-recipient-name",children:u(e.id)})]},`agent-${t}-nestedChat-recipient-${a}`)))})}),s.jsx(mi,{label:"Condition",id:`wf-${a}-wa-${t}-nested-chat-condition`,children:s.jsx(ko,{condition:d[0].condition,onDataChange:p,"aria-label":"Handoff condition settings"})}),s.jsx(mi,{label:"Availability",id:`wf-${a}-wa-${t}-nested-chat-availability`,children:s.jsx(vo,{available:d[0].available,onDataChange:h,"aria-label":"Handoff availability settings"})})]})})}));tl.displayName="WaldiezAgentGroupNestedChatTabs";const al=o.memo((e=>{const{id:t,chat:a,selectOptions:n,selectedRecipient:i,getEdgeLabel:r,onSelectedRecipientChange:l,onSelectedRecipientIsReplyChange:d,onAddNestedChatConnection:c,onRemoveRecipient:u,onNestedChatRecipientMovedUp:g,onNestedChatRecipientMovedDown:m,getMessageLabel:p}=e,h=o.useMemo((()=>i?{label:r(i.id),value:i.id}:null),[i,r]),f=!i||!i.id,y=0===a.messages.length;return s.jsxs("div",{className:"nested-chat-messages","data-testid":`nested-chat-messages-${t}`,children:[s.jsxs("div",{className:"info",children:[s.jsx("b",{children:"Messages:"})," Specifies which nested chat will be triggered. The final message is returned to the main chat. ",s.jsx("br",{}),s.jsx("b",{children:"Agent's Reply:"}),' Indicates the recipient of the trigger message. If selected, it is the second in the order. For example, if "User => Assistant" with the box ticked, the message is sent to the User; otherwise, it is sent to the Assistant.']}),s.jsx("label",{htmlFor:`new-nested-chat-select-recipient-${t}`,className:"nested-chat-messages-label",children:"Messages:"}),s.jsxs("div",{className:"nested-chats-add-message",children:[s.jsxs("div",{className:"nested-chat-recipients margin-right-10",children:[s.jsx("label",{htmlFor:`new-nested-chat-select-recipient-${t}`,className:"hidden",children:"Recipient"}),s.jsx($s,{options:n,onChange:l,value:h,inputId:`new-nested-chat-select-recipient-${t}`,"aria-label":"Select message recipient"})]}),s.jsx(Js,{id:`new-nested-chat-recipient-is-agent-reply-${t}`,label:"Agent's reply",isChecked:(null==i?void 0:i.isReply)??!1,onCheckedChange:d,"data-testid":`new-nested-chat-recipient-is-agent-reply-${t}`}),s.jsx("div",{className:"nested-chat-add-button",children:s.jsx("button",{type:"button",title:"Add",className:"add-nested-chat",disabled:f,onClick:c,"data-testid":`new-nested-chat-add-recipient-${t}`,"aria-label":"Add message to nested chat",children:"Add"})})]}),s.jsx("div",{className:"nested-chats-registered-messages",children:y?s.jsx("div",{className:"nested-chat-registered-message",children:"No messages to include"}):s.jsx("div",{className:"flex-1 messages-list",children:a.messages.map(((e,n)=>s.jsx(nl,{target:e,index:n,messageCount:a.messages.length,getMessageLabel:p,onMoveUp:g,onMoveDown:m,onRemove:u,id:t},`${e.id}-${n}`)))})})]})})),nl=o.memo((({target:e,index:t,messageCount:a,getMessageLabel:n,onMoveUp:o,onMoveDown:i,onRemove:r,id:l})=>{const d=a>1&&0!==t,c=a>1&&t!==a-1;return s.jsxs("div",{className:"nested-chat-registered-message","data-testid":`nested-chat-message-${l}-${t}`,children:[s.jsxs("span",{className:"message-label",children:[n(t),e.isReply&&s.jsx("span",{className:"reply-indicator",children:" (Reply)"})]}),s.jsxs("div",{className:"nested-chat-message-actions",children:[d&&s.jsx("div",{className:"nested-chat-reorder",children:s.jsx("button",{type:"button",title:"Move up",onClick:()=>o(t),"data-testid":`nested-chat-reorder-up-${t}`,"aria-label":`Move message ${t+1} up`,children:"↑"})}),c&&s.jsx("div",{className:"nested-chat-reorder",children:s.jsx("button",{type:"button",title:"Move down",onClick:()=>i(t),"data-testid":`nested-chat-reorder-down-${t}`,"aria-label":`Move message ${t+1} down`,children:"↓"})}),s.jsx("div",{className:"nested-chat-remove",children:s.jsx("button",{type:"button",title:"Remove",onClick:()=>r(t),"data-testid":`remove-nested-chat-recipient-${t}`,"aria-label":`Remove message ${t+1}`,children:"Remove"})})]})]})}));al.displayName="WaldiezAgentNestedChatsMessages",nl.displayName="MessageListItem";const sl=o.memo((e=>{const{id:t,selectOptions:a,selectedTriggers:n,onSelectedTriggersChange:i}=e,r=o.useMemo((()=>n.map((e=>{const t=a.find((t=>t.value===e));return{label:(null==t?void 0:t.label)||"Unknown",value:e}}))),[n,a]);return s.jsxs("div",{className:"nested-chat-triggers margin-bottom--10","data-testid":`nested-chat-triggers-${t}`,children:[s.jsxs("div",{className:"info",children:[s.jsx("b",{children:"Trigged by:"})," The agent triggers a sequence of nested chats when a message is received. If it is the termination message of a selected chat (e.g., max turns is set to 1) the trigger won't be activated."]}),s.jsx("label",{htmlFor:`new-nested-chat-select-trigger-${t}`,className:"nested-chat-triggers-label",children:"Triggered by:"}),s.jsx("div",{className:"nested-chat-select-trigger-view",children:s.jsx("div",{className:"nested-chat-select-trigger",children:s.jsx($s,{options:a,value:r,onChange:i,isMulti:!0,inputId:`new-nested-chat-select-trigger-${t}`,"aria-label":"Select triggers for nested chat"})})})]})}));sl.displayName="WaldiezAgentNestedChatsTriggers";const ol=o.memo((e=>{const{id:t}=e,{chat:a,triggerSelectOptions:n,messageSelectOptions:i,selectedTriggers:r,selectedRecipient:l,onSelectedTriggersChange:d,onSelectedRecipientChange:c,onSelectedRecipientIsReplyChange:u,onAddNestedChatConnection:g,onRemoveRecipient:m,onNestedChatRecipientMovedUp:p,onNestedChatRecipientMovedDown:h,getMessageLabel:f,getEdgeLabel:y}=(e=>{const{data:t,onDataChange:a,agentConnections:n}=e;o.useEffect((()=>{0===t.nestedChats.length&&a({nestedChats:[{messages:[],triggeredBy:[],condition:{conditionType:"string_llm",prompt:""},available:{type:"none",value:""}}]})}),[t.nestedChats,a]);const s=o.useMemo((()=>t.nestedChats.length>0?t.nestedChats[0]:{messages:[],triggeredBy:[],condition:{conditionType:"string_llm",prompt:""},available:{type:"none",value:""}}),[t.nestedChats]),[i,r]=o.useState(null),[l,d]=o.useState(s.triggeredBy),{sources:c,targets:u}=n,g=o.useMemo((()=>[...new Map([...c.nodes,...u.nodes].map((e=>[e.id,e]))).values()]),[c.nodes,u.nodes]),m=o.useMemo((()=>c.edges.concat(u.edges)),[c.edges,u.edges]),p=o.useMemo((()=>g.map((e=>{var t;return{label:null==(t=e.data)?void 0:t.label,value:e.id}}))),[g]),h=o.useMemo((()=>m.map((e=>{var t;return{label:null==(t=e.data)?void 0:t.label,value:e.id}}))),[m]),f=o.useCallback((e=>{var t;const a=m.find((t=>t.id===e));return(null==(t=null==a?void 0:a.data)?void 0:t.label)||"Unknown"}),[m]),y=o.useCallback((e=>e<0||e>=s.messages.length?"Invalid message":f(s.messages[e].id)),[s.messages,f]),b=o.useCallback((()=>{if(!i)return;if(s.messages.some((e=>e.id===i.id&&e.isReply===i.isReply)))return;const e={messages:[...s.messages,{id:i.id,isReply:i.isReply}],triggeredBy:s.triggeredBy,condition:s.condition,available:s.available};a({nestedChats:[e]})}),[i,s,a]),v=o.useCallback((e=>{const t={...s,messages:s.messages.filter(((t,a)=>a!==e))};a({nestedChats:[t]})}),[s,a]),x=o.useCallback((e=>{if(e<=0||e>=s.messages.length)return;const t=[...s.messages],n=t[e];t[e]=t[e-1],t[e-1]=n;const o={...s,messages:t};a({nestedChats:[o]})}),[s,a]),C=o.useCallback((e=>{if(e<0||e>=s.messages.length-1)return;const t=[...s.messages],n=t[e];t[e]=t[e+1],t[e+1]=n;const o={...s,messages:t};a({nestedChats:[o]})}),[s,a]),w=o.useCallback((e=>{d(e?e.map((e=>e.value)):[]);const t={...s,messages:e?s.messages:[],triggeredBy:e?e.map((e=>e.value)):[]};a({nestedChats:[t]})}),[s,a]),k=o.useCallback((e=>{e&&e.value?r((t=>({id:e.value,isReply:(null==t?void 0:t.isReply)||!1}))):r(null)}),[]),j=o.useCallback((e=>{i&&r((t=>({...t,isReply:e})))}),[i]);return{chat:s,triggerSelectOptions:p,messageSelectOptions:h,selectedTriggers:l,selectedRecipient:i,onSelectedTriggersChange:w,onSelectedRecipientChange:k,onSelectedRecipientIsReplyChange:j,onAddNestedChatConnection:b,onRemoveRecipient:v,onNestedChatRecipientMovedUp:x,onNestedChatRecipientMovedDown:C,getMessageLabel:y,getEdgeLabel:f}})(e),b=a.triggeredBy.length>0;return s.jsxs("div",{className:"agent-panel agent-nestedChats-panel margin-top--10","data-testid":`agent-nested-chats-panel-${t}`,children:[s.jsx(sl,{id:t,selectedTriggers:r,onSelectedTriggersChange:d,selectOptions:n}),b&&s.jsxs(s.Fragment,{children:[s.jsx("hr",{className:"nested-chat-separator margin-top--10",style:{width:"100%",opacity:.3},"aria-hidden":"true"}),s.jsx(al,{id:t,chat:a,selectOptions:i,selectedRecipient:l,onSelectedRecipientChange:c,onSelectedRecipientIsReplyChange:u,onAddNestedChatConnection:g,onRemoveRecipient:m,onNestedChatRecipientMovedUp:p,onNestedChatRecipientMovedDown:h,getMessageLabel:f,getEdgeLabel:y})]})]})}));ol.displayName="WaldiezAgentNestedChats";const il=[{label:"Chroma",value:"chroma"},{label:"Qdrant",value:"qdrant"},{label:"Pgvector",value:"pgvector"},{label:"MongoDB",value:"mongodb"}],rl={chroma:"Chroma",pgvector:"Pgvector",mongodb:"MongoDB",qdrant:"Qdrant"},ll={chroma:"all-MiniLM-L6-v2",pgvector:"all-MiniLM-L6-v2",mongodb:"all-MiniLM-L6-v2",qdrant:"BAAI/bge-small-en-v1.5"},dl=()=>s.jsxs("div",{children:["The model for embedding. ",s.jsx("br",{}),"The defaults are: ",s.jsx("br",{}),s.jsx("b",{children:"Chroma:"})," all-MiniLM-L6-v2; ",s.jsx("br",{}),s.jsx("b",{children:"Pgvector:"})," all-MiniLM-L6-v2; ",s.jsx("br",{}),s.jsx("b",{children:"MongoDB:"})," all-MiniLM-L6-v2; ",s.jsx("br",{}),s.jsx("b",{children:"Qdrant:"})," BAAI/bge-small-en-v1.5."]}),cl=o.memo((e=>{const{id:t,data:a}=e,{retrieveConfig:n}=a,{onVectorDbChange:i,onModelChange:r,onQdrantUseMemoryChange:l,onQdrantUseLocalStorageChange:d,onQdrantLocalStoragePathChange:c,onChromaUseLocalStorageChange:u,onChromaLocalStoragePathChange:g,onDbConfigConnectionUrlChange:m}=(e=>{const{data:t,onDataChange:a}=e,n=o.useCallback((e=>{a({...t,retrieveConfig:{...t.retrieveConfig,...e}})}),[t,a]),s=o.useCallback((e=>{n({dbConfig:{...t.retrieveConfig.dbConfig,...e}})}),[t,n]);return{onVectorDbChange:o.useCallback((e=>{e&&n({vectorDb:e.value})}),[n]),onModelChange:o.useCallback((e=>{n({model:e.target.value})}),[n]),onQdrantUseMemoryChange:o.useCallback((e=>{s({useMemory:e,useLocalStorage:!1})}),[s]),onQdrantUseLocalStorageChange:o.useCallback((e=>{s({useMemory:!1,useLocalStorage:e})}),[s]),onQdrantLocalStoragePathChange:o.useCallback((e=>{s({localStoragePath:e.target.value})}),[s]),onChromaUseLocalStorageChange:o.useCallback((e=>{s({useLocalStorage:e})}),[s]),onChromaLocalStoragePathChange:o.useCallback((e=>{s({localStoragePath:e.target.value})}),[s]),onDbConfigConnectionUrlChange:o.useCallback((e=>{s({connectionUrl:e.target.value})}),[s])}})(e),p=o.useMemo((()=>({label:rl[n.vectorDb??"chroma"],value:n.vectorDb??"chroma"})),[n.vectorDb]),h=o.useMemo((()=>n.dbConfig.model??ll[n.vectorDb??"chroma"]),[n.dbConfig.model,n.vectorDb]),f="qdrant"===n.vectorDb,y="chroma"===n.vectorDb,b=f&&n.dbConfig.useMemory,v=n.dbConfig.useLocalStorage,x=!f||f&&!b&&!v;return s.jsxs("div",{className:"flex-column vector-db-config","data-testid":`rag-vector-db-config-${t}`,children:[s.jsx("label",{htmlFor:`rag-vector-db-${t}`,children:"Vector DB:"}),s.jsx($s,{options:il,value:p,onChange:i,inputId:`rag-vector-db-${t}`,"aria-label":"Select vector database type"}),s.jsx(mo,{label:"Embedding Model:",info:dl,htmlFor:`rag-vector-db-model-${t}`}),s.jsx("input",{type:"text",title:"Embedding model",value:h,onChange:r,"data-testid":`rag-vector-db-model-${t}`,id:`rag-vector-db-model-${t}`,"aria-label":"Embedding model name"}),f&&s.jsxs(s.Fragment,{children:[s.jsx(Ys,{label:"Use Memory Storage ",info:"Use memory for the vector db. Default is True.",checked:n.dbConfig.useMemory,id:`rag-vector-db-use-memory-${t}`,onChange:l,"aria-label":"Use memory storage for Qdrant"}),!b&&s.jsxs(s.Fragment,{children:[s.jsx(Ys,{label:"Use Local Storage ",info:'Use local storage for the vector db. Default is: True if "Use Memory Storage" is False.',checked:v,onChange:d,id:`rag-vector-db-use-local-storage-${t}`,"aria-label":"Use local storage for Qdrant"}),v&&s.jsxs(s.Fragment,{children:[s.jsx("label",{htmlFor:`rag-vector-db-local-storage-path-${t}`,children:"Storage Path:"}),s.jsx("input",{id:`rag-vector-db-local-storage-path-${t}`,title:"Storage path",type:"text",value:n.dbConfig.localStoragePath??"",onChange:c,"data-testid":`rag-vector-db-local-storage-path-${t}`,"aria-label":"Qdrant local storage path"})]})]})]}),y&&s.jsxs(s.Fragment,{children:[s.jsx(Ys,{label:"Use Persistent Storage ",info:"Use persistent storage for the vector db (i.e., whether to store data after closing the session). Default is False.",checked:v,id:`rag-vector-db-use-local-storage-${t}`,onChange:u,"aria-label":"Use persistent storage for Chroma"}),v&&s.jsxs(s.Fragment,{children:[s.jsx("label",{htmlFor:`rag-vector-db-chroma-local-storage-path-${t}`,children:"Storage Path:"}),s.jsx("input",{id:`rag-vector-db-chroma-local-storage-path-${t}`,title:"Storage path",type:"text",value:n.dbConfig.localStoragePath??"",onChange:g,"data-testid":`rag-vector-db-local-storage-path-${t}`,"aria-label":"Chroma storage path"})]})]}),x&&s.jsxs("div",{className:"flex-column",children:[s.jsx(mo,{htmlFor:`rag-vector-db-connection-url-${t}`,label:"Connection URL:",info:"The connection URL for the vector db. If using chroma and not provided, a new chroma db server will be spawned. For pgvector and mongodb, this is required."}),s.jsx("input",{type:"text",title:"Connection URL",value:n.dbConfig.connectionUrl??"",onChange:m,"data-testid":`rag-vector-db-connection-url-${t}`,id:`rag-vector-db-connection-url-${t}`,"aria-label":"Vector DB connection URL"})]})]})}));cl.displayName="WaldiezAgentRagUserVectorDb";const ul=[{label:"Code",value:"code"},{label:"QA",value:"qa"},{label:"Default",value:"default"}],gl={code:"Code",qa:"QA",default:"Default"},ml=[".txt",".pdf",".doc",".docx",".rtf",".xlsx",".xls",".csv",".json",".yaml",".yml",".xml",".md",".odt"],pl=o.memo((e=>{const{id:t,flowId:a,uploadsEnabled:n,data:i}=e,{retrieveConfig:r}=i,{onFilesUpload:l,onTaskChange:d,onAddDocsPath:c,onRemoveDocsPath:u,onDocPathChange:g,onCollectionNameChange:m,onNResultsChange:p,onDistanceThresholdChange:h}=(e=>{const{data:t,onDataChange:a,filesToUpload:n,onFilesToUploadChange:s}=e,i=o.useCallback((e=>{a({...t,retrieveConfig:{...t.retrieveConfig,...e}})}),[t,a]);return{onFilesUpload:o.useCallback((e=>{if(!e.length)return;const a=[...t.retrieveConfig.docsPath],o=[...n];for(const t of e){const e=`file:///${t.name}`;a.includes(e)||(a.push(e),o.push(t))}s(o),i({docsPath:a})}),[t.retrieveConfig.docsPath,n,s,i]),onTaskChange:o.useCallback((e=>{e&&i({task:e.value})}),[i]),onAddDocsPath:o.useCallback((e=>{i({docsPath:[...t.retrieveConfig.docsPath,e]})}),[t.retrieveConfig.docsPath,i]),onRemoveDocsPath:o.useCallback((e=>{if(n.length){const t=n.filter((t=>`file:///${t.name}`!==e));s(t.length?t:[])}const a=t.retrieveConfig.docsPath.filter((t=>t!==e));i({docsPath:a})}),[t.retrieveConfig.docsPath,n,s,i]),onDocPathChange:o.useCallback(((e,a)=>{i({docsPath:t.retrieveConfig.docsPath.map((t=>t===e?a:t))})}),[t.retrieveConfig.docsPath,i]),onCollectionNameChange:o.useCallback((e=>{i({collectionName:e.target.value})}),[i]),onNResultsChange:o.useCallback((e=>{try{const t=parseInt(e.target.value,10);i({nResults:isNaN(t)||t<1?null:t})}catch(t){i({nResults:null})}}),[i]),onDistanceThresholdChange:o.useCallback((e=>{try{const t=parseFloat(e.target.value);i({distanceThreshold:isNaN(t)||t<0?null:t})}catch(t){i({distanceThreshold:null})}}),[i])}})(e),f=o.useMemo((()=>({label:gl[r.task],value:i.retrieveConfig.task})),[i.retrieveConfig.task,r.task]);return s.jsxs("div",{className:"rag-retrieve-config-container","data-testid":`rag-retrieve-config-${t}`,children:[s.jsxs("div",{className:"flex-column",children:[s.jsx(mo,{label:"Task:",info:'The task of the retrieve chat. Possible values are "code", "qa" and "default". The system prompt will be different for different tasks. The default value is `default`, which supports both code and qa, and provides source information in the end of the response.',htmlFor:`rag-retrieve-task-input-${t}`}),s.jsx("label",{className:"hidden",htmlFor:`rag-retrieve-task-${t}`,children:"Task"}),s.jsx($s,{options:ul,value:f,onChange:d,inputId:`rag-retrieve-task-${t}`,"aria-label":"Select RAG task type"})]}),s.jsxs("div",{className:"flex-column",children:[n&&s.jsx("div",{className:"margin-top-20",children:s.jsx(ho,{flowId:a,onUpload:l,allowedFileExtensions:ml,multiple:!0,"aria-label":"Upload documents for RAG"})}),s.jsx(gi,{viewLabel:"Docs Paths:",viewLabelInfo:"The paths of the documents for the retrieve chat. It can be a list of directories, files and urls. Default is None, which works only if the collection is already created.",items:r.docsPath,itemsType:"rag-doc",onItemAdded:c,onItemDeleted:u,onItemChange:g,"aria-label":"Document paths"})]}),s.jsxs("div",{className:"flex-column",children:[s.jsx(mo,{label:"Collection Name:",info:"The name of the collection to be used in the vector database. If not provided, a default name `autogen-docs` will be used.",htmlFor:`rag-retrieve-collection-name-${t}`}),s.jsx("input",{type:"text",title:"Collection name",value:r.collectionName??"",onChange:m,"data-testid":`rag-retrieve-collection-name-${t}`,"aria-label":"Collection name",id:`rag-retrieve-collection-name-${t}`})]}),s.jsxs("div",{className:"flex-column",children:[s.jsx(mo,{label:"Number of results:",info:"The number of results to return. Default is None, which means the system will return all the results. Will be ignored if < 1.",htmlFor:`rag-retrieve-n-results-${t}`}),s.jsx("input",{title:"Number of results",type:"number",value:r.nResults??"",onChange:p,"data-testid":`rag-retrieve-n-results-${t}`,"aria-label":"Number of results",id:`rag-retrieve-n-results-${t}`})]}),s.jsxs("div",{className:"flex-column",children:[s.jsx(mo,{htmlFor:`rag-retrieve-distance-threshold-${t}`,label:"Distance Threshold:",info:"The threshold for the distance score, only distance smaller than it will be returned. Will be ignored if < 0. Default is -1."}),s.jsx("input",{title:"Distance threshold",type:"number",value:r.distanceThreshold??-1,onChange:h,"data-testid":`rag-retrieve-distance-threshold-${t}`,"aria-label":"Distance threshold",id:`rag-retrieve-distance-threshold-${t}`})]})]})}));pl.displayName="WaldiezAgentRagUserRetrieveConfig";const hl=[{label:"Multi Lines",value:"multi_lines"},{label:"One Line",value:"one_line"}],fl={multi_lines:"Multi Lines",one_line:"One Line"},yl=o.memo((e=>{const{id:t,data:a}=e,{retrieveConfig:n}=a,{onChunkTokenSizeChange:i,onContextMaxTokensChange:r,onChunkModeChange:l,onMustBreakAtEmptyLineChange:d}=(e=>{const{data:t,onDataChange:a}=e,n=o.useCallback((e=>{a({...t,retrieveConfig:{...t.retrieveConfig,...e}})}),[t,a]);return{onChunkTokenSizeChange:o.useCallback((e=>{try{const t=parseInt(e.target.value,10);if(isNaN(t)||t<1)return;n({chunkTokenSize:t})}catch(t){}}),[n]),onContextMaxTokensChange:o.useCallback((e=>{try{const t=parseInt(e.target.value,10);if(isNaN(t)||t<1)return;n({contextMaxTokens:t})}catch(t){}}),[n]),onChunkModeChange:o.useCallback((e=>{e&&n({chunkMode:e.value})}),[n]),onMustBreakAtEmptyLineChange:o.useCallback((e=>{n({mustBreakAtEmptyLine:e})}),[n])}})(e),c=o.useMemo((()=>({label:fl[n.chunkMode],value:n.chunkMode})),[n.chunkMode]),u="multi_lines"===n.chunkMode;return s.jsxs("div",{className:"text-split-config","data-testid":`rag-text-split-config-${t}`,children:[s.jsxs("div",{className:"flex-column",children:[s.jsx(mo,{label:"Chunk Token Size:",info:"The chunk token size for the retrieve chat. If not provided, a default size `max_tokens * 0.4` will be used.",htmlFor:`rag-chunk-token-size-${t}`}),s.jsx("input",{title:"Chunk token size",type:"number",value:n.chunkTokenSize??"",onChange:i,"data-testid":`rag-chunk-token-size-${t}`,id:`rag-chunk-token-size-${t}`,"aria-label":"Chunk token size"})]}),s.jsxs("div",{className:"flex-column",children:[s.jsx(mo,{label:"Context Max Tokens:",info:"The context max token size for the retrieve chat. If not provided, a default size `max_tokens * 0.8` will be used.",htmlFor:`rag-context-max-tokens-${t}`}),s.jsx("input",{title:"Context max tokens",type:"number",value:n.contextMaxTokens??"",onChange:r,"data-testid":`rag-context-max-tokens-${t}`,id:`rag-context-max-tokens-${t}`,"aria-label":"Context maximum tokens"})]}),s.jsxs("div",{className:"flex-column",children:[s.jsx(mo,{htmlFor:`rag-chunk-mode-${t}`,label:"Chunk Mode:",info:'The chunk mode for the retrieve chat. Possible values are "Multi Lines" and "One Line". If not provided, a default mode "Multi Lines" will be used.'}),s.jsx("label",{className:"hidden",htmlFor:`rag-select-chunk-mode-${t}`,children:"Chunk Mode"}),s.jsx($s,{options:hl,value:c,onChange:l,inputId:`rag-select-chunk-mode-${t}`,"aria-label":"Select chunk mode"})]}),u&&s.jsx("div",{className:"flex-column",children:s.jsx(Ys,{label:"Must Break at Empty Line ",info:'Chunk will only break at empty line if True. Default is True. If chunk_mode is "one_line", this parameter will be ignored.',id:`rag-must-break-at-empty-line-${t}`,checked:n.mustBreakAtEmptyLine,onChange:d,"aria-label":"Must break at empty line"})})]})}));yl.displayName="WaldiezAgentRagUserTextSplit";const bl=o.memo((e=>{const{id:t,data:a}=e,{retrieveConfig:n}=a,{onCustomizedPromptChange:i,onCustomizedAnswerPrefixChange:r,onUpdateContextChange:l,onGetOrCreateChange:d,onNewDocsChange:c,onOverwriteChange:u,onRecursiveChange:g}=(e=>{const{data:t,onDataChange:a}=e,n=o.useCallback((e=>{a({...t,retrieveConfig:{...t.retrieveConfig,...e}})}),[t,a]);return{onCustomizedPromptChange:o.useCallback((e=>{n({customizedPrompt:e.target.value})}),[n]),onCustomizedAnswerPrefixChange:o.useCallback((e=>{n({customizedAnswerPrefix:e.target.value})}),[n]),onUpdateContextChange:o.useCallback((e=>{n({updateContext:e})}),[n]),onGetOrCreateChange:o.useCallback((e=>{n({getOrCreate:e})}),[n]),onNewDocsChange:o.useCallback((e=>{n({newDocs:e})}),[n]),onOverwriteChange:o.useCallback((e=>{n({overwrite:e})}),[n]),onRecursiveChange:o.useCallback((e=>{n({recursive:e})}),[n])}})(e);return s.jsxs("div",{className:"rag-advanced-settings","data-testid":`rag-advanced-settings-${t}`,children:[s.jsxs("div",{className:"flex-column",children:[s.jsx(mo,{label:"Customized Prompt:",info:"The customized prompt for the retrieve chat. Default is None.",htmlFor:`rag-customized-prompt-${t}`}),s.jsx(yo,{title:"Customized prompt",rows:2,value:n.customizedPrompt??"",onChange:i,"data-testid":`rag-customized-prompt-${t}`,id:`rag-customized-prompt-${t}`,"aria-label":"Customized prompt for RAG"})]}),s.jsxs("div",{className:"flex-column",children:[s.jsx(mo,{label:"Customized Answer Prefix:",info:'The customized answer prefix for the retrieve chat. Default is "".If not "" and the customized_answer_prefix is not in the answer, `Update Context` will be triggered.',htmlFor:`rag-customized-answer-prefix-${t}`}),s.jsx("input",{type:"text",title:"Customized answer prefix",value:n.customizedAnswerPrefix??"",onChange:r,"data-testid":`rag-customized-answer-prefix-${t}`,id:`rag-customized-answer-prefix-${t}`,"aria-label":"Customized answer prefix"})]}),s.jsx("div",{className:"flex-column",children:s.jsx(Ys,{label:"Update Context ",info:"If False, will not apply `Update Context` for interactive retrieval. Default is True.",checked:n.updateContext,onChange:l,id:`rag-update-context-${t}`,"aria-label":"Update context for interactive retrieval"})}),s.jsx("div",{className:"flex-column",children:s.jsx(Ys,{label:"Get or Create ",info:"Whether to get the collection if it exists. Default is True.",checked:n.getOrCreate,id:`rag-get-or-create-${t}`,onChange:d,"aria-label":"Get or create collection"})}),s.jsx("div",{className:"flex-column",children:s.jsx(Ys,{label:"New Docs ",info:"When True, only adds new documents to the collection; when False, updates existing documents and adds new ones. The default value is True. Document id is used to determine if a document is new or existing. By default, the id is the hash value of the content.",checked:n.newDocs,onChange:c,id:`rag-new-docs-${t}`,"aria-label":"Only add new documents"})}),s.jsx("div",{className:"flex-column",children:s.jsx(Ys,{label:"Overwrite ",info:"Whether to overwrite the collection if it exists. Default is False. Case 1. if the collection does not exist, create the collection. Case 2. the collection exists, if overwrite is True, it will overwrite the collection. Case 3. the collection exists and overwrite is False, if get_or_create is True, it will get the collection, otherwise it raise a ValueError.",checked:n.overwrite,onChange:u,id:`rag-overwrite-${t}`,"aria-label":"Overwrite existing collection"})}),s.jsx("div",{className:"flex-column",children:s.jsx(Ys,{label:"Recursive ",info:"Whether to search documents recursively in the docs_path. Default is True.",checked:n.recursive,onChange:g,id:`rag-recursive-${t}`,"aria-label":"Search documents recursively"})})]})}));bl.displayName="WaldiezAgentRagUserAdvanced";const vl=o.memo((e=>{const{flowId:t,data:a,isDarkMode:n}=e,{retrieveConfig:i}=a,{onUseCustomEmbeddingChange:r,onEmbeddingFunctionChange:l,onUseCustomTokenCountChange:d,onCustomTokenCountFunctionChange:c,onUseCustomTextSplitChange:u,onCustomTextSplitFunctionChange:g}=(e=>{const{data:t,onDataChange:a}=e,n=o.useCallback((e=>{a({...t,retrieveConfig:{...t.retrieveConfig,...e}})}),[t,a]);return{onUseCustomEmbeddingChange:o.useCallback((e=>{n({useCustomEmbedding:e})}),[n]),onEmbeddingFunctionChange:o.useCallback((e=>{void 0!==e&&n({embeddingFunction:e})}),[n]),onUseCustomTokenCountChange:o.useCallback((e=>{n({useCustomTokenCount:e})}),[n]),onCustomTokenCountFunctionChange:o.useCallback((e=>{void 0!==e&&n({customTokenCountFunction:e})}),[n]),onUseCustomTextSplitChange:o.useCallback((e=>{n({useCustomTextSplit:e})}),[n]),onCustomTextSplitFunctionChange:o.useCallback((e=>{void 0!==e&&n({customTextSplitFunction:e})}),[n])}})(e),m=o.useMemo((()=>i.embeddingFunction??'"""Custom embedding function."""\n# provide the function to embed the input text\n# complete the `custom_embedding_function` below.\n# Do not change the name of the function.\n# See https://docs.trychroma.com/integrations for more information and examples.\n# examples:\n# def custom_embedding_function():\n#    # type: () -> callable\n#   import chromadb.utils.embedding_functions as embedding_functions\n#   huggingface_ef = embedding_functions.HuggingFaceEmbeddingFunction(\n#        api_key="YOUR_API_KEY",\n#        model_name="sentence-transformers/all-MiniLM-L6-v2"\n#   )\n#   return huggingface_ef\n#\n# def custom_embedding_function():\n#    # type: () -> callable\n#    import chromadb.utils.embedding_functions as embedding_functions\n#    openai_ef = embedding_functions.OpenAIEmbeddingFunction(\n#       api_key="YOUR_API_KEY",\n#       model_name="text-embedding-3-small"\n#    )\n#    return openai_ef\n#\ndef custom_embedding_function():\n    # type: () -> callable\n    """Complete the custom embedding function."""\n    ...\n'),[i.embeddingFunction]),p=o.useMemo((()=>i.customTokenCountFunction??'"""Custom function to count the number of tokens in a string.\n\nThe function should take (text:str, model:str) as input and return the\ntoken_count(int). the retrieve_config["model"] will be passed in the function.\nDefault is autogen.token_count_utils.count_token that uses tiktoken, which may\nnot be accurate for non-OpenAI models.\n"""\n# provide the function to count the number of tokens in a string.\n# complete the `custom_token_count_function` below. Do not change the name or the arguments of the function.\n# only complete the function body and the docstring and return the token count.\n\n# example:\n# def custom_token_count_function(text, model):\n#    # type: (Union[str, List, Dict], str) -> int\n#    return len(text.split())\n#\ndef custom_token_count_function(text, model):\n    """Complete the custom token count function."""\n    ...\n'),[i.customTokenCountFunction]),h=o.useMemo((()=>i.customTextSplitFunction??'"""Custom text split function.\n\nA custom function to split a string into a list of strings. The default function is\n\'autogen.retrieve_utils.split_text_to_chunks\'.\n"""\n# provide the function to split the text into chunks.\n# complete the `custom_text_split_function` below. Do not change the name or the arguments of the function.\n# only complete the function body and the docstring and return the list of strings.\n# example:\n# def custom_text_split_function(\n#    text: str,\n#    max_tokens: int = 4000,\n#    chunk_mode: str = "multi_lines",\n#    must_break_at_empty_line: bool = True,\n#    overlap: int = 0,  # number of overlapping lines\n# ) -> list[str]:\n#    return text.split("\\n")\n#\ndef custom_text_split_function(\n    text,  # type: str\n    max_tokens,  # type: int\n    chunk_mode,  # type: str (multi_lines or one_line)\n    must_break_at_empty_line,  # type: bool\n    overlap,  # type: int # number of overlapping lines\n):\n    # type: (...) -> list[str]\n    """Complete the custom text split function."""\n    ...\n'),[i.customTextSplitFunction]),f=i.useCustomEmbedding??!1,y=i.useCustomTokenCount??!1,b=i.useCustomTextSplit??!1,v={marginTop:-20,marginBottom:-10};return s.jsxs("div",{className:"waldiez-agent-rag-user-custom-functions","data-testid":`rag-custom-functions-${t}`,children:[s.jsx(go,{title:"Embedding Function",dataTestId:`${t}-rag-use-custom-embedding`,"aria-label":"Embedding function settings",children:s.jsxs("div",{className:"flex-column",style:v,children:[s.jsx("div",{className:"info",children:s.jsx("div",{className:"info-tooltip",children:"If selected, the agent will use a custom embedding function. Default is False."})}),s.jsx(Js,{id:`${t}-rag-use-custom-embedding-checkbox`,label:"Use Custom Embedding Function",isChecked:f,onCheckedChange:r,"data-testid":`${t}-rag-use-custom-embedding-checkbox`}),f&&s.jsxs(s.Fragment,{children:[s.jsx("label",{htmlFor:`${t}-embedding-function-editor`,children:"Embedding Function:"}),s.jsx("div",{className:"margin-top-10",children:s.jsx(fo,{darkMode:n,value:m,onChange:l,"aria-label":"Custom embedding function code editor"})})]})]})}),s.jsx(go,{title:"Token Count",dataTestId:`${t}-rag-use-custom-tokenCount`,"aria-label":"Token count function settings",children:s.jsxs("div",{className:"flex-column",style:v,children:[s.jsx("div",{className:"info",children:s.jsx("div",{className:"info-tooltip",children:"If selected, the agent will use a custom token count function. Default is False."})}),s.jsx(Js,{id:`${t}-rag-use-custom-tokenCount-checkbox`,label:"Use Custom Token Count Function",isChecked:y,onCheckedChange:d,"data-testid":`${t}-rag-use-custom-tokenCount-checkbox`}),y&&s.jsxs(s.Fragment,{children:[s.jsx("label",{htmlFor:`${t}-token-count-function-editor`,children:"Custom Token Count Function:"}),s.jsx("div",{className:"margin-top-10",children:s.jsx(fo,{darkMode:n,value:p,onChange:c,"aria-label":"Custom token count function code editor"})})]})]})}),s.jsx(go,{title:"Text Split",dataTestId:`${t}-rag-use-custom-textSplit`,"aria-label":"Text split function settings",children:s.jsxs("div",{className:"flex-column",style:v,children:[s.jsx("div",{className:"info",children:s.jsx("div",{className:"info-tooltip",children:"If selected, the agent will use a custom text split function. Default is False."})}),s.jsx(Js,{id:`${t}-rag-use-custom-textSplit-checkbox`,label:"Use Custom Text Split Function",isChecked:b,onCheckedChange:u,"data-testid":`${t}-rag-use-custom-textSplit-checkbox`}),b&&s.jsxs(s.Fragment,{children:[s.jsx("label",{htmlFor:`${t}-text-split-function-editor`,children:"Custom Text Split Function:"}),s.jsx("div",{className:"margin-top-10",children:s.jsx(fo,{darkMode:n,value:h,onChange:g,"aria-label":"Custom text split function code editor"})})]})]})})]})}));vl.displayName="WaldiezAgentRagUserCustomFunctions";const xl=o.memo((e=>{const{id:t,data:a,models:n,flowId:i,isDarkMode:r,isModalOpen:l,onDataChange:d,filesToUpload:c,onFilesToUploadChange:u,uploadsEnabled:g}=e,[m,p]=o.useState(0);return o.useEffect((()=>{p(0)}),[l]),s.jsx("div",{className:"agent-panel agent-ragUser-panel margin-bottom-10","data-testid":`agent-rag-user-panel-${t}`,children:s.jsxs(pi,{activeTabIndex:m,children:[s.jsx(mi,{label:"Model",id:`wf-${i}-wa-${t}-models`,children:s.jsx("div",{className:"modal-tab-body",children:s.jsx(Xr,{id:t,data:a,models:n,onDataChange:d})})}),s.jsx(mi,{label:"Retrieve Config",id:`wf-${i}-wa-${t}-rag-retrieveConfig`,children:s.jsx(pl,{id:t,flowId:i,data:a,onDataChange:d,uploadsEnabled:g,filesToUpload:c,onFilesToUploadChange:u})}),s.jsx(mi,{label:"Text splitting",id:`wf-${i}-wa-${t}-rag-textSplit`,children:s.jsx(yl,{id:t,data:a,onDataChange:d})}),s.jsx(mi,{label:"Vector DB Config",id:`wf-${i}-wa-${t}-rag-vectorDb`,children:s.jsx(cl,{id:t,data:a,onDataChange:d})}),s.jsx(mi,{label:"Custom Functions",id:`wf-${i}-wa-${t}-rag-customFunctions`,children:s.jsx(vl,{id:t,flowId:i,data:a,isDarkMode:r,onDataChange:d})}),s.jsx(mi,{label:"Advanced",id:`wf-${i}-wa-${t}-rag-advanced`,children:s.jsx(bl,{id:t,data:a,onDataChange:d})})]})})}));xl.displayName="WaldiezAgentRagUserTabs";const Cl=o.memo((e=>{const{id:t,data:a}=e,{reasoningMethodOptions:n,reasoningMethodValue:i,answerApproachOptions:r,answerApproachValue:l,isBeamSearch:d,isSimulationBasedMethod:c,onVerboseChange:u,onReasoningMethodChange:g,onMaxDepthChange:m,onForestSizeChange:p,onRatingScaleChange:h,onBeamSizeChange:f,onAnswerApproachChange:y,onNSimChange:b,onExplorationConstantChange:v}=(e=>{const{data:t,onDataChange:a}=e,n=o.useMemo((()=>[{value:"beam_search",label:"Beam Search"},{value:"mcts",label:"Monte Carlo Tree Search"},{value:"lats",label:"Language Agent Tree Search"},{value:"dfs",label:"Depth First Search"}]),[]),s=o.useMemo((()=>{var e;return{value:t.reasonConfig.method,label:(null==(e=n.find((e=>e.value===t.reasonConfig.method)))?void 0:e.label)||"Beam Search"}}),[t.reasonConfig.method,n]),i=o.useMemo((()=>[{value:"pool",label:"Pool"},{value:"best",label:"Best"}]),[]),r=o.useMemo((()=>{var e;return{value:t.reasonConfig.answerApproach,label:(null==(e=i.find((e=>e.value===t.reasonConfig.answerApproach)))?void 0:e.label)||"Pool"}}),[t.reasonConfig.answerApproach,i]),l=o.useMemo((()=>["mcts","lats"].includes(t.reasonConfig.method)),[t.reasonConfig.method]),d=o.useMemo((()=>"beam_search"===t.reasonConfig.method),[t.reasonConfig.method]),c=o.useCallback((e=>{a({...e})}),[a]),u=o.useCallback((e=>{c({verbose:e})}),[c]),g=o.useCallback((e=>{e&&c({reasonConfig:{...t.reasonConfig,answerApproach:e.value}})}),[c,t.reasonConfig]),m=o.useCallback((e=>{null!==e&&c({reasonConfig:{...t.reasonConfig,forestSize:e}})}),[c,t.reasonConfig]),p=o.useCallback((e=>{e&&c({reasonConfig:{...t.reasonConfig,method:e.value}})}),[c,t.reasonConfig]),h=o.useCallback((e=>{null!==e&&c({reasonConfig:{...t.reasonConfig,maxDepth:e}})}),[c,t.reasonConfig]),f=o.useCallback((e=>{null!==e&&c({reasonConfig:{...t.reasonConfig,ratingScale:e}})}),[c,t.reasonConfig]),y=o.useCallback((e=>{null!==e&&c({reasonConfig:{...t.reasonConfig,beamSize:e}})}),[c,t.reasonConfig]),b=o.useCallback((e=>{null!==e&&c({reasonConfig:{...t.reasonConfig,nsim:e}})}),[c,t.reasonConfig]),v=o.useCallback((e=>{null!==e&&c({reasonConfig:{...t.reasonConfig,explorationConstant:e}})}),[c,t.reasonConfig]);return{reasoningMethodOptions:n,answerApproachOptions:i,isSimulationBasedMethod:l,isBeamSearch:d,reasoningMethodValue:s,answerApproachValue:r,onVerboseChange:u,onAnswerApproachChange:g,onForestSizeChange:m,onReasoningMethodChange:p,onMaxDepthChange:h,onRatingScaleChange:f,onBeamSizeChange:y,onNSimChange:b,onExplorationConstantChange:v}})(e);return s.jsxs("div",{className:"agent-panel agent-codeExecution-panel margin-top--10",children:[s.jsx(Ys,{label:"Verbose",info:"When enabled, the agent will provide additional information about the reasoning process.",checked:!0===a.verbose,onChange:u,id:`agent-reasoning-verbose-toggle-${t}`,"aria-label":"Enable verbose reasoning output"}),s.jsx("label",{className:"agent-panel-label",htmlFor:`agent-reasoning-method-${t}`,children:"Reasoning Method:"}),s.jsx($s,{options:n,value:i,onChange:g,inputId:`agent-reasoning-method-${t}`,"aria-label":"Select reasoning method"}),s.jsx(ui,{label:"Max Depth:",name:"max-depth",value:a.reasonConfig.maxDepth,onChange:m,min:1,max:10,dataTestId:`agent-reasoning-max-depth-${t}`,"aria-label":"Maximum depth for reasoning"}),s.jsx(ui,{label:"Forest Size:",name:"forest-size",value:a.reasonConfig.forestSize,onChange:p,min:1,max:10,dataTestId:`agent-reasoning-forest-size-${t}`,"aria-label":"Forest size for reasoning"}),s.jsx(ui,{label:"Rating Scale:",name:"rating-scale",value:a.reasonConfig.ratingScale,onChange:h,min:1,max:10,dataTestId:`agent-reasoning-rating-scale-${t}`,"aria-label":"Rating scale for reasoning"}),d&&s.jsxs(s.Fragment,{children:[s.jsx(ui,{name:"beam-size",label:"Beam Size:",value:a.reasonConfig.beamSize,onChange:f,min:1,max:10,dataTestId:`agent-reasoning-beam-size-${t}`,"aria-label":"Beam size for beam search"}),s.jsx("label",{className:"agent-panel-label",htmlFor:`agent-reasoning-answer-approach-${t}`,children:"Answer Approach:"}),s.jsx($s,{options:r,value:l,onChange:y,inputId:`agent-reasoning-answer-approach-${t}`,"aria-label":"Select answer approach"})]}),c&&s.jsxs(s.Fragment,{children:[s.jsx(ui,{name:"number-of-simulations",label:"Number of Simulations:",value:a.reasonConfig.nsim,onChange:b,min:1,max:10,dataTestId:`agent-reasoning-nsim-${t}`,"aria-label":"Number of simulations for MCTS/LATS"}),s.jsx(ui,{label:"Exploration Constant:",name:"exploration-constant",value:a.reasonConfig.explorationConstant,onChange:v,min:0,max:10,step:.01,dataTestId:`agent-reasoning-exploration-constant-${t}`,"aria-label":"Exploration constant for MCTS/LATS"})]})]})}));Cl.displayName="WaldiezAgentReasoning";const wl=[{label:"Keyword is found",value:"found"},{label:"Keyword is the last word",value:"ending"},{label:"Keyword is the first word",value:"starting"},{label:"Exact match",value:"exact"}],kl=[{label:"None",value:"none"},{label:"Keyword",value:"keyword"},{label:"Method",value:"method"}],jl=o.memo((e=>{var t;const{id:a}=e,{data:n,isDarkMode:i,terminationCriterionOptions:r,terminationTypeOptions:l,defaultTerminationMethodContent:d,onTerminationTypeChange:c,onTerminationMethodChange:u,onTerminationCriterionChange:g,onAddTerminationKeyword:m,onDeleteTerminationKeyword:p,onTerminationKeywordChange:h}=(e=>{const{data:t,onDataChange:a}=e,{isDark:n}=ga(),s=o.useMemo((()=>t.termination.methodContent&&t.termination.methodContent.length>1?t.termination.methodContent:'"""Custom termination message function."""\n# provide the function to check if the message is a termination message\n# complete the `is_termination_message` below. Do not change the name or the arguments of the function.\n# only complete the function body and the docstring and return True if the message is a termination message, False otherwise.\n# example:\n# def is_termination_message(message):\n#    # type: (dict[str, any]) -> bool\n#    return message.get("content", "").lower() == "terminate"\n#\ndef is_termination_message(message):\n    """Complete the termination message function"""\n    ...\n'),[t.termination.methodContent]),i=o.useCallback((e=>{if(!e)return;const n=e.value;a({termination:{...t.termination,keywords:"keyword"===n?t.termination.keywords:[],methodContent:"method"===n?s:"",criterion:"keyword"===n?t.termination.criterion:"found",type:n}})}),[t.termination,a,s]),r=o.useCallback((e=>{e&&a({termination:{...t.termination,methodContent:e}})}),[t.termination,a]),l=o.useCallback((e=>{if(!e)return;const n=e.value;a({termination:{...t.termination,criterion:n}})}),[t.termination,a]),d=o.useCallback((e=>{a({termination:{...t.termination,keywords:[...t.termination.keywords,e]}})}),[t.termination,a]),c=o.useCallback((e=>{a({termination:{...t.termination,keywords:t.termination.keywords.filter((t=>t!==e))}})}),[t.termination,a]),u=o.useCallback(((e,n)=>{a({termination:{...t.termination,keywords:t.termination.keywords.map((t=>t===e?n:t))}})}),[t.termination,a]);return{data:t,terminationCriterionOptions:wl,terminationTypeOptions:kl,defaultTerminationMethodContent:s,isDarkMode:n,onTerminationTypeChange:i,onTerminationMethodChange:r,onTerminationCriterionChange:l,onAddTerminationKeyword:d,onDeleteTerminationKeyword:c,onTerminationKeywordChange:u}})(e),f=o.useMemo((()=>{var e,t;return{label:(null==(e=l.find((e=>e.value===n.termination.type)))?void 0:e.label)??"None",value:(null==(t=n.termination)?void 0:t.type)??"none"}}),[n.termination.type,l]),y=o.useMemo((()=>{const e=r.find((e=>e.value===n.termination.criterion));if(e)return{label:e.label,value:e.value}}),[n.termination.criterion,r]),b=n.termination&&"method"===n.termination.type,v=n.termination&&"keyword"===n.termination.type;return s.jsxs("div",{className:"agent-panel agent-termination-panel",children:[s.jsx("div",{className:"info",children:"After receiving each message, the agent will send a reply to the sender unless the termination condition is met. A termination condition can be a keyword or a custom method."}),s.jsx("label",{htmlFor:`termination-type-${a}`,children:"Termination Type:"}),s.jsx("div",{className:"margin-top-10"}),s.jsx($s,{options:l,value:f,onChange:c,inputId:`termination-type-${a}`,"aria-label":"Select termination type"}),b&&s.jsxs(s.Fragment,{children:[s.jsx("label",{htmlFor:`termination-method-editor-${a}`,children:"Termination Method:"}),s.jsx("div",{className:"margin-top-10"}),s.jsx(fo,{"data-testid":`termination-method-editor-${a}`,darkMode:i,value:d,onChange:u,"aria-label":"Edit termination method code"})]}),v&&s.jsxs("div",{className:"margin-top-10",children:[s.jsx("label",{htmlFor:`termination-criterion-${a}`,children:"Termination Criterion:"}),s.jsx("div",{className:"margin-top-10"}),s.jsx($s,{options:r,value:y,onChange:g,inputId:`termination-criterion-${a}`,"aria-label":"Select termination criterion"}),s.jsx(gi,{viewLabel:"Termination Keywords:",viewLabelInfo:"List of keywords to check for termination.",items:(null==(t=n.termination)?void 0:t.keywords)??[],itemsType:"termination-keyword",onItemAdded:m,onItemDeleted:p,onItemChange:h,"aria-label":"Termination keywords list"})]})]})}));jl.displayName="WaldiezAgentTermination";const Al=o.memo((e=>{const{id:t,data:a,tools:n,skipExecutor:i}=e,{toolOptions:r,agentOptions:l,selectedTool:d,selectedTools:c,selectedExecutor:u,getToolName:g,getAgentName:m,onSelectedToolChange:p,onSelectedToolsChange:h,onSelectedExecutorChange:f,onAddTool:y,onRemoveTool:b}=(e=>{const{id:t,data:a,tools:n,agents:s,onDataChange:i}=e,r=us((e=>e.updateAgentData)),[l,d]=o.useState(null),[c,u]=o.useState(null);o.useEffect((()=>{const e=n.map((e=>e.id)),s=a.tools.filter((t=>e.includes(t.id)));s.length!==a.tools.length&&r(t,{tools:s})}),[n,a.tools,r,t]);const g=o.useMemo((()=>a.tools.map((e=>{const t=n.find((t=>t.id===e.id));return t?{label:t.data.label,value:t}:null}))),[a.tools,n]),m=o.useCallback((e=>{e&&0!==e.length?i({tools:e.filter((e=>null!==e)).map((e=>({id:e.value.id,executorId:t})))}):i({tools:[]})}),[i,t]),p=o.useMemo((()=>n.filter((e=>"shared"!==e.data.toolType)).map((e=>({label:e.data.label??"Unknown tool",value:e})))),[n]),h=o.useMemo((()=>s.map((e=>({label:e.data.label??"Unknown Agent",value:e})))),[s]),f=o.useCallback((e=>{const t=n.find((t=>t.id===e.id));return t?t.data.label:"Unknown tool"}),[n]),y=o.useCallback((e=>{const t=s.find((t=>t.id===e.executorId));return t?t.data.label:"Unknown Agent"}),[s]),b=o.useCallback((()=>{if(!l||!c)return;const e=l.value,t=c.value;if(!a.tools.find((a=>a.executorId===t.id&&a.id===e.id))){const n={id:e.id,executorId:t.id},s=[...a.tools,n];i({tools:s}),d(null),u(null)}}),[l,c,a.tools,i]),v=o.useCallback((e=>{const t=a.tools.filter(((t,a)=>a!==e));i({tools:t})}),[a.tools,i]);return{toolOptions:p,agentOptions:h,selectedTool:l,selectedTools:g,selectedExecutor:c,getToolName:f,getAgentName:y,onSelectedToolChange:d,onSelectedToolsChange:m,onSelectedExecutorChange:u,onAddTool:b,onRemoveTool:v}})(e);return 0===n.length?s.jsx("div",{className:"agent-panel agent-tools-panel margin-bottom-10",children:s.jsx("div",{className:"margin-top-10 margin-left-10",children:"No tools found in the workspace"})}):!0===i?s.jsx("div",{className:"agent-panel agent-tools-panel margin-bottom-10",children:s.jsxs("div",{className:"agent-panel-select-tools",children:[s.jsx("label",{htmlFor:`select-agent-tools-${t}`,children:"Tools:"}),s.jsx($s,{options:r,onChange:h,value:c,isMulti:!0,isClearable:!0,inputId:`select-agent-tool-${t}`,"aria-label":"Select tools"})]})}):s.jsx("div",{className:"agent-panel agent-tools-panel margin-bottom-10",children:s.jsxs("div",{children:[s.jsxs("div",{className:"agent-panel-add-tool",children:[s.jsx("label",{htmlFor:`select-agent-tool-${t}`,children:"Tool:"}),s.jsx($s,{options:r,onChange:p,value:d,inputId:`select-agent-tool-${t}`,"aria-label":"Select tool"}),s.jsx("label",{htmlFor:`select-agent-tool-executor-${t}`,children:"Executor:"}),s.jsx($s,{options:l,onChange:f,value:u,inputId:`select-agent-tool-executor-${t}`,"aria-label":"Select executor agent"}),s.jsx("button",{type:"button",title:"Add tool",disabled:!d||!u,onClick:y,"data-testid":`add-agent-tool-${t}`,"aria-label":"Add tool",children:"Add"})]}),a.tools.length>0&&s.jsxs("div",{className:"agent-panel-current-tools margin-top-10",children:[s.jsx("div",{className:"agent-panel-current-tools-heading",children:"Current tools:"}),a.tools.map(((e,a)=>s.jsx("div",{className:"agent-panel-current-tool",children:s.jsxs("div",{className:"agent-panel-current-tool-entry",children:[s.jsxs("div",{className:"tool-item",children:["Tool:"," ",s.jsx("div",{className:"tool-name","data-testid":`tool-name-${t}-${a}`,children:g(e)})]}),s.jsxs("div",{className:"agent-item",children:["Executor:"," ",s.jsx("div",{className:"agent-name","data-testid":`agent-name-${t}-${a}`,children:m(e)})]}),s.jsx("button",{type:"button",title:"Remove tool",onClick:()=>b(a),"data-testid":`remove-agent-tool-${t}-${a}`,"aria-label":`Remove ${g(e)}`,children:"Remove"})]})},`tool-${t}-${e.id}-${e.executorId}`)))]})]})})}));Al.displayName="WaldiezAgentTools";const Nl=o.memo((e=>{const{id:t,flowId:a,data:n,tools:i,showNestedChatsTab:r,onDataChange:l,agentConnections:d}=e,c=o.useCallback((e=>{l({label:e.target.value})}),[l]),u=o.useCallback((e=>{l({maxConsecutiveAutoReply:e})}),[l]),g=o.useCallback((e=>{l({agentDefaultAutoReply:e.target.value})}),[l]);return s.jsx("div",{className:"agent-panel agent-user-panel margin-bottom-10","data-testid":`agent-user-panel-${t}`,children:s.jsxs(pi,{children:[s.jsx(mi,{label:"User",id:`wf-${a}-wa-${t}-user`,children:s.jsxs("div",{className:"modal-tab-body",children:[s.jsx(xo,{label:"Name:",name:"agent-name",value:n.label,onChange:c,dataTestId:`agent-name-input-${t}`,"aria-label":"Agent name",className:"margin-top-5"}),s.jsx(ui,{name:"max-consecutive-auto-reply",label:"Max consecutive auto reply: ",value:n.maxConsecutiveAutoReply,onChange:u,min:0,max:1001,step:1,setNullOnUpper:!0,setNullOnLower:!1,onLowerLabel:"No auto reply",onUpperLabel:"Unset",labelInfo:"The maximum number of consecutive auto replies (i.e., when no code execution or llm-based reply is generated). Default is None (no limit provided). When set to 0, no auto reply will be generated.",dataTestId:`agent-max-consecutive-auto-reply-input-${t}`,"aria-label":"Maximum consecutive auto replies"}),s.jsx("div",{className:"margin-bottom-20"}),s.jsx("label",{htmlFor:`agent-default-auto-reply-input-${t}`,children:"Default Auto Reply:"}),s.jsx(yo,{className:"full-width margin-top-5",value:n.agentDefaultAutoReply??"",onChange:g,"data-testid":`agent-default-auto-reply-input-${t}`,"aria-label":"Default auto reply message",placeholder:"Type your default auto reply message here..."})]})}),s.jsx(mi,{label:"Code Execution",id:`wf-${a}-wa-${t}-codeExecution`,children:s.jsx("div",{className:"modal-tab-body",children:s.jsx(_r,{id:t,data:n,tools:i,onDataChange:l})})}),r&&s.jsx(mi,{label:"Nested chat",id:`wf-${a}-wa-${t}-nested`,children:s.jsx("div",{className:"modal-tab-body",children:s.jsx(ol,{id:t,data:n,onDataChange:l,agentConnections:d})})})]})})}));Nl.displayName="WaldiezAgentUserTabs";const Tl=o.memo((({id:e,data:t,flowId:a,isModalOpen:n,isDarkMode:i,filesToUpload:r,onDataChange:l,onAgentTypeChange:d,onFilesToUploadChange:c})=>{const u=us((e=>e.getAgentConnections)),g=us((e=>e.getAgents)),m=us((e=>e.getModels)),p=us((e=>e.getTools)),h=us((e=>e.getEdges)),f=us((e=>e.onUpload)),[y,b]=o.useState(0);o.useEffect((()=>{b(0)}),[n]);const v=o.useMemo((()=>({isManager:"group_manager"===t.agentType,isGroupMember:"group_manager"!==t.agentType&&!!t.parentId,isRagUser:"rag_user_proxy"===t.agentType,isReasoning:"reasoning"===t.agentType,isCaptain:"captain"===t.agentType})),[t.agentType,t.parentId]),{isManager:x,isGroupMember:C,isRagUser:w,isReasoning:k,isCaptain:j}=v,A=o.useMemo((()=>{const a=u(e),n=m(),s=g(),o=p(),i=h(),r=s.filter((e=>"group_manager"===e.data.agentType)),l=a.targets.edges.length+a.sources.edges.length,d=!C&&l>0;let c=!1,y=[],b=[];C&&(y=s.filter((e=>e.data.parentId===t.parentId)),b=a.targets.edges.filter((e=>-1===y.findIndex((t=>t.id===e.target)))),c=b.length>0);return{agentConnections:a,models:n,agents:s,edges:i,tools:o,groupManagers:r,showNestedChatsTab:d,showGroupNestedChatTab:c,groupMembers:y,connectionsOutsideGroup:b,uploadsEnabled:!!f}}),[u,m,g,h,p,e,C,t.parentId,f]),{agentConnections:N,models:T,agents:S,edges:M,tools:I,groupManagers:E,showNestedChatsTab:D,showGroupNestedChatTab:R,connectionsOutsideGroup:P,uploadsEnabled:O}=A;return w?s.jsx(xl,{id:e,flowId:a,isDarkMode:i,isModalOpen:n,models:T,uploadsEnabled:O,data:t,onDataChange:l,filesToUpload:r,onFilesToUploadChange:c}):"user_proxy"===t.agentType?s.jsx(Nl,{id:e,flowId:a,isDarkMode:i,isModalOpen:n,data:t,tools:I,showNestedChatsTab:D,agentConnections:N,onDataChange:l}):s.jsxs(pi,{activeTabIndex:y,children:[s.jsx(mi,{label:"Agent",id:`wf-${a}-wa-${e}-basic`,children:s.jsx("div",{className:"modal-tab-body",children:s.jsx(Yr,{id:e,data:t,onDataChange:l,onAgentTypeChange:d})})}),k&&s.jsx(mi,{label:"Reasoning",id:`wf-${a}-wa-${e}-reasoning`,children:s.jsx("div",{className:"modal-tab-body",children:s.jsx(Cl,{id:e,data:t,onDataChange:l})})}),j&&s.jsx(mi,{label:"Captain",id:`wf-${a}-wa-${e}-captain`,children:s.jsx("div",{className:"modal-tab-body",children:s.jsx($r,{id:e,flowId:a,data:t,onDataChange:l})})}),s.jsx(mi,{label:"Termination",id:`wf-${a}-wa-${e}-termination`,children:s.jsx("div",{className:"modal-tab-body",children:s.jsx(jl,{id:e,data:t,onDataChange:l})})}),s.jsx(mi,{label:"Code Execution",id:`wf-${a}-wa-${e}-codeExecution`,children:s.jsx("div",{className:"modal-tab-body",children:s.jsx(_r,{id:e,data:t,tools:I,onDataChange:l})})}),s.jsx(mi,{label:"Models",id:`wf-${a}-wa-${e}-models`,children:s.jsx("div",{className:"modal-tab-body",children:s.jsx(Xr,{id:e,data:t,models:T,onDataChange:l})})}),s.jsx(mi,{label:"Tools",id:`wf-${a}-wa-${e}-tools`,children:s.jsx("div",{className:"modal-tab-body",children:s.jsx(Al,{id:e,data:t,agents:S,tools:I,skipExecutor:C,onDataChange:l})})}),D&&s.jsx(mi,{label:"Nested chat",id:`wf-${a}-wa-${e}-nested`,children:s.jsx("div",{className:"modal-tab-body",children:s.jsx(ol,{id:e,data:t,onDataChange:l,agentConnections:N})})}),C&&R&&s.jsx(mi,{label:"Nested chat",id:`wf-${a}-wa-${e}-group-nested`,children:s.jsx("div",{className:"modal-tab-body",children:s.jsx(tl,{id:e,flowId:a,darkMode:i,data:t,agentConnections:N,edges:P,onDataChange:l})})}),!x&&E.length>0&&s.jsx(mi,{id:`wf-${a}-wa-${e}-group`,label:"Group",children:s.jsx("div",{className:"modal-tab-body",children:s.jsx(el,{id:e,data:t,agents:S,edges:M,darkMode:i,onDataChange:l})})})]})}));Tl.displayName="WaldiezNodeAgentModalTabs";const Sl=(e,t,a,n,o)=>{const i=a.toLowerCase(),r=a.charAt(0).toUpperCase()+a.slice(1);return s.jsxs("div",{className:"modal-header-import-export",children:[s.jsx("input",{title:`Import ${r}`,id:`file-upload-${i}-${e}-${t}`,"data-testid":`file-upload-${i}-${e}-${t}`,type:"file",accept:`.waldiez${r}`,onChange:n,className:"hidden"}),s.jsx("label",{htmlFor:`file-upload-${i}-${e}-${t}`,className:"modal-header-import-button file-label",title:`Import ${r}`,children:s.jsx(y.FaFileImport,{})}),s.jsx("div",{role:"button",className:"modal-header-export-button",onClick:o,title:`Export ${r}`,"data-testid":`export-${i}-${e}-${t}`,children:s.jsx(y.FaFileExport,{})})]})},Ml=o.memo((e=>{const{id:t,data:a,isOpen:n,onClose:i}=e,{flowId:r,isDirty:l,isDarkMode:d,agentData:c,filesToUpload:u,onDataChange:g,onAgentTypeChange:m,onFilesToUploadChange:p,onImport:h,onExport:f,onSave:y,onSaveAndClose:b,onCancel:v}=((e,t,a,n)=>{const s=us((e=>e.flowId)),i=us((e=>e.getAgentById)),r=us((e=>e.updateAgentData)),l=us((e=>e.updateEdgeData)),d=us((e=>e.exportAgent)),c=us((e=>e.importAgent)),u=us((e=>e.getAgentConnections)),g=us((e=>e.removeGroupMember)),m=us((e=>e.addGroupMember)),p=us((e=>e.updateEdgePath)),h=us((e=>e.onUpload)),f=us((e=>e.onFlowChanged)),[y,b]=o.useState({...a}),[v,x]=o.useState([]),[C,w]=o.useState(!1),{isDark:k}=ga();o.useEffect((()=>{w(!1),x([])}),[t]);const j=o.useCallback((t=>{const a=document.getElementById(`flow-${s}-agent-description-${e}`);a&&(a.value=t)}),[s,e]),A=o.useCallback((()=>{const t=i(e);if(!t)return j(y.description),void w(!1);t.data&&(b({...t.data}),w(!1)),j(t.data.description),f()}),[e,y.description,i,j,f]),N=o.useCallback((()=>{const t=u(e,{sourcesOnly:!1,targetsOnly:!1}),n=t.sources.edges,s=t.targets.edges,o=y.label,i=a.label;n.forEach((e=>{var t,a;const n=` => ${i}`,s=` => ${o}`,r=null==(t=e.data)?void 0:t.label.indexOf(n);if("number"==typeof r&&r>-1){const t=null==(a=e.data)?void 0:a.label.replace(n,s);l(e.id,{...e.data,label:t})}})),s.forEach((e=>{var t,a;const n=`${i} => `,s=`${o} => `,r=null==(t=e.data)?void 0:t.label.indexOf(n);if("number"==typeof r&&r>-1){const t=null==(a=e.data)?void 0:a.label.replace(n,s);l(e.id,{...e.data,label:t})}}))}),[e,y.label,a.label,u,l]),T=o.useCallback((t=>{u(e,{targetsOnly:!0}).targets.edges.forEach((e=>{p(e.id,t)}))}),[e,u,p]),S=o.useCallback((e=>{const t=e.agentType;T(t),"rag_user_proxy"!==t||e.retrieveConfig?"user_proxy"===t&&e.retrieveConfig&&delete e.retrieveConfig:e.retrieveConfig=re}),[T]),M=o.useCallback((t=>{const n=a.parentId,s=t.parentId;n!==s&&(n&&g(n,e),s&&m(s,e))}),[a.parentId,e,g,m]),I=o.useCallback((t=>{t.agentType!==a.agentType&&S(t),M(t),r(e,t),a.label!==t.label&&N(),x([]),A()}),[a,e,S,M,r,N,A]),E=o.useCallback((e=>{if(v.length>0&&h)h(v).then((t=>{const a=[...y.retrieveConfig.docsPath];for(let e=0;e<v.length;e++){const n=a.indexOf(`file:///${v[e].name}`);n>-1&&("string"==typeof t[e]?a[n]=t[e]:a.splice(n,1))}e.retrieveConfig.docsPath=a})).catch((e=>{})).finally((()=>{const t=e.retrieveConfig.docsPath;e.retrieveConfig.docsPath=[...t].filter((e=>"string"==typeof e&&e.length>0&&!e.startsWith("file:///"))),x([]),I(e)}));else{const t=y.retrieveConfig.docsPath;e.retrieveConfig.docsPath=t.filter((e=>"string"==typeof e&&e.length>0&&!e.startsWith("file:///"))),x([]),I(e)}}),[y,v,h,I]),D=o.useCallback((()=>{const e=y;e.agentType="rag_user_proxy",e.retrieveConfig||(e.retrieveConfig=re),e.retrieveConfig.docsPath=[],b({...y,...e})}),[y]),R=o.useCallback((()=>{const e=y;e.agentType="user_proxy",e.retrieveConfig&&delete e.retrieveConfig,b({...y,...e})}),[y]),P=o.useCallback((()=>{const e={...y};"rag_user_proxy"===y.agentType?E(e):I(e)}),[y,E,I]),O=o.useCallback((()=>{P(),n()}),[P,n]),L=o.useCallback((e=>{const t=!Pr({...y,...e},a);b((t=>({...t,...e}))),w(t)}),[y,a]),z=o.useCallback(((t,a)=>{const n=c(a,e,!0,null==t?void 0:t.position,!1);L({...n.data})}),[e,c,L]),F=o.useCallback((t=>{G(t,i.bind(null,e),z)}),[e,i,z]),U=o.useCallback((async()=>{await W(y.label,"agent",d.bind(null,e,!0))}),[y.label,e,d]),q=o.useCallback((()=>{const t=i(e);if(!t)return w(!1),void n();t.data&&b({...t.data}),w(!1),n()}),[e,i,n]),B=o.useCallback((e=>{"rag_user_proxy"===e?D():R(),w(a.agentType!==e)}),[a.agentType,D,R]),H=o.useCallback((e=>{const t=!Pr(e,v);x(e),w(t)}),[v]);return{flowId:s,filesToUpload:v,agentData:y,isDirty:C,isDarkMode:k,onDataChange:L,onAgentTypeChange:B,onFilesToUploadChange:H,onImport:F,onExport:U,onSave:P,onSaveAndClose:O,onCancel:q}})(t,n,a,i),x=o.useMemo((()=>"group_manager"!==a.agentType?Sl(r,t,"agent",h,f):void 0),[a.agentType,r,t,h,f]),C=o.useMemo((()=>"group_manager"===a.agentType?c.groupName:c.label),[a.agentType,c]),w=o.useMemo((()=>"group_manager"===a.agentType?s.jsx(Jr,{isModalOpen:n,flowId:r,id:t,data:c,onDataChange:g,isDarkMode:d}):s.jsx(Tl,{id:t,flowId:r,data:c,isDarkMode:d,onDataChange:g,isModalOpen:n,onAgentTypeChange:m,filesToUpload:u,onFilesToUploadChange:p})),[a.agentType,n,r,t,c,g,d,m,u,p]);return s.jsxs(Eo,{title:C,isOpen:n,onClose:v,onSaveAndClose:b,beforeTitle:x,dataTestId:`wf-${r}-agent-modal-${t}`,hasUnsavedChanges:l,preventCloseIfUnsavedChanges:!0,children:[s.jsx("div",{className:"modal-body",children:w}),s.jsxs("div",{className:"modal-actions",children:[s.jsx("button",{className:"secondary",onClick:v,"data-testid":`cancel-agent-data-${t}`,type:"button",title:"Cancel","aria-label":"Cancel",children:"Cancel"}),s.jsxs("div",{className:"flex-row",children:[s.jsx("button",{type:"button",title:"Save & Close",className:"save margin-right-10",onClick:b,"data-testid":`submit-and-close-agent-data-${t}`,disabled:!l,"aria-label":"Save and Close",children:"Save & Close"}),s.jsx("button",{type:"button",title:l?"Save":"No changes to save",className:"primary",onClick:y,"data-testid":`submit-agent-data-${t}`,disabled:!l,"aria-label":"Save",children:"Save"})]})]})]})}));Ml.displayName="WaldiezNodeAgentModal";const Il={minWidth:490,minHeight:330},El={minWidth:130,minHeight:120};function Dl(e){return tr({attr:{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},child:[{tag:"path",attr:{d:"M11.445 20.913a1.665 1.665 0 0 1 -1.12 -1.23a1.724 1.724 0 0 0 -2.573 -1.066c-1.543 .94 -3.31 -.826 -2.37 -2.37a1.724 1.724 0 0 0 -1.065 -2.572c-1.756 -.426 -1.756 -2.924 0 -3.35a1.724 1.724 0 0 0 1.066 -2.573c-.94 -1.543 .826 -3.31 2.37 -2.37c1 .608 2.296 .07 2.572 -1.065c.426 -1.756 2.924 -1.756 3.35 0a1.724 1.724 0 0 0 2.573 1.066c1.543 -.94 3.31 .826 2.37 2.37a1.724 1.724 0 0 0 1.065 2.572c1.31 .318 1.643 1.79 .997 2.694"},child:[]},{tag:"path",attr:{d:"M15 19l2 2l4 -4"},child:[]},{tag:"path",attr:{d:"M9 12a3 3 0 1 0 6 0a3 3 0 0 0 -6 0"},child:[]}]})(e)}const Rl=[{label:"OpenAI",value:"openai"},{label:"Claude",value:"anthropic"},{label:"NIM",value:"nim"},{label:"Gemini",value:"google"},{label:"Cohere",value:"cohere"},{label:"DeepSeek",value:"deepseek"},{label:"Mistral",value:"mistral"},{label:"Azure",value:"azure"},{label:"Groq",value:"groq"},{label:"Together",value:"together"},{label:"Bedrock",value:"bedrock"},{label:"Other",value:"other"}],Pl={openai:"OPENAI_API_KEY",azure:"AZURE_API_KEY",bedrock:"BEDROCK_API_KEY",deepseek:"DEEPSEEK_API_KEY",google:"GOOGLE_GEMINI_API_KEY",anthropic:"ANTHROPIC_API_KEY",cohere:"COHERE_API_KEY",mistral:"MISTRAL_API_KEY",groq:"GROQ_API_KEY",together:"TOGETHER_API_KEY",nim:"NIM_API_KEY",other:"OPENAI_API_KEY"},Ol={openai:"https://platform.openai.com/docs/models",anthropic:"https://docs.anthropic.com/en/docs/about-claude/models/all-models",google:"https://ai.google.dev/gemini-api/docs/models",deepseek:"https://api-docs.deepseek.com/quick_start/pricing",cohere:"https://docs.cohere.com/v2/docs/models",together:"https://docs.together.ai/docs/serverless-models",nim:"https://docs.nvidia.com/nim/large-language-models/latest/models.html",mistral:"https://docs.mistral.ai/getting-started/models/models_overview/",azure:"https://learn.microsoft.com/en-us/azure/cognitive-services/openai/concepts/models",bedrock:"https://docs.aws.amazon.com/bedrock/latest/userguide/models-regions.html",groq:"",other:""},Ll={openai:[{label:"GPT-4.1",value:"gpt-4.1"},{label:"GPT-4",value:"gpt-4"},{label:"GPT-4 Turbo",value:"gpt-4-turbo"},{label:"GPT-3.5 Turbo",value:"gpt-3.5-turbo"},{label:"GPT-4o",value:"gpt-4o"},{label:"GPT-4o Mini",value:"gpt-4o-mini"},{label:"GPT Image 1",value:"gpt-image-1"},{label:"o4-mini",value:"o4-mini"},{label:"o3",value:"o3"}],anthropic:[{label:"Claude 4 Sonnet",value:"claude-sonnet-4-20250514"},{label:"Claude 4 Opus",value:"claude-opus-4-20250514"},{label:"Claude 3.7 Sonnet",value:"claude-3-7-sonnet-20250219"},{label:"Claude 3.5 Haiku",value:"claude-3-5-haiku-20241022"},{label:"Claude 3.5 Sonnet v2",value:"claude-3-5-sonnet-20241022"},{label:"Claude 3.5 Sonnet",value:"claude-3-5-sonnet-20240620"},{label:"Claude 3 Opus",value:"claude-3-opus-20240229"},{label:"Claude 3 Sonnet",value:"claude-3-sonnet-20240229"},{label:"Claude 3 Haiku",value:"claude-3-haiku-20240307"}],google:[{label:"Gemini 2.5 Flash Preview 04-17",value:"gemini-2.5-flash-preview-04-17"},{label:"Gemini 2.5 Pro Preview",value:"gemini-2.5-pro-preview-03-25"},{label:"Gemini 2.0 Flash",value:"gemini-2.0-flash"},{label:"Gemini 2.0 Flash-Lite",value:"gemini-2.0-flash-lite"},{label:"Gemini 1.5 Flash",value:"gemini-1.5-flash"},{label:"Gemini 1.5 Pro",value:"gemini-1.5-pro"}],deepseek:[{label:"DeepSeek-V3",value:"deepseek-chat"},{label:"DeepSeek-R1",value:"deepseek-reasoner"}],cohere:[{label:"Command-R",value:"command-r"},{label:"Command-R+",value:"command-r-plus"},{label:"Command Light Nightly",value:"command-light-nightly"},{label:"Command A",value:"command-a-03-2025"},{label:"Command Nightly",value:"command-nightly"},{label:"Command R7B",value:"command-r7b-12-2024"}],together:[{label:"Llama 4 Maverick",value:"meta-llama/Llama-4-Maverick-17B-128E-Instruct-FP8"},{label:"Llama 4 Scout",value:"meta-llama/Llama-4-Scout-17B-16E-Instruct"},{label:"DeepSeek-R1",value:"deepseek-ai/DeepSeek-R1"},{label:"DeepSeek-R1 Distill Llama 70B",value:"deepseek-ai/DeepSeek-R1-Distill-Llama-70B"},{label:"DeepSeek-V3",value:"deepseek-ai/DeepSeek-V3"},{label:"Llama 3.3 70B Instruct Turbo",value:"meta-llama/Llama-3.3-70B-Instruct-Turbo"},{label:"Mistral Small 3 Instruct",value:"mistral-ai/Mistral-Small-3-Instruct"},{label:"Mistral (7B) Instruct v0.3",value:"mistralai/Mistral-7B-Instruct-v0.3"}],nim:[{label:"Meta Llama 3 8B Instruct",value:"meta/llama3-8b-instruct"},{label:"Meta Llama 3 70B Instruct",value:"meta/llama3-70b-instruct"},{label:"Llama 3.3 70B Instruct",value:"meta/llama-3.3-70b-instruct"},{label:"Llama 3.1 Nemotron Ultra 253B v1",value:"nvidia/llama-3.1-nemotron-ultra-253b-v1"},{label:"Llama 3.1 Nemotron Super 49B v1",value:"nvidia/llama-3.3-nemotron-super-49b-v1"},{label:"Llama 3.1 Nemotron Nano 8B v1",value:"nvidia/llama-3.1-nemotron-nano-8b-v1"}],mistral:[{label:"Codestral",value:"codestral-latest"},{label:"Mistral Large",value:"mistral-large-latest"},{label:"Pixtral Large",value:"pixtral-large-latest"},{label:"Mistral Saba",value:"mistral-saba-latest"},{label:"Ministral 3B",value:"ministral-3b-latest"},{label:"Ministral 8B",value:"ministral-8b-latest"}],bedrock:[],azure:[],groq:[],other:[]},zl={async signRequest(e,t,a,n,s,o,i,r={},l=""){const{host:d,path:c}=this.parseUrl(t),u=(new Date).toISOString().replace(/[:-]|\.\d{3}/g,""),g=u.slice(0,8),m=await U(l),p={...r,host:d,"x-amz-date":u,"x-amz-content-sha256":m};i&&(p["x-amz-security-token"]=i);const h=this.buildCanonicalHeaders(p),f=this.buildSignedHeadersList(p),y=[e,c,"",h,f,m].join("\n"),b="AWS4-HMAC-SHA256",v=`${g}/${a}/${n}/aws4_request`,x=[b,u,v,await U(y)].join("\n"),C=await this.getSignatureKey(o,g,a,n),w=await q(C,x,"hex");return p.Authorization=`${b} Credential=${s}/${v}, SignedHeaders=${f}, Signature=${w}`,p},parseUrl(e){try{const t=new URL(e);return{host:t.host,path:t.pathname}}catch(t){throw new Error(`Invalid URL: ${e}`)}},buildCanonicalHeaders:e=>Object.keys(e).sort().map((t=>`${t.toLowerCase()}:${e[t].trim()}\n`)).join(""),buildSignedHeadersList:e=>Object.keys(e).sort().map((e=>e.toLowerCase())).join(";"),async getSignatureKey(e,t,a,n){const s=await q("AWS4"+e,t),o=await q(s,a),i=await q(o,n);return await q(i,"aws4_request")}},Fl={openai:"https://api.openai.com/v1",google:"https://generativelanguage.googleapis.com/v1beta",anthropic:"https://api.anthropic.com/v1",cohere:"https://api.cohere.com/v1",deepseek:"https://api.deepseek.com",mistral:"https://api.mistral.ai/v1",groq:"https://api.groq.com/openai/v1",together:"https://api.together.xyz/v1",nim:"https://integrate.api.nvidia.com/v1",bedrock:"https://bedrock.{region}.amazonaws.com",azure:"",other:""},Ul={openai:"/models",azure:"/openai/deployments",deepseek:"/models",google:"/models",anthropic:"/models",cohere:"/models",mistral:"/models",groq:"/models",together:"/models",nim:"/models",other:"/v1/models",bedrock:""},ql=["openai","google","groq","anthropic","cohere","mistral","nim","other"],Bl=e=>{const{success:t,message:a,details:n}=(e=>{if(["azure","other"].includes(e.apiType)&&!e.baseUrl)return{success:!1,message:"Missing base URL"};let t=e.baseUrl||Fl[e.apiType];return["azure","other"].includes(e.apiType)&&e.baseUrl&&(t=e.baseUrl),t.trim()?{success:!0,message:"Model validated successfully",details:t}:{success:!1,message:"Missing base URL"}})(e);return t?e.apiKey?e.label.trim()?"azure"!==e.apiType||e.apiVersion?{success:!0,message:a,details:n}:{success:!1,message:"Missing Azure API version"}:{success:!1,message:"Missing model name"}:{success:!1,message:"Missing API key"}:{success:t,message:a,details:n}},Hl=(e,t)=>{let a=t.replace(/\/$/,"")+Ul[e.apiType];const n=Object.fromEntries(Object.entries(e.defaultHeaders||{}).map((([e,t])=>[e,String(t)])));return"azure"===e.apiType?(a+=`?api-version=${e.apiVersion}`,n["api-key"]=e.apiKey):e.apiKey&&(n.Authorization=`Bearer ${e.apiKey}`),{url:a,headers:n}},Wl=async(e,t,a)=>{try{const n=await Ql(e,{method:"GET",headers:t});if(!n.ok)return{success:!1,message:"Azure API error"};const s=await n.json();return Array.isArray(s.data)&&s.data.some((e=>e.id===a))?{success:!0,message:"Model validated successfully"}:{success:!1,message:"Model not found"}}catch(n){return Xl(n)}},Vl=async(e,t,a)=>{const n=Jl(a);if(!n.success)return n;const{region:s,accessKey:o,secretKey:i,sessionToken:r}=a,l="bedrock",d=`https://${l}.${s}.amazonaws.com/foundation-models/${encodeURIComponent(t)}`;try{const a=await zl.signRequest("GET",d,s,l,o,i,r,e),n=await Ql(d,{method:"GET",headers:a});return await Yl(n,t,s)}catch(c){return Xl(c)}},Gl=async(e,t,a)=>{try{const n=`${e}/${encodeURIComponent(a)}`,s=await Ql(n,{method:"GET",headers:t});return s.ok?{success:!0,message:"Model validated successfully"}:Zl(s)}catch(n){return Xl(n)}},Kl=async(e,t,a)=>{try{const s=await Ql(e,{method:"GET",headers:t});if(!s.ok)return Zl(s);let o={data:[]};try{o=await s.json()}catch(n){return{success:!1,message:"Could not fetch model",details:n instanceof Error?n.message:String(n)}}return Array.isArray(o.data)&&o.data.some((e=>e.id===a))?{success:!0,message:"Model validated successfully"}:{success:!1,message:"Model not found"}}catch(n){return Xl(n)}},Ql=async(e,t)=>{const a=new AbortController,n=setTimeout((()=>a.abort()),4e3);try{return await fetch(e,{...t,signal:a.signal})}finally{clearTimeout(n)}},Zl=async e=>{var t;try{const a=await e.json().catch((()=>({}))),n=(null==(t=null==a?void 0:a.error)?void 0:t.message)||e.statusText||"Unknown error";let s="API error";return 404===e.status&&(s="Model not found"),{success:!1,message:s,details:n}}catch(a){return Xl(a)}},Xl=e=>({success:!1,message:e instanceof DOMException&&"AbortError"===e.name?"Could not get a response from the model's endpoint":"Unknown error",details:e instanceof Error?e.message:String(e)}),Jl=e=>{if(!e)return{success:!1,message:"Model fetch failed",details:"Missing AWS configuration"};const{region:t,accessKey:a,secretKey:n}=e;return t&&a&&n?{success:!0,message:"Model validated successfully"}:{success:!1,message:"Model fetch failed",details:"Missing required AWS credentials (region, accessKey, or secretKey)"}},Yl=async(e,t,a)=>{if(e.ok)return{success:!0,message:"Model validated successfully",details:`Model ${t} is available in region ${a}`};if(404===e.status)return{success:!1,message:"Model not found",details:`Model ${t} not found in region ${a}`};if(403===e.status)return{success:!1,message:"API error",details:`Not authorized to access model ${t} in region ${a}`};try{const t=await e.text();return{success:!1,message:"API error",details:`Error (${e.status}): ${t}`}}catch(n){return{success:!1,message:"API error",details:`Error (${e.status})`}}},$l=(e,t)=>{const a=us((e=>e.getModelById)),n=us((e=>e.updateModelData)),s=us((e=>e.cloneModel)),i=us((e=>e.deleteModel)),r=us((e=>e.importModel)),l=us((e=>e.exportModel)),d=us((e=>e.onFlowChanged)),c=us((e=>e.flowId)),[u,g]=o.useState(da[t.apiType]||""),[m,p]=o.useState(!1),[h,f]=o.useState(t),[y,b]=o.useState(!1);o.useEffect((()=>{f(t),g(da[t.apiType]||""),b(!1)}),[t]);const v=o.useCallback((()=>{p(!0),b(!1)}),[]),x=o.useCallback((()=>{i(e),b(!1),d()}),[i,e,d]),C=o.useCallback((()=>{s(e),b(!1),d()}),[s,e,d]),w=o.useCallback(((a,n)=>{const s=r(n,e,null==a?void 0:a.position,!1);f(s.data),b(!Pr(t,s.data))}),[r,e,t]),k=o.useCallback((t=>{G(t,(e=>a(e)).bind(null,e),w)}),[a,e,w]),j=o.useCallback((async()=>{await W(t.label,"model",(()=>l(e,!0)))}),[t.label,l,e]),A=o.useCallback((e=>{f((a=>{const n={...a,...e};return b(!Pr(n,t)),n}))}),[t]),N=o.useCallback((()=>{g(da[t.apiType]||""),f(t),b(!1),p(!1)}),[t]),T=o.useCallback((()=>{(async e=>{const t=Bl(e);if(!t.success||!t.details)return t;const{url:a,headers:n}=Hl(e,t.details);return"azure"===e.apiType?Wl(a,n,e.label.trim()):"bedrock"===e.apiType?Vl(n,e.label.trim(),e.aws):ql.includes(e.apiType)?Gl(a,n,e.label.trim()):Kl(a,n,e.label.trim())})(h).then((e=>{e.success?is({flowId:c,message:e.message,level:"success",details:null,duration:3e3,withCloseButton:!1}):is({flowId:c,message:e.message,level:"error",details:e.details,duration:void 0,withCloseButton:!0})})).catch((e=>{const t=e instanceof Error?e.message:String(e);is({flowId:c,message:"Error validating model",level:"error",details:t,duration:void 0,withCloseButton:!0})}))}),[h,c]),S=o.useCallback((()=>{const t=da[h.apiType]||"";g(t),n(e,h);const s=a(e);(null==s?void 0:s.data)&&f(s.data),b(!1),d()}),[h,n,e,a,d]),M=o.useCallback((()=>{S(),p(!1)}),[S]);return o.useMemo((()=>({flowId:c,isOpen:m,isDirty:y,logo:u,modelData:h,setLogo:g,onOpen:v,onImport:k,onExport:j,onDataChange:A,onDelete:x,onClone:C,onSave:S,onSaveAndClose:M,onCancel:N,onCheck:T})),[c,m,y,u,h,g,v,k,j,A,x,C,S,M,N,T])},_l=o.memo((e=>{const{data:t}=e,{temperature:a,topP:n,maxTokens:i,defaultHeaders:r,tags:l}=t,{onTemperatureChange:d,onTopPChange:c,onMaxTokensChange:u,onUpdateHeaders:g,onDeleteHeader:m,onAddHeader:p,onAddTag:h,onUpdateTag:f,onDeleteTag:y}=(e=>{const{data:t,onDataChange:a}=e;return{onTemperatureChange:o.useCallback((e=>{let t=null;e>=0&&(t=e),a({temperature:t})}),[a]),onTopPChange:o.useCallback((e=>{let t=null;e>=0&&(t=e),a({topP:t})}),[a]),onMaxTokensChange:o.useCallback((e=>{let t=null;e>=0&&(t=e),a({maxTokens:t})}),[a]),onUpdateHeaders:o.useCallback((e=>{a({defaultHeaders:e})}),[a]),onDeleteHeader:o.useCallback((e=>{const n={...t.defaultHeaders};delete n[e],a({defaultHeaders:n})}),[t.defaultHeaders,a]),onAddHeader:o.useCallback(((e,n)=>{const s={...t.defaultHeaders};s[e]=n,a({defaultHeaders:s})}),[t.defaultHeaders,a]),onAddTag:o.useCallback((e=>{const{tags:n}=t;if(!n.includes(e)){const t=[...n,e];a({tags:t})}}),[t,a]),onUpdateTag:o.useCallback(((e,n)=>{const{tags:s}=t,o=s.indexOf(e);if(o>=0){const e=[...s];e[o]=n,a({tags:e})}}),[t,a]),onDeleteTag:o.useCallback((e=>{const n=[...t.tags],s=n.indexOf(e);s>=0&&(n.splice(s,1),a({tags:n}))}),[t.tags,a])}})(e);return s.jsxs("div",{className:"flex-column",children:[s.jsx(ui,{name:"temperature",label:"Temperature:",value:null!==a?a:-.001,onChange:d,min:-.001,max:1,step:.001,setNullOnLower:!0,onLowerLabel:"Unset",dataTestId:"model-modal-temperature"}),s.jsx(ui,{name:"top-p",label:"Top P:",labelInfo:"Top P value for sampling (it is recommended to use either temperature or top P, not both)",value:null!==n?n:-.001,onChange:c,min:-.001,max:1,step:.001,setNullOnLower:!0,onLowerLabel:"Unset",dataTestId:"model-modal-top-p"}),s.jsx(ui,{name:"max-tokens",label:"Max Tokens:",value:null!==i?i:0,onChange:u,min:0,max:5e4,step:1,forceInt:!0,setNullOnLower:!0,onLowerLabel:"No limit",dataTestId:"model-modal-max-tokens"}),s.jsx(po,{viewLabel:"Default Headers:",viewLabelInfo:"Optional headers to be included in every request",items:r,itemsType:"model-header",onUpdate:g,onDelete:m,onAdd:p}),s.jsx(gi,{viewLabel:"Tags:",items:l,itemsType:"tag",placeholder:"Tag",onItemAdded:h,onItemChange:f,onItemDeleted:y})]})})),ed=o.memo((({data:e,onDataChange:t})=>{var a,n,i,r,l;const d=o.useCallback((a=>{t({aws:{...e.aws,accessKey:a.target.value}})}),[e.aws,t]),c=o.useCallback((a=>{t({aws:{...e.aws,secretKey:a.target.value}})}),[e.aws,t]),u=o.useCallback((a=>{t({aws:{...e.aws,region:a.target.value}})}),[e.aws,t]),g=o.useCallback((a=>{t({aws:{...e.aws,profileName:a.target.value}})}),[e.aws,t]),m=o.useCallback((a=>{t({aws:{...e.aws,sessionToken:a.target.value}})}),[e.aws,t]);return s.jsxs("div",{className:"flex-column",children:[s.jsx(xo,{value:(null==(a=e.aws)?void 0:a.accessKey)||"",name:"aws-access-key",label:"AWS Access Key:",placeholder:"AWS Access Key",onChange:d}),s.jsx(xo,{value:(null==(n=e.aws)?void 0:n.secretKey)||"",name:"aws-secret-key",label:"AWS Secret Key:",placeholder:"AWS Secret Key",onChange:c}),s.jsx(xo,{value:(null==(i=e.aws)?void 0:i.region)||"",name:"aws-region",label:"AWS Region:",placeholder:"AWS Region",onChange:u}),s.jsx(xo,{value:(null==(r=e.aws)?void 0:r.profileName)||"",name:"aws-profile-name",label:"AWS Profile Name:",placeholder:"AWS Profile Name",onChange:g}),s.jsx(xo,{value:(null==(l=e.aws)?void 0:l.sessionToken)||"",name:"aws-session-token",label:"AWS Session Token:",placeholder:"AWS Session Token",onChange:m})]})})),td=o.memo((e=>{const{ref:t,onChange:a}=e,n=o.useMemo((()=>Object.entries(Ll).filter((([e,t])=>t.length>0)).map((([e,t])=>({label:e,options:t.map((t=>({label:t.label,value:t.value,apiType:e})))})))),[]);return s.jsxs("div",{className:"margin-bottom-5",children:[s.jsx("label",{htmlFor:"predefined-models-select",children:"Predefined models:"}),s.jsx("div",{className:"margin-top-10"}),s.jsx($s,{ref:t,inputId:"predefined-models-select",options:n,onChange:e=>{a(e?{label:e.value,apiType:e.apiType}:void 0)},placeholder:"Select a model...",formatGroupLabel:e=>{const t=da[e.label];return s.jsxs("div",{className:`model-logo ${e.label} flex items-center`,children:[s.jsx("img",{src:t,alt:`${e.label} logo`,style:{width:20,height:20,marginRight:10,backgroundColor:"transparent"}}),s.jsx("strong",{children:e.label})]})},isSearchable:!0,isClearable:!0,"aria-label":"Predefined models",className:"full-width"})]})}));td.displayName="ModelSelector";const ad=o.memo((e=>{const{id:t,data:a}=e,{label:n,apiType:i,apiKey:r,baseUrl:l}=a,{apiTypeLabel:d,apiKeyInfo:c,apiKeyEnv:u,urlIsEditable:g,apiKeyVisible:m,apiTypeOptions:p,readOnlyBaseUrl:h,predefinedModelsSelectRef:f,onDataChange:b,onApiKeyVisibleChange:v,onLabelChange:x,onApiTypeChange:C,onApiKeyChange:w,onBaseUrlChange:k}=(e=>{const{data:t,onDataChange:a,onLogoChange:n}=e,{apiType:s}=t,i=o.useRef(null),[r,l]=o.useState(!1),d=o.useCallback((e=>Fl[e]),[]),c=o.useCallback((e=>["other","azure"].includes(e)),[]),u=o.useCallback((e=>{a({label:e.target.value})}),[a]),g=o.useCallback((e=>{a({description:e.target.value})}),[a]),m=o.useCallback((e=>{var t;e&&(null==(t=i.current)||t.clearValue(),a({apiType:e.value}),n(da[e.value]))}),[a,n]),p=o.useCallback((e=>{a({apiKey:e.target.value})}),[a]),h=o.useCallback((e=>{a({baseUrl:e.target.value})}),[a]),f=o.useCallback((()=>{l((e=>!e))}),[]),y=o.useMemo((()=>Pl[s]),[s]),b=o.useMemo((()=>`API key to use if the '${y}' environment variable is not set`),[y]),v=o.useMemo((()=>{return"anthropic"===(e=s)?"Claude":"deepseek"===e?"DeepSeek":"google"===e?"Gemini":"openai"===e?"OpenAI":"nim"===e?"NIM":e[0].toUpperCase()+e.slice(1);var e}),[s]),x=o.useMemo((()=>d(s)),[d,s]),C=o.useMemo((()=>c(s)),[c,s]);return{apiTypeOptions:Rl,apiKeyVisible:r,apiKeyEnv:y,apiKeyInfo:b,apiTypeLabel:v,readOnlyBaseUrl:x,urlIsEditable:C,predefinedModelsSelectRef:i,onDataChange:a,onLabelChange:u,onDescriptionChange:g,onApiTypeChange:m,onApiKeyChange:p,onBaseUrlChange:h,onApiKeyVisibleChange:f}})(e),j=o.useMemo((()=>e=>{if(!e)return;const{label:t,apiType:a}=e;b({label:t,apiType:a})}),[b]),A=o.useMemo((()=>s.jsx("div",{className:"flex-column",children:Object.entries(Ol).filter((([e,t])=>t.length>0)).map((([e,t])=>s.jsxs("div",{className:"flex-row margin-bottom-5",children:[s.jsxs("span",{className:"flex-shrink-0",children:[Q(e)," models:  "]}),s.jsx("a",{href:t,target:"_blank",rel:"noreferrer",className:"text-truncate",children:t})]},e)))})),[]),N=`model-name-input-${t}`,T=`model-api-type-select-${t}`,S=`model-api-key-input-${t}`,M=`model-base-url-input-${t}`;return s.jsxs("div",{className:"flex-column",children:[s.jsxs("div",{className:"info margin-bottom-10",children:["You can select one of the predefined models from the list below or manually enter the model name and type. In the latter case, make sure that the model's name is a valid name (based on the provider). You can use the ",s.jsx("strong",{children:"Test"})," button to check if the model parameters are correct, but model credits might be used for this test (depending on the provider). ",s.jsx("br",{}),s.jsx("strong",{children:"Note"}),' that if testing the model fails with a "Failed to load" message (for example a NIM model), it doesn\'t mean that the configuration is not correct (it could be a browser/CORS issue).',s.jsx(go,{title:"Useful Links",expanded:!1,fullWidth:!0,className:"transparent color-info no-padding margin-top-5 margin-bottom-5",contentClassName:"background-info",children:A})]}),s.jsx(td,{ref:f,onChange:j}),s.jsxs("div",{className:"margin-top-10",children:[s.jsx("label",{htmlFor:N,children:"Name:"}),s.jsx("div",{className:"margin-top-10"}),s.jsx("input",{id:N,type:"text",value:n||"",onChange:x,title:"Model name","data-testid":"model-name-input",className:"full-width","aria-label":"Model name"})]}),s.jsxs("div",{className:"margin-top-0",children:[s.jsx(mo,{htmlFor:`model-type-${t}`,label:"Model Type:",info:"API type to use for the model. Use 'other' for custom openai compatible models"}),s.jsx("label",{htmlFor:T,className:"hidden",children:"Model Type:"}),s.jsx($s,{options:p,value:{label:d,value:i},onChange:C,inputId:T,"aria-label":"Model API type",className:"full-width"})]}),"bedrock"!==i&&s.jsxs("div",{className:"margin-top-0",children:[s.jsx(mo,{label:"API Key:",info:c,htmlFor:S}),s.jsxs("div",{className:"flex full-width",children:[s.jsx("input",{id:S,className:"flex-1 margin-right-10",type:m?"text":"password",value:r||"",placeholder:u,onChange:w,"data-testid":"model-api-key-input","aria-label":"API key"}),s.jsx("button",{type:"button",className:"toggle-visibility-btn",onClick:v,title:m?"Hide API key":"Show API key","aria-label":m?"Hide API key":"Show API key","data-testid":`visibility-apiKey-model-${t}`,children:m?s.jsx(y.FaEyeSlash,{}):s.jsx(y.FaEye,{})})]})]}),s.jsxs("div",{className:"margin-top-0",children:[s.jsx(mo,{label:"Base URL:",info:"Model's base URL (including version)",htmlFor:M}),g?s.jsx("input",{id:M,title:"Model base URL",type:"text",value:l||"",onChange:k,"data-testid":"model-base-url-input",className:"full-width","aria-label":"Base URL"}):s.jsx("input",{id:M,type:"text",title:"Model base URL",readOnly:!0,disabled:!0,value:h,"data-testid":"model-base-url-input-read-only",className:"full-width","aria-label":"Base URL (read-only)"})]})]})}));ad.displayName="WaldiezNodeModelModalBasicTab";const nd=o.memo((e=>{var t,a;const{modelId:n,data:i}=e,{onPricePromptChange:r,onPriceCompletionChange:l}=(e=>{var t,a;const{data:n,onDataChange:s}=e;return{onPricePromptChange:o.useCallback((e=>{var t;const a=parseFloat(e.target.value);if(isNaN(a))return;const o=(null==(t=n.price)?void 0:t.completionTokenPricePer1k)??null;s({price:{completionTokenPricePer1k:o,promptPricePer1k:a>=0?a:null}})}),[null==(t=n.price)?void 0:t.completionTokenPricePer1k,s]),onPriceCompletionChange:o.useCallback((e=>{var t;const a=parseFloat(e.target.value);if(isNaN(a))return;const o=(null==(t=n.price)?void 0:t.promptPricePer1k)??null;s({price:{completionTokenPricePer1k:a>=0?a:null,promptPricePer1k:o}})}),[null==(a=n.price)?void 0:a.promptPricePer1k,s])}})(e),d=o.useMemo((()=>{var e;return null!==(null==(e=i.price)?void 0:e.promptPricePer1k)?i.price.promptPricePer1k:-1}),[null==(t=i.price)?void 0:t.promptPricePer1k]),c=o.useMemo((()=>{var e;return null!==(null==(e=i.price)?void 0:e.completionTokenPricePer1k)?i.price.completionTokenPricePer1k:-1}),[null==(a=i.price)?void 0:a.completionTokenPricePer1k]),u=`model-modal-price-prompt-${n}`,g=`model-modal-price-completion-${n}`,m=`price-prompt-${n}`,p=`price-completion-${n}`;return s.jsx("div",{className:"flex-column",children:s.jsxs("div",{className:"model-price",children:[s.jsx(mo,{label:"Price:",info:"Price in USD ($). Use 0 if it's free, -1 to skip setting a value",htmlFor:"prompt-price-inputs"}),s.jsxs("div",{className:"flex-column margin-left-10 margin-bottom-10 padding-left-10",children:[s.jsxs("div",{className:"flex-column margin-bottom-10",children:[s.jsx("label",{htmlFor:m,children:"Prompt price per 1K tokens:"}),s.jsx("input",{id:m,title:"Prompt price per 1K tokens",type:"number",min:"-1",step:"0.0001",className:"number-max-width",value:d,onChange:r,"data-testid":u,"aria-label":"Prompt price per 1000 tokens"})]}),s.jsxs("div",{className:"flex-column",children:[s.jsx("label",{htmlFor:p,children:"Completion price per 1K tokens:"}),s.jsx("input",{id:p,title:"Completion price per 1K tokens",type:"number",min:"-1",step:"0.0001",className:"number-max-width",value:c,onChange:l,"data-testid":g,"aria-label":"Completion price per 1000 tokens"})]})]})]})})}));nd.displayName="WaldiezNodeModelModalPriceTab";const sd=e=>{const{modelId:t,data:a,isOpen:n,isDirty:i,importExportView:r,onDataChange:l,onLogoChange:d,onClose:c,onSave:u,onSaveAndClose:g,onTest:m,onCancel:p}=e,[h,f]=o.useState(0);return o.useEffect((()=>{f(0)}),[n]),s.jsx(Eo,{beforeTitle:r,title:a.label,dataTestId:`model-modal-${t}`,isOpen:n,onClose:c,onSaveAndClose:g,hasUnsavedChanges:i,preventCloseIfUnsavedChanges:!0,children:s.jsxs("div",{className:"modal-body",children:[s.jsxs(pi,{activeTabIndex:h,children:[s.jsx(mi,{label:"Basic",id:`model-config-basic-${t}`,children:s.jsx("div",{className:"model-panel",children:s.jsx(ad,{id:t,data:a,onDataChange:l,onLogoChange:d})})}),"bedrock"===a.apiType&&s.jsx(mi,{label:"AWS",id:`model-config-aws-${t}`,children:s.jsx("div",{className:"model-panel",children:s.jsx(ed,{data:a,onDataChange:l})})}),s.jsx(mi,{label:"Advanced",id:`model-config-advanced-${t}`,children:s.jsx("div",{className:"model-panel",children:s.jsx(_l,{data:a,onDataChange:l})})}),s.jsx(mi,{label:"Price",id:`model-config-price-${t}`,children:s.jsx("div",{className:"model-panel",children:s.jsx(nd,{modelId:t,data:a,onDataChange:l})})})]}),s.jsxs("div",{className:"modal-actions",children:[s.jsx("button",{type:"button",title:"Cancel",className:"modal-action-cancel",onClick:p,"data-testid":`modal-cancel-btn-${t}`,children:"Cancel"}),s.jsxs("div",{className:"flex-row",children:[s.jsx("button",{type:"button",title:"Test",className:"margin-right-10 neutral",onClick:m,"data-testid":`modal-test-btn-${t}`,disabled:i,children:"Test"}),s.jsx("button",{title:"Save & Close",type:"button",className:"save margin-right-10",onClick:g,"data-testid":`modal-submit-and-close-btn-${t}`,disabled:!i,children:"Save & Close"}),s.jsx("button",{type:"button",title:"Save",className:"modal-action-submit",onClick:u,"data-testid":`modal-submit-btn-${t}`,disabled:!i,children:"Save"})]})]})]})})},od=(e,t)=>{const a=us((e=>e.flowId)),n=us((e=>e.updateToolData)),s=us((e=>e.cloneTool)),i=us((e=>e.deleteTool)),r=us((e=>e.getToolById)),l=us((e=>e.importTool)),d=us((e=>e.exportTool)),c=us((e=>e.onFlowChanged)),{isDark:u}=ga(),[g,m]=o.useState(!1),[p,h]=o.useState(t),[f,y]=o.useState(!1),b=o.useMemo((()=>(e=>{const t=new Date(e);return t.toLocaleDateString()+" "+t.toLocaleTimeString()})(t.updatedAt)),[t.updatedAt]);o.useEffect((()=>{h(t),y(!1)}),[t]);const v=o.useCallback((()=>{m(!0),y(!1)}),[]),x=o.useCallback((()=>{g||(s(e),c())}),[g,s,e,c]),C=o.useCallback((()=>{i(e),y(!1),c()}),[i,e,c]),w=o.useCallback((()=>{h(t),m(!1),y(!1)}),[t]),k=o.useCallback((e=>{h((a=>{const n={...a,...e};return y(!Pr(n,t)),n}))}),[t]),j=o.useCallback((async()=>{await W(t.label,"tool",(()=>d(e,!0)))}),[t.label,d,e]),A=o.useCallback(((a,n)=>{const s=l(n,e,null==a?void 0:a.position,!1);h(s.data),y(!Pr(t,s.data))}),[l,e,t]),N=o.useCallback((t=>{G(t,(e=>r(e)).bind(null,e),A)}),[r,e,A]),T=o.useCallback((()=>{n(e,p);const t=r(e);(null==t?void 0:t.data)&&h(t.data),y(!1),c()}),[n,e,p,r,c]),S=o.useCallback((()=>{T(),m(!1)}),[T]);return{flowId:a,isModalOpen:g,isDirty:f,toolData:p,isDark:u,updatedAt:b,onOpen:v,onClone:x,onDelete:C,onCancel:w,onSave:T,onSaveAndClose:S,onChange:k,onExport:j,onImport:N}},id=e=>{const{data:t,onDataChange:a}=e;return{onUpdateSecrets:o.useCallback((e=>{a({secrets:e})}),[a]),onDeleteSecret:o.useCallback((e=>{const{[e]:n,...s}=t.secrets;a({secrets:s})}),[t.secrets,a]),onAddSecret:o.useCallback(((e,n)=>{a({secrets:{...t.secrets,[e]:n}})}),[t.secrets,a]),onToolContentChange:o.useCallback((e=>{e&&a({content:e})}),[a]),onToolLabelChange:o.useCallback((e=>{a({label:e.target.value})}),[a]),onToolDescriptionChange:o.useCallback((e=>{a({description:e.target.value})}),[a]),onToolTypeChange:o.useCallback((e=>{a({toolType:e,content:Te[e]})}),[a]),onAddTag:o.useCallback((e=>{a({tags:[...t.tags,e]})}),[t.tags,a]),onDeleteTag:o.useCallback((e=>{a({tags:t.tags.filter((t=>t!==e))})}),[t.tags,a]),onTagChange:o.useCallback(((e,n)=>{a({tags:t.tags.map((t=>t===e?n:t))})}),[t.tags,a]),onAddRequirement:o.useCallback((e=>{a({requirements:[...t.requirements,e]})}),[t.requirements,a]),onDeleteRequirement:o.useCallback((e=>{a({requirements:t.requirements.filter((t=>t!==e))})}),[t.requirements,a]),onRequirementChange:o.useCallback(((e,n)=>{a({requirements:t.requirements.map((t=>t===e?n:t))})}),[t.requirements,a])}},rd=e=>{const{data:t}=e,{onUpdateSecrets:a,onDeleteSecret:n,onAddSecret:i,onAddRequirement:r,onDeleteRequirement:l,onRequirementChange:d,onAddTag:c,onDeleteTag:u,onTagChange:g}=id(e),m=o.useMemo((()=>s.jsxs("div",{children:["Requirements to ",s.jsx("span",{className:"bold italic",children:"pip install"})," for this tool"]})),[]);return s.jsxs(s.Fragment,{children:[s.jsx(po,{viewLabel:"Environment Variables:",items:t.secrets,itemsType:"tool-secret",onUpdate:a,onDelete:n,onAdd:i,areValuesSecret:!0}),s.jsx(gi,{viewLabel:"Requirements:",viewLabelInfo:m,placeholder:"Add a requirement...",items:t.requirements,itemsType:"tool-requirements",onItemAdded:r,onItemDeleted:l,onItemChange:d}),s.jsx(gi,{viewLabel:"Tags:",placeholder:"Add a tag...",items:t.tags,itemsType:"tool-tags",onItemAdded:c,onItemDeleted:u,onItemChange:g})]})},ld=[{value:"shared",label:"Shared"},{value:"custom",label:"Custom"},{value:"langchain",label:"Langchain"},{value:"crewai",label:"CrewAI"}],dd=o.memo((e=>{const{toolId:t,data:a,darkMode:n}=e,{onToolContentChange:i,onToolLabelChange:r,onToolDescriptionChange:l,onToolTypeChange:d}=id(e),c=o.useMemo((()=>ld.find((e=>e.value===a.toolType))||ld[0]),[a.toolType]),u=o.useCallback((e=>{e&&d(e.value)}),[d]),g=`tool-type-select-${t}`,m=`tool-label-input-${t}`,p=`tool-description-input-${t}`,h=`tool-content-editor-${t}`;return s.jsxs("div",{className:"flex-column",children:[s.jsx("div",{className:"info margin-bottom-10",children:"Enter the tool details below. You can follow the instructions for each tool type in the comments of the content editor."}),s.jsxs("div",{className:"margin-bottom-10",children:[s.jsx("label",{htmlFor:g,children:"Type:"}),s.jsx("div",{className:"margin-top-10"}),s.jsx($s,{inputId:g,options:ld,value:c,onChange:u,"data-testid":g,"aria-label":"Tool type"})]}),s.jsxs("div",{className:"margin-bottom-10",children:[s.jsx("label",{htmlFor:m,children:"Name:"}),s.jsx("div",{className:"margin-top-10"}),s.jsx("input",{title:"Name",type:"text",value:a.label||"","data-testid":m,id:m,onChange:r,className:"full-width","aria-label":"Tool name"})]}),s.jsxs("div",{className:"margin-bottom-10",children:[s.jsx("label",{htmlFor:p,children:"Description:"}),s.jsx("div",{className:"margin-top-10"}),s.jsx(yo,{title:"Description",rows:2,value:a.description||"","data-testid":p,id:p,onChange:l,className:"full-width","aria-label":"Tool description"})]}),s.jsxs("div",{children:[s.jsx("label",{htmlFor:h,children:"Content:"}),s.jsx("div",{className:"margin-top-10"}),s.jsx(fo,{value:a.content||"",onChange:i,darkMode:n,"aria-label":"Tool content","data-testid":h})]})]})}));dd.displayName="WaldiezToolBasicTab";const cd=e=>{const{toolId:t,flowId:a,data:n,isModalOpen:i,isDirty:r,onClose:l,onCancel:d,onSave:c,onSaveAndClose:u,onImport:g,onExport:m}=e,p=Sl(a,t,"tool",g,m),[h,f]=o.useState(0);return o.useEffect((()=>{f(0)}),[i]),s.jsxs(Eo,{beforeTitle:p,title:n.label,isOpen:i,onSaveAndClose:u,onClose:l,hasUnsavedChanges:r,preventCloseIfUnsavedChanges:!0,children:[s.jsx("div",{className:"modal-body",children:s.jsxs(pi,{activeTabIndex:h,children:[s.jsx(mi,{label:"Basic",id:`tool-basic-tab-${t}`,children:s.jsx("div",{className:"tool-panel",children:s.jsx(dd,{...e})})}),s.jsx(mi,{label:"Advanced",id:`tool-advanced-tab-${t}`,children:s.jsx("div",{className:"tool-panel",children:s.jsx(rd,{...e})})})]})}),s.jsxs("div",{className:"modal-actions",children:[s.jsx("button",{type:"button",title:"Cancel",className:"modal-action-cancel",onClick:d,"data-testid":`modal-cancel-btn-${t}`,children:"Cancel"}),s.jsx("button",{title:"Save & Close",type:"button",className:"modal-action-submit margin-right-10 ",onClick:u,"data-testid":`modal-submit-and-close-btn-${t}`,disabled:!r,children:"Save & Close"}),s.jsx("button",{title:"Save",type:"button",className:"modal-action-submit",onClick:c,"data-testid":`modal-submit-btn-${t}`,disabled:!r,children:"Save"})]})]})},ud={chat:Ar,hidden:Sr,nested:Nr,group:Tr},gd={agent:e=>{const{id:t,data:a,selected:n}=e,r=a.agentType,{edge:l,flowId:d,isReadOnly:c,isNodeModalOpen:u,isEdgeModalOpen:g,isModalOpen:m,isDragging:p,onDragOver:h,onDragLeave:f,onDrop:b,onDelete:x,onClone:C,onOpenNodeModal:w,onCloseNodeModal:k,onOpenEdgeModal:j,onCloseEdgeModal:A,onEdgeConnection:N}=(e=>{const t=us((e=>e.getEdgeById)),a=us((e=>e.addEdge)),n=us((e=>e.deleteAgent)),s=us((e=>e.cloneAgent)),i=us((e=>e.onFlowChanged)),r=us((e=>e.flowId)),l=us((e=>e.isReadOnly)),d=o.useMemo((()=>!0===l),[l]),[c,u]=o.useState(!1),[g,m]=o.useState(!1),[p,h]=o.useState(null),[f,y]=o.useState(!1),b=o.useMemo((()=>c||g),[c,g]),v=o.useCallback((()=>{!0===d||b||(n(e),i())}),[d,b,n,e,i]),x=o.useCallback((()=>{!0===d||b||(s(e),i())}),[d,b,s,e,i]),C=o.useCallback((()=>{d||u(!0)}),[d]),w=o.useCallback((()=>{u(!1)}),[]),k=o.useCallback((e=>{if(!d&&!c&&!g){const a=e.currentTarget.getAttribute("data-edge-id");if(a){const e=t(a);e&&(h(e),m(!0))}}}),[d,c,g,t]),j=o.useCallback((()=>{m(!1),h(null)}),[]),A=o.useCallback((e=>{if(!d&&!c){const t=a({flowId:r,connection:e,hidden:!1});h(t)}}),[d,c,a,r]),N=o.useCallback((e=>{e.preventDefault(),e.stopPropagation(),y(!0)}),[]),T=o.useCallback((e=>{e.preventDefault(),e.stopPropagation(),y(!1)}),[]),S=o.useCallback((e=>{y(!1)}),[]);return{flowId:r,edge:p,isNodeModalOpen:c,isEdgeModalOpen:g,isModalOpen:b,isReadOnly:d,isDragging:f,onDelete:v,onClone:x,onOpenNodeModal:C,onCloseNodeModal:w,onOpenEdgeModal:k,onCloseEdgeModal:j,onEdgeConnection:A,onDragOver:N,onDragLeave:T,onDrop:S}})(t),T=o.useMemo((()=>{let e=m?"nodrag nowheel ":"";return a.parentId?e+=`agent-node ${r} group-member`:e+=`agent-node ${r}`,"group_manager"===r&&(e+=" flex-column flex-1",p&&(e+=" dragging")),e}),[m,a.parentId,r,p]),S=o.useMemo((()=>a.parentId?"group-member ":"group_manager"===r?"group-manager ":""),[a.parentId,r]),M=o.useMemo((()=>"group_manager"===r?Il.minWidth:El.minWidth),[r]),I=o.useMemo((()=>"group_manager"===r?Il.minHeight:El.minHeight),[r]),E=ca[r];return s.jsxs("div",{className:T,"data-testid":`agent-node-${t}-view`,onDragOver:h,onDragLeave:f,onDrop:b,children:[s.jsx(i.NodeResizer,{color:oa[r],minWidth:M,minHeight:I,handleStyle:{color:oa[r],borderColor:oa[r]},handleClassName:r}),!c&&!p&&n&&s.jsxs("div",{className:`agent-actions ${r}`,"data-testid":`agent-actions-${t}`,children:[s.jsx(v.FaTrash,{role:"button",onClick:x,title:"Delete Agent",className:"delete-icon clickable margin-right-20","aria-label":"Delete Agent"}),"group_manager"!==a.agentType&&s.jsx(y.FaCopy,{role:"button",onClick:C,title:"Clone Agent",className:"copy-icon margin-right-20 clickable","aria-label":"Clone Agent"}),s.jsx(v.FaGear,{role:"button",className:"clickable cog-icon",onClick:w,"aria-label":"Open Settings",title:"Open Settings"})]}),s.jsxs("div",{className:"agent-main",children:[s.jsxs("div",{className:"agent-top",children:[s.jsxs("div",{className:"agent-icon-with-label",children:[s.jsx("img",{className:"agent-icon-image",src:E,alt:"Agent"}),s.jsx("div",{className:"agent-icon-label",children:a.label})]}),s.jsx(Kr,{flowId:d,id:t,data:a,isModalOpen:m,isReadOnly:c,onOpenModal:w})]}),Zr({agentType:r,id:t,handleClassNameBase:S,selected:n,onEdgeConnection:N}),s.jsx("button",{title:"Open Node Modal",type:"button","data-node-id":t,"data-testid":`open-agent-node-modal-${t}`,className:"hidden",onClick:w}),s.jsx("button",{title:"Open Edge Modal",type:"button","data-testid":`open-edge-modal-node-${t}`,className:"hidden",onClick:j,"data-edge-node-id":t,"data-edge-id":""}),l&&g&&!u&&s.jsx(Gr,{isOpen:g,edgeId:l.id,onClose:A}),u&&!g&&s.jsx(Ml,{id:t,data:a,isOpen:u,onClose:k})]})]})},model:({id:e,data:t})=>{const{flowId:a,isOpen:n,isDirty:o,logo:i,modelData:r,setLogo:l,onOpen:d,onImport:c,onExport:u,onDataChange:g,onDelete:m,onClone:p,onSave:h,onSaveAndClose:f,onCancel:y,onCheck:b}=$l(e,t),x=Sl(a,e,"model",c,u);return s.jsxs("div",{className:n?"model-node nodrag nowheel":"model-node nodrag",children:[s.jsxs("div",{className:"model-header",children:[s.jsx("div",{role:"button",title:"Edit",className:"clickable","data-node-id":e,"data-testid":`open-model-node-modal-${e}`,onClick:d,children:s.jsx(v.FaGear,{})}),s.jsx("div",{id:`node-label-${e}`,className:"node-label","data-testid":`node-label-${e}`,children:t.label}),s.jsx("div",{className:`model-logo ${t.apiType}`,children:s.jsx("img",{src:i,alt:"logo"})})]}),s.jsxs("div",{className:"model-footer","data-testid":`model-footer-${e}`,children:[s.jsx("div",{role:"button",title:"Delete",className:"clickable",id:`delete-node-${e}`,"data-testid":`delete-node-${e}`,onClick:m,children:s.jsx(v.FaTrashCan,{})}),s.jsxs("div",{className:"flex",children:[s.jsx("div",{role:"button",title:"Check",className:"clickable margin-right-10",id:`test-model-${e}`,"data-testid":`test-model-${e}`,onClick:b,children:s.jsx(Dl,{fontSize:"1.1em"})}),s.jsx("div",{role:"button",title:"Clone",className:"clickable",id:`clone-node-${e}`,"data-testid":`clone-node-${e}`,onClick:p,children:s.jsx(v.FaCopy,{})})]})]}),s.jsx(sd,{modelId:e,data:r,isOpen:n,isDirty:o,importExportView:x,onLogoChange:l,onDataChange:g,onClose:y,onCancel:y,onSave:h,onTest:b,onSaveAndClose:f})]})},tool:e=>{const{id:t}=e,{flowId:a,isModalOpen:n,isDirty:o,toolData:i,isDark:r,onOpen:l,onClone:d,onDelete:c,onCancel:u,onSave:g,onSaveAndClose:m,onChange:p,onExport:h,onImport:f}=od(e.id,e.data);return s.jsxs("div",{className:n?"tool-node nodrag nowheel":"tool-node nodrag",children:[s.jsxs("div",{className:"tool-header",children:[s.jsx("div",{role:"button",title:"Edit",className:"clickable","data-node-id":t,"data-testid":`open-tool-node-modal-${t}`,onClick:l,children:s.jsx(v.FaGear,{})}),s.jsx("div",{"data-testid":`node-label-${t}`,className:"node-label",children:i.label})]}),s.jsx("div",{className:"tool-content",children:s.jsx("div",{className:"description","data-test-id":`node-description-${t}`,children:i.description})}),s.jsxs("div",{className:"tool-footer","data-testid":`tool-footer-${t}`,children:[s.jsx("div",{role:"button",title:"Delete",className:"clickable",id:`delete-node-${t}`,"data-testid":`delete-node-${t}`,onClick:c,children:s.jsx(v.FaTrashCan,{})}),s.jsx("div",{role:"button",title:"Clone",className:"clickable",id:`clone-node-${t}`,"data-testid":`clone-node-${t}`,onClick:d,children:s.jsx(v.FaCopy,{})})]}),s.jsx(cd,{toolId:t,flowId:a,data:i,isModalOpen:n,darkMode:r,isDirty:o,onClose:u,onCancel:u,onSave:g,onSaveAndClose:m,onDataChange:p,onImport:f,onExport:h})]})}},md=({children:e,collapsed:t})=>{const a="boolean"==typeof t?t:hd(),[n,i]=o.useState(a);o.useEffect((()=>{pd(n)}),[n]);return s.jsx(fd.Provider,{value:{isCollapsed:n,toggleSidebar:()=>{i((e=>!e))}},children:e})},pd=e=>{e?(document.body.classList.add("waldiez-sidebar-collapsed"),document.body.classList.remove("waldiez-sidebar-expanded")):(document.body.classList.add("waldiez-sidebar-expanded"),document.body.classList.remove("waldiez-sidebar-collapsed"))},hd=()=>!!document.body.classList.contains("waldiez-sidebar-collapsed")||!document.body.classList.contains("waldiez-sidebar-expanded")&&window.innerWidth<768,fd=o.createContext(void 0),yd=e=>{const{isOpen:t,onClose:a}=e,n=us((e=>e.getFlowInfo)),s=us((e=>e.updateFlowInfo)),i=us((e=>e.updateFlowOrder)),r=us((e=>e.updateFlowPrerequisites)),l=n(),{name:d,description:c,requirements:u,tags:g,isAsync:m,cacheSeed:p}=l,[h,f]=o.useState({name:d,description:c,requirements:u,tags:g,isAsync:m,cacheSeed:p}),[y,b]=o.useState(null),v=us((e=>e.getFlowEdges)),{used:x,remaining:C}=v(),w=us((e=>e.onFlowChanged)),[k,j]=o.useState(x),[A,N]=o.useState(C),T=!Pr(h,{name:d,description:c,requirements:u,tags:g,isAsync:m,cacheSeed:p}),S=!Pr(k,x),[M,I]=o.useState(T||S),E=o.useCallback((()=>{const{name:e,description:t,requirements:a,tags:s,isAsync:o,cacheSeed:i}=n();f({name:e,description:t,requirements:a,tags:s,isAsync:o,cacheSeed:i});const{used:r,remaining:l}=v();j(r),N(l),I(!1)}),[v,n]);o.useEffect((()=>{E()}),[t,E]);const D=e=>e.map(((t,a)=>{if(0===a)return{...t,data:{...t.data,order:0,prerequisites:[]}};const n=e[a-1];return{...t,data:{...t.data,order:a,prerequisites:[n.id]}}}));return{flowData:h,isOpen:t,sortedEdgesState:k,remainingEdgesState:A,selectedNewEdge:y,isDirty:M,onClose:a,onSubmit:()=>{if(s(h),h.isAsync)r(k);else{const e=k.map(((e,t)=>({id:e.id,order:t}))).concat(A.map((e=>({id:e.id,order:-1}))));i(e)}w(),I(!1)},onCancel:()=>{E(),a()},onDataChange:e=>{const t=!Pr({...h,...e},{name:d,description:c,requirements:u,tags:g,isAsync:m,cacheSeed:p}),a=!Pr(k,x);f({...h,...e}),I(t||a)},onSelectedNewEdgeChange:e=>{e&&b(e.value)},onAddEdge:()=>{if(y&&A.find((e=>e.id===y.id))){const e=(()=>{var e,t;let a=null==(t=null==(e=k[k.length-1])?void 0:e.data)?void 0:t.order;return void 0===a?a=k.length:a++,a<0&&(a=0),a})(),t={...y,data:{...y.data,order:e}};j([...k,t]),N(A.filter((e=>e.id!==y.id))),b(null),I(!0)}},onRemoveEdge:e=>{1!==k.length&&k.find((t=>t.id===e.id))&&(j(k.filter((t=>t.id!==e.id))),N([...A,{...e,data:{...e.data,order:-1,prerequisites:[]}}]),I(!0))},onMoveEdgeUp:e=>{if(k.find((t=>t.id===k[e].id))){const t=k[e-1],a=k[e],n=k.slice();n[e-1]=a,n[e]=t,j(D(n)),I(!0)}},onMoveEdgeDown:e=>{var t,a;if(k.find((t=>t.id===k[e].id))){const n=k[e+1],s=null==(t=n.data)?void 0:t.order,o=k[e],i=null==(a=o.data)?void 0:a.order,r=k.slice();r[e+1]={...o,data:{...o.data,order:s}},r[e]={...n,data:{...n.data,order:i}},j(D(r)),I(!0)}},onPrerequisitesChange:(e,t)=>{const a=k.map((a=>a.id===e.id?{...a,data:{...a.data,prerequisites:t}}:a));j(a),I(!0)}}},bd=e=>{var t;const{sortedEdges:a,remainingEdges:n,selectedNewEdge:o,onSelectedNewEdgeChange:i,onAddEdge:r,onRemoveEdge:l,onPrerequisitesChange:d}=e,c=(e,t)=>{if(t){const a=t.map((e=>e.value.id));d(e,a)}else d(e,[])};return s.jsxs("div",{className:"flow-chat-prerequisites-wrapper",children:[s.jsx("div",{className:"info",children:"Specify the chats to run when the flow initializes and their prerequisites (if more than one). You should remove the ones that are expected to be triggered during the flow (like in nested chats)."}),a.map(((e,t)=>{var n,o;return s.jsxs("div",{className:"flow-chat-prerequisites",children:[s.jsx("div",{className:"flow-chat-prerequisite-source",children:s.jsx("span",{children:null==(n=e.data)?void 0:n.label})}),a.length>1&&s.jsxs("div",{className:"flow-chat-prerequisite-actions",children:[s.jsx("label",{htmlFor:"chat-pre-requisites-select",children:"Prerequisites:"}),s.jsx($s,{placeholder:"Select prerequisites...",options:a.filter((t=>t.id!==e.id)).map((e=>{var t;return{value:e,label:null==(t=e.data)?void 0:t.label}})),value:null==(o=e.data)?void 0:o.prerequisites.map((e=>{var t;const n=a.find((t=>t.id===e));return n?{value:n,label:null==(t=n.data)?void 0:t.label}:[]})),onChange:c.bind(null,e),isMulti:!0,inputId:"chat-pre-requisites-select"}),a.length>1&&s.jsx("div",{className:"flow-chat-remove",children:a.length>1&&s.jsx("button",{type:"button",title:"Remove",className:"flow-order-item-action","data-testid":`remove-edge-button-${t}`,onClick:l.bind(null,e),children:"Remove"})})]})]},e.id)})),n.length>0&&s.jsxs("div",{className:"flow-order-add-wrapper",children:[s.jsxs("div",{className:"flex-1 margin-right-10",children:[s.jsx("label",{htmlFor:"new-edge-select",className:"hidden",children:"Add new chat"}),s.jsx($s,{options:n.map((e=>{var t;return{value:e,label:null==(t=e.data)?void 0:t.label}})),value:o?{value:o,label:null==(t=o.data)?void 0:t.label}:null,onChange:i,inputId:"new-edge-select"})]}),s.jsx("button",{type:"button",title:"Add chat",className:"flow-order-add-button",disabled:!o,onClick:r,"data-testid":"add-edge-to-flow-button",children:"Add"})]})]})},vd=e=>{var t;const{sortedEdges:a,remainingEdges:n,selectedNewEdge:o,onSelectedNewEdgeChange:i,onAddEdge:r,onRemoveEdge:l,onMoveEdgeUp:d,onMoveEdgeDown:c}=e;return s.jsxs("div",{className:"flow-chat-order-wrapper",children:[s.jsx("div",{className:"info",children:"Specify the chats to run when the flow initializes and their order (if more than one). You should remove the ones that are expected to be triggered during the flow (like in nested chats)."}),a.map(((e,t)=>{var n;return s.jsxs("div",{className:"flow-order-item-wrapper",children:[s.jsx("div",{className:"flow-order-item",children:s.jsx("span",{className:"flow-order-item-entry",children:null==(n=e.data)?void 0:n.label})}),a.length>1&&s.jsxs("div",{className:"flow-order-item-actions",children:[t>0&&a.length>1&&s.jsx("button",{type:"button",title:"Move up",className:"flow-order-item-action","data-testid":`move-edge-up-button-${t}`,onClick:d.bind(null,t),children:"↑"}),t<a.length-1&&s.jsx("button",{title:"Move down",type:"button",className:"flow-order-item-action","data-testid":`move-edge-down-button-${t}`,onClick:c.bind(null,t),children:"↓"}),a.length>1&&s.jsx("button",{type:"button",title:"Remove",className:"flow-order-item-action","data-testid":`remove-edge-button-${t}`,onClick:l.bind(null,e),children:"Remove"})]})]},e.id)})),n.length>0&&s.jsxs("div",{className:"flow-order-add-wrapper",children:[s.jsxs("div",{className:"flex-1 margin-right-10",children:[s.jsx("label",{htmlFor:"new-edge-select",className:"hidden",children:"Add new chat"}),s.jsx($s,{options:n.map((e=>{var t;return{value:e,label:null==(t=e.data)?void 0:t.label}})),value:o?{value:o,label:null==(t=o.data)?void 0:t.label}:null,onChange:i,inputId:"new-edge-select"})]}),s.jsx("button",{type:"button",title:"Add chat",className:"flow-order-add-button",disabled:!o,onClick:r,"data-testid":"add-edge-to-flow-button",children:"Add"})]})]})},xd=e=>{const{flowId:t,data:a,sortedEdges:n,remainingEdges:o,onDataChange:i}=e,{name:r,description:l,isAsync:d}=a,c=n.length+o.length;return s.jsxs("div",{className:"flex-column padding-left-10 padding-right-10",id:`rf-${t}-edit-flow-modal`,children:[s.jsx("label",{htmlFor:`rf-${t}-edit-flow-modal-name`,children:"Name"}),s.jsx("input",{type:"text",className:"margin-right--20 margin-top-5 margin-bottom-10",id:`rf-${t}-edit-flow-modal-name`,placeholder:"Flow name",value:r,onChange:e=>{const t=e.target.value;i({name:t})},"data-testid":`edit-flow-${t}-name-input`}),s.jsx("label",{htmlFor:`rf-${t}-edit-flow-modal-description`,children:"Description"}),s.jsx("div",{className:"margin-bottom-5"}),s.jsx(yo,{id:`rf-${t}-edit-flow-modal-description`,placeholder:"Flow description",rows:2,value:l,onChange:e=>{const t=e.target.value;i({description:t})},"data-testid":`edit-flow-${t}-description-input`}),s.jsx("div",{className:"margin-bottom-5"}),s.jsx(Js,{id:`edit-flow-${t}-modal-async-mode`,label:"Async Mode",isChecked:d,onCheckedChange:e=>{i({isAsync:e})}}),s.jsxs("div",{className:"margin-top-5 margin-left-5",children:["Chat order ",d&&"& prerequisites"," "]}),0===c?s.jsx("div",{className:"info",children:"No chats added to the flow yet."}):d?s.jsx(bd,{...e}):s.jsx(vd,{...e})]})},Cd=e=>{const{flowId:t,data:a,onDataChange:n}=e,{tags:o,requirements:i,cacheSeed:r}=a;return s.jsxs("div",{className:"padding-left-10 padding-right-10","data-testid":`edit-flow-${t}-modal-other-view`,children:[s.jsx(Js,{id:`edit-flow-${t}-modal-cache-seed-toggle`,label:"Disable cache",isChecked:"number"!=typeof r,onCheckedChange:e=>{n({cacheSeed:e?null:42})},"data-testid":`edit-flow-${t}-modal-cache-seed-toggle`}),"number"==typeof r&&s.jsxs("div",{className:"cache-seed-view flex",children:[s.jsx("div",{className:"margin-left-5 margin-right-5",children:" Cache seed:"}),s.jsx("input",{type:"number",step:1,placeholder:"42",value:r,onChange:e=>{try{const t=parseInt(e.target.value);n({cacheSeed:t})}catch(t){}},id:`edit-flow-${t}-cache-seed-input`,"data-testid":`edit-flow-${t}-cache-seed-input`})]}),s.jsx(gi,{items:i,itemsType:"requirement",viewLabel:"Additional Requirements",viewLabelInfo:()=>s.jsxs("div",{children:["Requirements to ",s.jsx("span",{className:"bold italic",children:"pip install"})," before running this flow"]}),onItemAdded:e=>{n({requirements:[...i,e]})},onItemDeleted:e=>{n({requirements:i.filter((t=>t!==e))})},onItemChange:(e,t)=>{n({requirements:i.map((a=>a===e?t:a))})}}),s.jsx(gi,{items:o,itemsType:"tag",viewLabel:"Tags",onItemAdded:e=>{n({tags:[...o,e]})},onItemDeleted:e=>{n({tags:o.filter((t=>t!==e))})},onItemChange:(e,t)=>{n({tags:o.map((a=>a===e?t:a))})}})]})},wd=e=>{const{flowId:t}=e,{flowData:a,isOpen:n,sortedEdgesState:o,remainingEdgesState:i,selectedNewEdge:r,isDirty:l,onClose:d,onSubmit:c,onCancel:u,onDataChange:g,onSelectedNewEdgeChange:m,onAddEdge:p,onRemoveEdge:h,onMoveEdgeUp:f,onMoveEdgeDown:y,onPrerequisitesChange:b}=yd(e),v=()=>{c(),d()};return s.jsx(Eo,{title:"Edit Flow",isOpen:n,onSaveAndClose:v,onClose:d,className:"edit-flow-modal",hasMaximizeBtn:!0,dataTestId:`edit-flow-modal-${t}`,hasUnsavedChanges:l,preventCloseIfUnsavedChanges:!0,children:s.jsxs("div",{className:"modal-body",children:[s.jsxs(pi,{activeTabIndex:0,children:[s.jsx(mi,{label:"Properties",id:`rf-${t}-edit-flow-modal`,children:s.jsx(xd,{flowId:t,data:a,remainingEdges:i,sortedEdges:o,selectedNewEdge:r,onPrerequisitesChange:b,onSelectedNewEdgeChange:m,onAddEdge:p,onRemoveEdge:h,onMoveEdgeUp:f,onMoveEdgeDown:y,onDataChange:g})}),s.jsx(mi,{label:"Other",id:`rf-${t}-edit-flow-modal-extras`,children:s.jsx(Cd,{flowId:t,data:a,onDataChange:g})})]}),s.jsxs("div",{className:"modal-actions",children:[s.jsx("button",{className:"modal-action-cancel",onClick:u,"data-testid":"edit-flow-cancel-button",type:"button",title:"Cancel",children:"Cancel"}),s.jsxs("div",{className:"flex-row",children:[s.jsx("button",{title:"Save & Close",type:"button",className:"primary save margin-right-10",onClick:v,"data-testid":`modal-submit-and-close-btn-${t}`,disabled:!l,children:"Save & Close"}),s.jsx("button",{type:"button",title:"Save",className:"modal-action-submit",onClick:c,"data-testid":"edit-flow-submit-button",disabled:!l,children:"Save"})]})]})]})})},kd=e=>{const{isReadonly:t}=e,{flowId:a,isEditModalOpen:n,isAgentsViewCollapsed:i,onOpenEditModal:r,onCloseEditModal:l,onShowAgents:d,onShowModels:c,onShowTools:u,onUserDragStart:g,onAssistantDragStart:m,onRagDragStart:p,onReasoningDragStart:h,onCaptainDragStart:f,onManagerDragStart:b}=(e=>{const{selectedNodeType:t,onSelectNodeType:a}=e,[n,s]=o.useState(!1),[i,r]=o.useState(!1),l=us((e=>e.flowId)),d=o.useCallback(((e,t,a)=>{e.dataTransfer.setData("application/node",t),"agent"===t&&a&&e.dataTransfer.setData("application/agent",a),e.dataTransfer.effectAllowed="move"}),[]),c=o.useCallback((()=>{"agent"!==t?(a("agent"),r(!1)):r((e=>!e))}),[t,a]),u=o.useCallback((()=>{a("model")}),[a]),g=o.useCallback((()=>{a("tool")}),[a]),m=o.useCallback((e=>{d(e,"agent","user_proxy")}),[d]),p=o.useCallback((e=>{d(e,"agent","assistant")}),[d]),h=o.useCallback((e=>{d(e,"agent","rag_user_proxy")}),[d]),f=o.useCallback((e=>{d(e,"agent","reasoning")}),[d]),y=o.useCallback((e=>{d(e,"agent","captain")}),[d]),b=o.useCallback((e=>{d(e,"agent","group_manager")}),[d]),v=o.useCallback((()=>{s(!0)}),[]),x=o.useCallback((()=>{s(!1)}),[]),C=o.useMemo((()=>({user_proxy:m,assistant:p,reasoning:f,captain:y,group_manager:b,rag_user_proxy:h})),[m,p,f,y,b,h]);return{flowId:l,isEditModalOpen:n,isAgentsViewCollapsed:i,onOpenEditModal:v,onCloseEditModal:x,onShowAgents:c,onShowModels:u,onShowTools:g,onUserDragStart:m,onRagDragStart:h,onAssistantDragStart:p,onReasoningDragStart:f,onCaptainDragStart:y,onManagerDragStart:b,agentDragHandlers:C}})(e),{isCollapsed:x,toggleSidebar:C}=(()=>{const e=o.useContext(fd);if(!e)throw new Error("useSidebar must be used within a SidebarProvider context");return e})();return s.jsxs("div",{className:"sidebar"+(t?" hidden":""),"data-testid":`sidebar-${a}`,style:{width:x?"40px":"200px"},children:[s.jsxs("div",{className:"sidebar-header",style:{justifyContent:x?"center":"space-between"},children:[!x&&s.jsx("div",{className:"title",children:"Waldiez"}),s.jsx("div",{className:"sidebar-toggle",onClick:C,role:"button","aria-hidden":"true","data-testid":"sidebar-toggle",children:s.jsx(v.FaBars,{className:"sidebar-toggle-button tooltip-container clickable",title:x?"Open sidebar":"Close sidebar","aria-hidden":"true"})})]}),s.jsxs("div",{className:"sidebar-content",children:[s.jsxs("ul",{children:[s.jsxs("li",{className:"clickable",id:`edit-flow-${a}-sidebar-button`,"data-testid":`edit-flow-${a}-sidebar-button`,onClick:r,title:"Edit flow",children:[s.jsx(y.FaEdit,{}),!x&&s.jsx("span",{children:"Edit flow"})]}),s.jsxs("li",{className:"clickable","data-node-type":"model","data-testid":"show-models",onClick:c,children:[s.jsx(N.AiFillOpenAI,{}),!x&&s.jsx("span",{children:"Models"})]}),s.jsxs("li",{className:"clickable","data-node-type":"tool","data-testid":"show-tools",onClick:u,children:[s.jsx(N.AiFillCode,{}),!x&&s.jsx("span",{children:"Tools"})]}),s.jsxs("li",{className:"clickable expandable","data-node-type":"agent","data-testid":"show-agents",onClick:d,children:[s.jsxs("div",{className:"flex",children:[s.jsx(v.FaRobot,{}),!x&&s.jsx("span",{children:"Agents"})]}),!x&&s.jsx("div",{className:"expand-icon",children:i?s.jsx(A.GoChevronDown,{}):s.jsx(A.GoChevronUp,{})})]})]}),!x&&!i&&s.jsxs(s.Fragment,{children:[s.jsx("div",{className:"dnd-description",children:s.jsx("p",{children:"Drag n' drop an agent to the canvas to add it to the flow"})}),s.jsxs("div",{className:"dnd-area","data-testid":"user-dnd",onDragStart:g,draggable:!0,children:[s.jsx("img",{src:ca.user_proxy,title:"User Proxy Agent"}),"User"]}),s.jsxs("div",{className:"dnd-area","data-testid":"assistant-dnd",onDragStart:m,draggable:!0,children:[s.jsx("img",{src:ca.assistant,title:"Assistant Agent"}),"Assistant"]}),s.jsxs("div",{className:"dnd-area","data-testid":"rag-dnd",onDragStart:p,draggable:!0,children:[s.jsx("img",{src:ca.rag_user_proxy,title:"RAG User Proxy Agent"}),"RAG User"]}),s.jsxs("div",{className:"dnd-area","data-testid":"reasoning-dnd",onDragStart:h,draggable:!0,children:[s.jsx("img",{src:ca.reasoning,title:"Reasoning Agent"}),"Reasoning"]}),s.jsxs("div",{className:"dnd-area","data-testid":"captain-dnd",onDragStart:f,draggable:!0,children:[s.jsx("img",{src:ca.captain,title:"Captain Agent"}),"Captain"]}),s.jsxs("div",{className:"dnd-area","data-testid":"group-manager-dnd",onDragStart:b,draggable:!0,children:[s.jsx("img",{src:ca.group_manager,title:"Group Manager Agent"}),"Group Manager"]})]})]}),s.jsx("div",{className:"spacer"}),n&&s.jsx(wd,{flowId:a,isOpen:n,onClose:l})]})},jd=o.memo((e=>{var t,a;const{flowId:n,skipExport:r,skipImport:l,skipHub:d,chat:c}=e,u=o.useRef(null),g=o.useRef("agent"),[m,p]=o.useState(!1),[h,f]=o.useState(!1),[y,b]=o.useState(!1),v=us((e=>e.nodes)),x=us((e=>e.edges)),C=us((e=>e.isReadOnly)),w=us((e=>e.viewport)),k=us((e=>e.addModel)),j=us((e=>e.addTool)),A=us((e=>e.onViewportChange)),N=us((e=>e.onFlowChanged)),T=us((e=>e.showNodes)),S=us((e=>e.onReconnect)),M=us((e=>e.onSave)),{isDark:I}=ga(),E=o.useMemo((()=>I?"dark":"light"),[I]),D=!0===C,{onKeyDown:R}=Gi(n,M),{convertToPy:P,convertToIpynb:O,exportFlow:L,onExport:z,onRun:F,onFlowInit:U,onNodesChange:q,onEdgesChange:B,onNodeDoubleClick:H,onEdgeDoubleClick:V}=(e=>{const t=us((e=>e.isReadOnly)),a=us((e=>e.skipImport)),n=us((e=>e.skipExport)),s=!0===t,i=us((e=>e.onRun)),r=us((e=>e.onConvert)),l=us((e=>e.setRfInstance)),d=us((e=>e.onNodesChange)),c=us((e=>e.onEdgesChange)),u=us((e=>e.onEdgeDoubleClick)),g=us((e=>e.onNodeDoubleClick)),m=us((e=>e.onFlowChanged)),p=us((e=>e.getAgents)),h=us((e=>e.getFlowEdges)),f=us((e=>e.getFlowInfo)),y=us((e=>e.exportFlow)),b=o.useCallback((t=>{const o=K(e),i=s||!0===a&&!0===n,r=t.getNodes().length>0||t.getEdges().length>0;if(o){if(i){const e=o.querySelector(".react-flow__controls-interactive");e&&e.click()}r?requestAnimationFrame((()=>{requestAnimationFrame((()=>{t.fitView({includeHiddenNodes:!1,padding:.2,duration:100}),l(t)}))})):(t.setViewport({x:0,y:0,zoom:1}),l(t))}else l(t)}),[e,s,a,n,l]),v=o.useCallback((e=>{s||d(e)}),[s,d]),x=o.useCallback((e=>{s||(c(e),m())}),[s,c,m]),C=o.useCallback(((e,t)=>{s||u(e,t)}),[s,u]),w=o.useCallback(((e,t)=>{if(s)return;const a=e.target;a instanceof Element&&"TEXTAREA"===a.tagName||g(e,t)}),[s,g]),k=o.useCallback((()=>{if(s)return!1;const t=p(),a=t.length;if(a<2)return is({flowId:e,message:(0===a?"No agents":"Only one agent")+" found in the flow",level:"error",details:void 0,duration:3e3}),!1;if(t.find((e=>"group_manager"===e.data.agentType)))return!0;const{used:n,remaining:o}=h();return n.length>0&&0===o.length}),[s,p,h,e]),j=o.useCallback((()=>{if(!s&&r){const e=m();r(JSON.stringify(e),"py")}}),[s,m,r]),A=o.useCallback((()=>{if(!s&&r){const e=m();r(JSON.stringify(e),"ipynb")}}),[s,m,r]),N=o.useCallback((()=>{if(!s&&"function"==typeof i)if(k()){const e=m();e&&i(JSON.stringify(e))}else{const t=`edit-flow-${e}-sidebar-button`,a=document.getElementById(t);a&&a.click()}}),[s,i,k,m,e]),T=o.useCallback((async t=>{if(s)return;const{name:a}=f();await W(a,"flow",(()=>y(!0,!1)),(()=>{is({flowId:e,message:"Could not export the flow",level:"error",details:void 0,duration:3e3})}))}),[s,f,y,e]);return o.useMemo((()=>({convertToPy:j,convertToIpynb:A,exportFlow:y,onExport:T,onRun:N,onFlowInit:b,onNodesChange:v,onEdgesChange:x,onNodeDoubleClick:w,onEdgeDoubleClick:C})),[j,A,y,T,N,b,v,x,w,C])})(n);o.useEffect((()=>{T("agent")}),[T]);const G=o.useCallback((e=>{g.current=e,p((e=>!e))}),[]),Q=o.useCallback((()=>{f(!0)}),[]),Z=o.useCallback((()=>{f(!1)}),[]),X=o.useCallback((()=>{b(!1)}),[]),J=o.useCallback((e=>{g.current!==e&&G(e),T(e)}),[G,T]),Y=o.useCallback((()=>{"model"===g.current?(k(),N()):"tool"===g.current&&(j(),N())}),[k,j,N]),$=o.useCallback((()=>{requestAnimationFrame((()=>{"agent"!==g.current&&(G("agent"),T("agent")),N()}))}),[G,T,N]),_=o.useCallback((e=>{A(e,g.current)}),[A]),ee=o.useCallback((async e=>{d?await z(e):b(!0)}),[d,z]),te=o.useCallback((()=>{const e=L(!0,!1);return JSON.stringify(e)}),[L]),{onDragOver:ae,onDrop:ne,onNodeDrag:se,onNodeDragStop:oe}=(e=>{const{screenToFlowPosition:t,getIntersectingNodes:a}=i.useReactFlow(),n=us((e=>e.addAgent)),s=us((e=>e.setAgentGroup)),r=us((e=>e.addGroupMember)),l=us((e=>e.getRfInstance)),d=us((e=>e.highlightNode)),c=us((e=>e.clearNodeHighlight)),u=o.useCallback((e=>{if("agent"!==e.dataTransfer.getData("application/node"))return;const t=e.dataTransfer.getData("application/agent");return me.includes(t)?t:void 0}),[]),g=o.useCallback((e=>{e.preventDefault(),e.dataTransfer.dropEffect="move",document.body.classList.add("dragging")}),[]),m=o.useCallback((e=>e.find((e=>"agent"===e.type&&"group_manager"===e.data.agentType))),[]),p=o.useCallback((e=>{const{x:t,y:n}=e,s={x:t,y:n,width:100,height:100};try{const e=a(s);if(e.length>0)return m(e)}catch(o){}}),[a,m]),h=o.useCallback((e=>{const t=l();if(!t)return;const a=t.getInternalNode(e.id);return(null==a?void 0:a.internals.positionAbsolute)?{x:a.internals.positionAbsolute.x,y:a.internals.positionAbsolute.y}:void 0}),[l]),f=o.useCallback(((e,a)=>{let n=t({x:e.clientX,y:e.clientY},{snapToGrid:!1});const s=a||p(n);if(s){const a=h(s);if(a){const s=t({x:e.clientX,y:e.clientY});n={x:s.x-a.x-50,y:s.y-a.y-50}}}return{position:n,parent:s}}),[t,p,h]),y=o.useCallback(((e,t)=>{const{position:a,parent:o}=f(e),i=n(t,a,null==o?void 0:o.id);return o&&(i.parentId=o.id,i.data.parentId=o.id,window.requestAnimationFrame((()=>{s(i.id,o.id)}))),i}),[f,n,s]),b=o.useCallback((t=>{document.body.classList.remove("dragging");const a=u(t);a&&(t.preventDefault(),y(t,a),e())}),[u,y,e]),v=o.useCallback(((e,t)=>{try{const e=a(t).filter((e=>"agent"===e.type&&"group_manager"===e.data.agentType));if(1===e.length)return e[0]}catch(n){}}),[a]),x=o.useCallback(((e,t)=>{if(t.parentId||"group_manager"===t.data.agentType)c();else{const a=v(e,t);a?d(a.id):c()}}),[v,d,c]),C=o.useCallback(((e,t)=>{if(!t.parentId&&"group_manager"!==t.data.agentType){const a=v(e,t);if(a){const{position:n}=f(e,a);r(a.id,t.id,n)}}c()}),[v,f,r,c]);return o.useMemo((()=>({onDragOver:g,onDrop:b,onNodeDrag:x,onNodeDragStop:C})),[g,b,x,C])})($),ie=o.useMemo((()=>v),[v]),re=o.useMemo((()=>x),[x]);return s.jsxs("div",{className:`flow-wrapper ${E}`,id:`rf-root-${n}`,"data-flow-id":n,"data-testid":`rf-root-${n}`,children:[s.jsxs("div",{className:"flow-main",children:[s.jsx(kd,{onSelectNodeType:J,selectedNodeType:g.current,isReadonly:D}),s.jsx("div",{className:"react-flow-wrapper","data-testid":`rf-wrapper-${n}`,ref:u,children:s.jsxs(i.ReactFlow,{id:n,nodeTypes:gd,edgeTypes:ud,onInit:U,nodes:ie,edges:re,onNodesChange:q,onEdgesChange:B,deleteKeyCode:[],onKeyDown:R,onNodeDoubleClick:H,onEdgeDoubleClick:V,onReconnect:S,colorMode:E,elevateNodesOnSelect:!0,elevateEdgesOnSelect:!0,snapToGrid:!0,defaultViewport:w,onDrop:ne,onDragOver:ae,onViewportChange:_,connectOnClick:!0,zoomOnDoubleClick:!1,noWheelClassName:"no-wheel",width:null==(t=u.current)?void 0:t.clientWidth,height:null==(a=u.current)?void 0:a.clientHeight,onNodeDrag:se,onNodeDragStop:oe,children:[s.jsx(i.Controls,{showInteractive:!0}),s.jsx(Cr,{flowId:n,skipExport:r,skipImport:l,skipHub:d,selectedNodeType:g.current,onAddNode:Y,onRun:F,onConvertToPy:P,onConvertToIpynb:O,onOpenImportModal:Q,onExport:ee}),s.jsx("div",{className:"hidden","data-testid":`drop-area-${n}`}),s.jsx(i.Background,{variant:i.BackgroundVariant.Dots})]})})]}),s.jsx(lr,{flowId:n,chat:c,isDarkMode:I}),h&&s.jsx(vr,{flowId:n,isOpen:h,onClose:Z,typeShown:g.current,onTypeShownChange:J}),y&&s.jsx(ur,{flowId:n,isOpen:y,onClose:X,onDownload:z,onExport:te})]})}));jd.displayName="WaldiezFlowView";const Ad=e=>{const t=e.flowId??`wf-${V()}`,a="boolean"==typeof e.skipImport&&e.skipImport,n="boolean"==typeof e.skipExport&&e.skipExport,c="boolean"==typeof e.skipHub&&e.skipHub,u=e.nodes??[],g=e.edges??[],m=e.readOnly??!1,{monacoVsPath:p,chat:h}=e;return o.useEffect((()=>{Td(),Sd(),window.localStorage.removeItem(`snackbar-${t}.lock`)}),[t]),o.useEffect((()=>{p&&d.loader.config({paths:{vs:p}})}),[p]),s.jsx(ds,{children:s.jsx(ya,{children:s.jsx(r.ErrorBoundary,{fallbackRender:Nd,children:s.jsx(l.HotkeysProvider,{initiallyActiveScopes:[t],children:s.jsx(i.ReactFlowProvider,{children:s.jsx(md,{children:s.jsx(Vi,{...e,flowId:t,nodes:u,edges:g,isReadOnly:m,skipImport:a,skipExport:n,children:s.jsx(jd,{flowId:t,skipImport:a,skipExport:n,skipHub:c,chat:h})})})})})})})})},Nd=e=>{const{error:t}=e;return s.jsx(ss,{error:t})},Td=()=>{const e=ma();pa(e)},Sd=()=>{if(!document.body.classList.contains("waldiez-sidebar-collapsed")&&!document.body.classList.contains("waldiez-sidebar-expanded")){window.matchMedia("(prefers-sidebar: collapsed)").matches?document.body.classList.add("waldiez-sidebar-collapsed"):document.body.classList.add("waldiez-sidebar-expanded")}};e.Waldiez=Ad,e.WaldiezChatMessageProcessor=z,e.default=Ad,e.exportFlow=(e,t=!0,a=!0)=>{const n=Xn.importFlow(e);return Xn.exportFlow(Xn.toReactFlow(n),t,a)},e.importFlow=e=>{const t=Xn.importFlow(e);return Xn.toReactFlow(t)},e.showSnackbar=is,Object.defineProperties(e,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})}));
